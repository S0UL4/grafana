{"ast":null,"code":"import { css } from '@emotion/css';\nimport React from 'react';\nimport { textUtil } from '@grafana/data';\nimport { HorizontalGroup, IconButton, Tag, useStyles2 } from '@grafana/ui';\nimport config from 'app/core/config';\nimport alertDef from 'app/features/alerting/state/alertDef';\nimport { CommentManager } from 'app/features/comments/CommentManager';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nexport const AnnotationTooltip = ({\n  annotation,\n  timeFormatter,\n  canEdit,\n  canDelete,\n  onEdit,\n  onDelete\n}) => {\n  const styles = useStyles2(getStyles);\n  const time = timeFormatter(annotation.time);\n  const timeEnd = timeFormatter(annotation.timeEnd);\n  let text = annotation.text;\n  const tags = annotation.tags;\n  let alertText = '';\n  let avatar;\n  let editControls;\n  let state = null;\n\n  const ts = /*#__PURE__*/_jsx(\"span\", {\n    className: styles.time,\n    children: Boolean(annotation.isRegion) ? `${time} - ${timeEnd}` : time\n  });\n\n  if (annotation.login && annotation.avatarUrl) {\n    avatar = /*#__PURE__*/_jsx(\"img\", {\n      className: styles.avatar,\n      src: annotation.avatarUrl\n    });\n  }\n\n  if (annotation.alertId !== undefined && annotation.newState) {\n    const stateModel = alertDef.getStateDisplayModel(annotation.newState);\n    state = /*#__PURE__*/_jsx(\"div\", {\n      className: styles.alertState,\n      children: /*#__PURE__*/_jsx(\"i\", {\n        className: stateModel.stateClass,\n        children: stateModel.text\n      })\n    });\n    alertText = alertDef.getAlertAnnotationInfo(annotation);\n  } else if (annotation.title) {\n    text = annotation.title + '<br />' + (typeof text === 'string' ? text : '');\n  }\n\n  if (canEdit || canDelete) {\n    editControls = /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.editControls,\n      children: [canEdit && /*#__PURE__*/_jsx(IconButton, {\n        name: 'pen',\n        size: 'sm',\n        onClick: onEdit\n      }), canDelete && /*#__PURE__*/_jsx(IconButton, {\n        name: 'trash-alt',\n        size: 'sm',\n        onClick: onDelete\n      })]\n    });\n  }\n\n  const areAnnotationCommentsEnabled = config.featureToggles.annotationComments;\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.wrapper,\n    style: areAnnotationCommentsEnabled ? {\n      minWidth: '300px'\n    } : {},\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: styles.header,\n      children: /*#__PURE__*/_jsxs(HorizontalGroup, {\n        justify: 'space-between',\n        align: 'center',\n        spacing: 'md',\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.meta,\n          children: [/*#__PURE__*/_jsxs(\"span\", {\n            children: [avatar, state]\n          }), ts]\n        }), editControls]\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.body,\n      children: [text && /*#__PURE__*/_jsx(\"div\", {\n        dangerouslySetInnerHTML: {\n          __html: textUtil.sanitize(text)\n        }\n      }), alertText, /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsx(HorizontalGroup, {\n          spacing: \"xs\",\n          wrap: true,\n          children: tags === null || tags === void 0 ? void 0 : tags.map((t, i) => /*#__PURE__*/_jsx(Tag, {\n            name: t\n          }, `${t}-${i}`))\n        })\n      }), areAnnotationCommentsEnabled && /*#__PURE__*/_jsx(\"div\", {\n        className: styles.commentWrapper,\n        children: /*#__PURE__*/_jsx(CommentManager, {\n          objectType: 'annotation',\n          objectId: annotation.id.toString()\n        })\n      })]\n    })]\n  });\n};\nAnnotationTooltip.displayName = 'AnnotationTooltip';\n\nconst getStyles = theme => {\n  return {\n    wrapper: css`\n      max-width: 400px;\n    `,\n    commentWrapper: css`\n      margin-top: 10px;\n      border-top: 2px solid #2d2b34;\n      height: 30vh;\n      overflow-y: scroll;\n      padding: 0 3px;\n    `,\n    header: css`\n      padding: ${theme.spacing(0.5, 1)};\n      border-bottom: 1px solid ${theme.colors.border.weak};\n      font-size: ${theme.typography.bodySmall.fontSize};\n      display: flex;\n    `,\n    meta: css`\n      display: flex;\n      justify-content: space-between;\n    `,\n    editControls: css`\n      display: flex;\n      align-items: center;\n      > :last-child {\n        margin-right: 0;\n      }\n    `,\n    avatar: css`\n      border-radius: 50%;\n      width: 16px;\n      height: 16px;\n      margin-right: ${theme.spacing(1)};\n    `,\n    alertState: css`\n      padding-right: ${theme.spacing(1)};\n      font-weight: ${theme.typography.fontWeightMedium};\n    `,\n    time: css`\n      color: ${theme.colors.text.secondary};\n      font-weight: normal;\n      display: inline-block;\n      position: relative;\n      top: 1px;\n    `,\n    body: css`\n      padding: ${theme.spacing(1)};\n\n      a {\n        color: ${theme.colors.text.link};\n        &:hover {\n          text-decoration: underline;\n        }\n      }\n    `\n  };\n};","map":{"version":3,"names":["css","React","textUtil","HorizontalGroup","IconButton","Tag","useStyles2","config","alertDef","CommentManager","AnnotationTooltip","annotation","timeFormatter","canEdit","canDelete","onEdit","onDelete","styles","getStyles","time","timeEnd","text","tags","alertText","avatar","editControls","state","ts","Boolean","isRegion","login","avatarUrl","alertId","undefined","newState","stateModel","getStateDisplayModel","alertState","stateClass","getAlertAnnotationInfo","title","areAnnotationCommentsEnabled","featureToggles","annotationComments","wrapper","minWidth","header","meta","body","__html","sanitize","map","t","i","commentWrapper","id","toString","displayName","theme","spacing","colors","border","weak","typography","bodySmall","fontSize","fontWeightMedium","secondary","link"],"sources":["/home/soula/grafana/public/app/plugins/panel/timeseries/plugins/annotations/AnnotationTooltip.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2, textUtil } from '@grafana/data';\nimport { HorizontalGroup, IconButton, Tag, useStyles2 } from '@grafana/ui';\nimport config from 'app/core/config';\nimport alertDef from 'app/features/alerting/state/alertDef';\nimport { CommentManager } from 'app/features/comments/CommentManager';\n\ninterface AnnotationTooltipProps {\n  annotation: AnnotationsDataFrameViewDTO;\n  timeFormatter: (v: number) => string;\n  canEdit: boolean;\n  canDelete: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n}\n\nexport const AnnotationTooltip = ({\n  annotation,\n  timeFormatter,\n  canEdit,\n  canDelete,\n  onEdit,\n  onDelete,\n}: AnnotationTooltipProps) => {\n  const styles = useStyles2(getStyles);\n  const time = timeFormatter(annotation.time);\n  const timeEnd = timeFormatter(annotation.timeEnd);\n  let text = annotation.text;\n  const tags = annotation.tags;\n  let alertText = '';\n  let avatar;\n  let editControls;\n  let state: React.ReactNode | null = null;\n\n  const ts = <span className={styles.time}>{Boolean(annotation.isRegion) ? `${time} - ${timeEnd}` : time}</span>;\n\n  if (annotation.login && annotation.avatarUrl) {\n    avatar = <img className={styles.avatar} src={annotation.avatarUrl} />;\n  }\n\n  if (annotation.alertId !== undefined && annotation.newState) {\n    const stateModel = alertDef.getStateDisplayModel(annotation.newState);\n    state = (\n      <div className={styles.alertState}>\n        <i className={stateModel.stateClass}>{stateModel.text}</i>\n      </div>\n    );\n\n    alertText = alertDef.getAlertAnnotationInfo(annotation);\n  } else if (annotation.title) {\n    text = annotation.title + '<br />' + (typeof text === 'string' ? text : '');\n  }\n\n  if (canEdit || canDelete) {\n    editControls = (\n      <div className={styles.editControls}>\n        {canEdit && <IconButton name={'pen'} size={'sm'} onClick={onEdit} />}\n        {canDelete && <IconButton name={'trash-alt'} size={'sm'} onClick={onDelete} />}\n      </div>\n    );\n  }\n\n  const areAnnotationCommentsEnabled = config.featureToggles.annotationComments;\n\n  return (\n    <div className={styles.wrapper} style={areAnnotationCommentsEnabled ? { minWidth: '300px' } : {}}>\n      <div className={styles.header}>\n        <HorizontalGroup justify={'space-between'} align={'center'} spacing={'md'}>\n          <div className={styles.meta}>\n            <span>\n              {avatar}\n              {state}\n            </span>\n            {ts}\n          </div>\n          {editControls}\n        </HorizontalGroup>\n      </div>\n\n      <div className={styles.body}>\n        {text && <div dangerouslySetInnerHTML={{ __html: textUtil.sanitize(text) }} />}\n        {alertText}\n        <>\n          <HorizontalGroup spacing=\"xs\" wrap>\n            {tags?.map((t, i) => (\n              <Tag name={t} key={`${t}-${i}`} />\n            ))}\n          </HorizontalGroup>\n        </>\n        {areAnnotationCommentsEnabled && (\n          <div className={styles.commentWrapper}>\n            <CommentManager objectType={'annotation'} objectId={annotation.id.toString()} />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nAnnotationTooltip.displayName = 'AnnotationTooltip';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      max-width: 400px;\n    `,\n    commentWrapper: css`\n      margin-top: 10px;\n      border-top: 2px solid #2d2b34;\n      height: 30vh;\n      overflow-y: scroll;\n      padding: 0 3px;\n    `,\n    header: css`\n      padding: ${theme.spacing(0.5, 1)};\n      border-bottom: 1px solid ${theme.colors.border.weak};\n      font-size: ${theme.typography.bodySmall.fontSize};\n      display: flex;\n    `,\n    meta: css`\n      display: flex;\n      justify-content: space-between;\n    `,\n    editControls: css`\n      display: flex;\n      align-items: center;\n      > :last-child {\n        margin-right: 0;\n      }\n    `,\n    avatar: css`\n      border-radius: 50%;\n      width: 16px;\n      height: 16px;\n      margin-right: ${theme.spacing(1)};\n    `,\n    alertState: css`\n      padding-right: ${theme.spacing(1)};\n      font-weight: ${theme.typography.fontWeightMedium};\n    `,\n    time: css`\n      color: ${theme.colors.text.secondary};\n      font-weight: normal;\n      display: inline-block;\n      position: relative;\n      top: 1px;\n    `,\n    body: css`\n      padding: ${theme.spacing(1)};\n\n      a {\n        color: ${theme.colors.text.link};\n        &:hover {\n          text-decoration: underline;\n        }\n      }\n    `,\n  };\n};\n"],"mappings":"AAAA,SAASA,GAAT,QAAoB,cAApB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,SAAwBC,QAAxB,QAAwC,eAAxC;AACA,SAASC,eAAT,EAA0BC,UAA1B,EAAsCC,GAAtC,EAA2CC,UAA3C,QAA6D,aAA7D;AACA,OAAOC,MAAP,MAAmB,iBAAnB;AACA,OAAOC,QAAP,MAAqB,sCAArB;AACA,SAASC,cAAT,QAA+B,sCAA/B;;;;AAWA,OAAO,MAAMC,iBAAiB,GAAG,CAAC;EAChCC,UADgC;EAEhCC,aAFgC;EAGhCC,OAHgC;EAIhCC,SAJgC;EAKhCC,MALgC;EAMhCC;AANgC,CAAD,KAOH;EAC5B,MAAMC,MAAM,GAAGX,UAAU,CAACY,SAAD,CAAzB;EACA,MAAMC,IAAI,GAAGP,aAAa,CAACD,UAAU,CAACQ,IAAZ,CAA1B;EACA,MAAMC,OAAO,GAAGR,aAAa,CAACD,UAAU,CAACS,OAAZ,CAA7B;EACA,IAAIC,IAAI,GAAGV,UAAU,CAACU,IAAtB;EACA,MAAMC,IAAI,GAAGX,UAAU,CAACW,IAAxB;EACA,IAAIC,SAAS,GAAG,EAAhB;EACA,IAAIC,MAAJ;EACA,IAAIC,YAAJ;EACA,IAAIC,KAA6B,GAAG,IAApC;;EAEA,MAAMC,EAAE,gBAAG;IAAM,SAAS,EAAEV,MAAM,CAACE,IAAxB;IAAA,UAA+BS,OAAO,CAACjB,UAAU,CAACkB,QAAZ,CAAP,GAAgC,GAAEV,IAAK,MAAKC,OAAQ,EAApD,GAAwDD;EAAvF,EAAX;;EAEA,IAAIR,UAAU,CAACmB,KAAX,IAAoBnB,UAAU,CAACoB,SAAnC,EAA8C;IAC5CP,MAAM,gBAAG;MAAK,SAAS,EAAEP,MAAM,CAACO,MAAvB;MAA+B,GAAG,EAAEb,UAAU,CAACoB;IAA/C,EAAT;EACD;;EAED,IAAIpB,UAAU,CAACqB,OAAX,KAAuBC,SAAvB,IAAoCtB,UAAU,CAACuB,QAAnD,EAA6D;IAC3D,MAAMC,UAAU,GAAG3B,QAAQ,CAAC4B,oBAAT,CAA8BzB,UAAU,CAACuB,QAAzC,CAAnB;IACAR,KAAK,gBACH;MAAK,SAAS,EAAET,MAAM,CAACoB,UAAvB;MAAA,uBACE;QAAG,SAAS,EAAEF,UAAU,CAACG,UAAzB;QAAA,UAAsCH,UAAU,CAACd;MAAjD;IADF,EADF;IAMAE,SAAS,GAAGf,QAAQ,CAAC+B,sBAAT,CAAgC5B,UAAhC,CAAZ;EACD,CATD,MASO,IAAIA,UAAU,CAAC6B,KAAf,EAAsB;IAC3BnB,IAAI,GAAGV,UAAU,CAAC6B,KAAX,GAAmB,QAAnB,IAA+B,OAAOnB,IAAP,KAAgB,QAAhB,GAA2BA,IAA3B,GAAkC,EAAjE,CAAP;EACD;;EAED,IAAIR,OAAO,IAAIC,SAAf,EAA0B;IACxBW,YAAY,gBACV;MAAK,SAAS,EAAER,MAAM,CAACQ,YAAvB;MAAA,WACGZ,OAAO,iBAAI,KAAC,UAAD;QAAY,IAAI,EAAE,KAAlB;QAAyB,IAAI,EAAE,IAA/B;QAAqC,OAAO,EAAEE;MAA9C,EADd,EAEGD,SAAS,iBAAI,KAAC,UAAD;QAAY,IAAI,EAAE,WAAlB;QAA+B,IAAI,EAAE,IAArC;QAA2C,OAAO,EAAEE;MAApD,EAFhB;IAAA,EADF;EAMD;;EAED,MAAMyB,4BAA4B,GAAGlC,MAAM,CAACmC,cAAP,CAAsBC,kBAA3D;EAEA,oBACE;IAAK,SAAS,EAAE1B,MAAM,CAAC2B,OAAvB;IAAgC,KAAK,EAAEH,4BAA4B,GAAG;MAAEI,QAAQ,EAAE;IAAZ,CAAH,GAA2B,EAA9F;IAAA,wBACE;MAAK,SAAS,EAAE5B,MAAM,CAAC6B,MAAvB;MAAA,uBACE,MAAC,eAAD;QAAiB,OAAO,EAAE,eAA1B;QAA2C,KAAK,EAAE,QAAlD;QAA4D,OAAO,EAAE,IAArE;QAAA,wBACE;UAAK,SAAS,EAAE7B,MAAM,CAAC8B,IAAvB;UAAA,wBACE;YAAA,WACGvB,MADH,EAEGE,KAFH;UAAA,EADF,EAKGC,EALH;QAAA,EADF,EAQGF,YARH;MAAA;IADF,EADF,eAcE;MAAK,SAAS,EAAER,MAAM,CAAC+B,IAAvB;MAAA,WACG3B,IAAI,iBAAI;QAAK,uBAAuB,EAAE;UAAE4B,MAAM,EAAE/C,QAAQ,CAACgD,QAAT,CAAkB7B,IAAlB;QAAV;MAA9B,EADX,EAEGE,SAFH,eAGE;QAAA,uBACE,KAAC,eAAD;UAAiB,OAAO,EAAC,IAAzB;UAA8B,IAAI,MAAlC;UAAA,UACGD,IADH,aACGA,IADH,uBACGA,IAAI,CAAE6B,GAAN,CAAU,CAACC,CAAD,EAAIC,CAAJ,kBACT,KAAC,GAAD;YAAK,IAAI,EAAED;UAAX,GAAoB,GAAEA,CAAE,IAAGC,CAAE,EAA7B,CADD;QADH;MADF,EAHF,EAUGZ,4BAA4B,iBAC3B;QAAK,SAAS,EAAExB,MAAM,CAACqC,cAAvB;QAAA,uBACE,KAAC,cAAD;UAAgB,UAAU,EAAE,YAA5B;UAA0C,QAAQ,EAAE3C,UAAU,CAAC4C,EAAX,CAAcC,QAAd;QAApD;MADF,EAXJ;IAAA,EAdF;EAAA,EADF;AAiCD,CAjFM;AAmFP9C,iBAAiB,CAAC+C,WAAlB,GAAgC,mBAAhC;;AAEA,MAAMvC,SAAS,GAAIwC,KAAD,IAA0B;EAC1C,OAAO;IACLd,OAAO,EAAE5C,GAAI;AACjB;AACA,KAHS;IAILsD,cAAc,EAAEtD,GAAI;AACxB;AACA;AACA;AACA;AACA;AACA,KAVS;IAWL8C,MAAM,EAAE9C,GAAI;AAChB,iBAAiB0D,KAAK,CAACC,OAAN,CAAc,GAAd,EAAmB,CAAnB,CAAsB;AACvC,iCAAiCD,KAAK,CAACE,MAAN,CAAaC,MAAb,CAAoBC,IAAK;AAC1D,mBAAmBJ,KAAK,CAACK,UAAN,CAAiBC,SAAjB,CAA2BC,QAAS;AACvD;AACA,KAhBS;IAiBLlB,IAAI,EAAE/C,GAAI;AACd;AACA;AACA,KApBS;IAqBLyB,YAAY,EAAEzB,GAAI;AACtB;AACA;AACA;AACA;AACA;AACA,KA3BS;IA4BLwB,MAAM,EAAExB,GAAI;AAChB;AACA;AACA;AACA,sBAAsB0D,KAAK,CAACC,OAAN,CAAc,CAAd,CAAiB;AACvC,KAjCS;IAkCLtB,UAAU,EAAErC,GAAI;AACpB,uBAAuB0D,KAAK,CAACC,OAAN,CAAc,CAAd,CAAiB;AACxC,qBAAqBD,KAAK,CAACK,UAAN,CAAiBG,gBAAiB;AACvD,KArCS;IAsCL/C,IAAI,EAAEnB,GAAI;AACd,eAAe0D,KAAK,CAACE,MAAN,CAAavC,IAAb,CAAkB8C,SAAU;AAC3C;AACA;AACA;AACA;AACA,KA5CS;IA6CLnB,IAAI,EAAEhD,GAAI;AACd,iBAAiB0D,KAAK,CAACC,OAAN,CAAc,CAAd,CAAiB;AAClC;AACA;AACA,iBAAiBD,KAAK,CAACE,MAAN,CAAavC,IAAb,CAAkB+C,IAAK;AACxC;AACA;AACA;AACA;AACA;EAtDS,CAAP;AAwDD,CAzDD"},"metadata":{},"sourceType":"module"}