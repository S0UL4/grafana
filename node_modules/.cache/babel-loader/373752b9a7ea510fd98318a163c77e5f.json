{"ast":null,"code":"import { useCallback, useEffect, useRef, useState } from 'react';\nconst defaultOptions = {\n  stepDown: s => s / 1.5,\n  stepUp: s => s * 1.5,\n  min: 0.13,\n  max: 2.25\n};\n\n/**\n * Keeps state and returns handlers that can be used to implement zooming functionality ideally by using it with\n * 'transform: scale'. It returns handler for manual buttons with zoom in/zoom out function and a ref that can be\n * used to zoom in/out with mouse wheel.\n */\nexport function useZoom({\n  stepUp,\n  stepDown,\n  min,\n  max\n} = defaultOptions) {\n  const ref = useRef(null);\n  const [scale, setScale] = useState(1);\n  const onStepUp = useCallback(() => {\n    if (scale < (max !== null && max !== void 0 ? max : Infinity)) {\n      setScale(stepUp(scale));\n    }\n  }, [scale, stepUp, max]);\n  const onStepDown = useCallback(() => {\n    if (scale > (min !== null && min !== void 0 ? min : -Infinity)) {\n      setScale(stepDown(scale));\n    }\n  }, [scale, stepDown, min]);\n  const onWheel = useCallback(function (event) {\n    // Seems like typing for the addEventListener is lacking a bit\n    const wheelEvent = event; // Only do this with special key pressed similar to how google maps work.\n    // TODO: I would guess this won't work very well with touch right now\n\n    if (wheelEvent.ctrlKey || wheelEvent.metaKey) {\n      event.preventDefault();\n      setScale(Math.min(Math.max(min !== null && min !== void 0 ? min : -Infinity, scale + Math.min(wheelEvent.deltaY, 2) * -0.01), max !== null && max !== void 0 ? max : Infinity));\n\n      if (wheelEvent.deltaY < 0) {\n        const newScale = scale + Math.max(wheelEvent.deltaY, -4) * -0.015;\n        setScale(Math.max(min !== null && min !== void 0 ? min : -Infinity, newScale));\n      } else if (wheelEvent.deltaY > 0) {\n        const newScale = scale + Math.min(wheelEvent.deltaY, 4) * -0.015;\n        setScale(Math.min(max !== null && max !== void 0 ? max : Infinity, newScale));\n      }\n    }\n  }, [min, max, scale]);\n  useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const zoomRef = ref.current; // Adds listener for wheel event, we need the passive: false to be able to prevent default otherwise that\n    // cannot be used with passive listeners.\n\n    zoomRef.addEventListener('wheel', onWheel, {\n      passive: false\n    });\n    return () => {\n      if (zoomRef) {\n        zoomRef.removeEventListener('wheel', onWheel);\n      }\n    };\n  }, [onWheel]);\n  return {\n    onStepUp,\n    onStepDown,\n    scale: Math.max(Math.min(scale, max !== null && max !== void 0 ? max : Infinity), min !== null && min !== void 0 ? min : -Infinity),\n    isMax: scale >= (max !== null && max !== void 0 ? max : Infinity),\n    isMin: scale <= (min !== null && min !== void 0 ? min : -Infinity),\n    ref\n  };\n}","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","defaultOptions","stepDown","s","stepUp","min","max","useZoom","ref","scale","setScale","onStepUp","Infinity","onStepDown","onWheel","event","wheelEvent","ctrlKey","metaKey","preventDefault","Math","deltaY","newScale","current","zoomRef","addEventListener","passive","removeEventListener","isMax","isMin"],"sources":["/home/soula/grafana/public/app/plugins/panel/nodeGraph/useZoom.ts"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\n\nconst defaultOptions: Options = {\n  stepDown: (s) => s / 1.5,\n  stepUp: (s) => s * 1.5,\n  min: 0.13,\n  max: 2.25,\n};\n\ninterface Options {\n  /**\n   * Allows you to specify how the step up will be handled so you can do fractional steps based on previous value.\n   */\n  stepUp: (scale: number) => number;\n  stepDown: (scale: number) => number;\n\n  /**\n   * Set max and min values. If stepUp/down overshoots these bounds this will return min or max but internal scale value\n   * will still be what ever the step functions returned last.\n   */\n  min?: number;\n  max?: number;\n}\n\n/**\n * Keeps state and returns handlers that can be used to implement zooming functionality ideally by using it with\n * 'transform: scale'. It returns handler for manual buttons with zoom in/zoom out function and a ref that can be\n * used to zoom in/out with mouse wheel.\n */\nexport function useZoom({ stepUp, stepDown, min, max } = defaultOptions) {\n  const ref = useRef<HTMLElement>(null);\n  const [scale, setScale] = useState(1);\n\n  const onStepUp = useCallback(() => {\n    if (scale < (max ?? Infinity)) {\n      setScale(stepUp(scale));\n    }\n  }, [scale, stepUp, max]);\n\n  const onStepDown = useCallback(() => {\n    if (scale > (min ?? -Infinity)) {\n      setScale(stepDown(scale));\n    }\n  }, [scale, stepDown, min]);\n\n  const onWheel = useCallback(\n    function (event: Event) {\n      // Seems like typing for the addEventListener is lacking a bit\n      const wheelEvent = event as WheelEvent;\n\n      // Only do this with special key pressed similar to how google maps work.\n      // TODO: I would guess this won't work very well with touch right now\n      if (wheelEvent.ctrlKey || wheelEvent.metaKey) {\n        event.preventDefault();\n\n        setScale(Math.min(Math.max(min ?? -Infinity, scale + Math.min(wheelEvent.deltaY, 2) * -0.01), max ?? Infinity));\n\n        if (wheelEvent.deltaY < 0) {\n          const newScale = scale + Math.max(wheelEvent.deltaY, -4) * -0.015;\n          setScale(Math.max(min ?? -Infinity, newScale));\n        } else if (wheelEvent.deltaY > 0) {\n          const newScale = scale + Math.min(wheelEvent.deltaY, 4) * -0.015;\n          setScale(Math.min(max ?? Infinity, newScale));\n        }\n      }\n    },\n    [min, max, scale]\n  );\n\n  useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const zoomRef = ref.current;\n\n    // Adds listener for wheel event, we need the passive: false to be able to prevent default otherwise that\n    // cannot be used with passive listeners.\n    zoomRef.addEventListener('wheel', onWheel, { passive: false });\n    return () => {\n      if (zoomRef) {\n        zoomRef.removeEventListener('wheel', onWheel);\n      }\n    };\n  }, [onWheel]);\n\n  return {\n    onStepUp,\n    onStepDown,\n    scale: Math.max(Math.min(scale, max ?? Infinity), min ?? -Infinity),\n    isMax: scale >= (max ?? Infinity),\n    isMin: scale <= (min ?? -Infinity),\n    ref,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}