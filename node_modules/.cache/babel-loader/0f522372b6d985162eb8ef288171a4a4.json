{"ast":null,"code":"// Copyright (c) 2017 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n// exported for tests\nexport const ITEM_ALPHA = 0.8;\nexport const MIN_ITEM_HEIGHT = 2;\nexport const MAX_TOTAL_HEIGHT = 200;\nexport const MIN_ITEM_WIDTH = 10;\nexport const MIN_TOTAL_HEIGHT = 60;\nexport const MAX_ITEM_HEIGHT = 6;\nexport default function renderIntoCanvas(canvas, items, totalValueWidth, getFillColor, bgColor) {\n  const fillCache = new Map();\n  const cHeight = items.length < MIN_TOTAL_HEIGHT ? MIN_TOTAL_HEIGHT : Math.min(items.length, MAX_TOTAL_HEIGHT);\n  const cWidth = window.innerWidth * 2; // eslint-disable-next-line no-param-reassign\n\n  canvas.width = cWidth; // eslint-disable-next-line no-param-reassign\n\n  canvas.height = cHeight;\n  const itemHeight = Math.min(MAX_ITEM_HEIGHT, Math.max(MIN_ITEM_HEIGHT, cHeight / items.length));\n  const itemYChange = cHeight / items.length;\n  const ctx = canvas.getContext('2d', {\n    alpha: false\n  });\n  ctx.fillStyle = bgColor;\n  ctx.fillRect(0, 0, cWidth, cHeight);\n\n  for (let i = 0; i < items.length; i++) {\n    const {\n      valueWidth,\n      valueOffset,\n      serviceName\n    } = items[i];\n    const x = valueOffset / totalValueWidth * cWidth;\n    let width = valueWidth / totalValueWidth * cWidth;\n\n    if (width < MIN_ITEM_WIDTH) {\n      width = MIN_ITEM_WIDTH;\n    }\n\n    let fillStyle = fillCache.get(serviceName);\n\n    if (!fillStyle) {\n      fillStyle = `rgba(${getFillColor(serviceName).concat(ITEM_ALPHA).join()})`;\n      fillCache.set(serviceName, fillStyle);\n    }\n\n    ctx.fillStyle = fillStyle;\n    ctx.fillRect(x, i * itemYChange, width, itemHeight);\n  }\n}","map":{"version":3,"names":["ITEM_ALPHA","MIN_ITEM_HEIGHT","MAX_TOTAL_HEIGHT","MIN_ITEM_WIDTH","MIN_TOTAL_HEIGHT","MAX_ITEM_HEIGHT","renderIntoCanvas","canvas","items","totalValueWidth","getFillColor","bgColor","fillCache","Map","cHeight","length","Math","min","cWidth","window","innerWidth","width","height","itemHeight","max","itemYChange","ctx","getContext","alpha","fillStyle","fillRect","i","valueWidth","valueOffset","serviceName","x","get","concat","join","set"],"sources":["/home/soula/grafana/packages/jaeger-ui-components/src/TracePageHeader/SpanGraph/render-into-canvas.tsx"],"sourcesContent":["// Copyright (c) 2017 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { TNil } from '../..';\n\n// exported for tests\nexport const ITEM_ALPHA = 0.8;\nexport const MIN_ITEM_HEIGHT = 2;\nexport const MAX_TOTAL_HEIGHT = 200;\nexport const MIN_ITEM_WIDTH = 10;\nexport const MIN_TOTAL_HEIGHT = 60;\nexport const MAX_ITEM_HEIGHT = 6;\n\nexport default function renderIntoCanvas(\n  canvas: HTMLCanvasElement,\n  items: Array<{ valueWidth: number; valueOffset: number; serviceName: string }>,\n  totalValueWidth: number,\n  getFillColor: (serviceName: string) => [number, number, number],\n  bgColor: string\n) {\n  const fillCache: Map<string, string | TNil> = new Map();\n  const cHeight = items.length < MIN_TOTAL_HEIGHT ? MIN_TOTAL_HEIGHT : Math.min(items.length, MAX_TOTAL_HEIGHT);\n  const cWidth = window.innerWidth * 2;\n  // eslint-disable-next-line no-param-reassign\n  canvas.width = cWidth;\n  // eslint-disable-next-line no-param-reassign\n  canvas.height = cHeight;\n  const itemHeight = Math.min(MAX_ITEM_HEIGHT, Math.max(MIN_ITEM_HEIGHT, cHeight / items.length));\n  const itemYChange = cHeight / items.length;\n\n  const ctx = canvas.getContext('2d', { alpha: false }) as CanvasRenderingContext2D;\n  ctx.fillStyle = bgColor;\n  ctx.fillRect(0, 0, cWidth, cHeight);\n  for (let i = 0; i < items.length; i++) {\n    const { valueWidth, valueOffset, serviceName } = items[i];\n    const x = (valueOffset / totalValueWidth) * cWidth;\n    let width = (valueWidth / totalValueWidth) * cWidth;\n    if (width < MIN_ITEM_WIDTH) {\n      width = MIN_ITEM_WIDTH;\n    }\n    let fillStyle = fillCache.get(serviceName);\n    if (!fillStyle) {\n      fillStyle = `rgba(${getFillColor(serviceName).concat(ITEM_ALPHA).join()})`;\n      fillCache.set(serviceName, fillStyle);\n    }\n    ctx.fillStyle = fillStyle;\n    ctx.fillRect(x, i * itemYChange, width, itemHeight);\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA,OAAO,MAAMA,UAAU,GAAG,GAAnB;AACP,OAAO,MAAMC,eAAe,GAAG,CAAxB;AACP,OAAO,MAAMC,gBAAgB,GAAG,GAAzB;AACP,OAAO,MAAMC,cAAc,GAAG,EAAvB;AACP,OAAO,MAAMC,gBAAgB,GAAG,EAAzB;AACP,OAAO,MAAMC,eAAe,GAAG,CAAxB;AAEP,eAAe,SAASC,gBAAT,CACbC,MADa,EAEbC,KAFa,EAGbC,eAHa,EAIbC,YAJa,EAKbC,OALa,EAMb;EACA,MAAMC,SAAqC,GAAG,IAAIC,GAAJ,EAA9C;EACA,MAAMC,OAAO,GAAGN,KAAK,CAACO,MAAN,GAAeX,gBAAf,GAAkCA,gBAAlC,GAAqDY,IAAI,CAACC,GAAL,CAAST,KAAK,CAACO,MAAf,EAAuBb,gBAAvB,CAArE;EACA,MAAMgB,MAAM,GAAGC,MAAM,CAACC,UAAP,GAAoB,CAAnC,CAHA,CAIA;;EACAb,MAAM,CAACc,KAAP,GAAeH,MAAf,CALA,CAMA;;EACAX,MAAM,CAACe,MAAP,GAAgBR,OAAhB;EACA,MAAMS,UAAU,GAAGP,IAAI,CAACC,GAAL,CAASZ,eAAT,EAA0BW,IAAI,CAACQ,GAAL,CAASvB,eAAT,EAA0Ba,OAAO,GAAGN,KAAK,CAACO,MAA1C,CAA1B,CAAnB;EACA,MAAMU,WAAW,GAAGX,OAAO,GAAGN,KAAK,CAACO,MAApC;EAEA,MAAMW,GAAG,GAAGnB,MAAM,CAACoB,UAAP,CAAkB,IAAlB,EAAwB;IAAEC,KAAK,EAAE;EAAT,CAAxB,CAAZ;EACAF,GAAG,CAACG,SAAJ,GAAgBlB,OAAhB;EACAe,GAAG,CAACI,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmBZ,MAAnB,EAA2BJ,OAA3B;;EACA,KAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvB,KAAK,CAACO,MAA1B,EAAkCgB,CAAC,EAAnC,EAAuC;IACrC,MAAM;MAAEC,UAAF;MAAcC,WAAd;MAA2BC;IAA3B,IAA2C1B,KAAK,CAACuB,CAAD,CAAtD;IACA,MAAMI,CAAC,GAAIF,WAAW,GAAGxB,eAAf,GAAkCS,MAA5C;IACA,IAAIG,KAAK,GAAIW,UAAU,GAAGvB,eAAd,GAAiCS,MAA7C;;IACA,IAAIG,KAAK,GAAGlB,cAAZ,EAA4B;MAC1BkB,KAAK,GAAGlB,cAAR;IACD;;IACD,IAAI0B,SAAS,GAAGjB,SAAS,CAACwB,GAAV,CAAcF,WAAd,CAAhB;;IACA,IAAI,CAACL,SAAL,EAAgB;MACdA,SAAS,GAAI,QAAOnB,YAAY,CAACwB,WAAD,CAAZ,CAA0BG,MAA1B,CAAiCrC,UAAjC,EAA6CsC,IAA7C,EAAoD,GAAxE;MACA1B,SAAS,CAAC2B,GAAV,CAAcL,WAAd,EAA2BL,SAA3B;IACD;;IACDH,GAAG,CAACG,SAAJ,GAAgBA,SAAhB;IACAH,GAAG,CAACI,QAAJ,CAAaK,CAAb,EAAgBJ,CAAC,GAAGN,WAApB,EAAiCJ,KAAjC,EAAwCE,UAAxC;EACD;AACF"},"metadata":{},"sourceType":"module"}