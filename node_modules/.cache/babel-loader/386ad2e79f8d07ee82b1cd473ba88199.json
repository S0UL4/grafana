{"ast":null,"code":"import { createAction } from '@reduxjs/toolkit';\nimport config from 'app/core/config';\nexport function buildInitialState() {\n  const navIndex = {};\n  const rootNodes = config.bootData.navTree;\n  buildNavIndex(navIndex, rootNodes);\n  return navIndex;\n}\n\nfunction buildNavIndex(navIndex, children, parentItem) {\n  for (const node of children) {\n    navIndex[node.id] = Object.assign({}, node, {\n      parentItem: parentItem\n    });\n\n    if (node.children) {\n      buildNavIndex(navIndex, node.children, node);\n    }\n  }\n\n  navIndex['not-found'] = Object.assign({}, buildWarningNav('Page not found', '404 Error').node);\n}\n\nfunction buildWarningNav(text, subTitle) {\n  const node = {\n    text,\n    subTitle,\n    icon: 'exclamation-triangle'\n  };\n  return {\n    breadcrumbs: [node],\n    node: node,\n    main: node\n  };\n}\n\nexport const initialState = {};\nexport const updateNavIndex = createAction('navIndex/updateNavIndex'); // Since the configuration subtitle includes the organization name, we include this action to update the org name if it changes.\n\nexport const updateConfigurationSubtitle = createAction('navIndex/updateConfigurationSubtitle');\nexport const getItemWithNewSubTitle = (item, subTitle) => {\n  var _item$parentItem$text, _item$parentItem;\n\n  return Object.assign({}, item, {\n    parentItem: Object.assign({}, item.parentItem, {\n      text: (_item$parentItem$text = (_item$parentItem = item.parentItem) === null || _item$parentItem === void 0 ? void 0 : _item$parentItem.text) !== null && _item$parentItem$text !== void 0 ? _item$parentItem$text : '',\n      subTitle\n    })\n  });\n}; // Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\n// the frozen state.\n// https://github.com/reduxjs/redux-toolkit/issues/242\n\nexport const navIndexReducer = (state = initialState, action) => {\n  if (updateNavIndex.match(action)) {\n    const newPages = {};\n    const payload = action.payload;\n\n    for (const node of payload.children) {\n      newPages[node.id] = Object.assign({}, node, {\n        parentItem: payload\n      });\n    }\n\n    return Object.assign({}, state, newPages);\n  } else if (updateConfigurationSubtitle.match(action)) {\n    const subTitle = `Organization: ${action.payload}`;\n    return Object.assign({}, state, {\n      cfg: Object.assign({}, state.cfg, {\n        subTitle\n      }),\n      datasources: getItemWithNewSubTitle(state.datasources, subTitle),\n      users: getItemWithNewSubTitle(state.users, subTitle),\n      teams: getItemWithNewSubTitle(state.teams, subTitle),\n      plugins: getItemWithNewSubTitle(state.plugins, subTitle),\n      'org-settings': getItemWithNewSubTitle(state['org-settings'], subTitle),\n      apikeys: getItemWithNewSubTitle(state.apikeys, subTitle)\n    });\n  }\n\n  return state;\n};","map":{"version":3,"names":["createAction","config","buildInitialState","navIndex","rootNodes","bootData","navTree","buildNavIndex","children","parentItem","node","id","buildWarningNav","text","subTitle","icon","breadcrumbs","main","initialState","updateNavIndex","updateConfigurationSubtitle","getItemWithNewSubTitle","item","navIndexReducer","state","action","match","newPages","payload","cfg","datasources","users","teams","plugins","apikeys"],"sources":["/home/soula/grafana/public/app/core/reducers/navModel.ts"],"sourcesContent":["import { AnyAction, createAction } from '@reduxjs/toolkit';\n\nimport { NavIndex, NavModel, NavModelItem } from '@grafana/data';\nimport config from 'app/core/config';\n\nexport function buildInitialState(): NavIndex {\n  const navIndex: NavIndex = {};\n  const rootNodes = config.bootData.navTree as NavModelItem[];\n  buildNavIndex(navIndex, rootNodes);\n  return navIndex;\n}\n\nfunction buildNavIndex(navIndex: NavIndex, children: NavModelItem[], parentItem?: NavModelItem) {\n  for (const node of children) {\n    navIndex[node.id!] = {\n      ...node,\n      parentItem: parentItem,\n    };\n\n    if (node.children) {\n      buildNavIndex(navIndex, node.children, node);\n    }\n  }\n\n  navIndex['not-found'] = { ...buildWarningNav('Page not found', '404 Error').node };\n}\n\nfunction buildWarningNav(text: string, subTitle?: string): NavModel {\n  const node = {\n    text,\n    subTitle,\n    icon: 'exclamation-triangle',\n  };\n  return {\n    breadcrumbs: [node],\n    node: node,\n    main: node,\n  };\n}\n\nexport const initialState: NavIndex = {};\n\nexport const updateNavIndex = createAction<NavModelItem>('navIndex/updateNavIndex');\n// Since the configuration subtitle includes the organization name, we include this action to update the org name if it changes.\nexport const updateConfigurationSubtitle = createAction<string>('navIndex/updateConfigurationSubtitle');\n\nexport const getItemWithNewSubTitle = (item: NavModelItem, subTitle: string): NavModelItem => ({\n  ...item,\n  parentItem: {\n    ...item.parentItem,\n    text: item.parentItem?.text ?? '',\n    subTitle,\n  },\n});\n\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\n// the frozen state.\n// https://github.com/reduxjs/redux-toolkit/issues/242\nexport const navIndexReducer = (state: NavIndex = initialState, action: AnyAction): NavIndex => {\n  if (updateNavIndex.match(action)) {\n    const newPages: NavIndex = {};\n    const payload = action.payload;\n\n    for (const node of payload.children!) {\n      newPages[node.id!] = {\n        ...node,\n        parentItem: payload,\n      };\n    }\n\n    return { ...state, ...newPages };\n  } else if (updateConfigurationSubtitle.match(action)) {\n    const subTitle = `Organization: ${action.payload}`;\n\n    return {\n      ...state,\n      cfg: { ...state.cfg, subTitle },\n      datasources: getItemWithNewSubTitle(state.datasources, subTitle),\n      users: getItemWithNewSubTitle(state.users, subTitle),\n      teams: getItemWithNewSubTitle(state.teams, subTitle),\n      plugins: getItemWithNewSubTitle(state.plugins, subTitle),\n      'org-settings': getItemWithNewSubTitle(state['org-settings'], subTitle),\n      apikeys: getItemWithNewSubTitle(state.apikeys, subTitle),\n    };\n  }\n\n  return state;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}