{"ast":null,"code":"import { dateTime, locationUtil, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { createShortLink } from 'app/core/utils/shortLinks';\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\nexport function buildParams({\n  useCurrentTimeRange,\n  selectedTheme,\n  panel,\n  search = window.location.search,\n  range = getTimeSrv().timeRange(),\n  orgId = config.bootData.user.orgId\n}) {\n  const searchParams = new URLSearchParams(search);\n  searchParams.set('from', String(range.from.valueOf()));\n  searchParams.set('to', String(range.to.valueOf()));\n  searchParams.set('orgId', String(orgId));\n\n  if (!useCurrentTimeRange) {\n    searchParams.delete('from');\n    searchParams.delete('to');\n  }\n\n  if (selectedTheme !== 'current') {\n    searchParams.set('theme', selectedTheme);\n  }\n\n  if (panel && !searchParams.has('editPanel')) {\n    searchParams.set('viewPanel', String(panel.id));\n  }\n\n  return searchParams;\n}\nexport function buildBaseUrl() {\n  let baseUrl = window.location.href;\n  const queryStart = baseUrl.indexOf('?');\n\n  if (queryStart !== -1) {\n    baseUrl = baseUrl.substring(0, queryStart);\n  }\n\n  return baseUrl;\n}\nexport async function buildShareUrl(useCurrentTimeRange, selectedTheme, panel, shortenUrl) {\n  const baseUrl = buildBaseUrl();\n  const params = buildParams({\n    useCurrentTimeRange,\n    selectedTheme,\n    panel\n  });\n  const shareUrl = urlUtil.appendQueryToUrl(baseUrl, params.toString());\n\n  if (shortenUrl) {\n    return await createShortLink(shareUrl);\n  }\n\n  return shareUrl;\n}\nexport function buildSoloUrl(useCurrentTimeRange, dashboardUid, selectedTheme, panel) {\n  var _ref, _params$get;\n\n  const baseUrl = buildBaseUrl();\n  const params = buildParams({\n    useCurrentTimeRange,\n    selectedTheme,\n    panel\n  });\n  let soloUrl = baseUrl.replace(config.appSubUrl + '/dashboard/', config.appSubUrl + '/dashboard-solo/');\n  soloUrl = soloUrl.replace(config.appSubUrl + '/d/', config.appSubUrl + '/d-solo/'); // For handling the case when default_home_dashboard_path is set in the grafana config\n\n  const strippedUrl = locationUtil.stripBaseFromUrl(baseUrl);\n\n  if (strippedUrl === '/') {\n    soloUrl = `${config.appUrl}d-solo/${dashboardUid}`;\n  }\n\n  const panelId = (_ref = (_params$get = params.get('editPanel')) !== null && _params$get !== void 0 ? _params$get : params.get('viewPanel')) !== null && _ref !== void 0 ? _ref : '';\n  params.set('panelId', panelId);\n  params.delete('editPanel');\n  params.delete('viewPanel');\n  return urlUtil.appendQueryToUrl(soloUrl, params.toString());\n}\nexport function buildImageUrl(useCurrentTimeRange, dashboardUid, selectedTheme, panel) {\n  let soloUrl = buildSoloUrl(useCurrentTimeRange, dashboardUid, selectedTheme, panel);\n  let imageUrl = soloUrl.replace(config.appSubUrl + '/dashboard-solo/', config.appSubUrl + '/render/dashboard-solo/');\n  imageUrl = imageUrl.replace(config.appSubUrl + '/d-solo/', config.appSubUrl + '/render/d-solo/');\n  imageUrl += '&width=1000&height=500' + getLocalTimeZone();\n  return imageUrl;\n}\nexport function buildIframeHtml(useCurrentTimeRange, dashboardUid, selectedTheme, panel) {\n  let soloUrl = buildSoloUrl(useCurrentTimeRange, dashboardUid, selectedTheme, panel);\n  return '<iframe src=\"' + soloUrl + '\" width=\"450\" height=\"200\" frameborder=\"0\"></iframe>';\n}\nexport function getLocalTimeZone() {\n  const utcOffset = '&tz=UTC' + encodeURIComponent(dateTime().format('Z')); // Older browser does not the internationalization API\n\n  if (!window.Intl) {\n    return utcOffset;\n  }\n\n  const dateFormat = window.Intl.DateTimeFormat();\n\n  if (!dateFormat.resolvedOptions) {\n    return utcOffset;\n  }\n\n  const options = dateFormat.resolvedOptions();\n\n  if (!options.timeZone) {\n    return utcOffset;\n  }\n\n  return '&tz=' + encodeURIComponent(options.timeZone);\n}","map":{"version":3,"names":["dateTime","locationUtil","urlUtil","config","createShortLink","getTimeSrv","buildParams","useCurrentTimeRange","selectedTheme","panel","search","window","location","range","timeRange","orgId","bootData","user","searchParams","URLSearchParams","set","String","from","valueOf","to","delete","has","id","buildBaseUrl","baseUrl","href","queryStart","indexOf","substring","buildShareUrl","shortenUrl","params","shareUrl","appendQueryToUrl","toString","buildSoloUrl","dashboardUid","soloUrl","replace","appSubUrl","strippedUrl","stripBaseFromUrl","appUrl","panelId","get","buildImageUrl","imageUrl","getLocalTimeZone","buildIframeHtml","utcOffset","encodeURIComponent","format","Intl","dateFormat","DateTimeFormat","resolvedOptions","options","timeZone"],"sources":["/home/soula/grafana/public/app/features/dashboard/components/ShareModal/utils.ts"],"sourcesContent":["import { dateTime, locationUtil, PanelModel, TimeRange, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { createShortLink } from 'app/core/utils/shortLinks';\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\n\nexport interface BuildParamsArgs {\n  useCurrentTimeRange: boolean;\n  selectedTheme?: string;\n  panel?: PanelModel;\n  search?: string;\n  range?: TimeRange;\n  orgId?: number;\n}\n\nexport function buildParams({\n  useCurrentTimeRange,\n  selectedTheme,\n  panel,\n  search = window.location.search,\n  range = getTimeSrv().timeRange(),\n  orgId = config.bootData.user.orgId,\n}: BuildParamsArgs): URLSearchParams {\n  const searchParams = new URLSearchParams(search);\n\n  searchParams.set('from', String(range.from.valueOf()));\n  searchParams.set('to', String(range.to.valueOf()));\n  searchParams.set('orgId', String(orgId));\n\n  if (!useCurrentTimeRange) {\n    searchParams.delete('from');\n    searchParams.delete('to');\n  }\n\n  if (selectedTheme !== 'current') {\n    searchParams.set('theme', selectedTheme!);\n  }\n\n  if (panel && !searchParams.has('editPanel')) {\n    searchParams.set('viewPanel', String(panel.id));\n  }\n\n  return searchParams;\n}\n\nexport function buildBaseUrl() {\n  let baseUrl = window.location.href;\n  const queryStart = baseUrl.indexOf('?');\n\n  if (queryStart !== -1) {\n    baseUrl = baseUrl.substring(0, queryStart);\n  }\n\n  return baseUrl;\n}\n\nexport async function buildShareUrl(\n  useCurrentTimeRange: boolean,\n  selectedTheme?: string,\n  panel?: PanelModel,\n  shortenUrl?: boolean\n) {\n  const baseUrl = buildBaseUrl();\n  const params = buildParams({ useCurrentTimeRange, selectedTheme, panel });\n  const shareUrl = urlUtil.appendQueryToUrl(baseUrl, params.toString());\n  if (shortenUrl) {\n    return await createShortLink(shareUrl);\n  }\n  return shareUrl;\n}\n\nexport function buildSoloUrl(\n  useCurrentTimeRange: boolean,\n  dashboardUid: string,\n  selectedTheme?: string,\n  panel?: PanelModel\n) {\n  const baseUrl = buildBaseUrl();\n  const params = buildParams({ useCurrentTimeRange, selectedTheme, panel });\n\n  let soloUrl = baseUrl.replace(config.appSubUrl + '/dashboard/', config.appSubUrl + '/dashboard-solo/');\n  soloUrl = soloUrl.replace(config.appSubUrl + '/d/', config.appSubUrl + '/d-solo/');\n\n  // For handling the case when default_home_dashboard_path is set in the grafana config\n  const strippedUrl = locationUtil.stripBaseFromUrl(baseUrl);\n  if (strippedUrl === '/') {\n    soloUrl = `${config.appUrl}d-solo/${dashboardUid}`;\n  }\n\n  const panelId = params.get('editPanel') ?? params.get('viewPanel') ?? '';\n  params.set('panelId', panelId);\n  params.delete('editPanel');\n  params.delete('viewPanel');\n\n  return urlUtil.appendQueryToUrl(soloUrl, params.toString());\n}\n\nexport function buildImageUrl(\n  useCurrentTimeRange: boolean,\n  dashboardUid: string,\n  selectedTheme?: string,\n  panel?: PanelModel\n) {\n  let soloUrl = buildSoloUrl(useCurrentTimeRange, dashboardUid, selectedTheme, panel);\n  let imageUrl = soloUrl.replace(config.appSubUrl + '/dashboard-solo/', config.appSubUrl + '/render/dashboard-solo/');\n  imageUrl = imageUrl.replace(config.appSubUrl + '/d-solo/', config.appSubUrl + '/render/d-solo/');\n  imageUrl += '&width=1000&height=500' + getLocalTimeZone();\n  return imageUrl;\n}\n\nexport function buildIframeHtml(\n  useCurrentTimeRange: boolean,\n  dashboardUid: string,\n  selectedTheme?: string,\n  panel?: PanelModel\n) {\n  let soloUrl = buildSoloUrl(useCurrentTimeRange, dashboardUid, selectedTheme, panel);\n  return '<iframe src=\"' + soloUrl + '\" width=\"450\" height=\"200\" frameborder=\"0\"></iframe>';\n}\n\nexport function getLocalTimeZone() {\n  const utcOffset = '&tz=UTC' + encodeURIComponent(dateTime().format('Z'));\n\n  // Older browser does not the internationalization API\n  if (!(window as any).Intl) {\n    return utcOffset;\n  }\n\n  const dateFormat = (window as any).Intl.DateTimeFormat();\n  if (!dateFormat.resolvedOptions) {\n    return utcOffset;\n  }\n\n  const options = dateFormat.resolvedOptions();\n  if (!options.timeZone) {\n    return utcOffset;\n  }\n\n  return '&tz=' + encodeURIComponent(options.timeZone);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}