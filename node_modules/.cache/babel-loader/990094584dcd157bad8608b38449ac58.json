{"ast":null,"code":"var _Icon;\n\nimport { css } from '@emotion/css';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { mergeMap } from 'rxjs/operators';\nimport { transformDataFrame } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Icon, JSONFormatter, useStyles } from '@grafana/ui';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const TransformationEditor = ({\n  debugMode,\n  index,\n  data,\n  uiConfig,\n  configs,\n  onChange\n}) => {\n  const styles = useStyles(getStyles);\n  const [input, setInput] = useState([]);\n  const [output, setOutput] = useState([]);\n  const config = useMemo(() => configs[index], [configs, index]);\n  useEffect(() => {\n    const inputTransforms = configs.slice(0, index).map(t => t.transformation);\n    const outputTransforms = configs.slice(index, index + 1).map(t => t.transformation);\n    const inputSubscription = transformDataFrame(inputTransforms, data).subscribe(setInput);\n    const outputSubscription = transformDataFrame(inputTransforms, data).pipe(mergeMap(before => transformDataFrame(outputTransforms, before))).subscribe(setOutput);\n    return function unsubscribe() {\n      inputSubscription.unsubscribe();\n      outputSubscription.unsubscribe();\n    };\n  }, [index, data, configs]);\n  const editor = useMemo(() => /*#__PURE__*/React.createElement(uiConfig.editor, {\n    options: Object.assign({}, uiConfig.transformation.defaultOptions, config.transformation.options),\n    input,\n    onChange: opts => {\n      onChange(index, {\n        id: config.transformation.id,\n        options: opts\n      });\n    }\n  }), [uiConfig.editor, uiConfig.transformation.defaultOptions, config.transformation.options, config.transformation.id, input, onChange, index]);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.editor,\n    \"aria-label\": selectors.components.TransformTab.transformationEditor(uiConfig.name),\n    children: [editor, debugMode && /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.debugWrapper,\n      \"aria-label\": selectors.components.TransformTab.transformationEditorDebugger(uiConfig.name),\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: styles.debug,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.debugTitle,\n          children: \"Transformation input data\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.debugJson,\n          children: /*#__PURE__*/_jsx(JSONFormatter, {\n            json: input\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.debugSeparator,\n        children: _Icon || (_Icon = /*#__PURE__*/_jsx(Icon, {\n          name: \"arrow-right\"\n        }))\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.debug,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.debugTitle,\n          children: \"Transformation output data\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.debugJson,\n          children: output && /*#__PURE__*/_jsx(JSONFormatter, {\n            json: output\n          })\n        })]\n      })]\n    })]\n  });\n};\n\nconst getStyles = theme => {\n  const debugBorder = theme.isLight ? theme.palette.gray85 : theme.palette.gray15;\n  return {\n    title: css`\n      display: flex;\n      padding: 4px 8px 4px 8px;\n      position: relative;\n      height: 35px;\n      border-radius: 4px 4px 0 0;\n      flex-wrap: nowrap;\n      justify-content: space-between;\n      align-items: center;\n    `,\n    name: css`\n      font-weight: ${theme.typography.weight.semibold};\n      color: ${theme.colors.textBlue};\n    `,\n    iconRow: css`\n      display: flex;\n    `,\n    icon: css`\n      background: transparent;\n      border: none;\n      box-shadow: none;\n      cursor: pointer;\n      color: ${theme.colors.textWeak};\n      margin-left: ${theme.spacing.sm};\n      &:hover {\n        color: ${theme.colors.text};\n      }\n    `,\n    editor: css``,\n    debugWrapper: css`\n      display: flex;\n      flex-direction: row;\n    `,\n    debugSeparator: css`\n      width: 48px;\n      min-height: 300px;\n      display: flex;\n      align-items: center;\n      align-self: stretch;\n      justify-content: center;\n      margin: 0 ${theme.spacing.xs};\n      color: ${theme.colors.textBlue};\n    `,\n    debugTitle: css`\n      padding: ${theme.spacing.sm} ${theme.spacing.xxs};\n      font-family: ${theme.typography.fontFamily.monospace};\n      font-size: ${theme.typography.size.sm};\n      color: ${theme.colors.text};\n      border-bottom: 1px solid ${debugBorder};\n      flex-grow: 0;\n      flex-shrink: 1;\n    `,\n    debug: css`\n      margin-top: ${theme.spacing.sm};\n      padding: 0 ${theme.spacing.sm} ${theme.spacing.sm} ${theme.spacing.sm};\n      border: 1px solid ${debugBorder};\n      background: ${theme.isLight ? theme.palette.white : theme.palette.gray05};\n      border-radius: ${theme.border.radius.sm};\n      width: 100%;\n      min-height: 300px;\n      display: flex;\n      flex-direction: column;\n      align-self: stretch;\n    `,\n    debugJson: css`\n      flex-grow: 1;\n      height: 100%;\n      overflow: hidden;\n      padding: ${theme.spacing.xs};\n    `\n  };\n};","map":{"version":3,"names":["css","React","useEffect","useMemo","useState","mergeMap","transformDataFrame","selectors","Icon","JSONFormatter","useStyles","TransformationEditor","debugMode","index","data","uiConfig","configs","onChange","styles","getStyles","input","setInput","output","setOutput","config","inputTransforms","slice","map","t","transformation","outputTransforms","inputSubscription","subscribe","outputSubscription","pipe","before","unsubscribe","editor","createElement","options","defaultOptions","opts","id","components","TransformTab","transformationEditor","name","debugWrapper","transformationEditorDebugger","debug","debugTitle","debugJson","debugSeparator","theme","debugBorder","isLight","palette","gray85","gray15","title","typography","weight","semibold","colors","textBlue","iconRow","icon","textWeak","spacing","sm","text","xs","xxs","fontFamily","monospace","size","white","gray05","border","radius"],"sources":["/home/soula/grafana/public/app/features/dashboard/components/TransformationsEditor/TransformationEditor.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { mergeMap } from 'rxjs/operators';\n\nimport {\n  DataFrame,\n  DataTransformerConfig,\n  GrafanaTheme,\n  transformDataFrame,\n  TransformerRegistryItem,\n} from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Icon, JSONFormatter, useStyles } from '@grafana/ui';\n\nimport { TransformationsEditorTransformation } from './types';\n\ninterface TransformationEditorProps {\n  debugMode?: boolean;\n  index: number;\n  data: DataFrame[];\n  uiConfig: TransformerRegistryItem<any>;\n  configs: TransformationsEditorTransformation[];\n  onChange: (index: number, config: DataTransformerConfig) => void;\n}\n\nexport const TransformationEditor = ({\n  debugMode,\n  index,\n  data,\n  uiConfig,\n  configs,\n  onChange,\n}: TransformationEditorProps) => {\n  const styles = useStyles(getStyles);\n  const [input, setInput] = useState<DataFrame[]>([]);\n  const [output, setOutput] = useState<DataFrame[]>([]);\n  const config = useMemo(() => configs[index], [configs, index]);\n\n  useEffect(() => {\n    const inputTransforms = configs.slice(0, index).map((t) => t.transformation);\n    const outputTransforms = configs.slice(index, index + 1).map((t) => t.transformation);\n    const inputSubscription = transformDataFrame(inputTransforms, data).subscribe(setInput);\n    const outputSubscription = transformDataFrame(inputTransforms, data)\n      .pipe(mergeMap((before) => transformDataFrame(outputTransforms, before)))\n      .subscribe(setOutput);\n\n    return function unsubscribe() {\n      inputSubscription.unsubscribe();\n      outputSubscription.unsubscribe();\n    };\n  }, [index, data, configs]);\n\n  const editor = useMemo(\n    () =>\n      React.createElement(uiConfig.editor, {\n        options: { ...uiConfig.transformation.defaultOptions, ...config.transformation.options },\n        input,\n        onChange: (opts: any) => {\n          onChange(index, { id: config.transformation.id, options: opts });\n        },\n      }),\n    [\n      uiConfig.editor,\n      uiConfig.transformation.defaultOptions,\n      config.transformation.options,\n      config.transformation.id,\n      input,\n      onChange,\n      index,\n    ]\n  );\n\n  return (\n    <div className={styles.editor} aria-label={selectors.components.TransformTab.transformationEditor(uiConfig.name)}>\n      {editor}\n      {debugMode && (\n        <div\n          className={styles.debugWrapper}\n          aria-label={selectors.components.TransformTab.transformationEditorDebugger(uiConfig.name)}\n        >\n          <div className={styles.debug}>\n            <div className={styles.debugTitle}>Transformation input data</div>\n            <div className={styles.debugJson}>\n              <JSONFormatter json={input} />\n            </div>\n          </div>\n          <div className={styles.debugSeparator}>\n            <Icon name=\"arrow-right\" />\n          </div>\n          <div className={styles.debug}>\n            <div className={styles.debugTitle}>Transformation output data</div>\n            <div className={styles.debugJson}>{output && <JSONFormatter json={output} />}</div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => {\n  const debugBorder = theme.isLight ? theme.palette.gray85 : theme.palette.gray15;\n\n  return {\n    title: css`\n      display: flex;\n      padding: 4px 8px 4px 8px;\n      position: relative;\n      height: 35px;\n      border-radius: 4px 4px 0 0;\n      flex-wrap: nowrap;\n      justify-content: space-between;\n      align-items: center;\n    `,\n    name: css`\n      font-weight: ${theme.typography.weight.semibold};\n      color: ${theme.colors.textBlue};\n    `,\n    iconRow: css`\n      display: flex;\n    `,\n    icon: css`\n      background: transparent;\n      border: none;\n      box-shadow: none;\n      cursor: pointer;\n      color: ${theme.colors.textWeak};\n      margin-left: ${theme.spacing.sm};\n      &:hover {\n        color: ${theme.colors.text};\n      }\n    `,\n    editor: css``,\n    debugWrapper: css`\n      display: flex;\n      flex-direction: row;\n    `,\n    debugSeparator: css`\n      width: 48px;\n      min-height: 300px;\n      display: flex;\n      align-items: center;\n      align-self: stretch;\n      justify-content: center;\n      margin: 0 ${theme.spacing.xs};\n      color: ${theme.colors.textBlue};\n    `,\n    debugTitle: css`\n      padding: ${theme.spacing.sm} ${theme.spacing.xxs};\n      font-family: ${theme.typography.fontFamily.monospace};\n      font-size: ${theme.typography.size.sm};\n      color: ${theme.colors.text};\n      border-bottom: 1px solid ${debugBorder};\n      flex-grow: 0;\n      flex-shrink: 1;\n    `,\n\n    debug: css`\n      margin-top: ${theme.spacing.sm};\n      padding: 0 ${theme.spacing.sm} ${theme.spacing.sm} ${theme.spacing.sm};\n      border: 1px solid ${debugBorder};\n      background: ${theme.isLight ? theme.palette.white : theme.palette.gray05};\n      border-radius: ${theme.border.radius.sm};\n      width: 100%;\n      min-height: 300px;\n      display: flex;\n      flex-direction: column;\n      align-self: stretch;\n    `,\n    debugJson: css`\n      flex-grow: 1;\n      height: 100%;\n      overflow: hidden;\n      padding: ${theme.spacing.xs};\n    `,\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}