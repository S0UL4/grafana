{"ast":null,"code":"let _context;\n\nconst cache = new Map();\nconst cacheLimit = 500;\nlet ctxFontStyle = '';\n/**\n * @internal\n */\n\nexport function getCanvasContext() {\n  if (!_context) {\n    _context = document.createElement('canvas').getContext('2d');\n  }\n\n  return _context;\n}\n/**\n * @beta\n */\n\nexport function measureText(text, fontSize) {\n  const fontStyle = `${fontSize}px 'Roboto'`;\n  const cacheKey = text + fontStyle;\n  const fromCache = cache.get(cacheKey);\n\n  if (fromCache) {\n    return fromCache;\n  }\n\n  const context = getCanvasContext();\n\n  if (ctxFontStyle !== fontStyle) {\n    context.font = ctxFontStyle = fontStyle;\n  }\n\n  const metrics = context.measureText(text);\n\n  if (cache.size === cacheLimit) {\n    cache.clear();\n  }\n\n  cache.set(cacheKey, metrics);\n  return metrics;\n}\n/**\n * @beta\n */\n\nexport function calculateFontSize(text, width, height, lineHeight, maxSize) {\n  // calculate width in 14px\n  const textSize = measureText(text, 14); // how much bigger than 14px can we make it while staying within our width constraints\n\n  const fontSizeBasedOnWidth = width / (textSize.width + 2) * 14;\n  const fontSizeBasedOnHeight = height / lineHeight; // final fontSize\n\n  const optimalSize = Math.min(fontSizeBasedOnHeight, fontSizeBasedOnWidth);\n  return Math.min(optimalSize, maxSize !== null && maxSize !== void 0 ? maxSize : optimalSize);\n}","map":{"version":3,"names":["_context","cache","Map","cacheLimit","ctxFontStyle","getCanvasContext","document","createElement","getContext","measureText","text","fontSize","fontStyle","cacheKey","fromCache","get","context","font","metrics","size","clear","set","calculateFontSize","width","height","lineHeight","maxSize","textSize","fontSizeBasedOnWidth","fontSizeBasedOnHeight","optimalSize","Math","min"],"sources":["/home/soula/grafana/packages/grafana-ui/src/utils/measureText.ts"],"sourcesContent":["let _context: CanvasRenderingContext2D;\nconst cache = new Map<string, TextMetrics>();\nconst cacheLimit = 500;\nlet ctxFontStyle = '';\n\n/**\n * @internal\n */\nexport function getCanvasContext() {\n  if (!_context) {\n    _context = document.createElement('canvas').getContext('2d')!;\n  }\n  return _context;\n}\n\n/**\n * @beta\n */\nexport function measureText(text: string, fontSize: number): TextMetrics {\n  const fontStyle = `${fontSize}px 'Roboto'`;\n  const cacheKey = text + fontStyle;\n  const fromCache = cache.get(cacheKey);\n\n  if (fromCache) {\n    return fromCache;\n  }\n\n  const context = getCanvasContext();\n\n  if (ctxFontStyle !== fontStyle) {\n    context.font = ctxFontStyle = fontStyle;\n  }\n\n  const metrics = context.measureText(text);\n\n  if (cache.size === cacheLimit) {\n    cache.clear();\n  }\n\n  cache.set(cacheKey, metrics);\n\n  return metrics;\n}\n\n/**\n * @beta\n */\nexport function calculateFontSize(text: string, width: number, height: number, lineHeight: number, maxSize?: number) {\n  // calculate width in 14px\n  const textSize = measureText(text, 14);\n  // how much bigger than 14px can we make it while staying within our width constraints\n  const fontSizeBasedOnWidth = (width / (textSize.width + 2)) * 14;\n  const fontSizeBasedOnHeight = height / lineHeight;\n\n  // final fontSize\n  const optimalSize = Math.min(fontSizeBasedOnHeight, fontSizeBasedOnWidth);\n  return Math.min(optimalSize, maxSize ?? optimalSize);\n}\n"],"mappings":"AAAA,IAAIA,QAAJ;;AACA,MAAMC,KAAK,GAAG,IAAIC,GAAJ,EAAd;AACA,MAAMC,UAAU,GAAG,GAAnB;AACA,IAAIC,YAAY,GAAG,EAAnB;AAEA;AACA;AACA;;AACA,OAAO,SAASC,gBAAT,GAA4B;EACjC,IAAI,CAACL,QAAL,EAAe;IACbA,QAAQ,GAAGM,QAAQ,CAACC,aAAT,CAAuB,QAAvB,EAAiCC,UAAjC,CAA4C,IAA5C,CAAX;EACD;;EACD,OAAOR,QAAP;AACD;AAED;AACA;AACA;;AACA,OAAO,SAASS,WAAT,CAAqBC,IAArB,EAAmCC,QAAnC,EAAkE;EACvE,MAAMC,SAAS,GAAI,GAAED,QAAS,aAA9B;EACA,MAAME,QAAQ,GAAGH,IAAI,GAAGE,SAAxB;EACA,MAAME,SAAS,GAAGb,KAAK,CAACc,GAAN,CAAUF,QAAV,CAAlB;;EAEA,IAAIC,SAAJ,EAAe;IACb,OAAOA,SAAP;EACD;;EAED,MAAME,OAAO,GAAGX,gBAAgB,EAAhC;;EAEA,IAAID,YAAY,KAAKQ,SAArB,EAAgC;IAC9BI,OAAO,CAACC,IAAR,GAAeb,YAAY,GAAGQ,SAA9B;EACD;;EAED,MAAMM,OAAO,GAAGF,OAAO,CAACP,WAAR,CAAoBC,IAApB,CAAhB;;EAEA,IAAIT,KAAK,CAACkB,IAAN,KAAehB,UAAnB,EAA+B;IAC7BF,KAAK,CAACmB,KAAN;EACD;;EAEDnB,KAAK,CAACoB,GAAN,CAAUR,QAAV,EAAoBK,OAApB;EAEA,OAAOA,OAAP;AACD;AAED;AACA;AACA;;AACA,OAAO,SAASI,iBAAT,CAA2BZ,IAA3B,EAAyCa,KAAzC,EAAwDC,MAAxD,EAAwEC,UAAxE,EAA4FC,OAA5F,EAA8G;EACnH;EACA,MAAMC,QAAQ,GAAGlB,WAAW,CAACC,IAAD,EAAO,EAAP,CAA5B,CAFmH,CAGnH;;EACA,MAAMkB,oBAAoB,GAAIL,KAAK,IAAII,QAAQ,CAACJ,KAAT,GAAiB,CAArB,CAAN,GAAiC,EAA9D;EACA,MAAMM,qBAAqB,GAAGL,MAAM,GAAGC,UAAvC,CALmH,CAOnH;;EACA,MAAMK,WAAW,GAAGC,IAAI,CAACC,GAAL,CAASH,qBAAT,EAAgCD,oBAAhC,CAApB;EACA,OAAOG,IAAI,CAACC,GAAL,CAASF,WAAT,EAAsBJ,OAAtB,aAAsBA,OAAtB,cAAsBA,OAAtB,GAAiCI,WAAjC,CAAP;AACD"},"metadata":{},"sourceType":"module"}