{"ast":null,"code":"var _div, _div2;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { css, cx } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { DataFrameView, dateTimeFormat, textUtil } from '@grafana/data';\nimport { RefreshEvent } from '@grafana/runtime';\nimport { CustomScrollbar, stylesFactory } from '@grafana/ui';\nimport config from 'app/core/config';\nimport { DEFAULT_FEED_URL } from './constants';\nimport { loadFeed } from './feed';\nimport { feedToDataFrame } from './utils';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport class NewsPanel extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"refreshSubscription\", void 0);\n\n    this.refreshSubscription = this.props.eventBus.subscribe(RefreshEvent, this.loadChannel.bind(this));\n    this.state = {};\n  }\n\n  componentDidMount() {\n    this.loadChannel();\n  }\n\n  componentWillUnmount() {\n    this.refreshSubscription.unsubscribe();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.options.feedUrl !== prevProps.options.feedUrl) {\n      this.loadChannel();\n    }\n  }\n\n  async loadChannel() {\n    const {\n      options\n    } = this.props;\n\n    try {\n      const url = options.feedUrl || DEFAULT_FEED_URL;\n      const feed = await loadFeed(url);\n      const frame = feedToDataFrame(feed);\n      this.setState({\n        news: new DataFrameView(frame),\n        isError: false\n      });\n    } catch (err) {\n      console.error('Error Loading News', err);\n      this.setState({\n        news: undefined,\n        isError: true\n      });\n    }\n  }\n\n  render() {\n    const {\n      width\n    } = this.props;\n    const {\n      showImage\n    } = this.props.options;\n    const {\n      isError,\n      news\n    } = this.state;\n    const styles = getStyles(config.theme2);\n    const useWideLayout = width > 600;\n\n    if (isError) {\n      return _div || (_div = /*#__PURE__*/_jsx(\"div\", {\n        children: \"Error loading RSS feed.\"\n      }));\n    }\n\n    if (!news) {\n      return _div2 || (_div2 = /*#__PURE__*/_jsx(\"div\", {\n        children: \"Loading...\"\n      }));\n    }\n\n    return /*#__PURE__*/_jsx(CustomScrollbar, {\n      autoHeightMin: \"100%\",\n      autoHeightMax: \"100%\",\n      children: news.map((item, index) => {\n        return /*#__PURE__*/_jsxs(\"article\", {\n          className: cx(styles.item, useWideLayout && styles.itemWide),\n          children: [showImage && item.ogImage && /*#__PURE__*/_jsx(\"a\", {\n            tabIndex: -1,\n            href: textUtil.sanitizeUrl(item.link),\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            className: cx(styles.socialImage, useWideLayout && styles.socialImageWide),\n            \"aria-hidden\": true,\n            children: /*#__PURE__*/_jsx(\"img\", {\n              src: item.ogImage,\n              alt: item.title\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.body,\n            children: [/*#__PURE__*/_jsxs(\"time\", {\n              className: styles.date,\n              dateTime: dateTimeFormat(item.date, {\n                format: 'MMM DD'\n              }),\n              children: [dateTimeFormat(item.date, {\n                format: 'MMM DD'\n              }), ' ']\n            }), /*#__PURE__*/_jsx(\"a\", {\n              className: styles.link,\n              href: textUtil.sanitizeUrl(item.link),\n              target: \"_blank\",\n              rel: \"noopener noreferrer\",\n              children: /*#__PURE__*/_jsx(\"h3\", {\n                className: styles.title,\n                children: item.title\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.content,\n              dangerouslySetInnerHTML: {\n                __html: textUtil.sanitize(item.content)\n              }\n            })]\n          })]\n        }, index);\n      })\n    });\n  }\n\n}\nconst getStyles = stylesFactory(theme => ({\n  container: css`\n    height: 100%;\n  `,\n  item: css`\n    display: flex;\n    padding: ${theme.spacing(1)};\n    position: relative;\n    margin-bottom: 4px;\n    margin-right: ${theme.spacing(1)};\n    border-bottom: 2px solid ${theme.colors.border.weak};\n    background: ${theme.colors.background.primary};\n    flex-direction: column;\n    flex-shrink: 0;\n  `,\n  itemWide: css`\n    flex-direction: row;\n  `,\n  body: css`\n    display: flex;\n    flex-direction: column;\n  `,\n  socialImage: css`\n    display: flex;\n    align-items: center;\n    margin-bottom: ${theme.spacing(1)};\n    > img {\n      width: 100%;\n      border-radius: ${theme.shape.borderRadius(2)} ${theme.shape.borderRadius(2)} 0 0;\n    }\n  `,\n  socialImageWide: css`\n    margin-right: ${theme.spacing(2)};\n    margin-bottom: 0;\n    > img {\n      width: 250px;\n      border-radius: ${theme.shape.borderRadius()};\n    }\n  `,\n  link: css`\n    color: ${theme.colors.text.link};\n    display: inline-block;\n\n    &:hover {\n      color: ${theme.colors.text.link};\n      text-decoration: underline;\n    }\n  `,\n  title: css`\n    font-size: 16px;\n    margin-bottom: ${theme.spacing(0.5)};\n  `,\n  content: css`\n    p {\n      margin-bottom: 4px;\n      color: ${theme.colors.text};\n    }\n  `,\n  date: css`\n    margin-bottom: ${theme.spacing(0.5)};\n    font-weight: 500;\n    border-radius: 0 0 0 3px;\n    color: ${theme.colors.text.secondary};\n  `\n}));","map":{"version":3,"names":["css","cx","React","PureComponent","DataFrameView","dateTimeFormat","textUtil","RefreshEvent","CustomScrollbar","stylesFactory","config","DEFAULT_FEED_URL","loadFeed","feedToDataFrame","NewsPanel","constructor","props","refreshSubscription","eventBus","subscribe","loadChannel","bind","state","componentDidMount","componentWillUnmount","unsubscribe","componentDidUpdate","prevProps","options","feedUrl","url","feed","frame","setState","news","isError","err","console","error","undefined","render","width","showImage","styles","getStyles","theme2","useWideLayout","map","item","index","itemWide","ogImage","sanitizeUrl","link","socialImage","socialImageWide","title","body","date","format","content","__html","sanitize","theme","container","spacing","colors","border","weak","background","primary","shape","borderRadius","text","secondary"],"sources":["/home/soula/grafana/public/app/plugins/panel/news/NewsPanel.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { Unsubscribable } from 'rxjs';\n\nimport { PanelProps, DataFrameView, dateTimeFormat, GrafanaTheme2, textUtil } from '@grafana/data';\nimport { RefreshEvent } from '@grafana/runtime';\nimport { CustomScrollbar, stylesFactory } from '@grafana/ui';\nimport config from 'app/core/config';\n\nimport { DEFAULT_FEED_URL } from './constants';\nimport { loadFeed } from './feed';\nimport { PanelOptions } from './models.gen';\nimport { NewsItem } from './types';\nimport { feedToDataFrame } from './utils';\n\ninterface Props extends PanelProps<PanelOptions> {}\n\ninterface State {\n  news?: DataFrameView<NewsItem>;\n  isError?: boolean;\n}\n\nexport class NewsPanel extends PureComponent<Props, State> {\n  private refreshSubscription: Unsubscribable;\n\n  constructor(props: Props) {\n    super(props);\n    this.refreshSubscription = this.props.eventBus.subscribe(RefreshEvent, this.loadChannel.bind(this));\n    this.state = {};\n  }\n\n  componentDidMount(): void {\n    this.loadChannel();\n  }\n\n  componentWillUnmount(): void {\n    this.refreshSubscription.unsubscribe();\n  }\n\n  componentDidUpdate(prevProps: Props): void {\n    if (this.props.options.feedUrl !== prevProps.options.feedUrl) {\n      this.loadChannel();\n    }\n  }\n\n  async loadChannel() {\n    const { options } = this.props;\n    try {\n      const url = options.feedUrl || DEFAULT_FEED_URL;\n\n      const feed = await loadFeed(url);\n      const frame = feedToDataFrame(feed);\n\n      this.setState({\n        news: new DataFrameView<NewsItem>(frame),\n        isError: false,\n      });\n    } catch (err) {\n      console.error('Error Loading News', err);\n\n      this.setState({\n        news: undefined,\n        isError: true,\n      });\n    }\n  }\n\n  render() {\n    const { width } = this.props;\n    const { showImage } = this.props.options;\n    const { isError, news } = this.state;\n    const styles = getStyles(config.theme2);\n    const useWideLayout = width > 600;\n\n    if (isError) {\n      return <div>Error loading RSS feed.</div>;\n    }\n    if (!news) {\n      return <div>Loading...</div>;\n    }\n\n    return (\n      <CustomScrollbar autoHeightMin=\"100%\" autoHeightMax=\"100%\">\n        {news.map((item, index) => {\n          return (\n            <article key={index} className={cx(styles.item, useWideLayout && styles.itemWide)}>\n              {showImage && item.ogImage && (\n                <a\n                  tabIndex={-1}\n                  href={textUtil.sanitizeUrl(item.link)}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className={cx(styles.socialImage, useWideLayout && styles.socialImageWide)}\n                  aria-hidden\n                >\n                  <img src={item.ogImage} alt={item.title} />\n                </a>\n              )}\n              <div className={styles.body}>\n                <time className={styles.date} dateTime={dateTimeFormat(item.date, { format: 'MMM DD' })}>\n                  {dateTimeFormat(item.date, { format: 'MMM DD' })}{' '}\n                </time>\n                <a\n                  className={styles.link}\n                  href={textUtil.sanitizeUrl(item.link)}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  <h3 className={styles.title}>{item.title}</h3>\n                </a>\n                <div className={styles.content} dangerouslySetInnerHTML={{ __html: textUtil.sanitize(item.content) }} />\n              </div>\n            </article>\n          );\n        })}\n      </CustomScrollbar>\n    );\n  }\n}\n\nconst getStyles = stylesFactory((theme: GrafanaTheme2) => ({\n  container: css`\n    height: 100%;\n  `,\n  item: css`\n    display: flex;\n    padding: ${theme.spacing(1)};\n    position: relative;\n    margin-bottom: 4px;\n    margin-right: ${theme.spacing(1)};\n    border-bottom: 2px solid ${theme.colors.border.weak};\n    background: ${theme.colors.background.primary};\n    flex-direction: column;\n    flex-shrink: 0;\n  `,\n  itemWide: css`\n    flex-direction: row;\n  `,\n  body: css`\n    display: flex;\n    flex-direction: column;\n  `,\n  socialImage: css`\n    display: flex;\n    align-items: center;\n    margin-bottom: ${theme.spacing(1)};\n    > img {\n      width: 100%;\n      border-radius: ${theme.shape.borderRadius(2)} ${theme.shape.borderRadius(2)} 0 0;\n    }\n  `,\n  socialImageWide: css`\n    margin-right: ${theme.spacing(2)};\n    margin-bottom: 0;\n    > img {\n      width: 250px;\n      border-radius: ${theme.shape.borderRadius()};\n    }\n  `,\n  link: css`\n    color: ${theme.colors.text.link};\n    display: inline-block;\n\n    &:hover {\n      color: ${theme.colors.text.link};\n      text-decoration: underline;\n    }\n  `,\n  title: css`\n    font-size: 16px;\n    margin-bottom: ${theme.spacing(0.5)};\n  `,\n  content: css`\n    p {\n      margin-bottom: 4px;\n      color: ${theme.colors.text};\n    }\n  `,\n  date: css`\n    margin-bottom: ${theme.spacing(0.5)};\n    font-weight: 500;\n    border-radius: 0 0 0 3px;\n    color: ${theme.colors.text.secondary};\n  `,\n}));\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}