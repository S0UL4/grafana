{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { config, getGrafanaLiveSrv } from '@grafana/runtime';\nimport { Alert, stylesFactory } from '@grafana/ui';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport class LiveConnectionWarning extends PureComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"subscription\", void 0);\n\n    _defineProperty(this, \"styles\", getStyle(config.theme2));\n\n    _defineProperty(this, \"state\", {});\n\n    _defineProperty(this, \"initListener\", () => {\n      const live = getGrafanaLiveSrv();\n\n      if (live) {\n        this.subscription = live.getConnectionState().subscribe({\n          next: v => {\n            this.setState({\n              show: !v\n            });\n          }\n        });\n      }\n    });\n  }\n\n  componentDidMount() {\n    // Only show the error in development mode\n    if (process.env.NODE_ENV === 'development') {\n      // Wait a second to listen for server errors\n      setTimeout(this.initListener, 1500);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n\n  render() {\n    const {\n      show\n    } = this.state;\n\n    if (show) {\n      if (!contextSrv.isSignedIn || !config.liveEnabled || contextSrv.user.orgRole === '') {\n        return null; // do not show the warning for anonymous users or ones with no org (and /login page etc)\n      }\n\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: this.styles.foot,\n        children: /*#__PURE__*/_jsx(Alert, {\n          severity: 'warning',\n          className: this.styles.warn,\n          title: \"connection to server is lost...\"\n        })\n      });\n    }\n\n    return null;\n  }\n\n}\nconst getStyle = stylesFactory(theme => {\n  return {\n    foot: css`\n      position: absolute;\n      bottom: 0px;\n      left: 0px;\n      right: 0px;\n      z-index: 10000;\n      cursor: wait;\n      margin: 16px;\n    `,\n    warn: css`\n      border: 2px solid ${theme.colors.warning.main};\n      max-width: 400px;\n      margin: auto;\n      height: 3em;\n    `\n  };\n});","map":{"version":3,"names":["css","React","PureComponent","config","getGrafanaLiveSrv","Alert","stylesFactory","contextSrv","LiveConnectionWarning","getStyle","theme2","live","subscription","getConnectionState","subscribe","next","v","setState","show","componentDidMount","process","env","NODE_ENV","setTimeout","initListener","componentWillUnmount","unsubscribe","render","state","isSignedIn","liveEnabled","user","orgRole","styles","foot","warn","theme","colors","warning","main"],"sources":["/home/soula/grafana/public/app/features/live/LiveConnectionWarning.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { Unsubscribable } from 'rxjs';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { config, getGrafanaLiveSrv } from '@grafana/runtime';\nimport { Alert, stylesFactory } from '@grafana/ui';\nimport { contextSrv } from 'app/core/services/context_srv';\n\nexport interface Props {}\n\nexport interface State {\n  show?: boolean;\n}\n\nexport class LiveConnectionWarning extends PureComponent<Props, State> {\n  subscription?: Unsubscribable;\n  styles = getStyle(config.theme2);\n  state: State = {};\n\n  componentDidMount() {\n    // Only show the error in development mode\n    if (process.env.NODE_ENV === 'development') {\n      // Wait a second to listen for server errors\n      setTimeout(this.initListener, 1500);\n    }\n  }\n\n  initListener = () => {\n    const live = getGrafanaLiveSrv();\n    if (live) {\n      this.subscription = live.getConnectionState().subscribe({\n        next: (v) => {\n          this.setState({ show: !v });\n        },\n      });\n    }\n  };\n\n  componentWillUnmount() {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n\n  render() {\n    const { show } = this.state;\n    if (show) {\n      if (!contextSrv.isSignedIn || !config.liveEnabled || contextSrv.user.orgRole === '') {\n        return null; // do not show the warning for anonymous users or ones with no org (and /login page etc)\n      }\n\n      return (\n        <div className={this.styles.foot}>\n          <Alert severity={'warning'} className={this.styles.warn} title=\"connection to server is lost...\" />\n        </div>\n      );\n    }\n    return null;\n  }\n}\n\nconst getStyle = stylesFactory((theme: GrafanaTheme2) => {\n  return {\n    foot: css`\n      position: absolute;\n      bottom: 0px;\n      left: 0px;\n      right: 0px;\n      z-index: 10000;\n      cursor: wait;\n      margin: 16px;\n    `,\n    warn: css`\n      border: 2px solid ${theme.colors.warning.main};\n      max-width: 400px;\n      margin: auto;\n      height: 3em;\n    `,\n  };\n});\n"],"mappings":";;AAAA,SAASA,GAAT,QAAoB,cAApB;AACA,OAAOC,KAAP,IAAgBC,aAAhB,QAAqC,OAArC;AAIA,SAASC,MAAT,EAAiBC,iBAAjB,QAA0C,kBAA1C;AACA,SAASC,KAAT,EAAgBC,aAAhB,QAAqC,aAArC;AACA,SAASC,UAAT,QAA2B,+BAA3B;;AAQA,OAAO,MAAMC,qBAAN,SAAoCN,aAApC,CAAgE;EAAA;IAAA;;IAAA;;IAAA,gCAE5DO,QAAQ,CAACN,MAAM,CAACO,MAAR,CAFoD;;IAAA,+BAGtD,EAHsD;;IAAA,sCAatD,MAAM;MACnB,MAAMC,IAAI,GAAGP,iBAAiB,EAA9B;;MACA,IAAIO,IAAJ,EAAU;QACR,KAAKC,YAAL,GAAoBD,IAAI,CAACE,kBAAL,GAA0BC,SAA1B,CAAoC;UACtDC,IAAI,EAAGC,CAAD,IAAO;YACX,KAAKC,QAAL,CAAc;cAAEC,IAAI,EAAE,CAACF;YAAT,CAAd;UACD;QAHqD,CAApC,CAApB;MAKD;IACF,CAtBoE;EAAA;;EAKrEG,iBAAiB,GAAG;IAClB;IACA,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;MAC1C;MACAC,UAAU,CAAC,KAAKC,YAAN,EAAoB,IAApB,CAAV;IACD;EACF;;EAaDC,oBAAoB,GAAG;IACrB,IAAI,KAAKb,YAAT,EAAuB;MACrB,KAAKA,YAAL,CAAkBc,WAAlB;IACD;EACF;;EAEDC,MAAM,GAAG;IACP,MAAM;MAAET;IAAF,IAAW,KAAKU,KAAtB;;IACA,IAAIV,IAAJ,EAAU;MACR,IAAI,CAACX,UAAU,CAACsB,UAAZ,IAA0B,CAAC1B,MAAM,CAAC2B,WAAlC,IAAiDvB,UAAU,CAACwB,IAAX,CAAgBC,OAAhB,KAA4B,EAAjF,EAAqF;QACnF,OAAO,IAAP,CADmF,CACtE;MACd;;MAED,oBACE;QAAK,SAAS,EAAE,KAAKC,MAAL,CAAYC,IAA5B;QAAA,uBACE,KAAC,KAAD;UAAO,QAAQ,EAAE,SAAjB;UAA4B,SAAS,EAAE,KAAKD,MAAL,CAAYE,IAAnD;UAAyD,KAAK,EAAC;QAA/D;MADF,EADF;IAKD;;IACD,OAAO,IAAP;EACD;;AA5CoE;AA+CvE,MAAM1B,QAAQ,GAAGH,aAAa,CAAE8B,KAAD,IAA0B;EACvD,OAAO;IACLF,IAAI,EAAElC,GAAI;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KATS;IAULmC,IAAI,EAAEnC,GAAI;AACd,0BAA0BoC,KAAK,CAACC,MAAN,CAAaC,OAAb,CAAqBC,IAAK;AACpD;AACA;AACA;AACA;EAfS,CAAP;AAiBD,CAlB6B,CAA9B"},"metadata":{},"sourceType":"module"}