{"ast":null,"code":"import { css } from '@emotion/css';\nimport React from 'react';\nimport { FieldMatcherID, PluginState } from '@grafana/data';\nimport { fieldMatchersUI, InlineField, InlineFieldRow, Select, useStyles2 } from '@grafana/ui';\nimport { FieldToConfigMappingEditor } from '../fieldToConfigMapping/FieldToConfigMappingEditor';\nimport { configFromDataTransformer } from './configFromQuery';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport function ConfigFromQueryTransformerEditor({\n  input,\n  onChange,\n  options\n}) {\n  var _options$applyTo;\n\n  const styles = useStyles2(getStyles);\n  const refIds = input.map(x => x.refId).filter(x => x != null).map(x => ({\n    label: x,\n    value: x\n  }));\n  const currentRefId = options.configRefId || 'config';\n  const currentMatcher = (_options$applyTo = options.applyTo) !== null && _options$applyTo !== void 0 ? _options$applyTo : {\n    id: FieldMatcherID.byType,\n    options: 'number'\n  };\n  const matcherUI = fieldMatchersUI.get(currentMatcher.id);\n  const configFrame = input.find(x => x.refId === currentRefId);\n\n  const onRefIdChange = value => {\n    onChange(Object.assign({}, options, {\n      configRefId: value.value || 'config'\n    }));\n  };\n\n  const onMatcherChange = value => {\n    onChange(Object.assign({}, options, {\n      applyTo: {\n        id: value.value\n      }\n    }));\n  };\n\n  const onMatcherConfigChange = matcherOption => {\n    onChange(Object.assign({}, options, {\n      applyTo: {\n        id: currentMatcher.id,\n        options: matcherOption\n      }\n    }));\n  };\n\n  const matchers = fieldMatchersUI.list().filter(o => !o.excludeFromPicker).map(i => ({\n    label: i.name,\n    value: i.id,\n    description: i.description\n  }));\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(InlineFieldRow, {\n      children: /*#__PURE__*/_jsx(InlineField, {\n        label: \"Config query\",\n        labelWidth: 20,\n        children: /*#__PURE__*/_jsx(Select, {\n          onChange: onRefIdChange,\n          options: refIds,\n          value: currentRefId,\n          width: 30\n        })\n      })\n    }), /*#__PURE__*/_jsx(InlineFieldRow, {\n      children: /*#__PURE__*/_jsx(InlineField, {\n        label: \"Apply to\",\n        labelWidth: 20,\n        children: /*#__PURE__*/_jsx(Select, {\n          onChange: onMatcherChange,\n          options: matchers,\n          value: currentMatcher.id,\n          width: 30\n        })\n      })\n    }), /*#__PURE__*/_jsx(InlineFieldRow, {\n      children: /*#__PURE__*/_jsx(InlineField, {\n        label: \"Apply to options\",\n        labelWidth: 20,\n        className: styles.matcherOptions,\n        children: /*#__PURE__*/_jsx(matcherUI.component, {\n          matcher: matcherUI.matcher,\n          data: input,\n          options: currentMatcher.options,\n          onChange: onMatcherConfigChange\n        })\n      })\n    }), /*#__PURE__*/_jsx(InlineFieldRow, {\n      children: configFrame && /*#__PURE__*/_jsx(FieldToConfigMappingEditor, {\n        frame: configFrame,\n        mappings: options.mappings,\n        onChange: mappings => onChange(Object.assign({}, options, {\n          mappings\n        })),\n        withReducers: true\n      })\n    })]\n  });\n}\nexport const configFromQueryTransformRegistryItem = {\n  id: configFromDataTransformer.id,\n  editor: ConfigFromQueryTransformerEditor,\n  transformation: configFromDataTransformer,\n  name: configFromDataTransformer.name,\n  description: configFromDataTransformer.description,\n  state: PluginState.beta,\n  help: `\n### Use cases\n\nThis transformation allows you select one query and from it extract standard options such as\n**Min**, **Max**, **Unit**, and **Thresholds** and apply them to other query results.\nThis enables dynamic query driven visualization configuration.\n\n### Options\n\n- **Config query**: Selet the query that returns the data you want to use as configuration.\n- **Apply to**: Select what fields or series to apply the configuration to.\n- **Apply to options**: Usually a field type or field name regex depending on what option you selected in **Apply to**.\n\n### Field mapping table\n\nBelow the configuration listed above you will find the field table. Here all fields found in the data returned by the config query will be listed along with a **Use as** and **Select** option. This table gives you control over what field should be mapped to which config property and if there are multiple rows which value to select.\n\n## Example\n\nInput[0] (From query: A, name: ServerA)\n\n| Time          | Value |\n| ------------- | ----- |\n| 1626178119127 | 10    |\n| 1626178119129 | 30    |\n\nInput[1] (From query: B)\n\n| Time          | Value |\n| ------------- | ----- |\n| 1626178119127 | 100   |\n| 1626178119129 | 100   |\n\nOutput (Same as Input[0] but now with config on the Value field)\n\n| Time          | Value (config: Max=100) |\n| ------------- | ----------------------- |\n| 1626178119127 | 10                      |\n| 1626178119129 | 30                      |\n\nEach row in the source data becomes a separate field. Each field now also has a maximum\nconfiguration option set. Options such as **min**, **max**, **unit**, and **thresholds** are all part of field configuration, and if they are set like this, they will be used by the visualization instead of any options that are manually configured.\nin the panel editor options pane.\n\n## Value mappings\n\nYou can also transform a query result into value mappings. This is is a bit different because every\nrow in the configuration query result is used to define a single value mapping row. See the following example.\n\nConfig query result:\n\n| Value | Text   | Color |\n| ----- | ------ | ----- |\n| L     | Low    | blue  |\n| M     | Medium | green |\n| H     | High   | red   |\n\nIn the field mapping specify:\n\n| Field | Use as                  | Select     |\n| ----- | ----------------------- | ---------- |\n| Value | Value mappings / Value  | All values |\n| Text  | Value mappings / Text   | All values |\n| Color | Value mappings / Ciolor | All values |\n\nGrafana will build the value mappings from you query result and apply it the the real data query results. You should see values being mapped and colored according to the config query results.\n`\n};\n\nconst getStyles = theme => ({\n  matcherOptions: css`\n    min-width: 404px;\n  `\n});","map":{"version":3,"names":["css","React","FieldMatcherID","PluginState","fieldMatchersUI","InlineField","InlineFieldRow","Select","useStyles2","FieldToConfigMappingEditor","configFromDataTransformer","ConfigFromQueryTransformerEditor","input","onChange","options","styles","getStyles","refIds","map","x","refId","filter","label","value","currentRefId","configRefId","currentMatcher","applyTo","id","byType","matcherUI","get","configFrame","find","onRefIdChange","onMatcherChange","onMatcherConfigChange","matcherOption","matchers","list","o","excludeFromPicker","i","name","description","matcherOptions","matcher","mappings","configFromQueryTransformRegistryItem","editor","transformation","state","beta","help","theme"],"sources":["/home/soula/grafana/public/app/features/transformers/configFromQuery/ConfigFromQueryTransformerEditor.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React from 'react';\n\nimport {\n  FieldMatcherID,\n  GrafanaTheme2,\n  PluginState,\n  SelectableValue,\n  TransformerRegistryItem,\n  TransformerUIProps,\n} from '@grafana/data';\nimport { fieldMatchersUI, InlineField, InlineFieldRow, Select, useStyles2 } from '@grafana/ui';\n\nimport { FieldToConfigMappingEditor } from '../fieldToConfigMapping/FieldToConfigMappingEditor';\n\nimport { configFromDataTransformer, ConfigFromQueryTransformOptions } from './configFromQuery';\n\nexport interface Props extends TransformerUIProps<ConfigFromQueryTransformOptions> {}\n\nexport function ConfigFromQueryTransformerEditor({ input, onChange, options }: Props) {\n  const styles = useStyles2(getStyles);\n\n  const refIds = input\n    .map((x) => x.refId)\n    .filter((x) => x != null)\n    .map((x) => ({ label: x, value: x }));\n\n  const currentRefId = options.configRefId || 'config';\n  const currentMatcher = options.applyTo ?? { id: FieldMatcherID.byType, options: 'number' };\n  const matcherUI = fieldMatchersUI.get(currentMatcher.id);\n  const configFrame = input.find((x) => x.refId === currentRefId);\n\n  const onRefIdChange = (value: SelectableValue<string>) => {\n    onChange({\n      ...options,\n      configRefId: value.value || 'config',\n    });\n  };\n\n  const onMatcherChange = (value: SelectableValue<string>) => {\n    onChange({ ...options, applyTo: { id: value.value! } });\n  };\n\n  const onMatcherConfigChange = (matcherOption: any) => {\n    onChange({ ...options, applyTo: { id: currentMatcher.id, options: matcherOption } });\n  };\n\n  const matchers = fieldMatchersUI\n    .list()\n    .filter((o) => !o.excludeFromPicker)\n    .map<SelectableValue<string>>((i) => ({ label: i.name, value: i.id, description: i.description }));\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label=\"Config query\" labelWidth={20}>\n          <Select onChange={onRefIdChange} options={refIds} value={currentRefId} width={30} />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField label=\"Apply to\" labelWidth={20}>\n          <Select onChange={onMatcherChange} options={matchers} value={currentMatcher.id} width={30} />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField label=\"Apply to options\" labelWidth={20} className={styles.matcherOptions}>\n          <matcherUI.component\n            matcher={matcherUI.matcher}\n            data={input}\n            options={currentMatcher.options}\n            onChange={onMatcherConfigChange}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        {configFrame && (\n          <FieldToConfigMappingEditor\n            frame={configFrame}\n            mappings={options.mappings}\n            onChange={(mappings) => onChange({ ...options, mappings })}\n            withReducers\n          />\n        )}\n      </InlineFieldRow>\n    </>\n  );\n}\n\nexport const configFromQueryTransformRegistryItem: TransformerRegistryItem<ConfigFromQueryTransformOptions> = {\n  id: configFromDataTransformer.id,\n  editor: ConfigFromQueryTransformerEditor,\n  transformation: configFromDataTransformer,\n  name: configFromDataTransformer.name,\n  description: configFromDataTransformer.description,\n  state: PluginState.beta,\n  help: `\n### Use cases\n\nThis transformation allows you select one query and from it extract standard options such as\n**Min**, **Max**, **Unit**, and **Thresholds** and apply them to other query results.\nThis enables dynamic query driven visualization configuration.\n\n### Options\n\n- **Config query**: Selet the query that returns the data you want to use as configuration.\n- **Apply to**: Select what fields or series to apply the configuration to.\n- **Apply to options**: Usually a field type or field name regex depending on what option you selected in **Apply to**.\n\n### Field mapping table\n\nBelow the configuration listed above you will find the field table. Here all fields found in the data returned by the config query will be listed along with a **Use as** and **Select** option. This table gives you control over what field should be mapped to which config property and if there are multiple rows which value to select.\n\n## Example\n\nInput[0] (From query: A, name: ServerA)\n\n| Time          | Value |\n| ------------- | ----- |\n| 1626178119127 | 10    |\n| 1626178119129 | 30    |\n\nInput[1] (From query: B)\n\n| Time          | Value |\n| ------------- | ----- |\n| 1626178119127 | 100   |\n| 1626178119129 | 100   |\n\nOutput (Same as Input[0] but now with config on the Value field)\n\n| Time          | Value (config: Max=100) |\n| ------------- | ----------------------- |\n| 1626178119127 | 10                      |\n| 1626178119129 | 30                      |\n\nEach row in the source data becomes a separate field. Each field now also has a maximum\nconfiguration option set. Options such as **min**, **max**, **unit**, and **thresholds** are all part of field configuration, and if they are set like this, they will be used by the visualization instead of any options that are manually configured.\nin the panel editor options pane.\n\n## Value mappings\n\nYou can also transform a query result into value mappings. This is is a bit different because every\nrow in the configuration query result is used to define a single value mapping row. See the following example.\n\nConfig query result:\n\n| Value | Text   | Color |\n| ----- | ------ | ----- |\n| L     | Low    | blue  |\n| M     | Medium | green |\n| H     | High   | red   |\n\nIn the field mapping specify:\n\n| Field | Use as                  | Select     |\n| ----- | ----------------------- | ---------- |\n| Value | Value mappings / Value  | All values |\n| Text  | Value mappings / Text   | All values |\n| Color | Value mappings / Ciolor | All values |\n\nGrafana will build the value mappings from you query result and apply it the the real data query results. You should see values being mapped and colored according to the config query results.\n`,\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  matcherOptions: css`\n    min-width: 404px;\n  `,\n});\n"],"mappings":"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AAeiC;QAAf,GAHlC;QAIE,YAAY;MAJd;IAFJ,EArBF;EAAA,EADF;AAkCD;AAED,OAAO,MAAMC,oCAA8F,GAAG;EAC5GpB,EAAE,EAAElB,yBAAyB,CAACkB,EAD8E;EAE5GqB,MAAM,EAAEtC,gCAFoG;EAG5GuC,cAAc,EAAExC,yBAH4F;EAI5GiC,IAAI,EAAEjC,yBAAyB,CAACiC,IAJ4E;EAK5GC,WAAW,EAAElC,yBAAyB,CAACkC,WALqE;EAM5GO,KAAK,EAAEhD,WAAW,CAACiD,IANyF;EAO5GC,IAAI,EAAG;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzE8G,CAAvG;;AA4EP,MAAMrC,SAAS,GAAIsC,KAAD,KAA2B;EAC3CT,cAAc,EAAE7C,GAAI;AACtB;AACA;AAH6C,CAA3B,CAAlB"},"metadata":{},"sourceType":"module"}