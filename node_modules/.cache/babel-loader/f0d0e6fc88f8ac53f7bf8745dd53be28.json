{"ast":null,"code":"import { css, cx } from '@emotion/css';\nimport React, { useState } from 'react';\nimport { HorizontalGroup, InlineLabel, useStyles2 } from '@grafana/ui';\nimport { actions } from '../state/actions';\nimport { useDispatch } from '../state/context';\nimport { FunctionEditor } from './FunctionEditor';\nimport { FunctionParamEditor } from './FunctionParamEditor';\nimport { mapFuncInstanceToParams } from './helpers';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\n/**\n * Allows editing function params and removing/moving a function (note: editing function name is not supported)\n */\nexport function GraphiteFunctionEditor({\n  func\n}) {\n  const dispatch = useDispatch();\n  const styles = useStyles2(getStyles); // keep track of mouse over and isExpanded state to display buttons for adding optional/multiple params\n  // only when the user mouse over over the function editor OR any param editor is expanded.\n\n  const [mouseOver, setIsMouseOver] = useState(false);\n  const [expanded, setIsExpanded] = useState(false);\n  let params = mapFuncInstanceToParams(func);\n  params = params.filter((p, index) => {\n    // func.added is set for newly added functions - see autofocus below\n    return index < func.def.params.length && !p.optional || func.added || p.value || expanded || mouseOver;\n  });\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: cx(styles.container, {\n      [styles.error]: func.def.unknown\n    }),\n    onMouseOver: () => setIsMouseOver(true),\n    onMouseLeave: () => setIsMouseOver(false),\n    children: /*#__PURE__*/_jsxs(HorizontalGroup, {\n      spacing: \"none\",\n      children: [/*#__PURE__*/_jsx(FunctionEditor, {\n        func: func,\n        onMoveLeft: () => {\n          dispatch(actions.moveFunction({\n            func,\n            offset: -1\n          }));\n        },\n        onMoveRight: () => {\n          dispatch(actions.moveFunction({\n            func,\n            offset: 1\n          }));\n        },\n        onRemove: () => {\n          dispatch(actions.removeFunction({\n            func\n          }));\n        }\n      }), /*#__PURE__*/_jsx(InlineLabel, {\n        className: styles.label,\n        children: \"(\"\n      }), params.map((editableParam, index) => {\n        return /*#__PURE__*/_jsxs(React.Fragment, {\n          children: [/*#__PURE__*/_jsx(FunctionParamEditor, {\n            autofocus: index === 0 && func.added,\n            editableParam: editableParam,\n            onChange: value => {\n              if (value !== '' || editableParam.optional) {\n                dispatch(actions.updateFunctionParam({\n                  func,\n                  index,\n                  value\n                }));\n              }\n\n              setIsExpanded(false);\n              setIsMouseOver(false);\n            },\n            onExpandedChange: setIsExpanded\n          }), index !== params.length - 1 ? ',' : '']\n        }, index);\n      }), /*#__PURE__*/_jsx(InlineLabel, {\n        className: styles.label,\n        children: \")\"\n      })]\n    })\n  });\n}\n\nconst getStyles = theme => ({\n  container: css({\n    backgroundColor: theme.colors.background.secondary,\n    borderRadius: theme.shape.borderRadius(),\n    marginRight: theme.spacing(0.5),\n    padding: `0 ${theme.spacing(1)}`,\n    height: `${theme.v1.spacing.formInputHeight}px`\n  }),\n  error: css`\n    border: 1px solid ${theme.colors.error.main};\n  `,\n  label: css({\n    padding: 0,\n    margin: 0\n  }),\n  button: css({\n    padding: theme.spacing(0.5)\n  })\n});","map":{"version":3,"names":["css","cx","React","useState","HorizontalGroup","InlineLabel","useStyles2","actions","useDispatch","FunctionEditor","FunctionParamEditor","mapFuncInstanceToParams","GraphiteFunctionEditor","func","dispatch","styles","getStyles","mouseOver","setIsMouseOver","expanded","setIsExpanded","params","filter","p","index","def","length","optional","added","value","container","error","unknown","moveFunction","offset","removeFunction","label","map","editableParam","updateFunctionParam","theme","backgroundColor","colors","background","secondary","borderRadius","shape","marginRight","spacing","padding","height","v1","formInputHeight","main","margin","button"],"sources":["/home/soula/grafana/public/app/plugins/datasource/graphite/components/GraphiteFunctionEditor.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { HorizontalGroup, InlineLabel, useStyles2 } from '@grafana/ui';\n\nimport { FuncInstance } from '../gfunc';\nimport { actions } from '../state/actions';\nimport { useDispatch } from '../state/context';\n\nimport { FunctionEditor } from './FunctionEditor';\nimport { EditableParam, FunctionParamEditor } from './FunctionParamEditor';\nimport { mapFuncInstanceToParams } from './helpers';\n\nexport type FunctionEditorProps = {\n  func: FuncInstance;\n};\n\n/**\n * Allows editing function params and removing/moving a function (note: editing function name is not supported)\n */\nexport function GraphiteFunctionEditor({ func }: FunctionEditorProps) {\n  const dispatch = useDispatch();\n  const styles = useStyles2(getStyles);\n\n  // keep track of mouse over and isExpanded state to display buttons for adding optional/multiple params\n  // only when the user mouse over over the function editor OR any param editor is expanded.\n  const [mouseOver, setIsMouseOver] = useState(false);\n  const [expanded, setIsExpanded] = useState(false);\n\n  let params = mapFuncInstanceToParams(func);\n  params = params.filter((p: EditableParam, index: number) => {\n    // func.added is set for newly added functions - see autofocus below\n    return (index < func.def.params.length && !p.optional) || func.added || p.value || expanded || mouseOver;\n  });\n\n  return (\n    <div\n      className={cx(styles.container, { [styles.error]: func.def.unknown })}\n      onMouseOver={() => setIsMouseOver(true)}\n      onMouseLeave={() => setIsMouseOver(false)}\n    >\n      <HorizontalGroup spacing=\"none\">\n        <FunctionEditor\n          func={func}\n          onMoveLeft={() => {\n            dispatch(actions.moveFunction({ func, offset: -1 }));\n          }}\n          onMoveRight={() => {\n            dispatch(actions.moveFunction({ func, offset: 1 }));\n          }}\n          onRemove={() => {\n            dispatch(actions.removeFunction({ func }));\n          }}\n        />\n        <InlineLabel className={styles.label}>(</InlineLabel>\n        {params.map((editableParam: EditableParam, index: number) => {\n          return (\n            <React.Fragment key={index}>\n              <FunctionParamEditor\n                autofocus={index === 0 && func.added}\n                editableParam={editableParam}\n                onChange={(value) => {\n                  if (value !== '' || editableParam.optional) {\n                    dispatch(actions.updateFunctionParam({ func, index, value }));\n                  }\n                  setIsExpanded(false);\n                  setIsMouseOver(false);\n                }}\n                onExpandedChange={setIsExpanded}\n              />\n              {index !== params.length - 1 ? ',' : ''}\n            </React.Fragment>\n          );\n        })}\n        <InlineLabel className={styles.label}>)</InlineLabel>\n      </HorizontalGroup>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    backgroundColor: theme.colors.background.secondary,\n    borderRadius: theme.shape.borderRadius(),\n    marginRight: theme.spacing(0.5),\n    padding: `0 ${theme.spacing(1)}`,\n    height: `${theme.v1.spacing.formInputHeight}px`,\n  }),\n  error: css`\n    border: 1px solid ${theme.colors.error.main};\n  `,\n  label: css({\n    padding: 0,\n    margin: 0,\n  }),\n  button: css({\n    padding: theme.spacing(0.5),\n  }),\n});\n"],"mappings":"AAAA,SAASA,GAAT,EAAcC,EAAd,QAAwB,cAAxB;AACA,OAAOC,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;AAGA,SAASC,eAAT,EAA0BC,WAA1B,EAAuCC,UAAvC,QAAyD,aAAzD;AAGA,SAASC,OAAT,QAAwB,kBAAxB;AACA,SAASC,WAAT,QAA4B,kBAA5B;AAEA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAAwBC,mBAAxB,QAAmD,uBAAnD;AACA,SAASC,uBAAT,QAAwC,WAAxC;;;;AAMA;AACA;AACA;AACA,OAAO,SAASC,sBAAT,CAAgC;EAAEC;AAAF,CAAhC,EAA+D;EACpE,MAAMC,QAAQ,GAAGN,WAAW,EAA5B;EACA,MAAMO,MAAM,GAAGT,UAAU,CAACU,SAAD,CAAzB,CAFoE,CAIpE;EACA;;EACA,MAAM,CAACC,SAAD,EAAYC,cAAZ,IAA8Bf,QAAQ,CAAC,KAAD,CAA5C;EACA,MAAM,CAACgB,QAAD,EAAWC,aAAX,IAA4BjB,QAAQ,CAAC,KAAD,CAA1C;EAEA,IAAIkB,MAAM,GAAGV,uBAAuB,CAACE,IAAD,CAApC;EACAQ,MAAM,GAAGA,MAAM,CAACC,MAAP,CAAc,CAACC,CAAD,EAAmBC,KAAnB,KAAqC;IAC1D;IACA,OAAQA,KAAK,GAAGX,IAAI,CAACY,GAAL,CAASJ,MAAT,CAAgBK,MAAxB,IAAkC,CAACH,CAAC,CAACI,QAAtC,IAAmDd,IAAI,CAACe,KAAxD,IAAiEL,CAAC,CAACM,KAAnE,IAA4EV,QAA5E,IAAwFF,SAA/F;EACD,CAHQ,CAAT;EAKA,oBACE;IACE,SAAS,EAAEhB,EAAE,CAACc,MAAM,CAACe,SAAR,EAAmB;MAAE,CAACf,MAAM,CAACgB,KAAR,GAAgBlB,IAAI,CAACY,GAAL,CAASO;IAA3B,CAAnB,CADf;IAEE,WAAW,EAAE,MAAMd,cAAc,CAAC,IAAD,CAFnC;IAGE,YAAY,EAAE,MAAMA,cAAc,CAAC,KAAD,CAHpC;IAAA,uBAKE,MAAC,eAAD;MAAiB,OAAO,EAAC,MAAzB;MAAA,wBACE,KAAC,cAAD;QACE,IAAI,EAAEL,IADR;QAEE,UAAU,EAAE,MAAM;UAChBC,QAAQ,CAACP,OAAO,CAAC0B,YAAR,CAAqB;YAAEpB,IAAF;YAAQqB,MAAM,EAAE,CAAC;UAAjB,CAArB,CAAD,CAAR;QACD,CAJH;QAKE,WAAW,EAAE,MAAM;UACjBpB,QAAQ,CAACP,OAAO,CAAC0B,YAAR,CAAqB;YAAEpB,IAAF;YAAQqB,MAAM,EAAE;UAAhB,CAArB,CAAD,CAAR;QACD,CAPH;QAQE,QAAQ,EAAE,MAAM;UACdpB,QAAQ,CAACP,OAAO,CAAC4B,cAAR,CAAuB;YAAEtB;UAAF,CAAvB,CAAD,CAAR;QACD;MAVH,EADF,eAaE,KAAC,WAAD;QAAa,SAAS,EAAEE,MAAM,CAACqB,KAA/B;QAAA;MAAA,EAbF,EAcGf,MAAM,CAACgB,GAAP,CAAW,CAACC,aAAD,EAA+Bd,KAA/B,KAAiD;QAC3D,oBACE,MAAC,KAAD,CAAO,QAAP;UAAA,wBACE,KAAC,mBAAD;YACE,SAAS,EAAEA,KAAK,KAAK,CAAV,IAAeX,IAAI,CAACe,KADjC;YAEE,aAAa,EAAEU,aAFjB;YAGE,QAAQ,EAAGT,KAAD,IAAW;cACnB,IAAIA,KAAK,KAAK,EAAV,IAAgBS,aAAa,CAACX,QAAlC,EAA4C;gBAC1Cb,QAAQ,CAACP,OAAO,CAACgC,mBAAR,CAA4B;kBAAE1B,IAAF;kBAAQW,KAAR;kBAAeK;gBAAf,CAA5B,CAAD,CAAR;cACD;;cACDT,aAAa,CAAC,KAAD,CAAb;cACAF,cAAc,CAAC,KAAD,CAAd;YACD,CATH;YAUE,gBAAgB,EAAEE;UAVpB,EADF,EAaGI,KAAK,KAAKH,MAAM,CAACK,MAAP,GAAgB,CAA1B,GAA8B,GAA9B,GAAoC,EAbvC;QAAA,GAAqBF,KAArB,CADF;MAiBD,CAlBA,CAdH,eAiCE,KAAC,WAAD;QAAa,SAAS,EAAET,MAAM,CAACqB,KAA/B;QAAA;MAAA,EAjCF;IAAA;EALF,EADF;AA2CD;;AAED,MAAMpB,SAAS,GAAIwB,KAAD,KAA2B;EAC3CV,SAAS,EAAE9B,GAAG,CAAC;IACbyC,eAAe,EAAED,KAAK,CAACE,MAAN,CAAaC,UAAb,CAAwBC,SAD5B;IAEbC,YAAY,EAAEL,KAAK,CAACM,KAAN,CAAYD,YAAZ,EAFD;IAGbE,WAAW,EAAEP,KAAK,CAACQ,OAAN,CAAc,GAAd,CAHA;IAIbC,OAAO,EAAG,KAAIT,KAAK,CAACQ,OAAN,CAAc,CAAd,CAAiB,EAJlB;IAKbE,MAAM,EAAG,GAAEV,KAAK,CAACW,EAAN,CAASH,OAAT,CAAiBI,eAAgB;EAL/B,CAAD,CAD6B;EAQ3CrB,KAAK,EAAE/B,GAAI;AACb,wBAAwBwC,KAAK,CAACE,MAAN,CAAaX,KAAb,CAAmBsB,IAAK;AAChD,GAV6C;EAW3CjB,KAAK,EAAEpC,GAAG,CAAC;IACTiD,OAAO,EAAE,CADA;IAETK,MAAM,EAAE;EAFC,CAAD,CAXiC;EAe3CC,MAAM,EAAEvD,GAAG,CAAC;IACViD,OAAO,EAAET,KAAK,CAACQ,OAAN,CAAc,GAAd;EADC,CAAD;AAfgC,CAA3B,CAAlB"},"metadata":{},"sourceType":"module"}