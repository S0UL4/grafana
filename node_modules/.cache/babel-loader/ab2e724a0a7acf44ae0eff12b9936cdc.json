{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport $ from 'jquery';\nimport { EchoEventType, isInteractionEvent, isPageviewEvent } from '@grafana/runtime';\nexport class ApplicationInsightsBackend {\n  constructor(options) {\n    _defineProperty(this, \"supportedEvents\", [EchoEventType.Pageview, EchoEventType.Interaction]);\n\n    _defineProperty(this, \"addEvent\", e => {\n      if (!window.applicationInsights) {\n        return;\n      }\n\n      if (isPageviewEvent(e)) {\n        window.applicationInsights.trackPageView();\n      }\n\n      if (isInteractionEvent(e)) {\n        window.applicationInsights.trackEvent({\n          name: e.payload.interactionName,\n          properties: e.payload.properties\n        });\n      }\n    });\n\n    _defineProperty(this, \"flush\", () => {});\n\n    this.options = options;\n    $.ajax({\n      url: 'https://js.monitor.azure.com/scripts/b/ai.2.min.js',\n      dataType: 'script',\n      cache: true\n    }).done(function () {\n      var applicationInsightsOpts = {\n        config: {\n          connectionString: options.connectionString,\n          endpointUrl: options.endpointUrl\n        }\n      };\n      var init = new window.Microsoft.ApplicationInsights.ApplicationInsights(applicationInsightsOpts);\n      window.applicationInsights = init.loadAppInsights();\n    });\n  }\n\n}","map":{"version":3,"names":["$","EchoEventType","isInteractionEvent","isPageviewEvent","ApplicationInsightsBackend","constructor","options","Pageview","Interaction","e","window","applicationInsights","trackPageView","trackEvent","name","payload","interactionName","properties","ajax","url","dataType","cache","done","applicationInsightsOpts","config","connectionString","endpointUrl","init","Microsoft","ApplicationInsights","loadAppInsights"],"sources":["/home/soula/grafana/public/app/core/services/echo/backends/analytics/ApplicationInsightsBackend.ts"],"sourcesContent":["import $ from 'jquery';\n\nimport {\n  EchoBackend,\n  EchoEventType,\n  InteractionEchoEvent,\n  isInteractionEvent,\n  isPageviewEvent,\n  PageviewEchoEvent,\n} from '@grafana/runtime';\n\nexport interface ApplicationInsightsBackendOptions {\n  connectionString: string;\n  endpointUrl?: string;\n}\n\nexport class ApplicationInsightsBackend implements EchoBackend<PageviewEchoEvent, ApplicationInsightsBackendOptions> {\n  supportedEvents = [EchoEventType.Pageview, EchoEventType.Interaction];\n\n  constructor(public options: ApplicationInsightsBackendOptions) {\n    $.ajax({\n      url: 'https://js.monitor.azure.com/scripts/b/ai.2.min.js',\n      dataType: 'script',\n      cache: true,\n    }).done(function () {\n      var applicationInsightsOpts = {\n        config: {\n          connectionString: options.connectionString,\n          endpointUrl: options.endpointUrl,\n        },\n      };\n      var init = new (window as any).Microsoft.ApplicationInsights.ApplicationInsights(applicationInsightsOpts);\n      (window as any).applicationInsights = init.loadAppInsights();\n    });\n  }\n\n  addEvent = (e: PageviewEchoEvent | InteractionEchoEvent) => {\n    if (!(window as any).applicationInsights) {\n      return;\n    }\n\n    if (isPageviewEvent(e)) {\n      (window as any).applicationInsights.trackPageView();\n    }\n\n    if (isInteractionEvent(e)) {\n      (window as any).applicationInsights.trackEvent({\n        name: e.payload.interactionName,\n        properties: e.payload.properties,\n      });\n    }\n  };\n\n  // Not using Echo buffering, addEvent above sends events to Application Insights as soon as they appear\n  flush = () => {};\n}\n"],"mappings":";;AAAA,OAAOA,CAAP,MAAc,QAAd;AAEA,SAEEC,aAFF,EAIEC,kBAJF,EAKEC,eALF,QAOO,kBAPP;AAcA,OAAO,MAAMC,0BAAN,CAA8G;EAGnHC,WAAW,CAAQC,OAAR,EAAoD;IAAA,yCAF7C,CAACL,aAAa,CAACM,QAAf,EAAyBN,aAAa,CAACO,WAAvC,CAE6C;;IAAA,kCAiBnDC,CAAD,IAAiD;MAC1D,IAAI,CAAEC,MAAD,CAAgBC,mBAArB,EAA0C;QACxC;MACD;;MAED,IAAIR,eAAe,CAACM,CAAD,CAAnB,EAAwB;QACrBC,MAAD,CAAgBC,mBAAhB,CAAoCC,aAApC;MACD;;MAED,IAAIV,kBAAkB,CAACO,CAAD,CAAtB,EAA2B;QACxBC,MAAD,CAAgBC,mBAAhB,CAAoCE,UAApC,CAA+C;UAC7CC,IAAI,EAAEL,CAAC,CAACM,OAAF,CAAUC,eAD6B;UAE7CC,UAAU,EAAER,CAAC,CAACM,OAAF,CAAUE;QAFuB,CAA/C;MAID;IACF,CAhC8D;;IAAA,+BAmCvD,MAAM,CAAE,CAnC+C;;IAAA,KAA5CX,OAA4C,GAA5CA,OAA4C;IAC7DN,CAAC,CAACkB,IAAF,CAAO;MACLC,GAAG,EAAE,oDADA;MAELC,QAAQ,EAAE,QAFL;MAGLC,KAAK,EAAE;IAHF,CAAP,EAIGC,IAJH,CAIQ,YAAY;MAClB,IAAIC,uBAAuB,GAAG;QAC5BC,MAAM,EAAE;UACNC,gBAAgB,EAAEnB,OAAO,CAACmB,gBADpB;UAENC,WAAW,EAAEpB,OAAO,CAACoB;QAFf;MADoB,CAA9B;MAMA,IAAIC,IAAI,GAAG,IAAKjB,MAAD,CAAgBkB,SAAhB,CAA0BC,mBAA1B,CAA8CA,mBAAlD,CAAsEN,uBAAtE,CAAX;MACCb,MAAD,CAAgBC,mBAAhB,GAAsCgB,IAAI,CAACG,eAAL,EAAtC;IACD,CAbD;EAcD;;AAlBkH"},"metadata":{},"sourceType":"module"}