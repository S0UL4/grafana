{"ast":null,"code":"import { useEffect, useState } from 'react';\nimport { useEffectOnce } from 'react-use';\n\nconst modulo = (a, n) => (a % n + n) % n;\n\nconst UNFOCUSED = -1;\n/** @internal */\n\n/** @internal */\nexport const useMenuFocus = ({\n  localRef,\n  isMenuOpen,\n  openedWithArrow,\n  setOpenedWithArrow,\n  close,\n  onOpen,\n  onClose,\n  onKeyDown\n}) => {\n  const [focusedItem, setFocusedItem] = useState(UNFOCUSED);\n  useEffect(() => {\n    if (isMenuOpen && openedWithArrow) {\n      setFocusedItem(0);\n      setOpenedWithArrow === null || setOpenedWithArrow === void 0 ? void 0 : setOpenedWithArrow(false);\n    }\n  }, [isMenuOpen, openedWithArrow, setOpenedWithArrow]);\n  useEffect(() => {\n    var _localRef$current, _menuItems$focusedIte;\n\n    const menuItems = localRef === null || localRef === void 0 ? void 0 : (_localRef$current = localRef.current) === null || _localRef$current === void 0 ? void 0 : _localRef$current.querySelectorAll(`[data-role=\"menuitem\"]`);\n    menuItems === null || menuItems === void 0 ? void 0 : (_menuItems$focusedIte = menuItems[focusedItem]) === null || _menuItems$focusedIte === void 0 ? void 0 : _menuItems$focusedIte.focus();\n    menuItems === null || menuItems === void 0 ? void 0 : menuItems.forEach((menuItem, i) => {\n      menuItem.tabIndex = i === focusedItem ? 0 : -1;\n    });\n  }, [localRef, focusedItem]);\n  useEffectOnce(() => {\n    var _localRef$current2;\n\n    const firstMenuItem = localRef === null || localRef === void 0 ? void 0 : (_localRef$current2 = localRef.current) === null || _localRef$current2 === void 0 ? void 0 : _localRef$current2.querySelector(`[data-role=\"menuitem\"]`);\n\n    if (firstMenuItem) {\n      firstMenuItem.tabIndex = 0;\n    }\n\n    onOpen === null || onOpen === void 0 ? void 0 : onOpen(setFocusedItem);\n  });\n\n  const handleKeys = event => {\n    var _localRef$current3, _menuItems$length, _menuItems$focusedIte2;\n\n    const menuItems = localRef === null || localRef === void 0 ? void 0 : (_localRef$current3 = localRef.current) === null || _localRef$current3 === void 0 ? void 0 : _localRef$current3.querySelectorAll(`[data-role=\"menuitem\"]`);\n    const menuItemsCount = (_menuItems$length = menuItems === null || menuItems === void 0 ? void 0 : menuItems.length) !== null && _menuItems$length !== void 0 ? _menuItems$length : 0;\n\n    switch (event.key) {\n      case 'ArrowUp':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(modulo(focusedItem - 1, menuItemsCount));\n        break;\n\n      case 'ArrowDown':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(modulo(focusedItem + 1, menuItemsCount));\n        break;\n\n      case 'ArrowLeft':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(UNFOCUSED);\n        close === null || close === void 0 ? void 0 : close();\n        break;\n\n      case 'Home':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(0);\n        break;\n\n      case 'End':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(menuItemsCount - 1);\n        break;\n\n      case 'Enter':\n        event.preventDefault();\n        event.stopPropagation();\n        menuItems === null || menuItems === void 0 ? void 0 : (_menuItems$focusedIte2 = menuItems[focusedItem]) === null || _menuItems$focusedIte2 === void 0 ? void 0 : _menuItems$focusedIte2.click();\n        break;\n\n      case 'Escape':\n        event.preventDefault();\n        event.stopPropagation();\n        onClose === null || onClose === void 0 ? void 0 : onClose();\n        break;\n\n      case 'Tab':\n        onClose === null || onClose === void 0 ? void 0 : onClose();\n        break;\n\n      default:\n        break;\n    } // Forward event to parent\n\n\n    onKeyDown === null || onKeyDown === void 0 ? void 0 : onKeyDown(event);\n  };\n\n  const handleFocus = () => {\n    if (focusedItem === UNFOCUSED) {\n      setFocusedItem(0);\n    }\n  };\n\n  return [handleKeys, handleFocus];\n};","map":{"version":3,"names":["useEffect","useState","useEffectOnce","modulo","a","n","UNFOCUSED","useMenuFocus","localRef","isMenuOpen","openedWithArrow","setOpenedWithArrow","close","onOpen","onClose","onKeyDown","focusedItem","setFocusedItem","menuItems","current","querySelectorAll","focus","forEach","menuItem","i","tabIndex","firstMenuItem","querySelector","handleKeys","event","menuItemsCount","length","key","preventDefault","stopPropagation","click","handleFocus"],"sources":["/home/soula/grafana/packages/grafana-ui/src/components/Menu/hooks.ts"],"sourcesContent":["import { RefObject, useEffect, useState } from 'react';\nimport { useEffectOnce } from 'react-use';\n\nimport { MenuItemElement } from './MenuItem';\n\nconst modulo = (a: number, n: number) => ((a % n) + n) % n;\nconst UNFOCUSED = -1;\n\n/** @internal */\nexport interface UseMenuFocusProps {\n  localRef: RefObject<HTMLDivElement>;\n  isMenuOpen?: boolean;\n  openedWithArrow?: boolean;\n  setOpenedWithArrow?: (openedWithArrow: boolean) => void;\n  close?: () => void;\n  onOpen?: (focusOnItem: (itemId: number) => void) => void;\n  onClose?: () => void;\n  onKeyDown?: React.KeyboardEventHandler;\n}\n\n/** @internal */\nexport type UseMenuFocusReturn = [(event: React.KeyboardEvent) => void, () => void];\n\n/** @internal */\nexport const useMenuFocus = ({\n  localRef,\n  isMenuOpen,\n  openedWithArrow,\n  setOpenedWithArrow,\n  close,\n  onOpen,\n  onClose,\n  onKeyDown,\n}: UseMenuFocusProps): UseMenuFocusReturn => {\n  const [focusedItem, setFocusedItem] = useState(UNFOCUSED);\n\n  useEffect(() => {\n    if (isMenuOpen && openedWithArrow) {\n      setFocusedItem(0);\n      setOpenedWithArrow?.(false);\n    }\n  }, [isMenuOpen, openedWithArrow, setOpenedWithArrow]);\n\n  useEffect(() => {\n    const menuItems = localRef?.current?.querySelectorAll(`[data-role=\"menuitem\"]`);\n    (menuItems?.[focusedItem] as MenuItemElement)?.focus();\n    menuItems?.forEach((menuItem, i) => {\n      (menuItem as MenuItemElement).tabIndex = i === focusedItem ? 0 : -1;\n    });\n  }, [localRef, focusedItem]);\n\n  useEffectOnce(() => {\n    const firstMenuItem = localRef?.current?.querySelector(`[data-role=\"menuitem\"]`) as MenuItemElement | null;\n    if (firstMenuItem) {\n      firstMenuItem.tabIndex = 0;\n    }\n    onOpen?.(setFocusedItem);\n  });\n\n  const handleKeys = (event: React.KeyboardEvent) => {\n    const menuItems = localRef?.current?.querySelectorAll(`[data-role=\"menuitem\"]`);\n    const menuItemsCount = menuItems?.length ?? 0;\n\n    switch (event.key) {\n      case 'ArrowUp':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(modulo(focusedItem - 1, menuItemsCount));\n        break;\n      case 'ArrowDown':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(modulo(focusedItem + 1, menuItemsCount));\n        break;\n      case 'ArrowLeft':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(UNFOCUSED);\n        close?.();\n        break;\n      case 'Home':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(0);\n        break;\n      case 'End':\n        event.preventDefault();\n        event.stopPropagation();\n        setFocusedItem(menuItemsCount - 1);\n        break;\n      case 'Enter':\n        event.preventDefault();\n        event.stopPropagation();\n        (menuItems?.[focusedItem] as MenuItemElement)?.click();\n        break;\n      case 'Escape':\n        event.preventDefault();\n        event.stopPropagation();\n        onClose?.();\n        break;\n      case 'Tab':\n        onClose?.();\n        break;\n      default:\n        break;\n    }\n\n    // Forward event to parent\n    onKeyDown?.(event);\n  };\n\n  const handleFocus = () => {\n    if (focusedItem === UNFOCUSED) {\n      setFocusedItem(0);\n    }\n  };\n\n  return [handleKeys, handleFocus];\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}