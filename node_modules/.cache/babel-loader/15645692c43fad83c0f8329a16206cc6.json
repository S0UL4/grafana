{"ast":null,"code":"var _div, _br, _Label, _br2, _Label2, _br3, _br4;\n\nimport { css } from '@emotion/css';\nimport React, { useMemo } from 'react';\nimport { getFrameDisplayName, getFieldDisplayName } from '@grafana/data';\nimport { IconButton, Label, Select, stylesFactory, useTheme } from '@grafana/ui';\nimport { getXYDimensions, isGraphable } from './dims';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const XYDimsEditor = ({\n  value,\n  onChange,\n  context\n}) => {\n  var _frameNames$find;\n\n  const frameNames = useMemo(() => {\n    var _context$data;\n\n    if (context !== null && context !== void 0 && (_context$data = context.data) !== null && _context$data !== void 0 && _context$data.length) {\n      return context.data.map((f, idx) => ({\n        value: idx,\n        label: getFrameDisplayName(f, idx)\n      }));\n    }\n\n    return [{\n      value: 0,\n      label: 'First result'\n    }];\n  }, [context.data]);\n  const dims = useMemo(() => getXYDimensions(value, context.data), [context.data, value]);\n  const info = useMemo(() => {\n    var _value$frame;\n\n    const first = {\n      label: '?',\n      value: undefined // empty\n\n    };\n    const v = {\n      numberFields: [first],\n      yFields: [],\n      xAxis: value !== null && value !== void 0 && value.x ? {\n        label: `${value.x} (Not found)`,\n        value: value.x // empty\n\n      } : first\n    };\n    const frame = context.data ? context.data[(_value$frame = value === null || value === void 0 ? void 0 : value.frame) !== null && _value$frame !== void 0 ? _value$frame : 0] : undefined;\n\n    if (frame) {\n      const xName = dims.x ? getFieldDisplayName(dims.x, dims.frame, context.data) : undefined;\n\n      for (let field of frame.fields) {\n        if (isGraphable(field)) {\n          const name = getFieldDisplayName(field, frame, context.data);\n          const sel = {\n            label: name,\n            value: name\n          };\n          v.numberFields.push(sel);\n\n          if (first.label === '?') {\n            first.label = `${name} (First)`;\n          }\n\n          if (value !== null && value !== void 0 && value.x && name === value.x) {\n            v.xAxis = sel;\n          }\n\n          if (xName !== name) {\n            var _value$exclude;\n\n            v.yFields.push({\n              label: name,\n              value: value === null || value === void 0 ? void 0 : (_value$exclude = value.exclude) === null || _value$exclude === void 0 ? void 0 : _value$exclude.includes(name)\n            });\n          }\n        }\n      }\n    }\n\n    return v;\n  }, [dims, context.data, value]);\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  if (!context.data) {\n    return _div || (_div = /*#__PURE__*/_jsx(\"div\", {\n      children: \"No data...\"\n    }));\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(Select, {\n      options: frameNames,\n      value: (_frameNames$find = frameNames.find(v => v.value === (value === null || value === void 0 ? void 0 : value.frame))) !== null && _frameNames$find !== void 0 ? _frameNames$find : frameNames[0],\n      onChange: v => {\n        onChange(Object.assign({}, value, {\n          frame: v.value\n        }));\n      }\n    }), _br || (_br = /*#__PURE__*/_jsx(\"br\", {})), _Label || (_Label = /*#__PURE__*/_jsx(Label, {\n      children: \"X Field\"\n    })), /*#__PURE__*/_jsx(Select, {\n      options: info.numberFields,\n      value: info.xAxis,\n      onChange: v => {\n        onChange(Object.assign({}, value, {\n          x: v.value\n        }));\n      }\n    }), _br2 || (_br2 = /*#__PURE__*/_jsx(\"br\", {})), _Label2 || (_Label2 = /*#__PURE__*/_jsx(Label, {\n      children: \"Y Fields\"\n    })), /*#__PURE__*/_jsx(\"div\", {\n      children: info.yFields.map(v => /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.row,\n        children: [/*#__PURE__*/_jsx(IconButton, {\n          name: v.value ? 'eye-slash' : 'eye',\n          onClick: () => {\n            const exclude = value !== null && value !== void 0 && value.exclude ? [...value.exclude] : [];\n            let idx = exclude.indexOf(v.label);\n\n            if (idx < 0) {\n              exclude.push(v.label);\n            } else {\n              exclude.splice(idx, 1);\n            }\n\n            onChange(Object.assign({}, value, {\n              exclude\n            }));\n          }\n        }), v.label]\n      }, v.label))\n    }), _br3 || (_br3 = /*#__PURE__*/_jsx(\"br\", {})), \" \", _br4 || (_br4 = /*#__PURE__*/_jsx(\"br\", {}))]\n  });\n};\nconst getStyles = stylesFactory(theme => ({\n  sorter: css`\n    margin-top: 10px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n    cursor: pointer;\n  `,\n  row: css`\n    padding: ${theme.spacing.xs} ${theme.spacing.sm};\n    border-radius: ${theme.border.radius.sm};\n    background: ${theme.colors.bg2};\n    min-height: ${theme.spacing.formInputHeight}px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n    margin-bottom: 3px;\n    border: 1px solid ${theme.colors.formInputBorder};\n  `\n}));","map":{"version":3,"names":["css","React","useMemo","getFrameDisplayName","getFieldDisplayName","IconButton","Label","Select","stylesFactory","useTheme","getXYDimensions","isGraphable","XYDimsEditor","value","onChange","context","frameNames","data","length","map","f","idx","label","dims","info","first","undefined","v","numberFields","yFields","xAxis","x","frame","xName","field","fields","name","sel","push","exclude","includes","theme","styles","getStyles","find","row","indexOf","splice","sorter","spacing","xs","sm","border","radius","colors","bg2","formInputHeight","formInputBorder"],"sources":["/home/soula/grafana/public/app/plugins/panel/xychart/XYDimsEditor.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { FC, useMemo } from 'react';\n\nimport {\n  SelectableValue,\n  getFrameDisplayName,\n  GrafanaTheme,\n  StandardEditorProps,\n  getFieldDisplayName,\n} from '@grafana/data';\nimport { IconButton, Label, Select, stylesFactory, useTheme } from '@grafana/ui';\n\nimport { getXYDimensions, isGraphable } from './dims';\nimport { XYDimensionConfig, XYChartOptions } from './models.gen';\n\ninterface XYInfo {\n  numberFields: Array<SelectableValue<string>>;\n  xAxis: SelectableValue<string>;\n  yFields: Array<SelectableValue<boolean>>;\n}\n\nexport const XYDimsEditor: FC<StandardEditorProps<XYDimensionConfig, any, XYChartOptions>> = ({\n  value,\n  onChange,\n  context,\n}) => {\n  const frameNames = useMemo(() => {\n    if (context?.data?.length) {\n      return context.data.map((f, idx) => ({\n        value: idx,\n        label: getFrameDisplayName(f, idx),\n      }));\n    }\n    return [{ value: 0, label: 'First result' }];\n  }, [context.data]);\n\n  const dims = useMemo(() => getXYDimensions(value, context.data), [context.data, value]);\n\n  const info = useMemo(() => {\n    const first = {\n      label: '?',\n      value: undefined, // empty\n    };\n    const v: XYInfo = {\n      numberFields: [first],\n      yFields: [],\n      xAxis: value?.x\n        ? {\n            label: `${value.x} (Not found)`,\n            value: value.x, // empty\n          }\n        : first,\n    };\n    const frame = context.data ? context.data[value?.frame ?? 0] : undefined;\n    if (frame) {\n      const xName = dims.x ? getFieldDisplayName(dims.x, dims.frame, context.data) : undefined;\n      for (let field of frame.fields) {\n        if (isGraphable(field)) {\n          const name = getFieldDisplayName(field, frame, context.data);\n          const sel = {\n            label: name,\n            value: name,\n          };\n          v.numberFields.push(sel);\n          if (first.label === '?') {\n            first.label = `${name} (First)`;\n          }\n          if (value?.x && name === value.x) {\n            v.xAxis = sel;\n          }\n          if (xName !== name) {\n            v.yFields.push({\n              label: name,\n              value: value?.exclude?.includes(name),\n            });\n          }\n        }\n      }\n    }\n\n    return v;\n  }, [dims, context.data, value]);\n\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  if (!context.data) {\n    return <div>No data...</div>;\n  }\n\n  return (\n    <div>\n      <Select\n        options={frameNames}\n        value={frameNames.find((v) => v.value === value?.frame) ?? frameNames[0]}\n        onChange={(v) => {\n          onChange({\n            ...value,\n            frame: v.value!,\n          });\n        }}\n      />\n      <br />\n      <Label>X Field</Label>\n      <Select\n        options={info.numberFields}\n        value={info.xAxis}\n        onChange={(v) => {\n          onChange({\n            ...value,\n            x: v.value,\n          });\n        }}\n      />\n      <br />\n      <Label>Y Fields</Label>\n      <div>\n        {info.yFields.map((v) => (\n          <div key={v.label} className={styles.row}>\n            <IconButton\n              name={v.value ? 'eye-slash' : 'eye'}\n              onClick={() => {\n                const exclude: string[] = value?.exclude ? [...value.exclude] : [];\n                let idx = exclude.indexOf(v.label!);\n                if (idx < 0) {\n                  exclude.push(v.label!);\n                } else {\n                  exclude.splice(idx, 1);\n                }\n                onChange({\n                  ...value,\n                  exclude,\n                });\n              }}\n            />\n            {v.label}\n          </div>\n        ))}\n      </div>\n      <br /> <br />\n    </div>\n  );\n};\n\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\n  sorter: css`\n    margin-top: 10px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n    cursor: pointer;\n  `,\n\n  row: css`\n    padding: ${theme.spacing.xs} ${theme.spacing.sm};\n    border-radius: ${theme.border.radius.sm};\n    background: ${theme.colors.bg2};\n    min-height: ${theme.spacing.formInputHeight}px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n    margin-bottom: 3px;\n    border: 1px solid ${theme.colors.formInputBorder};\n  `,\n}));\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}