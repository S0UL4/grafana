{"ast":null,"code":"var _RenderResults;\n\nimport { css } from '@emotion/css';\nimport { FocusScope } from '@react-aria/focus';\nimport { KBarAnimator, KBarPortal, KBarPositioner, KBarResults, KBarSearch, useMatches, VisualState, useRegisterActions, useKBar } from 'kbar';\nimport React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { reportInteraction, locationService } from '@grafana/runtime';\nimport { useStyles2 } from '@grafana/ui';\nimport { keybindingSrv } from '../../core/services/keybindingSrv';\nimport { ResultItem } from './ResultItem';\nimport getDashboardNavActions from './actions/dashboard.nav.actions';\nimport getGlobalActions from './actions/global.static.actions';\n/**\n * Wrap all the components from KBar here.\n * @constructor\n */\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const CommandPalette = () => {\n  const styles = useStyles2(getSearchStyles);\n  const [actions, setActions] = useState([]);\n  const [staticActions, setStaticActions] = useState([]);\n  const {\n    query,\n    showing\n  } = useKBar(state => ({\n    showing: state.visualState === VisualState.showing\n  }));\n  const isNotLogin = locationService.getLocation().pathname !== '/login';\n  const {\n    navBarTree\n  } = useSelector(state => {\n    return {\n      navBarTree: state.navBarTree\n    };\n  });\n  useEffect(() => {\n    (async () => {\n      if (isNotLogin) {\n        setStaticActions(getGlobalActions(navBarTree));\n        setActions(staticActions);\n      }\n    })(); // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [isNotLogin, navBarTree]);\n  useEffect(() => {\n    if (showing) {\n      reportInteraction('commandPalette_opened'); // Do dashboard search on demand\n\n      getDashboardNavActions('go/dashboard').then(dashAct => {\n        setActions([...staticActions, ...dashAct]);\n      });\n      keybindingSrv.bindGlobal('esc', () => {\n        query.setVisualState(VisualState.animatingOut);\n      });\n    }\n\n    return () => {\n      keybindingSrv.bindGlobal('esc', () => {\n        keybindingSrv.globalEsc();\n      });\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showing]);\n  useRegisterActions(actions, [actions]);\n  return actions.length > 0 ? /*#__PURE__*/_jsx(KBarPortal, {\n    children: /*#__PURE__*/_jsx(KBarPositioner, {\n      className: styles.positioner,\n      children: /*#__PURE__*/_jsx(KBarAnimator, {\n        className: styles.animator,\n        children: /*#__PURE__*/_jsxs(FocusScope, {\n          contain: true,\n          children: [/*#__PURE__*/_jsx(KBarSearch, {\n            className: styles.search\n          }), _RenderResults || (_RenderResults = /*#__PURE__*/_jsx(RenderResults, {}))]\n        })\n      })\n    })\n  }) : null;\n};\n\nconst RenderResults = () => {\n  const {\n    results,\n    rootActionId\n  } = useMatches();\n  const styles = useStyles2(getSearchStyles);\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: styles.resultsContainer,\n    children: /*#__PURE__*/_jsx(KBarResults, {\n      items: results,\n      onRender: ({\n        item,\n        active\n      }) => typeof item === 'string' ? /*#__PURE__*/_jsx(\"div\", {\n        className: styles.sectionHeader,\n        children: item\n      }) : /*#__PURE__*/_jsx(ResultItem, {\n        action: item,\n        active: active,\n        currentRootActionId: rootActionId\n      })\n    })\n  });\n};\n\nconst getSearchStyles = theme => ({\n  positioner: css({\n    zIndex: theme.zIndex.portal,\n    marginTop: '0px',\n    '&::before': {\n      content: '\"\"',\n      position: 'fixed',\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      background: theme.components.overlay.background,\n      backdropFilter: 'blur(1px)'\n    }\n  }),\n  animator: css({\n    maxWidth: theme.breakpoints.values.sm,\n    // supposed to be 600...\n    width: '100%',\n    background: theme.colors.background.canvas,\n    color: theme.colors.text.primary,\n    borderRadius: theme.shape.borderRadius(4),\n    overflow: 'hidden',\n    boxShadow: theme.shadows.z3\n  }),\n  search: css({\n    padding: theme.spacing(2, 3),\n    fontSize: theme.typography.fontSize,\n    width: '100%',\n    boxSizing: 'border-box',\n    outline: 'none',\n    border: 'none',\n    background: theme.colors.background.canvas,\n    color: theme.colors.text.primary,\n    borderBottom: `1px solid ${theme.colors.border.weak}`\n  }),\n  sectionHeader: css({\n    padding: theme.spacing(1, 2),\n    fontSize: theme.typography.h6.fontSize,\n    fontWeight: theme.typography.body.fontWeight,\n    color: theme.colors.text.secondary\n  }),\n  resultsContainer: css({\n    padding: theme.spacing(2, 0)\n  })\n});","map":{"version":3,"names":["css","FocusScope","KBarAnimator","KBarPortal","KBarPositioner","KBarResults","KBarSearch","useMatches","VisualState","useRegisterActions","useKBar","React","useEffect","useState","useSelector","reportInteraction","locationService","useStyles2","keybindingSrv","ResultItem","getDashboardNavActions","getGlobalActions","CommandPalette","styles","getSearchStyles","actions","setActions","staticActions","setStaticActions","query","showing","state","visualState","isNotLogin","getLocation","pathname","navBarTree","then","dashAct","bindGlobal","setVisualState","animatingOut","globalEsc","length","positioner","animator","search","RenderResults","results","rootActionId","resultsContainer","item","active","sectionHeader","theme","zIndex","portal","marginTop","content","position","top","right","bottom","left","background","components","overlay","backdropFilter","maxWidth","breakpoints","values","sm","width","colors","canvas","color","text","primary","borderRadius","shape","overflow","boxShadow","shadows","z3","padding","spacing","fontSize","typography","boxSizing","outline","border","borderBottom","weak","h6","fontWeight","body","secondary"],"sources":["/home/soula/grafana/public/app/features/commandPalette/CommandPalette.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport { FocusScope } from '@react-aria/focus';\nimport {\n  KBarAnimator,\n  KBarPortal,\n  KBarPositioner,\n  KBarResults,\n  KBarSearch,\n  useMatches,\n  Action,\n  VisualState,\n  useRegisterActions,\n  useKBar,\n} from 'kbar';\nimport React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction, locationService } from '@grafana/runtime';\nimport { useStyles2 } from '@grafana/ui';\nimport { StoreState } from 'app/types';\n\nimport { keybindingSrv } from '../../core/services/keybindingSrv';\n\nimport { ResultItem } from './ResultItem';\nimport getDashboardNavActions from './actions/dashboard.nav.actions';\nimport getGlobalActions from './actions/global.static.actions';\n\n/**\n * Wrap all the components from KBar here.\n * @constructor\n */\n\nexport const CommandPalette = () => {\n  const styles = useStyles2(getSearchStyles);\n  const [actions, setActions] = useState<Action[]>([]);\n  const [staticActions, setStaticActions] = useState<Action[]>([]);\n  const { query, showing } = useKBar((state) => ({\n    showing: state.visualState === VisualState.showing,\n  }));\n  const isNotLogin = locationService.getLocation().pathname !== '/login';\n\n  const { navBarTree } = useSelector((state: StoreState) => {\n    return {\n      navBarTree: state.navBarTree,\n    };\n  });\n\n  useEffect(() => {\n    (async () => {\n      if (isNotLogin) {\n        setStaticActions(getGlobalActions(navBarTree));\n        setActions(staticActions);\n      }\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isNotLogin, navBarTree]);\n\n  useEffect(() => {\n    if (showing) {\n      reportInteraction('commandPalette_opened');\n\n      // Do dashboard search on demand\n      getDashboardNavActions('go/dashboard').then((dashAct) => {\n        setActions([...staticActions, ...dashAct]);\n      });\n\n      keybindingSrv.bindGlobal('esc', () => {\n        query.setVisualState(VisualState.animatingOut);\n      });\n    }\n\n    return () => {\n      keybindingSrv.bindGlobal('esc', () => {\n        keybindingSrv.globalEsc();\n      });\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showing]);\n\n  useRegisterActions(actions, [actions]);\n\n  return actions.length > 0 ? (\n    <KBarPortal>\n      <KBarPositioner className={styles.positioner}>\n        <KBarAnimator className={styles.animator}>\n          <FocusScope contain>\n            <KBarSearch className={styles.search} />\n            <RenderResults />\n          </FocusScope>\n        </KBarAnimator>\n      </KBarPositioner>\n    </KBarPortal>\n  ) : null;\n};\n\nconst RenderResults = () => {\n  const { results, rootActionId } = useMatches();\n  const styles = useStyles2(getSearchStyles);\n\n  return (\n    <div className={styles.resultsContainer}>\n      <KBarResults\n        items={results}\n        onRender={({ item, active }) =>\n          typeof item === 'string' ? (\n            <div className={styles.sectionHeader}>{item}</div>\n          ) : (\n            <ResultItem action={item} active={active} currentRootActionId={rootActionId!} />\n          )\n        }\n      />\n    </div>\n  );\n};\n\nconst getSearchStyles = (theme: GrafanaTheme2) => ({\n  positioner: css({\n    zIndex: theme.zIndex.portal,\n    marginTop: '0px',\n    '&::before': {\n      content: '\"\"',\n      position: 'fixed',\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      background: theme.components.overlay.background,\n      backdropFilter: 'blur(1px)',\n    },\n  }),\n  animator: css({\n    maxWidth: theme.breakpoints.values.sm, // supposed to be 600...\n    width: '100%',\n    background: theme.colors.background.canvas,\n    color: theme.colors.text.primary,\n    borderRadius: theme.shape.borderRadius(4),\n    overflow: 'hidden',\n    boxShadow: theme.shadows.z3,\n  }),\n  search: css({\n    padding: theme.spacing(2, 3),\n    fontSize: theme.typography.fontSize,\n    width: '100%',\n    boxSizing: 'border-box',\n    outline: 'none',\n    border: 'none',\n    background: theme.colors.background.canvas,\n    color: theme.colors.text.primary,\n    borderBottom: `1px solid ${theme.colors.border.weak}`,\n  }),\n  sectionHeader: css({\n    padding: theme.spacing(1, 2),\n    fontSize: theme.typography.h6.fontSize,\n    fontWeight: theme.typography.body.fontWeight,\n    color: theme.colors.text.secondary,\n  }),\n  resultsContainer: css({\n    padding: theme.spacing(2, 0),\n  }),\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}