{"ast":null,"code":"import React from 'react';\nimport { isDateTime, toUtc } from '@grafana/data';\nimport { TimeRangePicker } from '@grafana/ui';\nimport { LocalStorageValueProvider } from '../LocalStorageValueProvider';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst LOCAL_STORAGE_KEY = 'grafana.dashboard.timepicker.history';\nexport const TimePickerWithHistory = props => {\n  return /*#__PURE__*/_jsx(LocalStorageValueProvider, {\n    storageKey: LOCAL_STORAGE_KEY,\n    defaultValue: [],\n    children: (values, onSaveToStore) => {\n      return /*#__PURE__*/_jsx(TimeRangePicker, Object.assign({}, props, {\n        history: convertIfJson(values),\n        onChange: value => {\n          onAppendToHistory(value, values, onSaveToStore);\n          props.onChange(value);\n        }\n      }));\n    }\n  });\n};\n\nfunction convertIfJson(history) {\n  return history.map(time => {\n    if (isDateTime(time.from)) {\n      return time;\n    }\n\n    return {\n      from: toUtc(time.from),\n      to: toUtc(time.to),\n      raw: time.raw\n    };\n  });\n}\n\nfunction onAppendToHistory(toAppend, values, onSaveToStore) {\n  if (!isAbsolute(toAppend)) {\n    return;\n  }\n\n  const toStore = limit([toAppend, ...values]);\n  onSaveToStore(toStore);\n}\n\nfunction isAbsolute(value) {\n  return isDateTime(value.raw.from) || isDateTime(value.raw.to);\n}\n\nfunction limit(value) {\n  return value.slice(0, 4);\n}","map":{"version":3,"names":["React","isDateTime","toUtc","TimeRangePicker","LocalStorageValueProvider","LOCAL_STORAGE_KEY","TimePickerWithHistory","props","values","onSaveToStore","convertIfJson","value","onAppendToHistory","onChange","history","map","time","from","to","raw","toAppend","isAbsolute","toStore","limit","slice"],"sources":["/home/soula/grafana/public/app/core/components/TimePicker/TimePickerWithHistory.tsx"],"sourcesContent":["import React from 'react';\n\nimport { TimeRange, isDateTime, toUtc } from '@grafana/data';\nimport { TimeRangePickerProps, TimeRangePicker } from '@grafana/ui';\n\nimport { LocalStorageValueProvider } from '../LocalStorageValueProvider';\n\nconst LOCAL_STORAGE_KEY = 'grafana.dashboard.timepicker.history';\n\ninterface Props extends Omit<TimeRangePickerProps, 'history' | 'theme'> {}\n\nexport const TimePickerWithHistory: React.FC<Props> = (props) => {\n  return (\n    <LocalStorageValueProvider<TimeRange[]> storageKey={LOCAL_STORAGE_KEY} defaultValue={[]}>\n      {(values, onSaveToStore) => {\n        return (\n          <TimeRangePicker\n            {...props}\n            history={convertIfJson(values)}\n            onChange={(value) => {\n              onAppendToHistory(value, values, onSaveToStore);\n              props.onChange(value);\n            }}\n          />\n        );\n      }}\n    </LocalStorageValueProvider>\n  );\n};\n\nfunction convertIfJson(history: TimeRange[]): TimeRange[] {\n  return history.map((time) => {\n    if (isDateTime(time.from)) {\n      return time;\n    }\n\n    return {\n      from: toUtc(time.from),\n      to: toUtc(time.to),\n      raw: time.raw,\n    };\n  });\n}\n\nfunction onAppendToHistory(toAppend: TimeRange, values: TimeRange[], onSaveToStore: (values: TimeRange[]) => void) {\n  if (!isAbsolute(toAppend)) {\n    return;\n  }\n  const toStore = limit([toAppend, ...values]);\n  onSaveToStore(toStore);\n}\n\nfunction isAbsolute(value: TimeRange): boolean {\n  return isDateTime(value.raw.from) || isDateTime(value.raw.to);\n}\n\nfunction limit(value: TimeRange[]): TimeRange[] {\n  return value.slice(0, 4);\n}\n"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,SAAoBC,UAApB,EAAgCC,KAAhC,QAA6C,eAA7C;AACA,SAA+BC,eAA/B,QAAsD,aAAtD;AAEA,SAASC,yBAAT,QAA0C,8BAA1C;;AAEA,MAAMC,iBAAiB,GAAG,sCAA1B;AAIA,OAAO,MAAMC,qBAAsC,GAAIC,KAAD,IAAW;EAC/D,oBACE,KAAC,yBAAD;IAAwC,UAAU,EAAEF,iBAApD;IAAuE,YAAY,EAAE,EAArF;IAAA,UACG,CAACG,MAAD,EAASC,aAAT,KAA2B;MAC1B,oBACE,KAAC,eAAD,oBACMF,KADN;QAEE,OAAO,EAAEG,aAAa,CAACF,MAAD,CAFxB;QAGE,QAAQ,EAAGG,KAAD,IAAW;UACnBC,iBAAiB,CAACD,KAAD,EAAQH,MAAR,EAAgBC,aAAhB,CAAjB;UACAF,KAAK,CAACM,QAAN,CAAeF,KAAf;QACD;MANH,GADF;IAUD;EAZH,EADF;AAgBD,CAjBM;;AAmBP,SAASD,aAAT,CAAuBI,OAAvB,EAA0D;EACxD,OAAOA,OAAO,CAACC,GAAR,CAAaC,IAAD,IAAU;IAC3B,IAAIf,UAAU,CAACe,IAAI,CAACC,IAAN,CAAd,EAA2B;MACzB,OAAOD,IAAP;IACD;;IAED,OAAO;MACLC,IAAI,EAAEf,KAAK,CAACc,IAAI,CAACC,IAAN,CADN;MAELC,EAAE,EAAEhB,KAAK,CAACc,IAAI,CAACE,EAAN,CAFJ;MAGLC,GAAG,EAAEH,IAAI,CAACG;IAHL,CAAP;EAKD,CAVM,CAAP;AAWD;;AAED,SAASP,iBAAT,CAA2BQ,QAA3B,EAAgDZ,MAAhD,EAAqEC,aAArE,EAAmH;EACjH,IAAI,CAACY,UAAU,CAACD,QAAD,CAAf,EAA2B;IACzB;EACD;;EACD,MAAME,OAAO,GAAGC,KAAK,CAAC,CAACH,QAAD,EAAW,GAAGZ,MAAd,CAAD,CAArB;EACAC,aAAa,CAACa,OAAD,CAAb;AACD;;AAED,SAASD,UAAT,CAAoBV,KAApB,EAA+C;EAC7C,OAAOV,UAAU,CAACU,KAAK,CAACQ,GAAN,CAAUF,IAAX,CAAV,IAA8BhB,UAAU,CAACU,KAAK,CAACQ,GAAN,CAAUD,EAAX,CAA/C;AACD;;AAED,SAASK,KAAT,CAAeZ,KAAf,EAAgD;EAC9C,OAAOA,KAAK,CAACa,KAAN,CAAY,CAAZ,EAAe,CAAf,CAAP;AACD"},"metadata":{},"sourceType":"module"}