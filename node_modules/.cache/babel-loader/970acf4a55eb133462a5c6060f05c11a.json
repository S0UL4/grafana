{"ast":null,"code":"import { css, cx } from '@emotion/css';\nimport React from 'react';\nimport { Button, ModalsController, CollapsableSection, HorizontalGroup, useStyles } from '@grafana/ui';\nimport { DiffGroup } from './DiffGroup';\nimport { DiffViewer } from './DiffViewer';\nimport { RevertDashboardModal } from './RevertDashboardModal';\nimport { jsonDiff } from './utils';\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport const VersionHistoryComparison = ({\n  baseInfo,\n  newInfo,\n  diffData,\n  isNewLatest\n}) => {\n  const diff = jsonDiff(diffData.lhs, diffData.rhs);\n  const styles = useStyles(getStyles);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: styles.spacer,\n      children: /*#__PURE__*/_jsxs(HorizontalGroup, {\n        justify: \"space-between\",\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsxs(\"p\", {\n            className: styles.versionInfo,\n            children: [/*#__PURE__*/_jsxs(\"strong\", {\n              children: [\"Version \", newInfo.version]\n            }), \" updated by \", newInfo.createdBy, \" \", newInfo.ageString, \" -\", ' ', newInfo.message]\n          }), /*#__PURE__*/_jsxs(\"p\", {\n            className: cx(styles.versionInfo, styles.noMarginBottom),\n            children: [/*#__PURE__*/_jsxs(\"strong\", {\n              children: [\"Version \", baseInfo.version]\n            }), \" updated by \", baseInfo.createdBy, \" \", baseInfo.ageString, \" -\", ' ', baseInfo.message]\n          })]\n        }), isNewLatest && /*#__PURE__*/_jsx(ModalsController, {\n          children: ({\n            showModal,\n            hideModal\n          }) => /*#__PURE__*/_jsxs(Button, {\n            variant: \"destructive\",\n            icon: \"history\",\n            onClick: () => {\n              showModal(RevertDashboardModal, {\n                version: baseInfo.version,\n                hideModal\n              });\n            },\n            children: [\"Restore to version \", baseInfo.version]\n          })\n        })]\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: styles.spacer,\n      children: Object.entries(diff).map(([key, diffs]) => /*#__PURE__*/_jsx(DiffGroup, {\n        diffs: diffs,\n        title: key\n      }, key))\n    }), /*#__PURE__*/_jsx(CollapsableSection, {\n      isOpen: false,\n      label: \"View JSON Diff\",\n      children: /*#__PURE__*/_jsx(DiffViewer, {\n        oldValue: JSON.stringify(diffData.lhs, null, 2),\n        newValue: JSON.stringify(diffData.rhs, null, 2)\n      })\n    })]\n  });\n};\n\nconst getStyles = theme => ({\n  spacer: css`\n    margin-bottom: ${theme.spacing.xl};\n  `,\n  versionInfo: css`\n    color: ${theme.colors.textWeak};\n    font-size: ${theme.typography.size.sm};\n  `,\n  noMarginBottom: css`\n    margin-bottom: 0;\n  `\n});","map":{"version":3,"names":["css","cx","React","Button","ModalsController","CollapsableSection","HorizontalGroup","useStyles","DiffGroup","DiffViewer","RevertDashboardModal","jsonDiff","VersionHistoryComparison","baseInfo","newInfo","diffData","isNewLatest","diff","lhs","rhs","styles","getStyles","spacer","versionInfo","version","createdBy","ageString","message","noMarginBottom","showModal","hideModal","Object","entries","map","key","diffs","JSON","stringify","theme","spacing","xl","colors","textWeak","typography","size","sm"],"sources":["/home/soula/grafana/public/app/features/dashboard/components/VersionHistory/VersionHistoryComparison.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme } from '@grafana/data';\nimport { Button, ModalsController, CollapsableSection, HorizontalGroup, useStyles } from '@grafana/ui';\n\nimport { DecoratedRevisionModel } from '../DashboardSettings/VersionsSettings';\n\nimport { DiffGroup } from './DiffGroup';\nimport { DiffViewer } from './DiffViewer';\nimport { RevertDashboardModal } from './RevertDashboardModal';\nimport { jsonDiff } from './utils';\n\ntype DiffViewProps = {\n  isNewLatest: boolean;\n  newInfo: DecoratedRevisionModel;\n  baseInfo: DecoratedRevisionModel;\n  diffData: { lhs: any; rhs: any };\n};\n\nexport const VersionHistoryComparison: React.FC<DiffViewProps> = ({ baseInfo, newInfo, diffData, isNewLatest }) => {\n  const diff = jsonDiff(diffData.lhs, diffData.rhs);\n  const styles = useStyles(getStyles);\n\n  return (\n    <div>\n      <div className={styles.spacer}>\n        <HorizontalGroup justify=\"space-between\" align=\"center\">\n          <div>\n            <p className={styles.versionInfo}>\n              <strong>Version {newInfo.version}</strong> updated by {newInfo.createdBy} {newInfo.ageString} -{' '}\n              {newInfo.message}\n            </p>\n            <p className={cx(styles.versionInfo, styles.noMarginBottom)}>\n              <strong>Version {baseInfo.version}</strong> updated by {baseInfo.createdBy} {baseInfo.ageString} -{' '}\n              {baseInfo.message}\n            </p>\n          </div>\n          {isNewLatest && (\n            <ModalsController>\n              {({ showModal, hideModal }) => (\n                <Button\n                  variant=\"destructive\"\n                  icon=\"history\"\n                  onClick={() => {\n                    showModal(RevertDashboardModal, {\n                      version: baseInfo.version,\n                      hideModal,\n                    });\n                  }}\n                >\n                  Restore to version {baseInfo.version}\n                </Button>\n              )}\n            </ModalsController>\n          )}\n        </HorizontalGroup>\n      </div>\n      <div className={styles.spacer}>\n        {Object.entries(diff).map(([key, diffs]) => (\n          <DiffGroup diffs={diffs} key={key} title={key} />\n        ))}\n      </div>\n      <CollapsableSection isOpen={false} label=\"View JSON Diff\">\n        <DiffViewer oldValue={JSON.stringify(diffData.lhs, null, 2)} newValue={JSON.stringify(diffData.rhs, null, 2)} />\n      </CollapsableSection>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => ({\n  spacer: css`\n    margin-bottom: ${theme.spacing.xl};\n  `,\n  versionInfo: css`\n    color: ${theme.colors.textWeak};\n    font-size: ${theme.typography.size.sm};\n  `,\n  noMarginBottom: css`\n    margin-bottom: 0;\n  `,\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}