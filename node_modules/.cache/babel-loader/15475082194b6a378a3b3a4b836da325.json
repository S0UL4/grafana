{"ast":null,"code":"var _th, _th2, _span;\n\nimport React, { useState, useCallback } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { getBackendSrv, locationService } from '@grafana/runtime';\nimport { ConfirmModal, Button, LinkButton } from '@grafana/ui';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport function getSnapshots() {\n  return getBackendSrv().get('/api/dashboard/snapshots').then(result => {\n    return result.map(snapshot => Object.assign({}, snapshot, {\n      url: `/dashboard/snapshot/${snapshot.key}`\n    }));\n  });\n}\nexport const SnapshotListTable = () => {\n  const [snapshots, setSnapshots] = useState([]);\n  const [removeSnapshot, setRemoveSnapshot] = useState();\n  const currentPath = locationService.getLocation().pathname;\n  const fullUrl = window.location.href;\n  const baseUrl = fullUrl.substring(0, fullUrl.indexOf(currentPath));\n  useAsync(async () => {\n    const response = await getSnapshots();\n    setSnapshots(response);\n  }, [setSnapshots]);\n  const doRemoveSnapshot = useCallback(async snapshot => {\n    const filteredSnapshots = snapshots.filter(ss => ss.key !== snapshot.key);\n    setSnapshots(filteredSnapshots);\n    await getBackendSrv().delete(`/api/snapshots/${snapshot.key}`).catch(() => {\n      setSnapshots(snapshots);\n    });\n  }, [snapshots]);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsxs(\"table\", {\n      className: \"filter-table\",\n      children: [/*#__PURE__*/_jsx(\"thead\", {\n        children: /*#__PURE__*/_jsxs(\"tr\", {\n          children: [_th || (_th = /*#__PURE__*/_jsx(\"th\", {\n            children: /*#__PURE__*/_jsx(\"strong\", {\n              children: \"Name\"\n            })\n          })), _th2 || (_th2 = /*#__PURE__*/_jsx(\"th\", {\n            children: /*#__PURE__*/_jsx(\"strong\", {\n              children: \"Snapshot url\"\n            })\n          })), /*#__PURE__*/_jsx(\"th\", {\n            style: {\n              width: '70px'\n            }\n          }), /*#__PURE__*/_jsx(\"th\", {\n            style: {\n              width: '30px'\n            }\n          }), /*#__PURE__*/_jsx(\"th\", {\n            style: {\n              width: '25px'\n            }\n          })]\n        })\n      }), /*#__PURE__*/_jsx(\"tbody\", {\n        children: snapshots.map(snapshot => {\n          const url = snapshot.externalUrl || snapshot.url;\n          const fullUrl = snapshot.externalUrl || `${baseUrl}${snapshot.url}`;\n          return /*#__PURE__*/_jsxs(\"tr\", {\n            children: [/*#__PURE__*/_jsx(\"td\", {\n              children: /*#__PURE__*/_jsx(\"a\", {\n                href: url,\n                children: snapshot.name\n              })\n            }), /*#__PURE__*/_jsx(\"td\", {\n              children: /*#__PURE__*/_jsx(\"a\", {\n                href: url,\n                children: fullUrl\n              })\n            }), /*#__PURE__*/_jsx(\"td\", {\n              children: snapshot.external && (_span || (_span = /*#__PURE__*/_jsx(\"span\", {\n                className: \"query-keyword\",\n                children: \"External\"\n              })))\n            }), /*#__PURE__*/_jsx(\"td\", {\n              className: \"text-center\",\n              children: /*#__PURE__*/_jsx(LinkButton, {\n                href: url,\n                variant: \"secondary\",\n                size: \"sm\",\n                icon: \"eye\",\n                children: \"View\"\n              })\n            }), /*#__PURE__*/_jsx(\"td\", {\n              className: \"text-right\",\n              children: /*#__PURE__*/_jsx(Button, {\n                variant: \"destructive\",\n                size: \"sm\",\n                icon: \"times\",\n                onClick: () => setRemoveSnapshot(snapshot)\n              })\n            })]\n          }, snapshot.key);\n        })\n      })]\n    }), /*#__PURE__*/_jsx(ConfirmModal, {\n      isOpen: !!removeSnapshot,\n      icon: \"trash-alt\",\n      title: \"Delete\",\n      body: `Are you sure you want to delete '${removeSnapshot === null || removeSnapshot === void 0 ? void 0 : removeSnapshot.name}'?`,\n      confirmText: \"Delete\",\n      onDismiss: () => setRemoveSnapshot(undefined),\n      onConfirm: () => {\n        doRemoveSnapshot(removeSnapshot);\n        setRemoveSnapshot(undefined);\n      }\n    })]\n  });\n};","map":{"version":3,"names":["React","useState","useCallback","useAsync","getBackendSrv","locationService","ConfirmModal","Button","LinkButton","getSnapshots","get","then","result","map","snapshot","url","key","SnapshotListTable","snapshots","setSnapshots","removeSnapshot","setRemoveSnapshot","currentPath","getLocation","pathname","fullUrl","window","location","href","baseUrl","substring","indexOf","response","doRemoveSnapshot","filteredSnapshots","filter","ss","delete","catch","width","externalUrl","name","external","undefined"],"sources":["/home/soula/grafana/public/app/features/manage-dashboards/components/SnapshotListTable.tsx"],"sourcesContent":["import React, { FC, useState, useCallback } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { getBackendSrv, locationService } from '@grafana/runtime';\nimport { ConfirmModal, Button, LinkButton } from '@grafana/ui';\n\nimport { Snapshot } from '../types';\n\nexport function getSnapshots() {\n  return getBackendSrv()\n    .get('/api/dashboard/snapshots')\n    .then((result: Snapshot[]) => {\n      return result.map((snapshot) => ({\n        ...snapshot,\n        url: `/dashboard/snapshot/${snapshot.key}`,\n      }));\n    });\n}\nexport const SnapshotListTable: FC = () => {\n  const [snapshots, setSnapshots] = useState<Snapshot[]>([]);\n  const [removeSnapshot, setRemoveSnapshot] = useState<Snapshot | undefined>();\n  const currentPath = locationService.getLocation().pathname;\n  const fullUrl = window.location.href;\n  const baseUrl = fullUrl.substring(0, fullUrl.indexOf(currentPath));\n\n  useAsync(async () => {\n    const response = await getSnapshots();\n    setSnapshots(response);\n  }, [setSnapshots]);\n\n  const doRemoveSnapshot = useCallback(\n    async (snapshot: Snapshot) => {\n      const filteredSnapshots = snapshots.filter((ss) => ss.key !== snapshot.key);\n      setSnapshots(filteredSnapshots);\n      await getBackendSrv()\n        .delete(`/api/snapshots/${snapshot.key}`)\n        .catch(() => {\n          setSnapshots(snapshots);\n        });\n    },\n    [snapshots]\n  );\n\n  return (\n    <div>\n      <table className=\"filter-table\">\n        <thead>\n          <tr>\n            <th>\n              <strong>Name</strong>\n            </th>\n            <th>\n              <strong>Snapshot url</strong>\n            </th>\n            <th style={{ width: '70px' }}></th>\n            <th style={{ width: '30px' }}></th>\n            <th style={{ width: '25px' }}></th>\n          </tr>\n        </thead>\n        <tbody>\n          {snapshots.map((snapshot) => {\n            const url = snapshot.externalUrl || snapshot.url;\n            const fullUrl = snapshot.externalUrl || `${baseUrl}${snapshot.url}`;\n            return (\n              <tr key={snapshot.key}>\n                <td>\n                  <a href={url}>{snapshot.name}</a>\n                </td>\n                <td>\n                  <a href={url}>{fullUrl}</a>\n                </td>\n                <td>{snapshot.external && <span className=\"query-keyword\">External</span>}</td>\n                <td className=\"text-center\">\n                  <LinkButton href={url} variant=\"secondary\" size=\"sm\" icon=\"eye\">\n                    View\n                  </LinkButton>\n                </td>\n                <td className=\"text-right\">\n                  <Button variant=\"destructive\" size=\"sm\" icon=\"times\" onClick={() => setRemoveSnapshot(snapshot)} />\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n\n      <ConfirmModal\n        isOpen={!!removeSnapshot}\n        icon=\"trash-alt\"\n        title=\"Delete\"\n        body={`Are you sure you want to delete '${removeSnapshot?.name}'?`}\n        confirmText=\"Delete\"\n        onDismiss={() => setRemoveSnapshot(undefined)}\n        onConfirm={() => {\n          doRemoveSnapshot(removeSnapshot!);\n          setRemoveSnapshot(undefined);\n        }}\n      />\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}