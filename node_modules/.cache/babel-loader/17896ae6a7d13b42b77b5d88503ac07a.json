{"ast":null,"code":"import angular from 'angular';\nimport coreModule from '../core_module';\n\nclass DynamicDirectiveSrv {\n  /** @ngInject */\n  constructor($compile) {\n    this.$compile = $compile;\n  }\n\n  addDirective(element, name, scope) {\n    const child = angular.element(document.createElement(name));\n    this.$compile(child)(scope);\n    element.empty();\n    element.append(child);\n  }\n\n  link(scope, elem, attrs, options) {\n    const directiveInfo = options.directive(scope);\n\n    if (!directiveInfo || !directiveInfo.fn) {\n      elem.empty();\n      return;\n    }\n\n    if (!directiveInfo.fn.registered) {\n      coreModule.directive(attrs.$normalize(directiveInfo.name), directiveInfo.fn);\n      directiveInfo.fn.registered = true;\n    }\n\n    this.addDirective(elem, directiveInfo.name, scope);\n  }\n\n  create(options) {\n    const directiveDef = {\n      restrict: 'E',\n      scope: options.scope,\n      link: (scope, elem, attrs) => {\n        if (options.watchPath) {\n          let childScope = null;\n          scope.$watch(options.watchPath, () => {\n            if (childScope) {\n              childScope.$destroy();\n            }\n\n            childScope = scope.$new();\n            this.link(childScope, elem, attrs, options);\n          });\n        } else {\n          this.link(scope, elem, attrs, options);\n        }\n      }\n    };\n    return directiveDef;\n  }\n\n}\n\nDynamicDirectiveSrv.$inject = [\"$compile\"];\ncoreModule.service('dynamicDirectiveSrv', DynamicDirectiveSrv);","map":{"version":3,"names":["angular","coreModule","DynamicDirectiveSrv","constructor","$compile","addDirective","element","name","scope","child","document","createElement","empty","append","link","elem","attrs","options","directiveInfo","directive","fn","registered","$normalize","create","directiveDef","restrict","watchPath","childScope","$watch","$destroy","$new","service"],"sources":["/home/soula/grafana/public/app/angular/services/dynamic_directive_srv.ts"],"sourcesContent":["import angular from 'angular';\n\nimport coreModule from '../core_module';\n\nclass DynamicDirectiveSrv {\n  /** @ngInject */\n  constructor(private $compile: angular.ICompileService) {}\n\n  addDirective(element: any, name: string, scope: any) {\n    const child = angular.element(document.createElement(name));\n    this.$compile(child)(scope);\n\n    element.empty();\n    element.append(child);\n  }\n\n  link(scope: any, elem: JQLite, attrs: any, options: any) {\n    const directiveInfo = options.directive(scope);\n    if (!directiveInfo || !directiveInfo.fn) {\n      elem.empty();\n      return;\n    }\n\n    if (!directiveInfo.fn.registered) {\n      coreModule.directive(attrs.$normalize(directiveInfo.name), directiveInfo.fn);\n      directiveInfo.fn.registered = true;\n    }\n\n    this.addDirective(elem, directiveInfo.name, scope);\n  }\n\n  create(options: any) {\n    const directiveDef = {\n      restrict: 'E',\n      scope: options.scope,\n      link: (scope: any, elem: JQLite, attrs: any) => {\n        if (options.watchPath) {\n          let childScope: any = null;\n          scope.$watch(options.watchPath, () => {\n            if (childScope) {\n              childScope.$destroy();\n            }\n            childScope = scope.$new();\n            this.link(childScope, elem, attrs, options);\n          });\n        } else {\n          this.link(scope, elem, attrs, options);\n        }\n      },\n    };\n\n    return directiveDef;\n  }\n}\n\ncoreModule.service('dynamicDirectiveSrv', DynamicDirectiveSrv);\n"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,SAApB;AAEA,OAAOC,UAAP,MAAuB,gBAAvB;;AAEA,MAAMC,mBAAN,CAA0B;EACxB;EACAC,WAAW,CAASC,QAAT,EAA4C;IAAA,KAAnCA,QAAmC,GAAnCA,QAAmC;EAAE;;EAEzDC,YAAY,CAACC,OAAD,EAAeC,IAAf,EAA6BC,KAA7B,EAAyC;IACnD,MAAMC,KAAK,GAAGT,OAAO,CAACM,OAAR,CAAgBI,QAAQ,CAACC,aAAT,CAAuBJ,IAAvB,CAAhB,CAAd;IACA,KAAKH,QAAL,CAAcK,KAAd,EAAqBD,KAArB;IAEAF,OAAO,CAACM,KAAR;IACAN,OAAO,CAACO,MAAR,CAAeJ,KAAf;EACD;;EAEDK,IAAI,CAACN,KAAD,EAAaO,IAAb,EAA2BC,KAA3B,EAAuCC,OAAvC,EAAqD;IACvD,MAAMC,aAAa,GAAGD,OAAO,CAACE,SAAR,CAAkBX,KAAlB,CAAtB;;IACA,IAAI,CAACU,aAAD,IAAkB,CAACA,aAAa,CAACE,EAArC,EAAyC;MACvCL,IAAI,CAACH,KAAL;MACA;IACD;;IAED,IAAI,CAACM,aAAa,CAACE,EAAd,CAAiBC,UAAtB,EAAkC;MAChCpB,UAAU,CAACkB,SAAX,CAAqBH,KAAK,CAACM,UAAN,CAAiBJ,aAAa,CAACX,IAA/B,CAArB,EAA2DW,aAAa,CAACE,EAAzE;MACAF,aAAa,CAACE,EAAd,CAAiBC,UAAjB,GAA8B,IAA9B;IACD;;IAED,KAAKhB,YAAL,CAAkBU,IAAlB,EAAwBG,aAAa,CAACX,IAAtC,EAA4CC,KAA5C;EACD;;EAEDe,MAAM,CAACN,OAAD,EAAe;IACnB,MAAMO,YAAY,GAAG;MACnBC,QAAQ,EAAE,GADS;MAEnBjB,KAAK,EAAES,OAAO,CAACT,KAFI;MAGnBM,IAAI,EAAE,CAACN,KAAD,EAAaO,IAAb,EAA2BC,KAA3B,KAA0C;QAC9C,IAAIC,OAAO,CAACS,SAAZ,EAAuB;UACrB,IAAIC,UAAe,GAAG,IAAtB;UACAnB,KAAK,CAACoB,MAAN,CAAaX,OAAO,CAACS,SAArB,EAAgC,MAAM;YACpC,IAAIC,UAAJ,EAAgB;cACdA,UAAU,CAACE,QAAX;YACD;;YACDF,UAAU,GAAGnB,KAAK,CAACsB,IAAN,EAAb;YACA,KAAKhB,IAAL,CAAUa,UAAV,EAAsBZ,IAAtB,EAA4BC,KAA5B,EAAmCC,OAAnC;UACD,CAND;QAOD,CATD,MASO;UACL,KAAKH,IAAL,CAAUN,KAAV,EAAiBO,IAAjB,EAAuBC,KAAvB,EAA8BC,OAA9B;QACD;MACF;IAhBkB,CAArB;IAmBA,OAAOO,YAAP;EACD;;AAhDuB;;;AAmD1BvB,UAAU,CAAC8B,OAAX,CAAmB,qBAAnB,EAA0C7B,mBAA1C"},"metadata":{},"sourceType":"module"}