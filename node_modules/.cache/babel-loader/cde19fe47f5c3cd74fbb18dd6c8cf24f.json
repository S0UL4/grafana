{"ast":null,"code":"import { css, cx } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { Draggable } from 'react-beautiful-dnd';\nimport { Stack } from '@grafana/experimental';\nimport { Button, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { OperationHeader } from './OperationHeader';\nimport { getOperationParamEditor } from './OperationParamEditor';\nimport { getOperationParamId } from './operationUtils';\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport function OperationEditor({\n  operation,\n  index,\n  onRemove,\n  onChange,\n  onRunQuery,\n  queryModeller,\n  query,\n  datasource,\n  highlight\n}) {\n  const styles = useStyles2(getStyles);\n  const def = queryModeller.getOperationDef(operation.id);\n  const shouldHighlight = useHighlight(highlight);\n\n  if (!def) {\n    return /*#__PURE__*/_jsxs(\"span\", {\n      children: [\"Operation \", operation.id, \" not found\"]\n    });\n  }\n\n  const onParamValueChanged = (paramIdx, value) => {\n    const update = Object.assign({}, operation, {\n      params: [...operation.params]\n    });\n    update.params[paramIdx] = value;\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const onAddRestParam = () => {\n    const update = Object.assign({}, operation, {\n      params: [...operation.params, '']\n    });\n    callParamChangedThenOnChange(def, update, index, operation.params.length, onChange);\n  };\n\n  const onRemoveRestParam = paramIdx => {\n    const update = Object.assign({}, operation, {\n      params: [...operation.params.slice(0, paramIdx), ...operation.params.slice(paramIdx + 1)]\n    });\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const operationElements = [];\n\n  for (let paramIndex = 0; paramIndex < operation.params.length; paramIndex++) {\n    const paramDef = def.params[Math.min(def.params.length - 1, paramIndex)];\n    const Editor = getOperationParamEditor(paramDef);\n    operationElements.push( /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.paramRow,\n      children: [!paramDef.hideName && /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.paramName,\n        children: [/*#__PURE__*/_jsx(\"label\", {\n          htmlFor: getOperationParamId(index, paramIndex),\n          children: paramDef.name\n        }), paramDef.description && /*#__PURE__*/_jsx(Tooltip, {\n          placement: \"top\",\n          content: paramDef.description,\n          theme: \"info\",\n          children: /*#__PURE__*/_jsx(Icon, {\n            name: \"info-circle\",\n            size: \"sm\",\n            className: styles.infoIcon\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.paramValue,\n        children: /*#__PURE__*/_jsxs(Stack, {\n          gap: 0.5,\n          direction: \"row\",\n          alignItems: \"center\",\n          wrap: false,\n          children: [/*#__PURE__*/_jsx(Editor, {\n            index: paramIndex,\n            paramDef: paramDef,\n            value: operation.params[paramIndex],\n            operation: operation,\n            operationIndex: index,\n            onChange: onParamValueChanged,\n            onRunQuery: onRunQuery,\n            query: query,\n            datasource: datasource\n          }), paramDef.restParam && (operation.params.length > def.params.length || paramDef.optional) && /*#__PURE__*/_jsx(Button, {\n            \"data-testid\": `operations.${index}.remove-rest-param`,\n            size: \"sm\",\n            fill: \"text\",\n            icon: \"times\",\n            variant: \"secondary\",\n            title: `Remove ${paramDef.name}`,\n            onClick: () => onRemoveRestParam(paramIndex)\n          })]\n        })\n      })]\n    }, `${paramIndex}-1`));\n  } // Handle adding button for rest params\n\n\n  let restParam;\n\n  if (def.params.length > 0) {\n    const lastParamDef = def.params[def.params.length - 1];\n\n    if (lastParamDef.restParam) {\n      restParam = renderAddRestParamButton(lastParamDef, onAddRestParam, index, operation.params.length, styles);\n    }\n  }\n\n  return /*#__PURE__*/_jsx(Draggable, {\n    draggableId: `operation-${index}`,\n    index: index,\n    children: provided => /*#__PURE__*/_jsxs(\"div\", Object.assign({\n      className: cx(styles.card, shouldHighlight && styles.cardHighlight),\n      ref: provided.innerRef\n    }, provided.draggableProps, {\n      \"data-testid\": `operations.${index}.wrapper`,\n      children: [/*#__PURE__*/_jsx(OperationHeader, {\n        operation: operation,\n        dragHandleProps: provided.dragHandleProps,\n        def: def,\n        index: index,\n        onChange: onChange,\n        onRemove: onRemove,\n        queryModeller: queryModeller\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.body,\n        children: operationElements\n      }), restParam, index < query.operations.length - 1 && /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.arrow,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.arrowLine\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.arrowArrow\n        })]\n      })]\n    }))\n  });\n}\n/**\n * When highlight is switched on makes sure it is switched of right away, so we just flash the highlight and then fade\n * out.\n * @param highlight\n */\n\nfunction useHighlight(highlight) {\n  const [keepHighlight, setKeepHighlight] = useState(true);\n  useEffect(() => {\n    let t;\n\n    if (highlight) {\n      t = setTimeout(() => {\n        setKeepHighlight(false);\n      }, 1);\n    } else {\n      setKeepHighlight(true);\n    }\n\n    return () => clearTimeout(t);\n  }, [highlight]);\n  return keepHighlight && highlight;\n}\n\nfunction renderAddRestParamButton(paramDef, onAddRestParam, operationIndex, paramIndex, styles) {\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: styles.restParam,\n    children: /*#__PURE__*/_jsx(Button, {\n      size: \"sm\",\n      icon: \"plus\",\n      title: `Add ${paramDef.name}`,\n      variant: \"secondary\",\n      onClick: onAddRestParam,\n      \"data-testid\": `operations.${operationIndex}.add-rest-param`,\n      children: paramDef.name\n    })\n  }, `${paramIndex}-2`);\n}\n\nfunction callParamChangedThenOnChange(def, operation, operationIndex, paramIndex, onChange) {\n  if (def.paramChangedHandler) {\n    onChange(operationIndex, def.paramChangedHandler(paramIndex, operation, def));\n  } else {\n    onChange(operationIndex, operation);\n  }\n}\n\nconst getStyles = theme => {\n  return {\n    card: css({\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.medium}`,\n      display: 'flex',\n      flexDirection: 'column',\n      cursor: 'grab',\n      borderRadius: theme.shape.borderRadius(1),\n      marginBottom: theme.spacing(1),\n      position: 'relative',\n      transition: 'all 1s ease-in 0s'\n    }),\n    cardHighlight: css({\n      boxShadow: `0px 0px 4px 0px ${theme.colors.primary.border}`,\n      border: `1px solid ${theme.colors.primary.border}`\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(0.5),\n      color: theme.colors.text.secondary,\n      ':hover': {\n        color: theme.colors.text.primary\n      }\n    }),\n    body: css({\n      margin: theme.spacing(1, 1, 0.5, 1),\n      display: 'table'\n    }),\n    paramRow: css({\n      label: 'paramRow',\n      display: 'table-row',\n      verticalAlign: 'middle'\n    }),\n    paramName: css({\n      display: 'table-cell',\n      padding: theme.spacing(0, 1, 0, 0),\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      verticalAlign: 'middle',\n      height: '32px'\n    }),\n    paramValue: css({\n      label: 'paramValue',\n      display: 'table-cell',\n      verticalAlign: 'middle'\n    }),\n    restParam: css({\n      padding: theme.spacing(0, 1, 1, 1)\n    }),\n    arrow: css({\n      position: 'absolute',\n      top: '0',\n      right: '-18px',\n      display: 'flex'\n    }),\n    arrowLine: css({\n      height: '2px',\n      width: '8px',\n      backgroundColor: theme.colors.border.strong,\n      position: 'relative',\n      top: '14px'\n    }),\n    arrowArrow: css({\n      width: 0,\n      height: 0,\n      borderTop: `5px solid transparent`,\n      borderBottom: `5px solid transparent`,\n      borderLeft: `7px solid ${theme.colors.border.strong}`,\n      position: 'relative',\n      top: '10px'\n    })\n  };\n};","map":{"version":3,"names":["css","cx","React","useEffect","useState","Draggable","Stack","Button","Icon","Tooltip","useStyles2","OperationHeader","getOperationParamEditor","getOperationParamId","OperationEditor","operation","index","onRemove","onChange","onRunQuery","queryModeller","query","datasource","highlight","styles","getStyles","def","getOperationDef","id","shouldHighlight","useHighlight","onParamValueChanged","paramIdx","value","update","params","callParamChangedThenOnChange","onAddRestParam","length","onRemoveRestParam","slice","operationElements","paramIndex","paramDef","Math","min","Editor","push","paramRow","hideName","paramName","name","description","infoIcon","paramValue","restParam","optional","lastParamDef","renderAddRestParamButton","provided","card","cardHighlight","innerRef","draggableProps","dragHandleProps","body","operations","arrow","arrowLine","arrowArrow","keepHighlight","setKeepHighlight","t","setTimeout","clearTimeout","operationIndex","paramChangedHandler","theme","background","colors","primary","border","medium","display","flexDirection","cursor","borderRadius","shape","marginBottom","spacing","position","transition","boxShadow","marginLeft","color","text","secondary","margin","label","verticalAlign","padding","fontSize","typography","bodySmall","fontWeight","fontWeightMedium","height","top","right","width","backgroundColor","strong","borderTop","borderBottom","borderLeft"],"sources":["/home/soula/grafana/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationEditor.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport { DataSourceApi, GrafanaTheme2 } from '@grafana/data';\nimport { Stack } from '@grafana/experimental';\nimport { Button, Icon, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport {\n  VisualQueryModeller,\n  QueryBuilderOperation,\n  QueryBuilderOperationParamValue,\n  QueryBuilderOperationDef,\n  QueryBuilderOperationParamDef,\n} from '../shared/types';\n\nimport { OperationHeader } from './OperationHeader';\nimport { getOperationParamEditor } from './OperationParamEditor';\nimport { getOperationParamId } from './operationUtils';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  index: number;\n  query: any;\n  datasource: DataSourceApi;\n  queryModeller: VisualQueryModeller;\n  onChange: (index: number, update: QueryBuilderOperation) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n  highlight?: boolean;\n}\n\nexport function OperationEditor({\n  operation,\n  index,\n  onRemove,\n  onChange,\n  onRunQuery,\n  queryModeller,\n  query,\n  datasource,\n  highlight,\n}: Props) {\n  const styles = useStyles2(getStyles);\n  const def = queryModeller.getOperationDef(operation.id);\n  const shouldHighlight = useHighlight(highlight);\n\n  if (!def) {\n    return <span>Operation {operation.id} not found</span>;\n  }\n\n  const onParamValueChanged = (paramIdx: number, value: QueryBuilderOperationParamValue) => {\n    const update: QueryBuilderOperation = { ...operation, params: [...operation.params] };\n    update.params[paramIdx] = value;\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const onAddRestParam = () => {\n    const update: QueryBuilderOperation = { ...operation, params: [...operation.params, ''] };\n    callParamChangedThenOnChange(def, update, index, operation.params.length, onChange);\n  };\n\n  const onRemoveRestParam = (paramIdx: number) => {\n    const update: QueryBuilderOperation = {\n      ...operation,\n      params: [...operation.params.slice(0, paramIdx), ...operation.params.slice(paramIdx + 1)],\n    };\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const operationElements: React.ReactNode[] = [];\n\n  for (let paramIndex = 0; paramIndex < operation.params.length; paramIndex++) {\n    const paramDef = def.params[Math.min(def.params.length - 1, paramIndex)];\n    const Editor = getOperationParamEditor(paramDef);\n\n    operationElements.push(\n      <div className={styles.paramRow} key={`${paramIndex}-1`}>\n        {!paramDef.hideName && (\n          <div className={styles.paramName}>\n            <label htmlFor={getOperationParamId(index, paramIndex)}>{paramDef.name}</label>\n            {paramDef.description && (\n              <Tooltip placement=\"top\" content={paramDef.description} theme=\"info\">\n                <Icon name=\"info-circle\" size=\"sm\" className={styles.infoIcon} />\n              </Tooltip>\n            )}\n          </div>\n        )}\n        <div className={styles.paramValue}>\n          <Stack gap={0.5} direction=\"row\" alignItems=\"center\" wrap={false}>\n            <Editor\n              index={paramIndex}\n              paramDef={paramDef}\n              value={operation.params[paramIndex]}\n              operation={operation}\n              operationIndex={index}\n              onChange={onParamValueChanged}\n              onRunQuery={onRunQuery}\n              query={query}\n              datasource={datasource}\n            />\n            {paramDef.restParam && (operation.params.length > def.params.length || paramDef.optional) && (\n              <Button\n                data-testid={`operations.${index}.remove-rest-param`}\n                size=\"sm\"\n                fill=\"text\"\n                icon=\"times\"\n                variant=\"secondary\"\n                title={`Remove ${paramDef.name}`}\n                onClick={() => onRemoveRestParam(paramIndex)}\n              />\n            )}\n          </Stack>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle adding button for rest params\n  let restParam: React.ReactNode | undefined;\n  if (def.params.length > 0) {\n    const lastParamDef = def.params[def.params.length - 1];\n    if (lastParamDef.restParam) {\n      restParam = renderAddRestParamButton(lastParamDef, onAddRestParam, index, operation.params.length, styles);\n    }\n  }\n\n  return (\n    <Draggable draggableId={`operation-${index}`} index={index}>\n      {(provided) => (\n        <div\n          className={cx(styles.card, shouldHighlight && styles.cardHighlight)}\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n          data-testid={`operations.${index}.wrapper`}\n        >\n          <OperationHeader\n            operation={operation}\n            dragHandleProps={provided.dragHandleProps}\n            def={def}\n            index={index}\n            onChange={onChange}\n            onRemove={onRemove}\n            queryModeller={queryModeller}\n          />\n          <div className={styles.body}>{operationElements}</div>\n          {restParam}\n          {index < query.operations.length - 1 && (\n            <div className={styles.arrow}>\n              <div className={styles.arrowLine} />\n              <div className={styles.arrowArrow} />\n            </div>\n          )}\n        </div>\n      )}\n    </Draggable>\n  );\n}\n\n/**\n * When highlight is switched on makes sure it is switched of right away, so we just flash the highlight and then fade\n * out.\n * @param highlight\n */\nfunction useHighlight(highlight?: boolean) {\n  const [keepHighlight, setKeepHighlight] = useState(true);\n  useEffect(() => {\n    let t: any;\n    if (highlight) {\n      t = setTimeout(() => {\n        setKeepHighlight(false);\n      }, 1);\n    } else {\n      setKeepHighlight(true);\n    }\n\n    return () => clearTimeout(t);\n  }, [highlight]);\n\n  return keepHighlight && highlight;\n}\n\nfunction renderAddRestParamButton(\n  paramDef: QueryBuilderOperationParamDef,\n  onAddRestParam: () => void,\n  operationIndex: number,\n  paramIndex: number,\n  styles: OperationEditorStyles\n) {\n  return (\n    <div className={styles.restParam} key={`${paramIndex}-2`}>\n      <Button\n        size=\"sm\"\n        icon=\"plus\"\n        title={`Add ${paramDef.name}`}\n        variant=\"secondary\"\n        onClick={onAddRestParam}\n        data-testid={`operations.${operationIndex}.add-rest-param`}\n      >\n        {paramDef.name}\n      </Button>\n    </div>\n  );\n}\n\nfunction callParamChangedThenOnChange(\n  def: QueryBuilderOperationDef,\n  operation: QueryBuilderOperation,\n  operationIndex: number,\n  paramIndex: number,\n  onChange: (index: number, update: QueryBuilderOperation) => void\n) {\n  if (def.paramChangedHandler) {\n    onChange(operationIndex, def.paramChangedHandler(paramIndex, operation, def));\n  } else {\n    onChange(operationIndex, operation);\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css({\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.medium}`,\n      display: 'flex',\n      flexDirection: 'column',\n      cursor: 'grab',\n      borderRadius: theme.shape.borderRadius(1),\n      marginBottom: theme.spacing(1),\n      position: 'relative',\n      transition: 'all 1s ease-in 0s',\n    }),\n    cardHighlight: css({\n      boxShadow: `0px 0px 4px 0px ${theme.colors.primary.border}`,\n      border: `1px solid ${theme.colors.primary.border}`,\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(0.5),\n      color: theme.colors.text.secondary,\n      ':hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n    body: css({\n      margin: theme.spacing(1, 1, 0.5, 1),\n      display: 'table',\n    }),\n    paramRow: css({\n      label: 'paramRow',\n      display: 'table-row',\n      verticalAlign: 'middle',\n    }),\n    paramName: css({\n      display: 'table-cell',\n      padding: theme.spacing(0, 1, 0, 0),\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      verticalAlign: 'middle',\n      height: '32px',\n    }),\n    paramValue: css({\n      label: 'paramValue',\n      display: 'table-cell',\n      verticalAlign: 'middle',\n    }),\n    restParam: css({\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n    arrow: css({\n      position: 'absolute',\n      top: '0',\n      right: '-18px',\n      display: 'flex',\n    }),\n    arrowLine: css({\n      height: '2px',\n      width: '8px',\n      backgroundColor: theme.colors.border.strong,\n      position: 'relative',\n      top: '14px',\n    }),\n    arrowArrow: css({\n      width: 0,\n      height: 0,\n      borderTop: `5px solid transparent`,\n      borderBottom: `5px solid transparent`,\n      borderLeft: `7px solid ${theme.colors.border.strong}`,\n      position: 'relative',\n      top: '10px',\n    }),\n  };\n};\n\ntype OperationEditorStyles = ReturnType<typeof getStyles>;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}