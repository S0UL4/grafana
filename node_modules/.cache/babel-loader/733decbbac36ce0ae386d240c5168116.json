{"ast":null,"code":"import { css } from '@emotion/css';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { first } from 'rxjs/operators';\nimport { ContextMenu, MenuItem } from '@grafana/ui';\nimport { LayerActionID } from './types';\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const CanvasContextMenu = ({\n  scene\n}) => {\n  var _scene$selecto;\n\n  const [isMenuVisible, setIsMenuVisible] = useState(false);\n  const [anchorPoint, setAnchorPoint] = useState({\n    x: 0,\n    y: 0\n  });\n  const styles = getStyles();\n  const selectedElements = (_scene$selecto = scene.selecto) === null || _scene$selecto === void 0 ? void 0 : _scene$selecto.getSelectedTargets();\n  const handleContextMenu = useCallback(event => {\n    event.preventDefault();\n\n    if (event.currentTarget) {\n      scene.select({\n        targets: [event.currentTarget]\n      });\n    }\n\n    setAnchorPoint({\n      x: event.pageX,\n      y: event.pageY\n    });\n    setIsMenuVisible(true);\n  }, [scene]);\n  useEffect(() => {\n    if (selectedElements && selectedElements.length === 1) {\n      const element = selectedElements[0];\n      element.addEventListener('contextmenu', handleContextMenu);\n    }\n  }, [selectedElements, handleContextMenu]);\n\n  if (!selectedElements) {\n    return /*#__PURE__*/_jsx(_Fragment, {});\n  }\n\n  const closeContextMenu = () => {\n    setIsMenuVisible(false);\n  };\n\n  const renderMenuItems = () => {\n    return /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(MenuItem, {\n        label: \"Delete\",\n        onClick: () => {\n          contextMenuAction(LayerActionID.Delete);\n          closeContextMenu();\n        },\n        className: styles.menuItem\n      }), /*#__PURE__*/_jsx(MenuItem, {\n        label: \"Duplicate\",\n        onClick: () => {\n          contextMenuAction(LayerActionID.Duplicate);\n          closeContextMenu();\n        },\n        className: styles.menuItem\n      }), /*#__PURE__*/_jsx(MenuItem, {\n        label: \"Bring to front\",\n        onClick: () => {\n          contextMenuAction(LayerActionID.MoveTop);\n          closeContextMenu();\n        },\n        className: styles.menuItem\n      }), /*#__PURE__*/_jsx(MenuItem, {\n        label: \"Send to back\",\n        onClick: () => {\n          contextMenuAction(LayerActionID.MoveBottom);\n          closeContextMenu();\n        },\n        className: styles.menuItem\n      })]\n    });\n  };\n\n  const contextMenuAction = actionType => {\n    scene.selection.pipe(first()).subscribe(currentSelectedElements => {\n      const currentSelectedElement = currentSelectedElements[0];\n      const currentLayer = currentSelectedElement.parent;\n\n      switch (actionType) {\n        case LayerActionID.Delete:\n          currentLayer.doAction(LayerActionID.Delete, currentSelectedElement);\n          break;\n\n        case LayerActionID.Duplicate:\n          currentLayer.doAction(LayerActionID.Duplicate, currentSelectedElement);\n          break;\n\n        case LayerActionID.MoveTop:\n          currentLayer.doAction(LayerActionID.MoveTop, currentSelectedElement);\n          break;\n\n        case LayerActionID.MoveBottom:\n          currentLayer.doAction(LayerActionID.MoveBottom, currentSelectedElement);\n          break;\n      }\n    });\n  };\n\n  if (isMenuVisible) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      onContextMenu: event => {\n        event.preventDefault();\n        closeContextMenu();\n      },\n      children: /*#__PURE__*/_jsx(ContextMenu, {\n        x: anchorPoint.x,\n        y: anchorPoint.y,\n        onClose: closeContextMenu,\n        renderMenuItems: renderMenuItems,\n        focusOnOpen: false\n      })\n    });\n  }\n\n  return /*#__PURE__*/_jsx(_Fragment, {});\n};\n\nconst getStyles = () => ({\n  menuItem: css`\n    max-width: 60ch;\n    overflow: hidden;\n  `\n});","map":{"version":3,"names":["css","React","useCallback","useEffect","useState","first","ContextMenu","MenuItem","LayerActionID","CanvasContextMenu","scene","isMenuVisible","setIsMenuVisible","anchorPoint","setAnchorPoint","x","y","styles","getStyles","selectedElements","selecto","getSelectedTargets","handleContextMenu","event","preventDefault","currentTarget","select","targets","pageX","pageY","length","element","addEventListener","closeContextMenu","renderMenuItems","contextMenuAction","Delete","menuItem","Duplicate","MoveTop","MoveBottom","actionType","selection","pipe","subscribe","currentSelectedElements","currentSelectedElement","currentLayer","parent","doAction"],"sources":["/home/soula/grafana/public/app/plugins/panel/canvas/CanvasContextMenu.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { first } from 'rxjs/operators';\n\nimport { ContextMenu, MenuItem } from '@grafana/ui';\n\nimport { Scene } from '../../../features/canvas/runtime/scene';\n\nimport { LayerActionID } from './types';\n\ntype Props = {\n  scene: Scene;\n};\n\ntype AnchorPoint = {\n  x: number;\n  y: number;\n};\n\nexport const CanvasContextMenu = ({ scene }: Props) => {\n  const [isMenuVisible, setIsMenuVisible] = useState<boolean>(false);\n  const [anchorPoint, setAnchorPoint] = useState<AnchorPoint>({ x: 0, y: 0 });\n\n  const styles = getStyles();\n\n  const selectedElements = scene.selecto?.getSelectedTargets();\n\n  const handleContextMenu = useCallback(\n    (event) => {\n      event.preventDefault();\n      if (event.currentTarget) {\n        scene.select({ targets: [event.currentTarget as HTMLElement | SVGElement] });\n      }\n      setAnchorPoint({ x: event.pageX, y: event.pageY });\n      setIsMenuVisible(true);\n    },\n    [scene]\n  );\n\n  useEffect(() => {\n    if (selectedElements && selectedElements.length === 1) {\n      const element = selectedElements[0];\n      element.addEventListener('contextmenu', handleContextMenu);\n    }\n  }, [selectedElements, handleContextMenu]);\n\n  if (!selectedElements) {\n    return <></>;\n  }\n\n  const closeContextMenu = () => {\n    setIsMenuVisible(false);\n  };\n\n  const renderMenuItems = () => {\n    return (\n      <>\n        <MenuItem\n          label=\"Delete\"\n          onClick={() => {\n            contextMenuAction(LayerActionID.Delete);\n            closeContextMenu();\n          }}\n          className={styles.menuItem}\n        />\n        <MenuItem\n          label=\"Duplicate\"\n          onClick={() => {\n            contextMenuAction(LayerActionID.Duplicate);\n            closeContextMenu();\n          }}\n          className={styles.menuItem}\n        />\n        <MenuItem\n          label=\"Bring to front\"\n          onClick={() => {\n            contextMenuAction(LayerActionID.MoveTop);\n            closeContextMenu();\n          }}\n          className={styles.menuItem}\n        />\n        <MenuItem\n          label=\"Send to back\"\n          onClick={() => {\n            contextMenuAction(LayerActionID.MoveBottom);\n            closeContextMenu();\n          }}\n          className={styles.menuItem}\n        />\n      </>\n    );\n  };\n\n  const contextMenuAction = (actionType: string) => {\n    scene.selection.pipe(first()).subscribe((currentSelectedElements) => {\n      const currentSelectedElement = currentSelectedElements[0];\n      const currentLayer = currentSelectedElement.parent!;\n\n      switch (actionType) {\n        case LayerActionID.Delete:\n          currentLayer.doAction(LayerActionID.Delete, currentSelectedElement);\n          break;\n        case LayerActionID.Duplicate:\n          currentLayer.doAction(LayerActionID.Duplicate, currentSelectedElement);\n          break;\n        case LayerActionID.MoveTop:\n          currentLayer.doAction(LayerActionID.MoveTop, currentSelectedElement);\n          break;\n        case LayerActionID.MoveBottom:\n          currentLayer.doAction(LayerActionID.MoveBottom, currentSelectedElement);\n          break;\n      }\n    });\n  };\n\n  if (isMenuVisible) {\n    return (\n      <div\n        onContextMenu={(event) => {\n          event.preventDefault();\n          closeContextMenu();\n        }}\n      >\n        <ContextMenu\n          x={anchorPoint.x}\n          y={anchorPoint.y}\n          onClose={closeContextMenu}\n          renderMenuItems={renderMenuItems}\n          focusOnOpen={false}\n        />\n      </div>\n    );\n  }\n\n  return <></>;\n};\n\nconst getStyles = () => ({\n  menuItem: css`\n    max-width: 60ch;\n    overflow: hidden;\n  `,\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}