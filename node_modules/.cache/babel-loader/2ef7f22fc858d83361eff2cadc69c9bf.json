{"ast":null,"code":"import React from 'react';\nimport { Icon, SegmentAsync } from '@grafana/ui';\nimport { getDatasourceSrv } from '../../../plugins/datasource_srv';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst MIN_WIDTH = 90;\nexport const AdHocFilterKey = ({\n  datasource,\n  onChange,\n  filterKey,\n  getTagKeysOptions\n}) => {\n  const loadKeys = () => fetchFilterKeys(datasource, getTagKeysOptions);\n\n  const loadKeysWithRemove = () => fetchFilterKeysWithRemove(datasource, getTagKeysOptions);\n\n  if (filterKey === null) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      className: \"gf-form\",\n      \"data-testid\": \"AdHocFilterKey-add-key-wrapper\",\n      children: /*#__PURE__*/_jsx(SegmentAsync, {\n        className: \"query-segment-key\",\n        Component: plusSegment,\n        value: filterKey,\n        onChange: onChange,\n        loadOptions: loadKeys,\n        inputMinWidth: MIN_WIDTH\n      })\n    });\n  }\n\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: \"gf-form\",\n    \"data-testid\": \"AdHocFilterKey-key-wrapper\",\n    children: /*#__PURE__*/_jsx(SegmentAsync, {\n      className: \"query-segment-key\",\n      value: filterKey,\n      onChange: onChange,\n      loadOptions: loadKeysWithRemove,\n      inputMinWidth: MIN_WIDTH\n    })\n  });\n};\nexport const REMOVE_FILTER_KEY = '-- remove filter --';\nconst REMOVE_VALUE = {\n  label: REMOVE_FILTER_KEY,\n  value: REMOVE_FILTER_KEY\n};\n\nconst plusSegment = /*#__PURE__*/_jsx(\"a\", {\n  className: \"gf-form-label query-part\",\n  \"aria-label\": \"Add Filter\",\n  children: /*#__PURE__*/_jsx(Icon, {\n    name: \"plus\"\n  })\n});\n\nconst fetchFilterKeys = async (datasource, getTagKeysOptions) => {\n  const ds = await getDatasourceSrv().get(datasource);\n\n  if (!ds || !ds.getTagKeys) {\n    return [];\n  }\n\n  const metrics = await ds.getTagKeys(getTagKeysOptions);\n  return metrics.map(m => ({\n    label: m.text,\n    value: m.text\n  }));\n};\n\nconst fetchFilterKeysWithRemove = async (datasource, getTagKeysOptions) => {\n  const keys = await fetchFilterKeys(datasource, getTagKeysOptions);\n  return [REMOVE_VALUE, ...keys];\n};","map":{"version":3,"names":["React","Icon","SegmentAsync","getDatasourceSrv","MIN_WIDTH","AdHocFilterKey","datasource","onChange","filterKey","getTagKeysOptions","loadKeys","fetchFilterKeys","loadKeysWithRemove","fetchFilterKeysWithRemove","plusSegment","REMOVE_FILTER_KEY","REMOVE_VALUE","label","value","ds","get","getTagKeys","metrics","map","m","text","keys"],"sources":["/home/soula/grafana/public/app/features/variables/adhoc/picker/AdHocFilterKey.tsx"],"sourcesContent":["import React, { FC, ReactElement } from 'react';\n\nimport { DataSourceRef, SelectableValue } from '@grafana/data';\nimport { Icon, SegmentAsync } from '@grafana/ui';\n\nimport { getDatasourceSrv } from '../../../plugins/datasource_srv';\n\ninterface Props {\n  datasource: DataSourceRef;\n  filterKey: string | null;\n  onChange: (item: SelectableValue<string | null>) => void;\n  getTagKeysOptions?: any;\n}\n\nconst MIN_WIDTH = 90;\nexport const AdHocFilterKey: FC<Props> = ({ datasource, onChange, filterKey, getTagKeysOptions }) => {\n  const loadKeys = () => fetchFilterKeys(datasource, getTagKeysOptions);\n  const loadKeysWithRemove = () => fetchFilterKeysWithRemove(datasource, getTagKeysOptions);\n\n  if (filterKey === null) {\n    return (\n      <div className=\"gf-form\" data-testid=\"AdHocFilterKey-add-key-wrapper\">\n        <SegmentAsync\n          className=\"query-segment-key\"\n          Component={plusSegment}\n          value={filterKey}\n          onChange={onChange}\n          loadOptions={loadKeys}\n          inputMinWidth={MIN_WIDTH}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"gf-form\" data-testid=\"AdHocFilterKey-key-wrapper\">\n      <SegmentAsync\n        className=\"query-segment-key\"\n        value={filterKey}\n        onChange={onChange}\n        loadOptions={loadKeysWithRemove}\n        inputMinWidth={MIN_WIDTH}\n      />\n    </div>\n  );\n};\n\nexport const REMOVE_FILTER_KEY = '-- remove filter --';\nconst REMOVE_VALUE = { label: REMOVE_FILTER_KEY, value: REMOVE_FILTER_KEY };\n\nconst plusSegment: ReactElement = (\n  <a className=\"gf-form-label query-part\" aria-label=\"Add Filter\">\n    <Icon name=\"plus\" />\n  </a>\n);\n\nconst fetchFilterKeys = async (\n  datasource: DataSourceRef,\n  getTagKeysOptions?: any\n): Promise<Array<SelectableValue<string>>> => {\n  const ds = await getDatasourceSrv().get(datasource);\n\n  if (!ds || !ds.getTagKeys) {\n    return [];\n  }\n\n  const metrics = await ds.getTagKeys(getTagKeysOptions);\n  return metrics.map((m) => ({ label: m.text, value: m.text }));\n};\n\nconst fetchFilterKeysWithRemove = async (\n  datasource: DataSourceRef,\n  getTagKeysOptions?: any\n): Promise<Array<SelectableValue<string>>> => {\n  const keys = await fetchFilterKeys(datasource, getTagKeysOptions);\n  return [REMOVE_VALUE, ...keys];\n};\n"],"mappings":"AAAA,OAAOA,KAAP,MAAwC,OAAxC;AAGA,SAASC,IAAT,EAAeC,YAAf,QAAmC,aAAnC;AAEA,SAASC,gBAAT,QAAiC,iCAAjC;;AASA,MAAMC,SAAS,GAAG,EAAlB;AACA,OAAO,MAAMC,cAAyB,GAAG,CAAC;EAAEC,UAAF;EAAcC,QAAd;EAAwBC,SAAxB;EAAmCC;AAAnC,CAAD,KAA4D;EACnG,MAAMC,QAAQ,GAAG,MAAMC,eAAe,CAACL,UAAD,EAAaG,iBAAb,CAAtC;;EACA,MAAMG,kBAAkB,GAAG,MAAMC,yBAAyB,CAACP,UAAD,EAAaG,iBAAb,CAA1D;;EAEA,IAAID,SAAS,KAAK,IAAlB,EAAwB;IACtB,oBACE;MAAK,SAAS,EAAC,SAAf;MAAyB,eAAY,gCAArC;MAAA,uBACE,KAAC,YAAD;QACE,SAAS,EAAC,mBADZ;QAEE,SAAS,EAAEM,WAFb;QAGE,KAAK,EAAEN,SAHT;QAIE,QAAQ,EAAED,QAJZ;QAKE,WAAW,EAAEG,QALf;QAME,aAAa,EAAEN;MANjB;IADF,EADF;EAYD;;EAED,oBACE;IAAK,SAAS,EAAC,SAAf;IAAyB,eAAY,4BAArC;IAAA,uBACE,KAAC,YAAD;MACE,SAAS,EAAC,mBADZ;MAEE,KAAK,EAAEI,SAFT;MAGE,QAAQ,EAAED,QAHZ;MAIE,WAAW,EAAEK,kBAJf;MAKE,aAAa,EAAER;IALjB;EADF,EADF;AAWD,CA9BM;AAgCP,OAAO,MAAMW,iBAAiB,GAAG,qBAA1B;AACP,MAAMC,YAAY,GAAG;EAAEC,KAAK,EAAEF,iBAAT;EAA4BG,KAAK,EAAEH;AAAnC,CAArB;;AAEA,MAAMD,WAAyB,gBAC7B;EAAG,SAAS,EAAC,0BAAb;EAAwC,cAAW,YAAnD;EAAA,uBACE,KAAC,IAAD;IAAM,IAAI,EAAC;EAAX;AADF,EADF;;AAMA,MAAMH,eAAe,GAAG,OACtBL,UADsB,EAEtBG,iBAFsB,KAGsB;EAC5C,MAAMU,EAAE,GAAG,MAAMhB,gBAAgB,GAAGiB,GAAnB,CAAuBd,UAAvB,CAAjB;;EAEA,IAAI,CAACa,EAAD,IAAO,CAACA,EAAE,CAACE,UAAf,EAA2B;IACzB,OAAO,EAAP;EACD;;EAED,MAAMC,OAAO,GAAG,MAAMH,EAAE,CAACE,UAAH,CAAcZ,iBAAd,CAAtB;EACA,OAAOa,OAAO,CAACC,GAAR,CAAaC,CAAD,KAAQ;IAAEP,KAAK,EAAEO,CAAC,CAACC,IAAX;IAAiBP,KAAK,EAAEM,CAAC,CAACC;EAA1B,CAAR,CAAZ,CAAP;AACD,CAZD;;AAcA,MAAMZ,yBAAyB,GAAG,OAChCP,UADgC,EAEhCG,iBAFgC,KAGY;EAC5C,MAAMiB,IAAI,GAAG,MAAMf,eAAe,CAACL,UAAD,EAAaG,iBAAb,CAAlC;EACA,OAAO,CAACO,YAAD,EAAe,GAAGU,IAAlB,CAAP;AACD,CAND"},"metadata":{},"sourceType":"module"}