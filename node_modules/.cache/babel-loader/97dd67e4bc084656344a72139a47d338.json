{"ast":null,"code":"import { toStateKey } from '../utils';\nimport { getTemplatingReducers } from './reducers';\nimport { variablesInitTransaction } from './transactionReducer';\nexport const initialKeyedVariablesState = {\n  keys: {}\n};\n\nconst keyedAction = payload => ({\n  type: `templating/keyed/${payload.action.type.replace(/^templating\\//, '')}`,\n  payload\n});\n\nexport function toKeyedAction(key, action) {\n  const keyAsString = toStateKey(key);\n  return keyedAction({\n    key: keyAsString,\n    action\n  });\n}\n\nconst isKeyedAction = action => {\n  return typeof action.type === 'string' && action.type.startsWith('templating/keyed') && 'payload' in action && typeof action.payload.key === 'string';\n};\n\nexport function keyedVariablesReducer(state = initialKeyedVariablesState, outerAction) {\n  if (isKeyedAction(outerAction)) {\n    const {\n      key,\n      action\n    } = outerAction.payload;\n    const stringKey = toStateKey(key);\n    const lastKey = variablesInitTransaction.match(action) ? stringKey : state.lastKey;\n    const templatingReducers = getTemplatingReducers();\n    const prevKeyState = state.keys[stringKey];\n    const nextKeyState = templatingReducers(prevKeyState, action);\n    return Object.assign({}, state, {\n      lastKey,\n      keys: Object.assign({}, state.keys, {\n        [stringKey]: nextKeyState\n      })\n    });\n  }\n\n  return state;\n}\nexport default {\n  templating: keyedVariablesReducer\n};","map":{"version":3,"names":["toStateKey","getTemplatingReducers","variablesInitTransaction","initialKeyedVariablesState","keys","keyedAction","payload","type","action","replace","toKeyedAction","key","keyAsString","isKeyedAction","startsWith","keyedVariablesReducer","state","outerAction","stringKey","lastKey","match","templatingReducers","prevKeyState","nextKeyState","templating"],"sources":["/home/soula/grafana/public/app/features/variables/state/keyedVariablesReducer.ts"],"sourcesContent":["import { PayloadAction } from '@reduxjs/toolkit';\nimport { AnyAction } from 'redux';\n\nimport { toStateKey } from '../utils';\n\nimport { getTemplatingReducers, TemplatingState } from './reducers';\nimport { variablesInitTransaction } from './transactionReducer';\n\nexport interface KeyedVariablesState {\n  lastKey?: string;\n  keys: Record<string, TemplatingState>;\n}\n\nexport const initialKeyedVariablesState: KeyedVariablesState = { keys: {} };\n\nexport interface KeyedAction {\n  key: string;\n  action: PayloadAction<any>;\n}\n\nconst keyedAction = (payload: KeyedAction) => ({\n  type: `templating/keyed/${payload.action.type.replace(/^templating\\//, '')}`,\n  payload,\n});\n\nexport function toKeyedAction(key: string, action: PayloadAction<any>): PayloadAction<KeyedAction> {\n  const keyAsString = toStateKey(key);\n  return keyedAction({ key: keyAsString, action });\n}\n\nconst isKeyedAction = (action: AnyAction): action is PayloadAction<KeyedAction> => {\n  return (\n    typeof action.type === 'string' &&\n    action.type.startsWith('templating/keyed') &&\n    'payload' in action &&\n    typeof action.payload.key === 'string'\n  );\n};\n\nexport function keyedVariablesReducer(state = initialKeyedVariablesState, outerAction: AnyAction): KeyedVariablesState {\n  if (isKeyedAction(outerAction)) {\n    const { key, action } = outerAction.payload;\n    const stringKey = toStateKey(key);\n    const lastKey = variablesInitTransaction.match(action) ? stringKey : state.lastKey;\n    const templatingReducers = getTemplatingReducers();\n    const prevKeyState = state.keys[stringKey];\n    const nextKeyState = templatingReducers(prevKeyState, action);\n\n    return {\n      ...state,\n      lastKey,\n      keys: {\n        ...state.keys,\n        [stringKey]: nextKeyState,\n      },\n    };\n  }\n\n  return state;\n}\n\nexport default {\n  templating: keyedVariablesReducer,\n};\n"],"mappings":"AAGA,SAASA,UAAT,QAA2B,UAA3B;AAEA,SAASC,qBAAT,QAAuD,YAAvD;AACA,SAASC,wBAAT,QAAyC,sBAAzC;AAOA,OAAO,MAAMC,0BAA+C,GAAG;EAAEC,IAAI,EAAE;AAAR,CAAxD;;AAOP,MAAMC,WAAW,GAAIC,OAAD,KAA2B;EAC7CC,IAAI,EAAG,oBAAmBD,OAAO,CAACE,MAAR,CAAeD,IAAf,CAAoBE,OAApB,CAA4B,eAA5B,EAA6C,EAA7C,CAAiD,EAD9B;EAE7CH;AAF6C,CAA3B,CAApB;;AAKA,OAAO,SAASI,aAAT,CAAuBC,GAAvB,EAAoCH,MAApC,EAA4F;EACjG,MAAMI,WAAW,GAAGZ,UAAU,CAACW,GAAD,CAA9B;EACA,OAAON,WAAW,CAAC;IAAEM,GAAG,EAAEC,WAAP;IAAoBJ;EAApB,CAAD,CAAlB;AACD;;AAED,MAAMK,aAAa,GAAIL,MAAD,IAA6D;EACjF,OACE,OAAOA,MAAM,CAACD,IAAd,KAAuB,QAAvB,IACAC,MAAM,CAACD,IAAP,CAAYO,UAAZ,CAAuB,kBAAvB,CADA,IAEA,aAAaN,MAFb,IAGA,OAAOA,MAAM,CAACF,OAAP,CAAeK,GAAtB,KAA8B,QAJhC;AAMD,CAPD;;AASA,OAAO,SAASI,qBAAT,CAA+BC,KAAK,GAAGb,0BAAvC,EAAmEc,WAAnE,EAAgH;EACrH,IAAIJ,aAAa,CAACI,WAAD,CAAjB,EAAgC;IAC9B,MAAM;MAAEN,GAAF;MAAOH;IAAP,IAAkBS,WAAW,CAACX,OAApC;IACA,MAAMY,SAAS,GAAGlB,UAAU,CAACW,GAAD,CAA5B;IACA,MAAMQ,OAAO,GAAGjB,wBAAwB,CAACkB,KAAzB,CAA+BZ,MAA/B,IAAyCU,SAAzC,GAAqDF,KAAK,CAACG,OAA3E;IACA,MAAME,kBAAkB,GAAGpB,qBAAqB,EAAhD;IACA,MAAMqB,YAAY,GAAGN,KAAK,CAACZ,IAAN,CAAWc,SAAX,CAArB;IACA,MAAMK,YAAY,GAAGF,kBAAkB,CAACC,YAAD,EAAed,MAAf,CAAvC;IAEA,yBACKQ,KADL;MAEEG,OAFF;MAGEf,IAAI,oBACCY,KAAK,CAACZ,IADP;QAEF,CAACc,SAAD,GAAaK;MAFX;IAHN;EAQD;;EAED,OAAOP,KAAP;AACD;AAED,eAAe;EACbQ,UAAU,EAAET;AADC,CAAf"},"metadata":{},"sourceType":"module"}