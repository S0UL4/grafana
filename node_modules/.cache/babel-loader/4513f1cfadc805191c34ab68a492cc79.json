{"ast":null,"code":"import * as comlink from 'comlink';\nimport { Subscriber } from 'rxjs'; // Observers, ie. functions passed to `observable.subscribe(...)`, are converted to a subclass of `Subscriber` before they are sent to the source Observable.\n// The conversion happens internally in the RxJS library - this transfer handler is catches them and wraps them with a proxy\n\nconst subscriberTransferHandler = {\n  canHandle(value) {\n    return value && value instanceof Subscriber;\n  },\n\n  serialize(value) {\n    const obj = comlink.proxy(value);\n    const {\n      port1,\n      port2\n    } = new MessageChannel();\n    comlink.expose(obj, port1);\n    return [port2, [port2]];\n  },\n\n  deserialize(value) {\n    value.start();\n    return comlink.wrap(value);\n  }\n\n};\ncomlink.transferHandlers.set('SubscriberHandler', subscriberTransferHandler);","map":{"version":3,"names":["comlink","Subscriber","subscriberTransferHandler","canHandle","value","serialize","obj","proxy","port1","port2","MessageChannel","expose","deserialize","start","wrap","transferHandlers","set"],"sources":["/home/soula/grafana/public/app/features/live/centrifuge/transferHandlers.ts"],"sourcesContent":["import * as comlink from 'comlink';\nimport { Subscriber } from 'rxjs';\n\n// Observers, ie. functions passed to `observable.subscribe(...)`, are converted to a subclass of `Subscriber` before they are sent to the source Observable.\n// The conversion happens internally in the RxJS library - this transfer handler is catches them and wraps them with a proxy\nconst subscriberTransferHandler: any = {\n  canHandle(value: any): boolean {\n    return value && value instanceof Subscriber;\n  },\n\n  serialize(value: Function): [MessagePort, Transferable[]] {\n    const obj = comlink.proxy(value);\n\n    const { port1, port2 } = new MessageChannel();\n\n    comlink.expose(obj, port1);\n\n    return [port2, [port2]];\n  },\n\n  deserialize(value: MessagePort): comlink.Remote<MessagePort> {\n    value.start();\n\n    return comlink.wrap<MessagePort>(value);\n  },\n};\ncomlink.transferHandlers.set('SubscriberHandler', subscriberTransferHandler);\n"],"mappings":"AAAA,OAAO,KAAKA,OAAZ,MAAyB,SAAzB;AACA,SAASC,UAAT,QAA2B,MAA3B,C,CAEA;AACA;;AACA,MAAMC,yBAA8B,GAAG;EACrCC,SAAS,CAACC,KAAD,EAAsB;IAC7B,OAAOA,KAAK,IAAIA,KAAK,YAAYH,UAAjC;EACD,CAHoC;;EAKrCI,SAAS,CAACD,KAAD,EAAiD;IACxD,MAAME,GAAG,GAAGN,OAAO,CAACO,KAAR,CAAcH,KAAd,CAAZ;IAEA,MAAM;MAAEI,KAAF;MAASC;IAAT,IAAmB,IAAIC,cAAJ,EAAzB;IAEAV,OAAO,CAACW,MAAR,CAAeL,GAAf,EAAoBE,KAApB;IAEA,OAAO,CAACC,KAAD,EAAQ,CAACA,KAAD,CAAR,CAAP;EACD,CAboC;;EAerCG,WAAW,CAACR,KAAD,EAAkD;IAC3DA,KAAK,CAACS,KAAN;IAEA,OAAOb,OAAO,CAACc,IAAR,CAA0BV,KAA1B,CAAP;EACD;;AAnBoC,CAAvC;AAqBAJ,OAAO,CAACe,gBAAR,CAAyBC,GAAzB,CAA6B,mBAA7B,EAAkDd,yBAAlD"},"metadata":{},"sourceType":"module"}