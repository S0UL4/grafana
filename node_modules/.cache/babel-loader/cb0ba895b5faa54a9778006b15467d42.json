{"ast":null,"code":"var _div;\n\nimport React, { useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { LinkButton } from '@grafana/ui';\nimport Page from 'app/core/components/Page/Page';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { AccessControlAction } from 'app/types';\nimport { AdminOrgsTable } from './AdminOrgsTable';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nconst deleteOrg = async orgId => {\n  return await getBackendSrv().delete('/api/orgs/' + orgId);\n};\n\nconst getOrgs = async () => {\n  return await getBackendSrv().get('/api/orgs');\n};\n\nconst getErrorMessage = error => {\n  var _error$data;\n\n  return (error === null || error === void 0 ? void 0 : (_error$data = error.data) === null || _error$data === void 0 ? void 0 : _error$data.message) || 'An unexpected error happened.';\n};\n\nexport default function AdminListOrgsPages() {\n  const navIndex = useSelector(state => state.navIndex);\n  const navModel = getNavModel(navIndex, 'global-orgs');\n  const [state, fetchOrgs] = useAsyncFn(async () => await getOrgs(), []);\n  const canCreateOrg = contextSrv.hasPermission(AccessControlAction.OrgsCreate);\n  useEffect(() => {\n    fetchOrgs();\n  }, [fetchOrgs]);\n  return /*#__PURE__*/_jsx(Page, {\n    navModel: navModel,\n    children: /*#__PURE__*/_jsx(Page.Contents, {\n      children: /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"page-action-bar\",\n          children: [_div || (_div = /*#__PURE__*/_jsx(\"div\", {\n            className: \"page-action-bar__spacer\"\n          })), /*#__PURE__*/_jsx(LinkButton, {\n            icon: \"plus\",\n            href: \"org/new\",\n            disabled: !canCreateOrg,\n            children: \"New org\"\n          })]\n        }), state.error && getErrorMessage(state.error), state.loading && 'Fetching organizations', state.value && /*#__PURE__*/_jsx(AdminOrgsTable, {\n          orgs: state.value,\n          onDelete: orgId => {\n            deleteOrg(orgId).then(() => fetchOrgs());\n          }\n        })]\n      })\n    })\n  });\n}","map":{"version":3,"names":["React","useEffect","useSelector","useAsyncFn","getBackendSrv","LinkButton","Page","getNavModel","contextSrv","AccessControlAction","AdminOrgsTable","deleteOrg","orgId","delete","getOrgs","get","getErrorMessage","error","data","message","AdminListOrgsPages","navIndex","state","navModel","fetchOrgs","canCreateOrg","hasPermission","OrgsCreate","loading","value","then"],"sources":["/home/soula/grafana/public/app/features/admin/AdminListOrgsPage.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { LinkButton } from '@grafana/ui';\nimport Page from 'app/core/components/Page/Page';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { AccessControlAction } from 'app/types';\nimport { StoreState } from 'app/types/store';\n\nimport { AdminOrgsTable } from './AdminOrgsTable';\n\nconst deleteOrg = async (orgId: number) => {\n  return await getBackendSrv().delete('/api/orgs/' + orgId);\n};\n\nconst getOrgs = async () => {\n  return await getBackendSrv().get('/api/orgs');\n};\n\nconst getErrorMessage = (error: any) => {\n  return error?.data?.message || 'An unexpected error happened.';\n};\n\nexport default function AdminListOrgsPages() {\n  const navIndex = useSelector((state: StoreState) => state.navIndex);\n  const navModel = getNavModel(navIndex, 'global-orgs');\n  const [state, fetchOrgs] = useAsyncFn(async () => await getOrgs(), []);\n  const canCreateOrg = contextSrv.hasPermission(AccessControlAction.OrgsCreate);\n\n  useEffect(() => {\n    fetchOrgs();\n  }, [fetchOrgs]);\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        <>\n          <div className=\"page-action-bar\">\n            <div className=\"page-action-bar__spacer\" />\n            <LinkButton icon=\"plus\" href=\"org/new\" disabled={!canCreateOrg}>\n              New org\n            </LinkButton>\n          </div>\n          {state.error && getErrorMessage(state.error)}\n          {state.loading && 'Fetching organizations'}\n          {state.value && (\n            <AdminOrgsTable\n              orgs={state.value}\n              onDelete={(orgId) => {\n                deleteOrg(orgId).then(() => fetchOrgs());\n              }}\n            />\n          )}\n        </>\n      </Page.Contents>\n    </Page>\n  );\n}\n"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AAEA,SAASC,aAAT,QAA8B,kBAA9B;AACA,SAASC,UAAT,QAA2B,aAA3B;AACA,OAAOC,IAAP,MAAiB,+BAAjB;AACA,SAASC,WAAT,QAA4B,6BAA5B;AACA,SAASC,UAAT,QAA2B,+BAA3B;AACA,SAASC,mBAAT,QAAoC,WAApC;AAGA,SAASC,cAAT,QAA+B,kBAA/B;;;;;AAEA,MAAMC,SAAS,GAAG,MAAOC,KAAP,IAAyB;EACzC,OAAO,MAAMR,aAAa,GAAGS,MAAhB,CAAuB,eAAeD,KAAtC,CAAb;AACD,CAFD;;AAIA,MAAME,OAAO,GAAG,YAAY;EAC1B,OAAO,MAAMV,aAAa,GAAGW,GAAhB,CAAoB,WAApB,CAAb;AACD,CAFD;;AAIA,MAAMC,eAAe,GAAIC,KAAD,IAAgB;EAAA;;EACtC,OAAO,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,2BAAAA,KAAK,CAAEC,IAAP,4DAAaC,OAAb,KAAwB,+BAA/B;AACD,CAFD;;AAIA,eAAe,SAASC,kBAAT,GAA8B;EAC3C,MAAMC,QAAQ,GAAGnB,WAAW,CAAEoB,KAAD,IAAuBA,KAAK,CAACD,QAA9B,CAA5B;EACA,MAAME,QAAQ,GAAGhB,WAAW,CAACc,QAAD,EAAW,aAAX,CAA5B;EACA,MAAM,CAACC,KAAD,EAAQE,SAAR,IAAqBrB,UAAU,CAAC,YAAY,MAAMW,OAAO,EAA1B,EAA8B,EAA9B,CAArC;EACA,MAAMW,YAAY,GAAGjB,UAAU,CAACkB,aAAX,CAAyBjB,mBAAmB,CAACkB,UAA7C,CAArB;EAEA1B,SAAS,CAAC,MAAM;IACduB,SAAS;EACV,CAFQ,EAEN,CAACA,SAAD,CAFM,CAAT;EAIA,oBACE,KAAC,IAAD;IAAM,QAAQ,EAAED,QAAhB;IAAA,uBACE,KAAC,IAAD,CAAM,QAAN;MAAA,uBACE;QAAA,wBACE;UAAK,SAAS,EAAC,iBAAf;UAAA,wCACE;YAAK,SAAS,EAAC;UAAf,EADF,gBAEE,KAAC,UAAD;YAAY,IAAI,EAAC,MAAjB;YAAwB,IAAI,EAAC,SAA7B;YAAuC,QAAQ,EAAE,CAACE,YAAlD;YAAA;UAAA,EAFF;QAAA,EADF,EAOGH,KAAK,CAACL,KAAN,IAAeD,eAAe,CAACM,KAAK,CAACL,KAAP,CAPjC,EAQGK,KAAK,CAACM,OAAN,IAAiB,wBARpB,EASGN,KAAK,CAACO,KAAN,iBACC,KAAC,cAAD;UACE,IAAI,EAAEP,KAAK,CAACO,KADd;UAEE,QAAQ,EAAGjB,KAAD,IAAW;YACnBD,SAAS,CAACC,KAAD,CAAT,CAAiBkB,IAAjB,CAAsB,MAAMN,SAAS,EAArC;UACD;QAJH,EAVJ;MAAA;IADF;EADF,EADF;AAwBD"},"metadata":{},"sourceType":"module"}