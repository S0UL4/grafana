{"ast":null,"code":"import { useEffect, useLayoutEffect, useState } from 'react';\nimport { pluginLog } from '../utils';\n// min px width that triggers zoom\nconst MIN_ZOOM_DIST = 5;\n/**\n * @alpha\n */\n\nexport const ZoomPlugin = ({\n  onZoom,\n  config\n}) => {\n  const [selection, setSelection] = useState(null);\n  useEffect(() => {\n    if (selection) {\n      pluginLog('ZoomPlugin', false, 'selected', selection);\n\n      if (selection.bbox.width < MIN_ZOOM_DIST) {\n        return;\n      }\n\n      onZoom({\n        from: selection.min,\n        to: selection.max\n      });\n    }\n  }, [selection]);\n  useLayoutEffect(() => {\n    config.addHook('setSelect', u => {\n      const min = u.posToVal(u.select.left, 'x');\n      const max = u.posToVal(u.select.left + u.select.width, 'x');\n      setSelection({\n        min,\n        max,\n        bbox: {\n          left: u.bbox.left / window.devicePixelRatio + u.select.left,\n          top: u.bbox.top / window.devicePixelRatio,\n          height: u.bbox.height / window.devicePixelRatio,\n          width: u.select.width\n        }\n      }); // manually hide selected region (since cursor.drag.setScale = false)\n\n      /* @ts-ignore */\n\n      u.setSelect({\n        left: 0,\n        width: 0\n      }, false);\n    });\n  }, [config]);\n  return null;\n};","map":{"version":3,"names":["useEffect","useLayoutEffect","useState","pluginLog","MIN_ZOOM_DIST","ZoomPlugin","onZoom","config","selection","setSelection","bbox","width","from","min","to","max","addHook","u","posToVal","select","left","window","devicePixelRatio","top","height","setSelect"],"sources":["/home/soula/grafana/packages/grafana-ui/src/components/uPlot/plugins/ZoomPlugin.tsx"],"sourcesContent":["import React, { useEffect, useLayoutEffect, useState } from 'react';\n\nimport { UPlotConfigBuilder } from '../config/UPlotConfigBuilder';\nimport { PlotSelection } from '../types';\nimport { pluginLog } from '../utils';\n\ninterface ZoomPluginProps {\n  onZoom: (range: { from: number; to: number }) => void;\n  config: UPlotConfigBuilder;\n}\n\n// min px width that triggers zoom\nconst MIN_ZOOM_DIST = 5;\n\n/**\n * @alpha\n */\nexport const ZoomPlugin: React.FC<ZoomPluginProps> = ({ onZoom, config }) => {\n  const [selection, setSelection] = useState<PlotSelection | null>(null);\n\n  useEffect(() => {\n    if (selection) {\n      pluginLog('ZoomPlugin', false, 'selected', selection);\n      if (selection.bbox.width < MIN_ZOOM_DIST) {\n        return;\n      }\n      onZoom({ from: selection.min, to: selection.max });\n    }\n  }, [selection]);\n\n  useLayoutEffect(() => {\n    config.addHook('setSelect', (u) => {\n      const min = u.posToVal(u.select.left, 'x');\n      const max = u.posToVal(u.select.left + u.select.width, 'x');\n\n      setSelection({\n        min,\n        max,\n        bbox: {\n          left: u.bbox.left / window.devicePixelRatio + u.select.left,\n          top: u.bbox.top / window.devicePixelRatio,\n          height: u.bbox.height / window.devicePixelRatio,\n          width: u.select.width,\n        },\n      });\n\n      // manually hide selected region (since cursor.drag.setScale = false)\n      /* @ts-ignore */\n      u.setSelect({ left: 0, width: 0 }, false);\n    });\n  }, [config]);\n\n  return null;\n};\n"],"mappings":"AAAA,SAAgBA,SAAhB,EAA2BC,eAA3B,EAA4CC,QAA5C,QAA4D,OAA5D;AAIA,SAASC,SAAT,QAA0B,UAA1B;AAOA;AACA,MAAMC,aAAa,GAAG,CAAtB;AAEA;AACA;AACA;;AACA,OAAO,MAAMC,UAAqC,GAAG,CAAC;EAAEC,MAAF;EAAUC;AAAV,CAAD,KAAwB;EAC3E,MAAM,CAACC,SAAD,EAAYC,YAAZ,IAA4BP,QAAQ,CAAuB,IAAvB,CAA1C;EAEAF,SAAS,CAAC,MAAM;IACd,IAAIQ,SAAJ,EAAe;MACbL,SAAS,CAAC,YAAD,EAAe,KAAf,EAAsB,UAAtB,EAAkCK,SAAlC,CAAT;;MACA,IAAIA,SAAS,CAACE,IAAV,CAAeC,KAAf,GAAuBP,aAA3B,EAA0C;QACxC;MACD;;MACDE,MAAM,CAAC;QAAEM,IAAI,EAAEJ,SAAS,CAACK,GAAlB;QAAuBC,EAAE,EAAEN,SAAS,CAACO;MAArC,CAAD,CAAN;IACD;EACF,CARQ,EAQN,CAACP,SAAD,CARM,CAAT;EAUAP,eAAe,CAAC,MAAM;IACpBM,MAAM,CAACS,OAAP,CAAe,WAAf,EAA6BC,CAAD,IAAO;MACjC,MAAMJ,GAAG,GAAGI,CAAC,CAACC,QAAF,CAAWD,CAAC,CAACE,MAAF,CAASC,IAApB,EAA0B,GAA1B,CAAZ;MACA,MAAML,GAAG,GAAGE,CAAC,CAACC,QAAF,CAAWD,CAAC,CAACE,MAAF,CAASC,IAAT,GAAgBH,CAAC,CAACE,MAAF,CAASR,KAApC,EAA2C,GAA3C,CAAZ;MAEAF,YAAY,CAAC;QACXI,GADW;QAEXE,GAFW;QAGXL,IAAI,EAAE;UACJU,IAAI,EAAEH,CAAC,CAACP,IAAF,CAAOU,IAAP,GAAcC,MAAM,CAACC,gBAArB,GAAwCL,CAAC,CAACE,MAAF,CAASC,IADnD;UAEJG,GAAG,EAAEN,CAAC,CAACP,IAAF,CAAOa,GAAP,GAAaF,MAAM,CAACC,gBAFrB;UAGJE,MAAM,EAAEP,CAAC,CAACP,IAAF,CAAOc,MAAP,GAAgBH,MAAM,CAACC,gBAH3B;UAIJX,KAAK,EAAEM,CAAC,CAACE,MAAF,CAASR;QAJZ;MAHK,CAAD,CAAZ,CAJiC,CAejC;;MACA;;MACAM,CAAC,CAACQ,SAAF,CAAY;QAAEL,IAAI,EAAE,CAAR;QAAWT,KAAK,EAAE;MAAlB,CAAZ,EAAmC,KAAnC;IACD,CAlBD;EAmBD,CApBc,EAoBZ,CAACJ,MAAD,CApBY,CAAf;EAsBA,OAAO,IAAP;AACD,CApCM"},"metadata":{},"sourceType":"module"}