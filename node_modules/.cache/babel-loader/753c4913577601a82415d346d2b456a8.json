{"ast":null,"code":"import React, { useCallback, useState } from 'react';\nimport { AdHocFilterKey, REMOVE_FILTER_KEY } from './AdHocFilterKey';\nimport { AdHocFilterRenderer } from './AdHocFilterRenderer';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const AdHocFilterBuilder = ({\n  datasource,\n  appendBefore,\n  onCompleted,\n  getTagKeysOptions\n}) => {\n  const [key, setKey] = useState(null);\n  const [operator, setOperator] = useState('=');\n  const onKeyChanged = useCallback(item => {\n    if (item.value !== REMOVE_FILTER_KEY) {\n      var _item$value;\n\n      setKey((_item$value = item.value) !== null && _item$value !== void 0 ? _item$value : '');\n      return;\n    }\n\n    setKey(null);\n  }, [setKey]);\n  const onOperatorChanged = useCallback(item => {\n    var _item$value2;\n\n    return setOperator((_item$value2 = item.value) !== null && _item$value2 !== void 0 ? _item$value2 : '');\n  }, [setOperator]);\n  const onValueChanged = useCallback(item => {\n    var _item$value3;\n\n    onCompleted({\n      value: (_item$value3 = item.value) !== null && _item$value3 !== void 0 ? _item$value3 : '',\n      operator: operator,\n      condition: '',\n      key: key\n    });\n    setKey(null);\n    setOperator('=');\n  }, [onCompleted, operator, key]);\n\n  if (key === null) {\n    return /*#__PURE__*/_jsx(AdHocFilterKey, {\n      datasource: datasource,\n      filterKey: key,\n      onChange: onKeyChanged,\n      getTagKeysOptions: getTagKeysOptions\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(React.Fragment, {\n    children: [appendBefore, /*#__PURE__*/_jsx(AdHocFilterRenderer, {\n      datasource: datasource,\n      filter: {\n        key,\n        value: '',\n        operator,\n        condition: ''\n      },\n      placeHolder: \"select value\",\n      onKeyChange: onKeyChanged,\n      onOperatorChange: onOperatorChanged,\n      onValueChange: onValueChanged,\n      getTagKeysOptions: getTagKeysOptions\n    })]\n  }, \"filter-builder\");\n};","map":{"version":3,"names":["React","useCallback","useState","AdHocFilterKey","REMOVE_FILTER_KEY","AdHocFilterRenderer","AdHocFilterBuilder","datasource","appendBefore","onCompleted","getTagKeysOptions","key","setKey","operator","setOperator","onKeyChanged","item","value","onOperatorChanged","onValueChanged","condition"],"sources":["/home/soula/grafana/public/app/features/variables/adhoc/picker/AdHocFilterBuilder.tsx"],"sourcesContent":["import React, { FC, useCallback, useState } from 'react';\n\nimport { DataSourceRef, SelectableValue } from '@grafana/data';\nimport { AdHocVariableFilter } from 'app/features/variables/types';\n\nimport { AdHocFilterKey, REMOVE_FILTER_KEY } from './AdHocFilterKey';\nimport { AdHocFilterRenderer } from './AdHocFilterRenderer';\n\ninterface Props {\n  datasource: DataSourceRef;\n  onCompleted: (filter: AdHocVariableFilter) => void;\n  appendBefore?: React.ReactNode;\n  getTagKeysOptions?: any;\n}\n\nexport const AdHocFilterBuilder: FC<Props> = ({ datasource, appendBefore, onCompleted, getTagKeysOptions }) => {\n  const [key, setKey] = useState<string | null>(null);\n  const [operator, setOperator] = useState<string>('=');\n\n  const onKeyChanged = useCallback(\n    (item: SelectableValue<string | null>) => {\n      if (item.value !== REMOVE_FILTER_KEY) {\n        setKey(item.value ?? '');\n        return;\n      }\n      setKey(null);\n    },\n    [setKey]\n  );\n\n  const onOperatorChanged = useCallback(\n    (item: SelectableValue<string>) => setOperator(item.value ?? ''),\n    [setOperator]\n  );\n\n  const onValueChanged = useCallback(\n    (item: SelectableValue<string>) => {\n      onCompleted({\n        value: item.value ?? '',\n        operator: operator,\n        condition: '',\n        key: key!,\n      });\n      setKey(null);\n      setOperator('=');\n    },\n    [onCompleted, operator, key]\n  );\n\n  if (key === null) {\n    return (\n      <AdHocFilterKey\n        datasource={datasource}\n        filterKey={key}\n        onChange={onKeyChanged}\n        getTagKeysOptions={getTagKeysOptions}\n      />\n    );\n  }\n\n  return (\n    <React.Fragment key=\"filter-builder\">\n      {appendBefore}\n      <AdHocFilterRenderer\n        datasource={datasource}\n        filter={{ key, value: '', operator, condition: '' }}\n        placeHolder=\"select value\"\n        onKeyChange={onKeyChanged}\n        onOperatorChange={onOperatorChanged}\n        onValueChange={onValueChanged}\n        getTagKeysOptions={getTagKeysOptions}\n      />\n    </React.Fragment>\n  );\n};\n"],"mappings":"AAAA,OAAOA,KAAP,IAAoBC,WAApB,EAAiCC,QAAjC,QAAiD,OAAjD;AAKA,SAASC,cAAT,EAAyBC,iBAAzB,QAAkD,kBAAlD;AACA,SAASC,mBAAT,QAAoC,uBAApC;;;AASA,OAAO,MAAMC,kBAA6B,GAAG,CAAC;EAAEC,UAAF;EAAcC,YAAd;EAA4BC,WAA5B;EAAyCC;AAAzC,CAAD,KAAkE;EAC7G,MAAM,CAACC,GAAD,EAAMC,MAAN,IAAgBV,QAAQ,CAAgB,IAAhB,CAA9B;EACA,MAAM,CAACW,QAAD,EAAWC,WAAX,IAA0BZ,QAAQ,CAAS,GAAT,CAAxC;EAEA,MAAMa,YAAY,GAAGd,WAAW,CAC7Be,IAAD,IAA0C;IACxC,IAAIA,IAAI,CAACC,KAAL,KAAeb,iBAAnB,EAAsC;MAAA;;MACpCQ,MAAM,gBAACI,IAAI,CAACC,KAAN,qDAAe,EAAf,CAAN;MACA;IACD;;IACDL,MAAM,CAAC,IAAD,CAAN;EACD,CAP6B,EAQ9B,CAACA,MAAD,CAR8B,CAAhC;EAWA,MAAMM,iBAAiB,GAAGjB,WAAW,CAClCe,IAAD;IAAA;;IAAA,OAAmCF,WAAW,iBAACE,IAAI,CAACC,KAAN,uDAAe,EAAf,CAA9C;EAAA,CADmC,EAEnC,CAACH,WAAD,CAFmC,CAArC;EAKA,MAAMK,cAAc,GAAGlB,WAAW,CAC/Be,IAAD,IAAmC;IAAA;;IACjCP,WAAW,CAAC;MACVQ,KAAK,kBAAED,IAAI,CAACC,KAAP,uDAAgB,EADX;MAEVJ,QAAQ,EAAEA,QAFA;MAGVO,SAAS,EAAE,EAHD;MAIVT,GAAG,EAAEA;IAJK,CAAD,CAAX;IAMAC,MAAM,CAAC,IAAD,CAAN;IACAE,WAAW,CAAC,GAAD,CAAX;EACD,CAV+B,EAWhC,CAACL,WAAD,EAAcI,QAAd,EAAwBF,GAAxB,CAXgC,CAAlC;;EAcA,IAAIA,GAAG,KAAK,IAAZ,EAAkB;IAChB,oBACE,KAAC,cAAD;MACE,UAAU,EAAEJ,UADd;MAEE,SAAS,EAAEI,GAFb;MAGE,QAAQ,EAAEI,YAHZ;MAIE,iBAAiB,EAAEL;IAJrB,EADF;EAQD;;EAED,oBACE,MAAC,KAAD,CAAO,QAAP;IAAA,WACGF,YADH,eAEE,KAAC,mBAAD;MACE,UAAU,EAAED,UADd;MAEE,MAAM,EAAE;QAAEI,GAAF;QAAOM,KAAK,EAAE,EAAd;QAAkBJ,QAAlB;QAA4BO,SAAS,EAAE;MAAvC,CAFV;MAGE,WAAW,EAAC,cAHd;MAIE,WAAW,EAAEL,YAJf;MAKE,gBAAgB,EAAEG,iBALpB;MAME,aAAa,EAAEC,cANjB;MAOE,iBAAiB,EAAET;IAPrB,EAFF;EAAA,GAAoB,gBAApB,CADF;AAcD,CA3DM"},"metadata":{},"sourceType":"module"}