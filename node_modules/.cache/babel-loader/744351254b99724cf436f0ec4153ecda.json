{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport $ from 'jquery';\nimport { EchoEventType } from '@grafana/runtime';\nexport class GAEchoBackend {\n  constructor(options) {\n    _defineProperty(this, \"supportedEvents\", [EchoEventType.Pageview]);\n\n    _defineProperty(this, \"trackedUserId\", null);\n\n    _defineProperty(this, \"addEvent\", e => {\n      if (!window.ga) {\n        return;\n      }\n\n      window.ga('set', {\n        page: e.payload.page\n      });\n      window.ga('send', 'pageview');\n      const {\n        userSignedIn,\n        userId\n      } = e.meta;\n\n      if (userSignedIn && userId !== this.trackedUserId) {\n        this.trackedUserId = userId;\n        window.ga('set', 'userId', userId);\n      }\n    });\n\n    _defineProperty(this, \"flush\", () => {});\n\n    this.options = options;\n    const url = `https://www.google-analytics.com/analytics${options.debug ? '_debug' : ''}.js`;\n    $.ajax({\n      url,\n      dataType: 'script',\n      cache: true\n    });\n\n    const ga = window.ga = window.ga || // this had the equivalent of `eslint-disable-next-line prefer-arrow/prefer-arrow-functions`\n    function () {\n      (ga.q = ga.q || []).push(arguments);\n    };\n\n    ga.l = +new Date();\n    ga('create', options.googleAnalyticsId, 'auto');\n    ga('set', 'anonymizeIp', true);\n  }\n\n}","map":{"version":3,"names":["$","EchoEventType","GAEchoBackend","constructor","options","Pageview","e","window","ga","page","payload","userSignedIn","userId","meta","trackedUserId","url","debug","ajax","dataType","cache","q","push","arguments","l","Date","googleAnalyticsId"],"sources":["/home/soula/grafana/public/app/core/services/echo/backends/analytics/GABackend.ts"],"sourcesContent":["import $ from 'jquery';\n\nimport { EchoBackend, EchoEventType, PageviewEchoEvent } from '@grafana/runtime';\n\nexport interface GAEchoBackendOptions {\n  googleAnalyticsId: string;\n  debug?: boolean;\n}\n\nexport class GAEchoBackend implements EchoBackend<PageviewEchoEvent, GAEchoBackendOptions> {\n  supportedEvents = [EchoEventType.Pageview];\n  trackedUserId: number | null = null;\n\n  constructor(public options: GAEchoBackendOptions) {\n    const url = `https://www.google-analytics.com/analytics${options.debug ? '_debug' : ''}.js`;\n\n    $.ajax({\n      url,\n      dataType: 'script',\n      cache: true,\n    });\n\n    const ga = (window.ga =\n      window.ga ||\n      // this had the equivalent of `eslint-disable-next-line prefer-arrow/prefer-arrow-functions`\n      function () {\n        (ga.q = ga.q || []).push(arguments);\n      });\n    ga.l = +new Date();\n    ga('create', options.googleAnalyticsId, 'auto');\n    ga('set', 'anonymizeIp', true);\n  }\n\n  addEvent = (e: PageviewEchoEvent) => {\n    if (!window.ga) {\n      return;\n    }\n\n    window.ga('set', { page: e.payload.page });\n    window.ga('send', 'pageview');\n\n    const { userSignedIn, userId } = e.meta;\n    if (userSignedIn && userId !== this.trackedUserId) {\n      this.trackedUserId = userId;\n      window.ga('set', 'userId', userId);\n    }\n  };\n\n  // Not using Echo buffering, addEvent above sends events to GA as soon as they appear\n  flush = () => {};\n}\n"],"mappings":";;AAAA,OAAOA,CAAP,MAAc,QAAd;AAEA,SAAsBC,aAAtB,QAA8D,kBAA9D;AAOA,OAAO,MAAMC,aAAN,CAAoF;EAIzFC,WAAW,CAAQC,OAAR,EAAuC;IAAA,yCAHhC,CAACH,aAAa,CAACI,QAAf,CAGgC;;IAAA,uCAFnB,IAEmB;;IAAA,kCAoBtCC,CAAD,IAA0B;MACnC,IAAI,CAACC,MAAM,CAACC,EAAZ,EAAgB;QACd;MACD;;MAEDD,MAAM,CAACC,EAAP,CAAU,KAAV,EAAiB;QAAEC,IAAI,EAAEH,CAAC,CAACI,OAAF,CAAUD;MAAlB,CAAjB;MACAF,MAAM,CAACC,EAAP,CAAU,MAAV,EAAkB,UAAlB;MAEA,MAAM;QAAEG,YAAF;QAAgBC;MAAhB,IAA2BN,CAAC,CAACO,IAAnC;;MACA,IAAIF,YAAY,IAAIC,MAAM,KAAK,KAAKE,aAApC,EAAmD;QACjD,KAAKA,aAAL,GAAqBF,MAArB;QACAL,MAAM,CAACC,EAAP,CAAU,KAAV,EAAiB,QAAjB,EAA2BI,MAA3B;MACD;IACF,CAjCiD;;IAAA,+BAoC1C,MAAM,CAAE,CApCkC;;IAAA,KAA/BR,OAA+B,GAA/BA,OAA+B;IAChD,MAAMW,GAAG,GAAI,6CAA4CX,OAAO,CAACY,KAAR,GAAgB,QAAhB,GAA2B,EAAG,KAAvF;IAEAhB,CAAC,CAACiB,IAAF,CAAO;MACLF,GADK;MAELG,QAAQ,EAAE,QAFL;MAGLC,KAAK,EAAE;IAHF,CAAP;;IAMA,MAAMX,EAAE,GAAID,MAAM,CAACC,EAAP,GACVD,MAAM,CAACC,EAAP,IACA;IACA,YAAY;MACV,CAACA,EAAE,CAACY,CAAH,GAAOZ,EAAE,CAACY,CAAH,IAAQ,EAAhB,EAAoBC,IAApB,CAAyBC,SAAzB;IACD,CALH;;IAMAd,EAAE,CAACe,CAAH,GAAO,CAAC,IAAIC,IAAJ,EAAR;IACAhB,EAAE,CAAC,QAAD,EAAWJ,OAAO,CAACqB,iBAAnB,EAAsC,MAAtC,CAAF;IACAjB,EAAE,CAAC,KAAD,EAAQ,aAAR,EAAuB,IAAvB,CAAF;EACD;;AAtBwF"},"metadata":{},"sourceType":"module"}