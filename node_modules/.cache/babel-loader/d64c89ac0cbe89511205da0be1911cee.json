{"ast":null,"code":"import { createAction } from '@reduxjs/toolkit';\nimport { LayoutModes } from '@grafana/data';\nexport const initialState = {\n  dataSources: [],\n  plugins: [],\n  categories: [],\n  dataSource: {},\n  layoutMode: LayoutModes.List,\n  searchQuery: '',\n  dataSourcesCount: 0,\n  dataSourceTypeSearchQuery: '',\n  hasFetched: false,\n  isLoadingDataSources: false,\n  dataSourceMeta: {}\n};\nexport const dataSourceLoaded = createAction('dataSources/dataSourceLoaded');\nexport const dataSourcesLoaded = createAction('dataSources/dataSourcesLoaded');\nexport const dataSourceMetaLoaded = createAction('dataSources/dataSourceMetaLoaded');\nexport const dataSourcePluginsLoad = createAction('dataSources/dataSourcePluginsLoad');\nexport const dataSourcePluginsLoaded = createAction('dataSources/dataSourcePluginsLoaded');\nexport const setDataSourcesSearchQuery = createAction('dataSources/setDataSourcesSearchQuery');\nexport const setDataSourcesLayoutMode = createAction('dataSources/setDataSourcesLayoutMode');\nexport const setDataSourceTypeSearchQuery = createAction('dataSources/setDataSourceTypeSearchQuery');\nexport const setDataSourceName = createAction('dataSources/setDataSourceName');\nexport const setIsDefault = createAction('dataSources/setIsDefault'); // Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\n// the frozen state.\n// https://github.com/reduxjs/redux-toolkit/issues/242\n\nexport const dataSourcesReducer = (state = initialState, action) => {\n  if (dataSourcesLoaded.match(action)) {\n    return Object.assign({}, state, {\n      hasFetched: true,\n      dataSources: action.payload,\n      dataSourcesCount: action.payload.length\n    });\n  }\n\n  if (dataSourceLoaded.match(action)) {\n    return Object.assign({}, state, {\n      dataSource: action.payload\n    });\n  }\n\n  if (setDataSourcesSearchQuery.match(action)) {\n    return Object.assign({}, state, {\n      searchQuery: action.payload\n    });\n  }\n\n  if (setDataSourcesLayoutMode.match(action)) {\n    return Object.assign({}, state, {\n      layoutMode: action.payload\n    });\n  }\n\n  if (dataSourcePluginsLoad.match(action)) {\n    return Object.assign({}, state, {\n      plugins: [],\n      isLoadingDataSources: true\n    });\n  }\n\n  if (dataSourcePluginsLoaded.match(action)) {\n    return Object.assign({}, state, {\n      plugins: action.payload.plugins,\n      categories: action.payload.categories,\n      isLoadingDataSources: false\n    });\n  }\n\n  if (setDataSourceTypeSearchQuery.match(action)) {\n    return Object.assign({}, state, {\n      dataSourceTypeSearchQuery: action.payload\n    });\n  }\n\n  if (dataSourceMetaLoaded.match(action)) {\n    return Object.assign({}, state, {\n      dataSourceMeta: action.payload\n    });\n  }\n\n  if (setDataSourceName.match(action)) {\n    return Object.assign({}, state, {\n      dataSource: Object.assign({}, state.dataSource, {\n        name: action.payload\n      })\n    });\n  }\n\n  if (setIsDefault.match(action)) {\n    return Object.assign({}, state, {\n      dataSource: Object.assign({}, state.dataSource, {\n        isDefault: action.payload\n      })\n    });\n  }\n\n  return state;\n};\nexport const initialDataSourceSettingsState = {\n  testingStatus: {},\n  loadError: null,\n  loading: true,\n  plugin: null\n};\nexport const initDataSourceSettingsSucceeded = createAction('dataSourceSettings/initDataSourceSettingsSucceeded');\nexport const initDataSourceSettingsFailed = createAction('dataSourceSettings/initDataSourceSettingsFailed');\nexport const testDataSourceStarting = createAction('dataSourceSettings/testDataSourceStarting');\nexport const testDataSourceSucceeded = createAction('dataSourceSettings/testDataSourceSucceeded');\nexport const testDataSourceFailed = createAction('dataSourceSettings/testDataSourceFailed');\nexport const dataSourceSettingsReducer = (state = initialDataSourceSettingsState, action) => {\n  if (initDataSourceSettingsSucceeded.match(action)) {\n    return Object.assign({}, state, {\n      plugin: action.payload,\n      loadError: null,\n      loading: false\n    });\n  }\n\n  if (initDataSourceSettingsFailed.match(action)) {\n    return Object.assign({}, state, {\n      plugin: null,\n      loadError: action.payload.message,\n      loading: false\n    });\n  }\n\n  if (testDataSourceStarting.match(action)) {\n    return Object.assign({}, state, {\n      testingStatus: {\n        message: 'Testing...',\n        status: 'info'\n      }\n    });\n  }\n\n  if (testDataSourceSucceeded.match(action)) {\n    var _action$payload, _action$payload2, _action$payload3;\n\n    return Object.assign({}, state, {\n      testingStatus: {\n        status: (_action$payload = action.payload) === null || _action$payload === void 0 ? void 0 : _action$payload.status,\n        message: (_action$payload2 = action.payload) === null || _action$payload2 === void 0 ? void 0 : _action$payload2.message,\n        details: (_action$payload3 = action.payload) === null || _action$payload3 === void 0 ? void 0 : _action$payload3.details\n      }\n    });\n  }\n\n  if (testDataSourceFailed.match(action)) {\n    var _action$payload4, _action$payload5;\n\n    return Object.assign({}, state, {\n      testingStatus: {\n        status: 'error',\n        message: (_action$payload4 = action.payload) === null || _action$payload4 === void 0 ? void 0 : _action$payload4.message,\n        details: (_action$payload5 = action.payload) === null || _action$payload5 === void 0 ? void 0 : _action$payload5.details\n      }\n    });\n  }\n\n  return state;\n};\nexport default {\n  dataSources: dataSourcesReducer,\n  dataSourceSettings: dataSourceSettingsReducer\n};","map":{"version":3,"names":["createAction","LayoutModes","initialState","dataSources","plugins","categories","dataSource","layoutMode","List","searchQuery","dataSourcesCount","dataSourceTypeSearchQuery","hasFetched","isLoadingDataSources","dataSourceMeta","dataSourceLoaded","dataSourcesLoaded","dataSourceMetaLoaded","dataSourcePluginsLoad","dataSourcePluginsLoaded","setDataSourcesSearchQuery","setDataSourcesLayoutMode","setDataSourceTypeSearchQuery","setDataSourceName","setIsDefault","dataSourcesReducer","state","action","match","payload","length","name","isDefault","initialDataSourceSettingsState","testingStatus","loadError","loading","plugin","initDataSourceSettingsSucceeded","initDataSourceSettingsFailed","testDataSourceStarting","testDataSourceSucceeded","testDataSourceFailed","dataSourceSettingsReducer","message","status","details","dataSourceSettings"],"sources":["/home/soula/grafana/public/app/features/datasources/state/reducers.ts"],"sourcesContent":["import { AnyAction, createAction } from '@reduxjs/toolkit';\n\nimport { DataSourcePluginMeta, DataSourceSettings, LayoutMode, LayoutModes } from '@grafana/data';\nimport { DataSourcesState, DataSourceSettingsState, TestingStatus } from 'app/types';\n\nimport { GenericDataSourcePlugin } from '../settings/PluginSettings';\n\nimport { DataSourceTypesLoadedPayload } from './actions';\n\nexport const initialState: DataSourcesState = {\n  dataSources: [],\n  plugins: [],\n  categories: [],\n  dataSource: {} as DataSourceSettings,\n  layoutMode: LayoutModes.List,\n  searchQuery: '',\n  dataSourcesCount: 0,\n  dataSourceTypeSearchQuery: '',\n  hasFetched: false,\n  isLoadingDataSources: false,\n  dataSourceMeta: {} as DataSourcePluginMeta,\n};\n\nexport const dataSourceLoaded = createAction<DataSourceSettings>('dataSources/dataSourceLoaded');\nexport const dataSourcesLoaded = createAction<DataSourceSettings[]>('dataSources/dataSourcesLoaded');\nexport const dataSourceMetaLoaded = createAction<DataSourcePluginMeta>('dataSources/dataSourceMetaLoaded');\nexport const dataSourcePluginsLoad = createAction('dataSources/dataSourcePluginsLoad');\nexport const dataSourcePluginsLoaded = createAction<DataSourceTypesLoadedPayload>(\n  'dataSources/dataSourcePluginsLoaded'\n);\nexport const setDataSourcesSearchQuery = createAction<string>('dataSources/setDataSourcesSearchQuery');\nexport const setDataSourcesLayoutMode = createAction<LayoutMode>('dataSources/setDataSourcesLayoutMode');\nexport const setDataSourceTypeSearchQuery = createAction<string>('dataSources/setDataSourceTypeSearchQuery');\nexport const setDataSourceName = createAction<string>('dataSources/setDataSourceName');\nexport const setIsDefault = createAction<boolean>('dataSources/setIsDefault');\n\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\n// the frozen state.\n// https://github.com/reduxjs/redux-toolkit/issues/242\nexport const dataSourcesReducer = (state: DataSourcesState = initialState, action: AnyAction): DataSourcesState => {\n  if (dataSourcesLoaded.match(action)) {\n    return {\n      ...state,\n      hasFetched: true,\n      dataSources: action.payload,\n      dataSourcesCount: action.payload.length,\n    };\n  }\n\n  if (dataSourceLoaded.match(action)) {\n    return { ...state, dataSource: action.payload };\n  }\n\n  if (setDataSourcesSearchQuery.match(action)) {\n    return { ...state, searchQuery: action.payload };\n  }\n\n  if (setDataSourcesLayoutMode.match(action)) {\n    return { ...state, layoutMode: action.payload };\n  }\n\n  if (dataSourcePluginsLoad.match(action)) {\n    return { ...state, plugins: [], isLoadingDataSources: true };\n  }\n\n  if (dataSourcePluginsLoaded.match(action)) {\n    return {\n      ...state,\n      plugins: action.payload.plugins,\n      categories: action.payload.categories,\n      isLoadingDataSources: false,\n    };\n  }\n\n  if (setDataSourceTypeSearchQuery.match(action)) {\n    return { ...state, dataSourceTypeSearchQuery: action.payload };\n  }\n\n  if (dataSourceMetaLoaded.match(action)) {\n    return { ...state, dataSourceMeta: action.payload };\n  }\n\n  if (setDataSourceName.match(action)) {\n    return { ...state, dataSource: { ...state.dataSource, name: action.payload } };\n  }\n\n  if (setIsDefault.match(action)) {\n    return {\n      ...state,\n      dataSource: { ...state.dataSource, isDefault: action.payload },\n    };\n  }\n\n  return state;\n};\n\nexport const initialDataSourceSettingsState: DataSourceSettingsState = {\n  testingStatus: {},\n  loadError: null,\n  loading: true,\n  plugin: null,\n};\n\nexport const initDataSourceSettingsSucceeded = createAction<GenericDataSourcePlugin>(\n  'dataSourceSettings/initDataSourceSettingsSucceeded'\n);\n\nexport const initDataSourceSettingsFailed = createAction<Error>('dataSourceSettings/initDataSourceSettingsFailed');\n\nexport const testDataSourceStarting = createAction<undefined>('dataSourceSettings/testDataSourceStarting');\n\nexport const testDataSourceSucceeded = createAction<TestingStatus>('dataSourceSettings/testDataSourceSucceeded');\n\nexport const testDataSourceFailed = createAction<TestingStatus>('dataSourceSettings/testDataSourceFailed');\n\nexport const dataSourceSettingsReducer = (\n  state: DataSourceSettingsState = initialDataSourceSettingsState,\n  action: AnyAction\n): DataSourceSettingsState => {\n  if (initDataSourceSettingsSucceeded.match(action)) {\n    return { ...state, plugin: action.payload, loadError: null, loading: false };\n  }\n\n  if (initDataSourceSettingsFailed.match(action)) {\n    return { ...state, plugin: null, loadError: action.payload.message, loading: false };\n  }\n\n  if (testDataSourceStarting.match(action)) {\n    return {\n      ...state,\n      testingStatus: {\n        message: 'Testing...',\n        status: 'info',\n      },\n    };\n  }\n\n  if (testDataSourceSucceeded.match(action)) {\n    return {\n      ...state,\n      testingStatus: {\n        status: action.payload?.status,\n        message: action.payload?.message,\n        details: action.payload?.details,\n      },\n    };\n  }\n\n  if (testDataSourceFailed.match(action)) {\n    return {\n      ...state,\n      testingStatus: {\n        status: 'error',\n        message: action.payload?.message,\n        details: action.payload?.details,\n      },\n    };\n  }\n\n  return state;\n};\n\nexport default {\n  dataSources: dataSourcesReducer,\n  dataSourceSettings: dataSourceSettingsReducer,\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}