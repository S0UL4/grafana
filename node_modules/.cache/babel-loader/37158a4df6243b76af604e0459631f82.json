{"ast":null,"code":"import React, { useMemo } from 'react';\nimport { EditorField, EditorRow } from '@grafana/experimental';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { getAlignmentPickerData } from '../../functions';\nimport { MetricKind, PreprocessorType, ValueTypes } from '../../types';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst NONE_OPTION = {\n  label: 'None',\n  value: PreprocessorType.None\n};\nexport const Preprocessor = ({\n  query,\n  metricDescriptor,\n  onChange\n}) => {\n  var _query$preprocessor;\n\n  const options = useOptions(metricDescriptor);\n  return /*#__PURE__*/_jsx(EditorRow, {\n    children: /*#__PURE__*/_jsx(EditorField, {\n      label: \"Pre-processing\",\n      tooltip: \"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metic's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series\",\n      children: /*#__PURE__*/_jsx(RadioButtonGroup, {\n        onChange: value => {\n          const {\n            valueType,\n            metricKind,\n            perSeriesAligner: psa\n          } = query;\n          const {\n            perSeriesAligner\n          } = getAlignmentPickerData(valueType, metricKind, psa, value);\n          onChange(Object.assign({}, query, {\n            preprocessor: value,\n            perSeriesAligner\n          }));\n        },\n        value: (_query$preprocessor = query.preprocessor) !== null && _query$preprocessor !== void 0 ? _query$preprocessor : PreprocessorType.None,\n        options: options\n      })\n    })\n  });\n};\n\nconst useOptions = metricDescriptor => {\n  const metricKind = metricDescriptor === null || metricDescriptor === void 0 ? void 0 : metricDescriptor.metricKind;\n  const valueType = metricDescriptor === null || metricDescriptor === void 0 ? void 0 : metricDescriptor.valueType;\n  return useMemo(() => {\n    if (!metricKind || metricKind === MetricKind.GAUGE || valueType === ValueTypes.DISTRIBUTION) {\n      return [NONE_OPTION];\n    }\n\n    const options = [NONE_OPTION, {\n      label: 'Rate',\n      value: PreprocessorType.Rate,\n      description: 'Data points are aligned and converted to a rate per time series'\n    }];\n    return metricKind === MetricKind.CUMULATIVE ? [...options, {\n      label: 'Delta',\n      value: PreprocessorType.Delta,\n      description: 'Data points are aligned by their delta (difference) per time series'\n    }] : options;\n  }, [metricKind, valueType]);\n};","map":{"version":3,"names":["React","useMemo","EditorField","EditorRow","RadioButtonGroup","getAlignmentPickerData","MetricKind","PreprocessorType","ValueTypes","NONE_OPTION","label","value","None","Preprocessor","query","metricDescriptor","onChange","options","useOptions","valueType","metricKind","perSeriesAligner","psa","preprocessor","GAUGE","DISTRIBUTION","Rate","description","CUMULATIVE","Delta"],"sources":["/home/soula/grafana/public/app/plugins/datasource/cloud-monitoring/components/Experimental/Preprocessor.tsx"],"sourcesContent":["import React, { FunctionComponent, useMemo } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { EditorField, EditorRow } from '@grafana/experimental';\nimport { RadioButtonGroup } from '@grafana/ui';\n\nimport { getAlignmentPickerData } from '../../functions';\nimport { MetricDescriptor, MetricKind, MetricQuery, PreprocessorType, ValueTypes } from '../../types';\n\nconst NONE_OPTION = { label: 'None', value: PreprocessorType.None };\n\nexport interface Props {\n  metricDescriptor?: MetricDescriptor;\n  onChange: (query: MetricQuery) => void;\n  query: MetricQuery;\n}\n\nexport const Preprocessor: FunctionComponent<Props> = ({ query, metricDescriptor, onChange }) => {\n  const options = useOptions(metricDescriptor);\n  return (\n    <EditorRow>\n      <EditorField\n        label=\"Pre-processing\"\n        tooltip=\"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metic's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series\"\n      >\n        <RadioButtonGroup\n          onChange={(value: PreprocessorType) => {\n            const { valueType, metricKind, perSeriesAligner: psa } = query;\n            const { perSeriesAligner } = getAlignmentPickerData(valueType, metricKind, psa, value);\n            onChange({ ...query, preprocessor: value, perSeriesAligner });\n          }}\n          value={query.preprocessor ?? PreprocessorType.None}\n          options={options}\n        />\n      </EditorField>\n    </EditorRow>\n  );\n};\n\nconst useOptions = (metricDescriptor?: MetricDescriptor): Array<SelectableValue<PreprocessorType>> => {\n  const metricKind = metricDescriptor?.metricKind;\n  const valueType = metricDescriptor?.valueType;\n\n  return useMemo(() => {\n    if (!metricKind || metricKind === MetricKind.GAUGE || valueType === ValueTypes.DISTRIBUTION) {\n      return [NONE_OPTION];\n    }\n\n    const options = [\n      NONE_OPTION,\n      {\n        label: 'Rate',\n        value: PreprocessorType.Rate,\n        description: 'Data points are aligned and converted to a rate per time series',\n      },\n    ];\n\n    return metricKind === MetricKind.CUMULATIVE\n      ? [\n          ...options,\n          {\n            label: 'Delta',\n            value: PreprocessorType.Delta,\n            description: 'Data points are aligned by their delta (difference) per time series',\n          },\n        ]\n      : options;\n  }, [metricKind, valueType]);\n};\n"],"mappings":"AAAA,OAAOA,KAAP,IAAmCC,OAAnC,QAAkD,OAAlD;AAGA,SAASC,WAAT,EAAsBC,SAAtB,QAAuC,uBAAvC;AACA,SAASC,gBAAT,QAAiC,aAAjC;AAEA,SAASC,sBAAT,QAAuC,iBAAvC;AACA,SAA2BC,UAA3B,EAAoDC,gBAApD,EAAsEC,UAAtE,QAAwF,aAAxF;;AAEA,MAAMC,WAAW,GAAG;EAAEC,KAAK,EAAE,MAAT;EAAiBC,KAAK,EAAEJ,gBAAgB,CAACK;AAAzC,CAApB;AAQA,OAAO,MAAMC,YAAsC,GAAG,CAAC;EAAEC,KAAF;EAASC,gBAAT;EAA2BC;AAA3B,CAAD,KAA2C;EAAA;;EAC/F,MAAMC,OAAO,GAAGC,UAAU,CAACH,gBAAD,CAA1B;EACA,oBACE,KAAC,SAAD;IAAA,uBACE,KAAC,WAAD;MACE,KAAK,EAAC,gBADR;MAEE,OAAO,EAAC,mWAFV;MAAA,uBAIE,KAAC,gBAAD;QACE,QAAQ,EAAGJ,KAAD,IAA6B;UACrC,MAAM;YAAEQ,SAAF;YAAaC,UAAb;YAAyBC,gBAAgB,EAAEC;UAA3C,IAAmDR,KAAzD;UACA,MAAM;YAAEO;UAAF,IAAuBhB,sBAAsB,CAACc,SAAD,EAAYC,UAAZ,EAAwBE,GAAxB,EAA6BX,KAA7B,CAAnD;UACAK,QAAQ,mBAAMF,KAAN;YAAaS,YAAY,EAAEZ,KAA3B;YAAkCU;UAAlC,GAAR;QACD,CALH;QAME,KAAK,yBAAEP,KAAK,CAACS,YAAR,qEAAwBhB,gBAAgB,CAACK,IANhD;QAOE,OAAO,EAAEK;MAPX;IAJF;EADF,EADF;AAkBD,CApBM;;AAsBP,MAAMC,UAAU,GAAIH,gBAAD,IAAmF;EACpG,MAAMK,UAAU,GAAGL,gBAAH,aAAGA,gBAAH,uBAAGA,gBAAgB,CAAEK,UAArC;EACA,MAAMD,SAAS,GAAGJ,gBAAH,aAAGA,gBAAH,uBAAGA,gBAAgB,CAAEI,SAApC;EAEA,OAAOlB,OAAO,CAAC,MAAM;IACnB,IAAI,CAACmB,UAAD,IAAeA,UAAU,KAAKd,UAAU,CAACkB,KAAzC,IAAkDL,SAAS,KAAKX,UAAU,CAACiB,YAA/E,EAA6F;MAC3F,OAAO,CAAChB,WAAD,CAAP;IACD;;IAED,MAAMQ,OAAO,GAAG,CACdR,WADc,EAEd;MACEC,KAAK,EAAE,MADT;MAEEC,KAAK,EAAEJ,gBAAgB,CAACmB,IAF1B;MAGEC,WAAW,EAAE;IAHf,CAFc,CAAhB;IASA,OAAOP,UAAU,KAAKd,UAAU,CAACsB,UAA1B,GACH,CACE,GAAGX,OADL,EAEE;MACEP,KAAK,EAAE,OADT;MAEEC,KAAK,EAAEJ,gBAAgB,CAACsB,KAF1B;MAGEF,WAAW,EAAE;IAHf,CAFF,CADG,GASHV,OATJ;EAUD,CAxBa,EAwBX,CAACG,UAAD,EAAaD,SAAb,CAxBW,CAAd;AAyBD,CA7BD"},"metadata":{},"sourceType":"module"}