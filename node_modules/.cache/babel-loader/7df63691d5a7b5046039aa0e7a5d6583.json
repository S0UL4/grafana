{"ast":null,"code":"import React, { useEffect, useState } from 'react';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Input } from '@grafana/ui';\nimport Page from 'app/core/components/Page/Page';\nimport { useNavModel } from 'app/core/hooks/useNavModel';\nimport { AddNewRule } from './AddNewRule';\nimport { PipelineTable } from './PipelineTable';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function PipelineAdminPage() {\n  const [rules, setRules] = useState([]);\n  const [defaultRules, setDefaultRules] = useState([]);\n  const [newRule, setNewRule] = useState();\n  const navModel = useNavModel('live-pipeline');\n  const [error, setError] = useState();\n\n  const loadRules = () => {\n    getBackendSrv().get(`api/live/channel-rules`).then(data => {\n      var _data$rules, _data$rules2;\n\n      setRules((_data$rules = data.rules) !== null && _data$rules !== void 0 ? _data$rules : []);\n      setDefaultRules((_data$rules2 = data.rules) !== null && _data$rules2 !== void 0 ? _data$rules2 : []);\n    }).catch(e => {\n      if (e.data) {\n        setError(JSON.stringify(e.data, null, 2));\n      }\n    });\n  };\n\n  useEffect(() => {\n    loadRules();\n  }, []);\n\n  const onSearchQueryChange = e => {\n    if (e.target.value) {\n      setRules(rules.filter(rule => rule.pattern.toLowerCase().includes(e.target.value.toLowerCase())));\n    } else {\n      setRules(defaultRules);\n    }\n  };\n\n  return /*#__PURE__*/_jsx(Page, {\n    navModel: navModel,\n    children: /*#__PURE__*/_jsxs(Page.Contents, {\n      children: [error && /*#__PURE__*/_jsx(\"pre\", {\n        children: error\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"page-action-bar\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"gf-form gf-form--grow\",\n          children: /*#__PURE__*/_jsx(Input, {\n            placeholder: \"Search pattern...\",\n            onChange: onSearchQueryChange\n          })\n        })\n      }), /*#__PURE__*/_jsx(PipelineTable, {\n        rules: rules,\n        onRuleChanged: loadRules,\n        selectRule: newRule\n      }), /*#__PURE__*/_jsx(AddNewRule, {\n        onRuleAdded: r => {\n          console.log('GOT', r, 'vs', rules[0]);\n          setNewRule(r);\n          loadRules();\n        }\n      })]\n    })\n  });\n}","map":{"version":3,"names":["React","useEffect","useState","getBackendSrv","Input","Page","useNavModel","AddNewRule","PipelineTable","PipelineAdminPage","rules","setRules","defaultRules","setDefaultRules","newRule","setNewRule","navModel","error","setError","loadRules","get","then","data","catch","e","JSON","stringify","onSearchQueryChange","target","value","filter","rule","pattern","toLowerCase","includes","r","console","log"],"sources":["/home/soula/grafana/public/app/features/live/pages/PipelineAdminPage.tsx"],"sourcesContent":["import React, { useEffect, useState, ChangeEvent } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Input } from '@grafana/ui';\nimport Page from 'app/core/components/Page/Page';\nimport { useNavModel } from 'app/core/hooks/useNavModel';\n\nimport { AddNewRule } from './AddNewRule';\nimport { PipelineTable } from './PipelineTable';\nimport { Rule } from './types';\n\nexport default function PipelineAdminPage() {\n  const [rules, setRules] = useState<Rule[]>([]);\n  const [defaultRules, setDefaultRules] = useState<any[]>([]);\n  const [newRule, setNewRule] = useState<Rule>();\n  const navModel = useNavModel('live-pipeline');\n  const [error, setError] = useState<string>();\n\n  const loadRules = () => {\n    getBackendSrv()\n      .get(`api/live/channel-rules`)\n      .then((data) => {\n        setRules(data.rules ?? []);\n        setDefaultRules(data.rules ?? []);\n      })\n      .catch((e) => {\n        if (e.data) {\n          setError(JSON.stringify(e.data, null, 2));\n        }\n      });\n  };\n\n  useEffect(() => {\n    loadRules();\n  }, []);\n\n  const onSearchQueryChange = (e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.value) {\n      setRules(rules.filter((rule) => rule.pattern.toLowerCase().includes(e.target.value.toLowerCase())));\n    } else {\n      setRules(defaultRules);\n    }\n  };\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        {error && <pre>{error}</pre>}\n        <div className=\"page-action-bar\">\n          <div className=\"gf-form gf-form--grow\">\n            <Input placeholder=\"Search pattern...\" onChange={onSearchQueryChange} />\n          </div>\n        </div>\n\n        <PipelineTable rules={rules} onRuleChanged={loadRules} selectRule={newRule} />\n\n        <AddNewRule\n          onRuleAdded={(r: Rule) => {\n            console.log('GOT', r, 'vs', rules[0]);\n            setNewRule(r);\n            loadRules();\n          }}\n        />\n      </Page.Contents>\n    </Page>\n  );\n}\n"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAAwD,OAAxD;AAEA,SAASC,aAAT,QAA8B,kBAA9B;AACA,SAASC,KAAT,QAAsB,aAAtB;AACA,OAAOC,IAAP,MAAiB,+BAAjB;AACA,SAASC,WAAT,QAA4B,4BAA5B;AAEA,SAASC,UAAT,QAA2B,cAA3B;AACA,SAASC,aAAT,QAA8B,iBAA9B;;;AAGA,eAAe,SAASC,iBAAT,GAA6B;EAC1C,MAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBT,QAAQ,CAAS,EAAT,CAAlC;EACA,MAAM,CAACU,YAAD,EAAeC,eAAf,IAAkCX,QAAQ,CAAQ,EAAR,CAAhD;EACA,MAAM,CAACY,OAAD,EAAUC,UAAV,IAAwBb,QAAQ,EAAtC;EACA,MAAMc,QAAQ,GAAGV,WAAW,CAAC,eAAD,CAA5B;EACA,MAAM,CAACW,KAAD,EAAQC,QAAR,IAAoBhB,QAAQ,EAAlC;;EAEA,MAAMiB,SAAS,GAAG,MAAM;IACtBhB,aAAa,GACViB,GADH,CACQ,wBADR,EAEGC,IAFH,CAESC,IAAD,IAAU;MAAA;;MACdX,QAAQ,gBAACW,IAAI,CAACZ,KAAN,qDAAe,EAAf,CAAR;MACAG,eAAe,iBAACS,IAAI,CAACZ,KAAN,uDAAe,EAAf,CAAf;IACD,CALH,EAMGa,KANH,CAMUC,CAAD,IAAO;MACZ,IAAIA,CAAC,CAACF,IAAN,EAAY;QACVJ,QAAQ,CAACO,IAAI,CAACC,SAAL,CAAeF,CAAC,CAACF,IAAjB,EAAuB,IAAvB,EAA6B,CAA7B,CAAD,CAAR;MACD;IACF,CAVH;EAWD,CAZD;;EAcArB,SAAS,CAAC,MAAM;IACdkB,SAAS;EACV,CAFQ,EAEN,EAFM,CAAT;;EAIA,MAAMQ,mBAAmB,GAAIH,CAAD,IAAsC;IAChE,IAAIA,CAAC,CAACI,MAAF,CAASC,KAAb,EAAoB;MAClBlB,QAAQ,CAACD,KAAK,CAACoB,MAAN,CAAcC,IAAD,IAAUA,IAAI,CAACC,OAAL,CAAaC,WAAb,GAA2BC,QAA3B,CAAoCV,CAAC,CAACI,MAAF,CAASC,KAAT,CAAeI,WAAf,EAApC,CAAvB,CAAD,CAAR;IACD,CAFD,MAEO;MACLtB,QAAQ,CAACC,YAAD,CAAR;IACD;EACF,CAND;;EAQA,oBACE,KAAC,IAAD;IAAM,QAAQ,EAAEI,QAAhB;IAAA,uBACE,MAAC,IAAD,CAAM,QAAN;MAAA,WACGC,KAAK,iBAAI;QAAA,UAAMA;MAAN,EADZ,eAEE;QAAK,SAAS,EAAC,iBAAf;QAAA,uBACE;UAAK,SAAS,EAAC,uBAAf;UAAA,uBACE,KAAC,KAAD;YAAO,WAAW,EAAC,mBAAnB;YAAuC,QAAQ,EAAEU;UAAjD;QADF;MADF,EAFF,eAQE,KAAC,aAAD;QAAe,KAAK,EAAEjB,KAAtB;QAA6B,aAAa,EAAES,SAA5C;QAAuD,UAAU,EAAEL;MAAnE,EARF,eAUE,KAAC,UAAD;QACE,WAAW,EAAGqB,CAAD,IAAa;UACxBC,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBF,CAAnB,EAAsB,IAAtB,EAA4BzB,KAAK,CAAC,CAAD,CAAjC;UACAK,UAAU,CAACoB,CAAD,CAAV;UACAhB,SAAS;QACV;MALH,EAVF;IAAA;EADF,EADF;AAsBD"},"metadata":{},"sourceType":"module"}