{"ast":null,"code":"var _span, _div;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Button, Icon } from '@grafana/ui';\nimport { VariablesDependenciesButton } from '../inspect/VariablesDependenciesButton';\nimport { VariablesUnknownTable } from '../inspect/VariablesUnknownTable';\nimport { toKeyedAction } from '../state/keyedVariablesReducer';\nimport { getEditorVariables, getVariablesState } from '../state/selectors';\nimport { changeVariableOrder, duplicateVariable, removeVariable } from '../state/sharedReducer';\nimport { toKeyedVariableIdentifier, toVariablePayload } from '../utils';\nimport { VariableEditorEditor } from './VariableEditorEditor';\nimport { VariableEditorList } from './VariableEditorList';\nimport { switchToEditMode, switchToListMode, switchToNewMode } from './actions';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nconst mapStateToProps = (state, ownProps) => {\n  const {\n    uid\n  } = ownProps.dashboard;\n  const templatingState = getVariablesState(uid, state);\n  return {\n    variables: getEditorVariables(uid, state),\n    idInEditor: templatingState.editor.id,\n    usagesNetwork: templatingState.inspect.usagesNetwork,\n    usages: templatingState.inspect.usages\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return Object.assign({}, bindActionCreators({\n    switchToNewMode,\n    switchToEditMode,\n    switchToListMode\n  }, dispatch), {\n    changeVariableOrder: (identifier, fromIndex, toIndex) => dispatch(toKeyedAction(identifier.rootStateKey, changeVariableOrder(toVariablePayload(identifier, {\n      fromIndex,\n      toIndex\n    })))),\n    duplicateVariable: identifier => dispatch(toKeyedAction(identifier.rootStateKey, duplicateVariable(toVariablePayload(identifier, {\n      newId: undefined\n    })))),\n    removeVariable: identifier => {\n      dispatch(toKeyedAction(identifier.rootStateKey, removeVariable(toVariablePayload(identifier, {\n        reIndex: true\n      }))));\n    }\n  });\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\nclass VariableEditorContainerUnconnected extends PureComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"onChangeToListMode\", event => {\n      event.preventDefault();\n      this.props.switchToListMode(this.props.dashboard.uid);\n    });\n\n    _defineProperty(this, \"onEditVariable\", identifier => {\n      this.props.switchToEditMode(identifier);\n    });\n\n    _defineProperty(this, \"onNewVariable\", () => {\n      this.props.switchToNewMode(this.props.dashboard.uid);\n    });\n\n    _defineProperty(this, \"onChangeVariableOrder\", (identifier, fromIndex, toIndex) => {\n      this.props.changeVariableOrder(identifier, fromIndex, toIndex);\n    });\n\n    _defineProperty(this, \"onDuplicateVariable\", identifier => {\n      this.props.duplicateVariable(identifier);\n    });\n\n    _defineProperty(this, \"onRemoveVariable\", identifier => {\n      this.props.removeVariable(identifier);\n    });\n  }\n\n  componentDidMount() {\n    this.props.switchToListMode(this.props.dashboard.uid);\n  }\n\n  render() {\n    var _this$props$variables;\n\n    const variableToEdit = (_this$props$variables = this.props.variables.find(s => s.id === this.props.idInEditor)) !== null && _this$props$variables !== void 0 ? _this$props$variables : null;\n    return /*#__PURE__*/_jsxs(\"div\", {\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"page-action-bar\",\n        children: [/*#__PURE__*/_jsxs(\"h3\", {\n          className: \"dashboard-settings__header\",\n          children: [/*#__PURE__*/_jsx(\"a\", {\n            onClick: this.onChangeToListMode,\n            \"aria-label\": selectors.pages.Dashboard.Settings.Variables.Edit.General.headerLink,\n            children: \"Variables\"\n          }), this.props.idInEditor && (_span || (_span = /*#__PURE__*/_jsxs(\"span\", {\n            children: [/*#__PURE__*/_jsx(Icon, {\n              name: \"angle-right\"\n            }), \"Edit\"]\n          })))]\n        }), _div || (_div = /*#__PURE__*/_jsx(\"div\", {\n          className: \"page-action-bar__spacer\"\n        })), this.props.variables.length > 0 && variableToEdit === null && /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(VariablesDependenciesButton, {\n            variables: this.props.variables\n          }), /*#__PURE__*/_jsx(Button, {\n            type: \"button\",\n            onClick: this.onNewVariable,\n            \"aria-label\": selectors.pages.Dashboard.Settings.Variables.List.newButton,\n            children: \"New\"\n          })]\n        })]\n      }), !variableToEdit && /*#__PURE__*/_jsx(VariableEditorList, {\n        variables: this.props.variables,\n        onAdd: this.onNewVariable,\n        onEdit: this.onEditVariable,\n        onChangeOrder: this.onChangeVariableOrder,\n        onDuplicate: this.onDuplicateVariable,\n        onDelete: this.onRemoveVariable,\n        usages: this.props.usages,\n        usagesNetwork: this.props.usagesNetwork\n      }), !variableToEdit && this.props.variables.length > 0 && /*#__PURE__*/_jsx(VariablesUnknownTable, {\n        variables: this.props.variables,\n        dashboard: this.props.dashboard\n      }), variableToEdit && /*#__PURE__*/_jsx(VariableEditorEditor, {\n        identifier: toKeyedVariableIdentifier(variableToEdit)\n      })]\n    });\n  }\n\n}\n\nexport const VariableEditorContainer = connector(VariableEditorContainerUnconnected);","map":{"version":3,"names":["React","PureComponent","connect","bindActionCreators","selectors","Button","Icon","VariablesDependenciesButton","VariablesUnknownTable","toKeyedAction","getEditorVariables","getVariablesState","changeVariableOrder","duplicateVariable","removeVariable","toKeyedVariableIdentifier","toVariablePayload","VariableEditorEditor","VariableEditorList","switchToEditMode","switchToListMode","switchToNewMode","mapStateToProps","state","ownProps","uid","dashboard","templatingState","variables","idInEditor","editor","id","usagesNetwork","inspect","usages","mapDispatchToProps","dispatch","identifier","fromIndex","toIndex","rootStateKey","newId","undefined","reIndex","connector","VariableEditorContainerUnconnected","event","preventDefault","props","componentDidMount","render","variableToEdit","find","s","onChangeToListMode","pages","Dashboard","Settings","Variables","Edit","General","headerLink","length","onNewVariable","List","newButton","onEditVariable","onChangeVariableOrder","onDuplicateVariable","onRemoveVariable","VariableEditorContainer"],"sources":["/home/soula/grafana/public/app/features/variables/editor/VariableEditorContainer.tsx"],"sourcesContent":["import React, { MouseEvent, PureComponent } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Button, Icon } from '@grafana/ui';\nimport { DashboardModel } from 'app/features/dashboard/state/DashboardModel';\n\nimport { StoreState, ThunkDispatch } from '../../../types';\nimport { VariablesDependenciesButton } from '../inspect/VariablesDependenciesButton';\nimport { VariablesUnknownTable } from '../inspect/VariablesUnknownTable';\nimport { toKeyedAction } from '../state/keyedVariablesReducer';\nimport { getEditorVariables, getVariablesState } from '../state/selectors';\nimport { changeVariableOrder, duplicateVariable, removeVariable } from '../state/sharedReducer';\nimport { KeyedVariableIdentifier } from '../state/types';\nimport { toKeyedVariableIdentifier, toVariablePayload } from '../utils';\n\nimport { VariableEditorEditor } from './VariableEditorEditor';\nimport { VariableEditorList } from './VariableEditorList';\nimport { switchToEditMode, switchToListMode, switchToNewMode } from './actions';\n\nconst mapStateToProps = (state: StoreState, ownProps: OwnProps) => {\n  const { uid } = ownProps.dashboard;\n  const templatingState = getVariablesState(uid, state);\n  return {\n    variables: getEditorVariables(uid, state),\n    idInEditor: templatingState.editor.id,\n    usagesNetwork: templatingState.inspect.usagesNetwork,\n    usages: templatingState.inspect.usages,\n  };\n};\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch) => {\n  return {\n    ...bindActionCreators({ switchToNewMode, switchToEditMode, switchToListMode }, dispatch),\n    changeVariableOrder: (identifier: KeyedVariableIdentifier, fromIndex: number, toIndex: number) =>\n      dispatch(\n        toKeyedAction(\n          identifier.rootStateKey,\n          changeVariableOrder(toVariablePayload(identifier, { fromIndex, toIndex }))\n        )\n      ),\n    duplicateVariable: (identifier: KeyedVariableIdentifier) =>\n      dispatch(\n        toKeyedAction(\n          identifier.rootStateKey,\n          duplicateVariable(toVariablePayload(identifier, { newId: undefined as unknown as string }))\n        )\n      ),\n    removeVariable: (identifier: KeyedVariableIdentifier) => {\n      dispatch(\n        toKeyedAction(identifier.rootStateKey, removeVariable(toVariablePayload(identifier, { reIndex: true })))\n      );\n    },\n  };\n};\n\ninterface OwnProps {\n  dashboard: DashboardModel;\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = OwnProps & ConnectedProps<typeof connector>;\n\nclass VariableEditorContainerUnconnected extends PureComponent<Props> {\n  componentDidMount(): void {\n    this.props.switchToListMode(this.props.dashboard.uid);\n  }\n\n  onChangeToListMode = (event: MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    this.props.switchToListMode(this.props.dashboard.uid);\n  };\n\n  onEditVariable = (identifier: KeyedVariableIdentifier) => {\n    this.props.switchToEditMode(identifier);\n  };\n\n  onNewVariable = () => {\n    this.props.switchToNewMode(this.props.dashboard.uid);\n  };\n\n  onChangeVariableOrder = (identifier: KeyedVariableIdentifier, fromIndex: number, toIndex: number) => {\n    this.props.changeVariableOrder(identifier, fromIndex, toIndex);\n  };\n\n  onDuplicateVariable = (identifier: KeyedVariableIdentifier) => {\n    this.props.duplicateVariable(identifier);\n  };\n\n  onRemoveVariable = (identifier: KeyedVariableIdentifier) => {\n    this.props.removeVariable(identifier);\n  };\n\n  render() {\n    const variableToEdit = this.props.variables.find((s) => s.id === this.props.idInEditor) ?? null;\n\n    return (\n      <div>\n        <div className=\"page-action-bar\">\n          <h3 className=\"dashboard-settings__header\">\n            <a\n              onClick={this.onChangeToListMode}\n              aria-label={selectors.pages.Dashboard.Settings.Variables.Edit.General.headerLink}\n            >\n              Variables\n            </a>\n            {this.props.idInEditor && (\n              <span>\n                <Icon name=\"angle-right\" />\n                Edit\n              </span>\n            )}\n          </h3>\n\n          <div className=\"page-action-bar__spacer\" />\n          {this.props.variables.length > 0 && variableToEdit === null && (\n            <>\n              <VariablesDependenciesButton variables={this.props.variables} />\n              <Button\n                type=\"button\"\n                onClick={this.onNewVariable}\n                aria-label={selectors.pages.Dashboard.Settings.Variables.List.newButton}\n              >\n                New\n              </Button>\n            </>\n          )}\n        </div>\n\n        {!variableToEdit && (\n          <VariableEditorList\n            variables={this.props.variables}\n            onAdd={this.onNewVariable}\n            onEdit={this.onEditVariable}\n            onChangeOrder={this.onChangeVariableOrder}\n            onDuplicate={this.onDuplicateVariable}\n            onDelete={this.onRemoveVariable}\n            usages={this.props.usages}\n            usagesNetwork={this.props.usagesNetwork}\n          />\n        )}\n        {!variableToEdit && this.props.variables.length > 0 && (\n          <VariablesUnknownTable variables={this.props.variables} dashboard={this.props.dashboard} />\n        )}\n        {variableToEdit && <VariableEditorEditor identifier={toKeyedVariableIdentifier(variableToEdit)} />}\n      </div>\n    );\n  }\n}\n\nexport const VariableEditorContainer = connector(VariableEditorContainerUnconnected);\n"],"mappings":";;;;AAAA,OAAOA,KAAP,IAA4BC,aAA5B,QAAiD,OAAjD;AACA,SAASC,OAAT,QAAwC,aAAxC;AACA,SAASC,kBAAT,QAAmC,OAAnC;AAEA,SAASC,SAAT,QAA0B,wBAA1B;AACA,SAASC,MAAT,EAAiBC,IAAjB,QAA6B,aAA7B;AAIA,SAASC,2BAAT,QAA4C,wCAA5C;AACA,SAASC,qBAAT,QAAsC,kCAAtC;AACA,SAASC,aAAT,QAA8B,gCAA9B;AACA,SAASC,kBAAT,EAA6BC,iBAA7B,QAAsD,oBAAtD;AACA,SAASC,mBAAT,EAA8BC,iBAA9B,EAAiDC,cAAjD,QAAuE,wBAAvE;AAEA,SAASC,yBAAT,EAAoCC,iBAApC,QAA6D,UAA7D;AAEA,SAASC,oBAAT,QAAqC,wBAArC;AACA,SAASC,kBAAT,QAAmC,sBAAnC;AACA,SAASC,gBAAT,EAA2BC,gBAA3B,EAA6CC,eAA7C,QAAoE,WAApE;;;;;AAEA,MAAMC,eAAe,GAAG,CAACC,KAAD,EAAoBC,QAApB,KAA2C;EACjE,MAAM;IAAEC;EAAF,IAAUD,QAAQ,CAACE,SAAzB;EACA,MAAMC,eAAe,GAAGhB,iBAAiB,CAACc,GAAD,EAAMF,KAAN,CAAzC;EACA,OAAO;IACLK,SAAS,EAAElB,kBAAkB,CAACe,GAAD,EAAMF,KAAN,CADxB;IAELM,UAAU,EAAEF,eAAe,CAACG,MAAhB,CAAuBC,EAF9B;IAGLC,aAAa,EAAEL,eAAe,CAACM,OAAhB,CAAwBD,aAHlC;IAILE,MAAM,EAAEP,eAAe,CAACM,OAAhB,CAAwBC;EAJ3B,CAAP;AAMD,CATD;;AAWA,MAAMC,kBAAkB,GAAIC,QAAD,IAA6B;EACtD,yBACKjC,kBAAkB,CAAC;IAAEkB,eAAF;IAAmBF,gBAAnB;IAAqCC;EAArC,CAAD,EAA0DgB,QAA1D,CADvB;IAEExB,mBAAmB,EAAE,CAACyB,UAAD,EAAsCC,SAAtC,EAAyDC,OAAzD,KACnBH,QAAQ,CACN3B,aAAa,CACX4B,UAAU,CAACG,YADA,EAEX5B,mBAAmB,CAACI,iBAAiB,CAACqB,UAAD,EAAa;MAAEC,SAAF;MAAaC;IAAb,CAAb,CAAlB,CAFR,CADP,CAHZ;IASE1B,iBAAiB,EAAGwB,UAAD,IACjBD,QAAQ,CACN3B,aAAa,CACX4B,UAAU,CAACG,YADA,EAEX3B,iBAAiB,CAACG,iBAAiB,CAACqB,UAAD,EAAa;MAAEI,KAAK,EAAEC;IAAT,CAAb,CAAlB,CAFN,CADP,CAVZ;IAgBE5B,cAAc,EAAGuB,UAAD,IAAyC;MACvDD,QAAQ,CACN3B,aAAa,CAAC4B,UAAU,CAACG,YAAZ,EAA0B1B,cAAc,CAACE,iBAAiB,CAACqB,UAAD,EAAa;QAAEM,OAAO,EAAE;MAAX,CAAb,CAAlB,CAAxC,CADP,CAAR;IAGD;EApBH;AAsBD,CAvBD;;AA6BA,MAAMC,SAAS,GAAG1C,OAAO,CAACoB,eAAD,EAAkBa,kBAAlB,CAAzB;;AAIA,MAAMU,kCAAN,SAAiD5C,aAAjD,CAAsE;EAAA;IAAA;;IAAA,4CAK9C6C,KAAD,IAA0C;MAC7DA,KAAK,CAACC,cAAN;MACA,KAAKC,KAAL,CAAW5B,gBAAX,CAA4B,KAAK4B,KAAL,CAAWtB,SAAX,CAAqBD,GAAjD;IACD,CARmE;;IAAA,wCAUlDY,UAAD,IAAyC;MACxD,KAAKW,KAAL,CAAW7B,gBAAX,CAA4BkB,UAA5B;IACD,CAZmE;;IAAA,uCAcpD,MAAM;MACpB,KAAKW,KAAL,CAAW3B,eAAX,CAA2B,KAAK2B,KAAL,CAAWtB,SAAX,CAAqBD,GAAhD;IACD,CAhBmE;;IAAA,+CAkB5C,CAACY,UAAD,EAAsCC,SAAtC,EAAyDC,OAAzD,KAA6E;MACnG,KAAKS,KAAL,CAAWpC,mBAAX,CAA+ByB,UAA/B,EAA2CC,SAA3C,EAAsDC,OAAtD;IACD,CApBmE;;IAAA,6CAsB7CF,UAAD,IAAyC;MAC7D,KAAKW,KAAL,CAAWnC,iBAAX,CAA6BwB,UAA7B;IACD,CAxBmE;;IAAA,0CA0BhDA,UAAD,IAAyC;MAC1D,KAAKW,KAAL,CAAWlC,cAAX,CAA0BuB,UAA1B;IACD,CA5BmE;EAAA;;EACpEY,iBAAiB,GAAS;IACxB,KAAKD,KAAL,CAAW5B,gBAAX,CAA4B,KAAK4B,KAAL,CAAWtB,SAAX,CAAqBD,GAAjD;EACD;;EA2BDyB,MAAM,GAAG;IAAA;;IACP,MAAMC,cAAc,4BAAG,KAAKH,KAAL,CAAWpB,SAAX,CAAqBwB,IAArB,CAA2BC,CAAD,IAAOA,CAAC,CAACtB,EAAF,KAAS,KAAKiB,KAAL,CAAWnB,UAArD,CAAH,yEAAuE,IAA3F;IAEA,oBACE;MAAA,wBACE;QAAK,SAAS,EAAC,iBAAf;QAAA,wBACE;UAAI,SAAS,EAAC,4BAAd;UAAA,wBACE;YACE,OAAO,EAAE,KAAKyB,kBADhB;YAEE,cAAYlD,SAAS,CAACmD,KAAV,CAAgBC,SAAhB,CAA0BC,QAA1B,CAAmCC,SAAnC,CAA6CC,IAA7C,CAAkDC,OAAlD,CAA0DC,UAFxE;YAAA;UAAA,EADF,EAOG,KAAKb,KAAL,CAAWnB,UAAX,oCACC;YAAA,wBACE,KAAC,IAAD;cAAM,IAAI,EAAC;YAAX,EADF;UAAA,EADD,EAPH;QAAA,EADF,+BAgBE;UAAK,SAAS,EAAC;QAAf,EAhBF,GAiBG,KAAKmB,KAAL,CAAWpB,SAAX,CAAqBkC,MAArB,GAA8B,CAA9B,IAAmCX,cAAc,KAAK,IAAtD,iBACC;UAAA,wBACE,KAAC,2BAAD;YAA6B,SAAS,EAAE,KAAKH,KAAL,CAAWpB;UAAnD,EADF,eAEE,KAAC,MAAD;YACE,IAAI,EAAC,QADP;YAEE,OAAO,EAAE,KAAKmC,aAFhB;YAGE,cAAY3D,SAAS,CAACmD,KAAV,CAAgBC,SAAhB,CAA0BC,QAA1B,CAAmCC,SAAnC,CAA6CM,IAA7C,CAAkDC,SAHhE;YAAA;UAAA,EAFF;QAAA,EAlBJ;MAAA,EADF,EAgCG,CAACd,cAAD,iBACC,KAAC,kBAAD;QACE,SAAS,EAAE,KAAKH,KAAL,CAAWpB,SADxB;QAEE,KAAK,EAAE,KAAKmC,aAFd;QAGE,MAAM,EAAE,KAAKG,cAHf;QAIE,aAAa,EAAE,KAAKC,qBAJtB;QAKE,WAAW,EAAE,KAAKC,mBALpB;QAME,QAAQ,EAAE,KAAKC,gBANjB;QAOE,MAAM,EAAE,KAAKrB,KAAL,CAAWd,MAPrB;QAQE,aAAa,EAAE,KAAKc,KAAL,CAAWhB;MAR5B,EAjCJ,EA4CG,CAACmB,cAAD,IAAmB,KAAKH,KAAL,CAAWpB,SAAX,CAAqBkC,MAArB,GAA8B,CAAjD,iBACC,KAAC,qBAAD;QAAuB,SAAS,EAAE,KAAKd,KAAL,CAAWpB,SAA7C;QAAwD,SAAS,EAAE,KAAKoB,KAAL,CAAWtB;MAA9E,EA7CJ,EA+CGyB,cAAc,iBAAI,KAAC,oBAAD;QAAsB,UAAU,EAAEpC,yBAAyB,CAACoC,cAAD;MAA3D,EA/CrB;IAAA,EADF;EAmDD;;AApFmE;;AAuFtE,OAAO,MAAMmB,uBAAuB,GAAG1B,SAAS,CAACC,kCAAD,CAAzC"},"metadata":{},"sourceType":"module"}