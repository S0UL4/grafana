{"ast":null,"code":"import { SearchLayout } from '../types';\nimport { ADD_TAG, CLEAR_FILTERS, LAYOUT_CHANGE, QUERY_CHANGE, REMOVE_STARRED, REMOVE_TAG, SET_TAGS, DATASOURCE_CHANGE, TOGGLE_SORT, TOGGLE_STARRED } from './actionTypes';\nexport const defaultQuery = {\n  query: '',\n  tag: [],\n  starred: false,\n  skipRecent: false,\n  skipStarred: false,\n  folderIds: [],\n  sort: null,\n  layout: SearchLayout.Folders,\n  prevSort: null\n};\nexport const defaultQueryParams = {\n  sort: null,\n  starred: null,\n  query: null,\n  tag: null,\n  layout: null\n};\nexport const queryReducer = (state, action) => {\n  switch (action.type) {\n    case QUERY_CHANGE:\n      return Object.assign({}, state, {\n        query: action.payload\n      });\n\n    case REMOVE_TAG:\n      return Object.assign({}, state, {\n        tag: state.tag.filter(t => t !== action.payload)\n      });\n\n    case SET_TAGS:\n      return Object.assign({}, state, {\n        tag: action.payload\n      });\n\n    case ADD_TAG:\n      {\n        const tag = action.payload;\n        return tag && !state.tag.includes(tag) ? Object.assign({}, state, {\n          tag: [...state.tag, tag]\n        }) : state;\n      }\n\n    case DATASOURCE_CHANGE:\n      return Object.assign({}, state, {\n        datasource: action.payload\n      });\n\n    case TOGGLE_STARRED:\n      return Object.assign({}, state, {\n        starred: action.payload\n      });\n\n    case REMOVE_STARRED:\n      return Object.assign({}, state, {\n        starred: false\n      });\n\n    case CLEAR_FILTERS:\n      return Object.assign({}, state, {\n        query: '',\n        tag: [],\n        starred: false,\n        sort: null\n      });\n\n    case TOGGLE_SORT:\n      {\n        const sort = action.payload;\n\n        if (state.layout === SearchLayout.Folders) {\n          return Object.assign({}, state, {\n            sort,\n            layout: SearchLayout.List\n          });\n        }\n\n        return Object.assign({}, state, {\n          sort\n        });\n      }\n\n    case LAYOUT_CHANGE:\n      {\n        const layout = action.payload;\n\n        if (state.sort && layout === SearchLayout.Folders) {\n          return Object.assign({}, state, {\n            layout,\n            sort: null,\n            prevSort: state.sort\n          });\n        }\n\n        return Object.assign({}, state, {\n          layout,\n          sort: state.prevSort\n        });\n      }\n\n    default:\n      return state;\n  }\n};","map":{"version":3,"names":["SearchLayout","ADD_TAG","CLEAR_FILTERS","LAYOUT_CHANGE","QUERY_CHANGE","REMOVE_STARRED","REMOVE_TAG","SET_TAGS","DATASOURCE_CHANGE","TOGGLE_SORT","TOGGLE_STARRED","defaultQuery","query","tag","starred","skipRecent","skipStarred","folderIds","sort","layout","Folders","prevSort","defaultQueryParams","queryReducer","state","action","type","payload","filter","t","includes","datasource","List"],"sources":["/home/soula/grafana/public/app/features/search/reducers/searchQueryReducer.ts"],"sourcesContent":["import { DashboardQuery, SearchQueryParams, SearchAction, SearchLayout } from '../types';\n\nimport {\n  ADD_TAG,\n  CLEAR_FILTERS,\n  LAYOUT_CHANGE,\n  QUERY_CHANGE,\n  REMOVE_STARRED,\n  REMOVE_TAG,\n  SET_TAGS,\n  DATASOURCE_CHANGE,\n  TOGGLE_SORT,\n  TOGGLE_STARRED,\n} from './actionTypes';\n\nexport const defaultQuery: DashboardQuery = {\n  query: '',\n  tag: [],\n  starred: false,\n  skipRecent: false,\n  skipStarred: false,\n  folderIds: [],\n  sort: null,\n  layout: SearchLayout.Folders,\n  prevSort: null,\n};\n\nexport const defaultQueryParams: SearchQueryParams = {\n  sort: null,\n  starred: null,\n  query: null,\n  tag: null,\n  layout: null,\n};\n\nexport const queryReducer = (state: DashboardQuery, action: SearchAction) => {\n  switch (action.type) {\n    case QUERY_CHANGE:\n      return { ...state, query: action.payload };\n    case REMOVE_TAG:\n      return { ...state, tag: state.tag.filter((t) => t !== action.payload) };\n    case SET_TAGS:\n      return { ...state, tag: action.payload };\n    case ADD_TAG: {\n      const tag = action.payload;\n      return tag && !state.tag.includes(tag) ? { ...state, tag: [...state.tag, tag] } : state;\n    }\n    case DATASOURCE_CHANGE:\n      return { ...state, datasource: action.payload };\n    case TOGGLE_STARRED:\n      return { ...state, starred: action.payload };\n    case REMOVE_STARRED:\n      return { ...state, starred: false };\n    case CLEAR_FILTERS:\n      return { ...state, query: '', tag: [], starred: false, sort: null };\n    case TOGGLE_SORT: {\n      const sort = action.payload;\n      if (state.layout === SearchLayout.Folders) {\n        return { ...state, sort, layout: SearchLayout.List };\n      }\n      return { ...state, sort };\n    }\n    case LAYOUT_CHANGE: {\n      const layout = action.payload;\n      if (state.sort && layout === SearchLayout.Folders) {\n        return { ...state, layout, sort: null, prevSort: state.sort };\n      }\n      return { ...state, layout, sort: state.prevSort };\n    }\n    default:\n      return state;\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}