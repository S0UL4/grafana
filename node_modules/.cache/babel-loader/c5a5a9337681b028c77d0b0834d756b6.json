{"ast":null,"code":"import React, { useEffect, useMemo, useState } from 'react';\nimport { Button, Form, HorizontalGroup, Select } from '@grafana/ui';\nimport { CloseButton } from 'app/core/components/CloseButton/CloseButton';\nimport { TeamPicker } from 'app/core/components/Select/TeamPicker';\nimport { UserPicker } from 'app/core/components/Select/UserPicker';\nimport { OrgRole } from 'app/types/acl';\nimport { PermissionTarget } from './types';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const AddPermission = ({\n  title = 'Add Permission For',\n  permissions,\n  assignments,\n  onAdd,\n  onCancel\n}) => {\n  const [target, setPermissionTarget] = useState(PermissionTarget.None);\n  const [teamId, setTeamId] = useState(0);\n  const [userId, setUserId] = useState(0);\n  const [builtInRole, setBuiltinRole] = useState('');\n  const [permission, setPermission] = useState('');\n  const targetOptions = useMemo(() => {\n    const options = [];\n\n    if (assignments.users) {\n      options.push({\n        value: PermissionTarget.User,\n        label: 'User'\n      });\n    }\n\n    if (assignments.teams) {\n      options.push({\n        value: PermissionTarget.Team,\n        label: 'Team'\n      });\n    }\n\n    if (assignments.builtInRoles) {\n      options.push({\n        value: PermissionTarget.BuiltInRole,\n        label: 'Role'\n      });\n    }\n\n    return options;\n  }, [assignments]);\n  useEffect(() => {\n    if (permissions.length > 0) {\n      setPermission(permissions[0]);\n    }\n  }, [permissions]);\n\n  const isValid = () => target === PermissionTarget.Team && teamId > 0 || target === PermissionTarget.User && userId > 0 || PermissionTarget.BuiltInRole && OrgRole.hasOwnProperty(builtInRole);\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"cta-form\",\n    \"aria-label\": \"Permissions slider\",\n    children: [/*#__PURE__*/_jsx(CloseButton, {\n      onClick: onCancel\n    }), /*#__PURE__*/_jsx(\"h5\", {\n      children: title\n    }), /*#__PURE__*/_jsx(Form, {\n      name: \"addPermission\",\n      maxWidth: \"none\",\n      onSubmit: () => onAdd({\n        userId,\n        teamId,\n        builtInRole,\n        permission,\n        target\n      }),\n      children: () => /*#__PURE__*/_jsxs(HorizontalGroup, {\n        children: [/*#__PURE__*/_jsx(Select, {\n          \"aria-label\": \"Role to add new permission to\",\n          value: target,\n          options: targetOptions,\n          onChange: v => setPermissionTarget(v.value),\n          disabled: targetOptions.length === 0\n        }), target === PermissionTarget.User && /*#__PURE__*/_jsx(UserPicker, {\n          onSelected: u => setUserId(u.value || 0),\n          className: 'width-20'\n        }), target === PermissionTarget.Team && /*#__PURE__*/_jsx(TeamPicker, {\n          onSelected: t => {\n            var _t$value;\n\n            return setTeamId(((_t$value = t.value) === null || _t$value === void 0 ? void 0 : _t$value.id) || 0);\n          },\n          className: 'width-20'\n        }), target === PermissionTarget.BuiltInRole && /*#__PURE__*/_jsx(Select, {\n          \"aria-label\": 'Built-in role picker',\n          options: Object.values(OrgRole).map(r => ({\n            value: r,\n            label: r\n          })),\n          onChange: r => setBuiltinRole(r.value || ''),\n          width: 40\n        }), /*#__PURE__*/_jsx(Select, {\n          \"aria-label\": \"Permission Level\",\n          width: 25,\n          value: permissions.find(p => p === permission),\n          options: permissions.map(p => ({\n            label: p,\n            value: p\n          })),\n          onChange: v => setPermission(v.value || '')\n        }), /*#__PURE__*/_jsx(Button, {\n          type: \"submit\",\n          disabled: !isValid(),\n          children: \"Save\"\n        })]\n      })\n    })]\n  });\n};","map":{"version":3,"names":["React","useEffect","useMemo","useState","Button","Form","HorizontalGroup","Select","CloseButton","TeamPicker","UserPicker","OrgRole","PermissionTarget","AddPermission","title","permissions","assignments","onAdd","onCancel","target","setPermissionTarget","None","teamId","setTeamId","userId","setUserId","builtInRole","setBuiltinRole","permission","setPermission","targetOptions","options","users","push","value","User","label","teams","Team","builtInRoles","BuiltInRole","length","isValid","hasOwnProperty","v","u","t","id","Object","values","map","r","find","p"],"sources":["/home/soula/grafana/public/app/core/components/AccessControl/AddPermission.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\n\nimport { Button, Form, HorizontalGroup, Select } from '@grafana/ui';\nimport { CloseButton } from 'app/core/components/CloseButton/CloseButton';\nimport { TeamPicker } from 'app/core/components/Select/TeamPicker';\nimport { UserPicker } from 'app/core/components/Select/UserPicker';\nimport { OrgRole } from 'app/types/acl';\n\nimport { Assignments, PermissionTarget, SetPermission } from './types';\n\nexport interface Props {\n  title?: string;\n  permissions: string[];\n  assignments: Assignments;\n  onCancel: () => void;\n  onAdd: (state: SetPermission) => void;\n}\n\nexport const AddPermission = ({ title = 'Add Permission For', permissions, assignments, onAdd, onCancel }: Props) => {\n  const [target, setPermissionTarget] = useState<PermissionTarget>(PermissionTarget.None);\n  const [teamId, setTeamId] = useState(0);\n  const [userId, setUserId] = useState(0);\n  const [builtInRole, setBuiltinRole] = useState('');\n  const [permission, setPermission] = useState('');\n\n  const targetOptions = useMemo(() => {\n    const options = [];\n    if (assignments.users) {\n      options.push({ value: PermissionTarget.User, label: 'User' });\n    }\n    if (assignments.teams) {\n      options.push({ value: PermissionTarget.Team, label: 'Team' });\n    }\n    if (assignments.builtInRoles) {\n      options.push({ value: PermissionTarget.BuiltInRole, label: 'Role' });\n    }\n    return options;\n  }, [assignments]);\n\n  useEffect(() => {\n    if (permissions.length > 0) {\n      setPermission(permissions[0]);\n    }\n  }, [permissions]);\n\n  const isValid = () =>\n    (target === PermissionTarget.Team && teamId > 0) ||\n    (target === PermissionTarget.User && userId > 0) ||\n    (PermissionTarget.BuiltInRole && OrgRole.hasOwnProperty(builtInRole));\n\n  return (\n    <div className=\"cta-form\" aria-label=\"Permissions slider\">\n      <CloseButton onClick={onCancel} />\n      <h5>{title}</h5>\n\n      <Form\n        name=\"addPermission\"\n        maxWidth=\"none\"\n        onSubmit={() => onAdd({ userId, teamId, builtInRole, permission, target })}\n      >\n        {() => (\n          <HorizontalGroup>\n            <Select\n              aria-label=\"Role to add new permission to\"\n              value={target}\n              options={targetOptions}\n              onChange={(v) => setPermissionTarget(v.value!)}\n              disabled={targetOptions.length === 0}\n            />\n\n            {target === PermissionTarget.User && (\n              <UserPicker onSelected={(u) => setUserId(u.value || 0)} className={'width-20'} />\n            )}\n\n            {target === PermissionTarget.Team && (\n              <TeamPicker onSelected={(t) => setTeamId(t.value?.id || 0)} className={'width-20'} />\n            )}\n\n            {target === PermissionTarget.BuiltInRole && (\n              <Select\n                aria-label={'Built-in role picker'}\n                options={Object.values(OrgRole).map((r) => ({ value: r, label: r }))}\n                onChange={(r) => setBuiltinRole(r.value || '')}\n                width={40}\n              />\n            )}\n\n            <Select\n              aria-label=\"Permission Level\"\n              width={25}\n              value={permissions.find((p) => p === permission)}\n              options={permissions.map((p) => ({ label: p, value: p }))}\n              onChange={(v) => setPermission(v.value || '')}\n            />\n            <Button type=\"submit\" disabled={!isValid()}>\n              Save\n            </Button>\n          </HorizontalGroup>\n        )}\n      </Form>\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}