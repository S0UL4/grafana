{"ast":null,"code":"import { FieldType, formattedValueToString, getDisplayProcessor, reduceField, fieldReducers } from '@grafana/data';\nimport { config } from 'app/core/config';\nexport function getFooterCells(frame, options) {\n  return frame.fields.map((field, i) => {\n    if (field.type !== FieldType.number) {\n      // show the reducer in the first column\n      if (i === 0 && options && options.reducer.length > 0) {\n        const reducer = fieldReducers.get(options.reducer[0]);\n        return reducer.name;\n      }\n\n      return undefined;\n    }\n\n    if (options !== null && options !== void 0 && options.fields && options.fields.length > 0) {\n      const f = options.fields.find(f => f === field.name);\n\n      if (f) {\n        return getFormattedValue(field, options.reducer);\n      }\n\n      return undefined;\n    }\n\n    return getFormattedValue(field, (options === null || options === void 0 ? void 0 : options.reducer) || []);\n  });\n}\n\nfunction getFormattedValue(field, reducer) {\n  var _field$display;\n\n  const fmt = (_field$display = field.display) !== null && _field$display !== void 0 ? _field$display : getDisplayProcessor({\n    field,\n    theme: config.theme2\n  });\n  const calc = reducer[0];\n  const v = reduceField({\n    field,\n    reducers: reducer\n  })[calc];\n  return formattedValueToString(fmt(v));\n}","map":{"version":3,"names":["FieldType","formattedValueToString","getDisplayProcessor","reduceField","fieldReducers","config","getFooterCells","frame","options","fields","map","field","i","type","number","reducer","length","get","name","undefined","f","find","getFormattedValue","fmt","display","theme","theme2","calc","v","reducers"],"sources":["/home/soula/grafana/public/app/plugins/panel/table/footer.ts"],"sourcesContent":["import {\n  DataFrame,\n  Field,\n  FieldType,\n  formattedValueToString,\n  getDisplayProcessor,\n  reduceField,\n  fieldReducers,\n} from '@grafana/data';\nimport { FooterItem } from '@grafana/ui/src/components/Table/types';\nimport { config } from 'app/core/config';\n\nimport { TableFooterCalc } from './models.gen';\n\nexport function getFooterCells(frame: DataFrame, options?: TableFooterCalc): FooterItem[] {\n  return frame.fields.map((field, i) => {\n    if (field.type !== FieldType.number) {\n      // show the reducer in the first column\n      if (i === 0 && options && options.reducer.length > 0) {\n        const reducer = fieldReducers.get(options.reducer[0]);\n        return reducer.name;\n      }\n      return undefined;\n    }\n    if (options?.fields && options.fields.length > 0) {\n      const f = options.fields.find((f) => f === field.name);\n      if (f) {\n        return getFormattedValue(field, options.reducer);\n      }\n      return undefined;\n    }\n    return getFormattedValue(field, options?.reducer || []);\n  });\n}\n\nfunction getFormattedValue(field: Field, reducer: string[]) {\n  const fmt = field.display ?? getDisplayProcessor({ field, theme: config.theme2 });\n  const calc = reducer[0];\n  const v = reduceField({ field, reducers: reducer })[calc];\n  return formattedValueToString(fmt(v));\n}\n"],"mappings":"AAAA,SAGEA,SAHF,EAIEC,sBAJF,EAKEC,mBALF,EAMEC,WANF,EAOEC,aAPF,QAQO,eARP;AAUA,SAASC,MAAT,QAAuB,iBAAvB;AAIA,OAAO,SAASC,cAAT,CAAwBC,KAAxB,EAA0CC,OAA1C,EAAmF;EACxF,OAAOD,KAAK,CAACE,MAAN,CAAaC,GAAb,CAAiB,CAACC,KAAD,EAAQC,CAAR,KAAc;IACpC,IAAID,KAAK,CAACE,IAAN,KAAeb,SAAS,CAACc,MAA7B,EAAqC;MACnC;MACA,IAAIF,CAAC,KAAK,CAAN,IAAWJ,OAAX,IAAsBA,OAAO,CAACO,OAAR,CAAgBC,MAAhB,GAAyB,CAAnD,EAAsD;QACpD,MAAMD,OAAO,GAAGX,aAAa,CAACa,GAAd,CAAkBT,OAAO,CAACO,OAAR,CAAgB,CAAhB,CAAlB,CAAhB;QACA,OAAOA,OAAO,CAACG,IAAf;MACD;;MACD,OAAOC,SAAP;IACD;;IACD,IAAIX,OAAO,SAAP,IAAAA,OAAO,WAAP,IAAAA,OAAO,CAAEC,MAAT,IAAmBD,OAAO,CAACC,MAAR,CAAeO,MAAf,GAAwB,CAA/C,EAAkD;MAChD,MAAMI,CAAC,GAAGZ,OAAO,CAACC,MAAR,CAAeY,IAAf,CAAqBD,CAAD,IAAOA,CAAC,KAAKT,KAAK,CAACO,IAAvC,CAAV;;MACA,IAAIE,CAAJ,EAAO;QACL,OAAOE,iBAAiB,CAACX,KAAD,EAAQH,OAAO,CAACO,OAAhB,CAAxB;MACD;;MACD,OAAOI,SAAP;IACD;;IACD,OAAOG,iBAAiB,CAACX,KAAD,EAAQ,CAAAH,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEO,OAAT,KAAoB,EAA5B,CAAxB;EACD,CAjBM,CAAP;AAkBD;;AAED,SAASO,iBAAT,CAA2BX,KAA3B,EAAyCI,OAAzC,EAA4D;EAAA;;EAC1D,MAAMQ,GAAG,qBAAGZ,KAAK,CAACa,OAAT,2DAAoBtB,mBAAmB,CAAC;IAAES,KAAF;IAASc,KAAK,EAAEpB,MAAM,CAACqB;EAAvB,CAAD,CAAhD;EACA,MAAMC,IAAI,GAAGZ,OAAO,CAAC,CAAD,CAApB;EACA,MAAMa,CAAC,GAAGzB,WAAW,CAAC;IAAEQ,KAAF;IAASkB,QAAQ,EAAEd;EAAnB,CAAD,CAAX,CAA0CY,IAA1C,CAAV;EACA,OAAO1B,sBAAsB,CAACsB,GAAG,CAACK,CAAD,CAAJ,CAA7B;AACD"},"metadata":{},"sourceType":"module"}