{"ast":null,"code":"var _Loader, _LinkButton, _LinkButton2, _LinkButton3, _LinkButton4, _CrawlerStatus, _ExportStatus;\n\nimport { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { config } from '@grafana/runtime';\nimport { CardContainer, LinkButton, useStyles2 } from '@grafana/ui';\nimport { AccessControlAction } from 'app/types';\nimport { contextSrv } from '../../core/services/context_srv';\nimport { Loader } from '../plugins/admin/components/Loader';\nimport { CrawlerStatus } from './CrawlerStatus';\nimport { ExportStatus } from './ExportStatus';\nimport { getServerStats } from './state/apis';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nexport const ServerStats = () => {\n  const [stats, setStats] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const styles = useStyles2(getStyles);\n  const hasAccessToDataSources = contextSrv.hasAccess(AccessControlAction.DataSourcesRead, contextSrv.isGrafanaAdmin);\n  const hasAccessToAdminUsers = contextSrv.hasAccess(AccessControlAction.UsersRead, contextSrv.isGrafanaAdmin);\n  useEffect(() => {\n    if (contextSrv.hasAccess(AccessControlAction.ActionServerStatsRead, contextSrv.isGrafanaAdmin)) {\n      setIsLoading(true);\n      getServerStats().then(stats => {\n        setStats(stats);\n        setIsLoading(false);\n      });\n    }\n  }, []);\n\n  if (!contextSrv.hasAccess(AccessControlAction.ActionServerStatsRead, contextSrv.isGrafanaAdmin)) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"h2\", {\n      className: styles.title,\n      children: \"Instance statistics\"\n    }), isLoading ? /*#__PURE__*/_jsx(\"div\", {\n      className: styles.loader,\n      children: _Loader || (_Loader = /*#__PURE__*/_jsx(Loader, {\n        text: 'Loading instance stats...'\n      }))\n    }) : stats ? /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.row,\n      children: [/*#__PURE__*/_jsx(StatCard, {\n        content: [{\n          name: 'Dashboards (starred)',\n          value: `${stats.dashboards} (${stats.stars})`\n        }, {\n          name: 'Tags',\n          value: stats.tags\n        }, {\n          name: 'Playlists',\n          value: stats.playlists\n        }, {\n          name: 'Snapshots',\n          value: stats.snapshots\n        }],\n        footer: _LinkButton || (_LinkButton = /*#__PURE__*/_jsx(LinkButton, {\n          href: '/dashboards',\n          variant: 'secondary',\n          children: \"Manage dashboards\"\n        }))\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.doubleRow,\n        children: [/*#__PURE__*/_jsx(StatCard, {\n          content: [{\n            name: 'Data sources',\n            value: stats.datasources\n          }],\n          footer: hasAccessToDataSources && (_LinkButton2 || (_LinkButton2 = /*#__PURE__*/_jsx(LinkButton, {\n            href: '/datasources',\n            variant: 'secondary',\n            children: \"Manage data sources\"\n          })))\n        }), /*#__PURE__*/_jsx(StatCard, {\n          content: [{\n            name: 'Alerts',\n            value: stats.alerts\n          }],\n          footer: _LinkButton3 || (_LinkButton3 = /*#__PURE__*/_jsx(LinkButton, {\n            href: '/alerting/list',\n            variant: 'secondary',\n            children: \"Alerts\"\n          }))\n        })]\n      }), /*#__PURE__*/_jsx(StatCard, {\n        content: [{\n          name: 'Organisations',\n          value: stats.orgs\n        }, {\n          name: 'Users total',\n          value: stats.users\n        }, {\n          name: 'Active users in last 30 days',\n          value: stats.activeUsers\n        }, {\n          name: 'Active sessions',\n          value: stats.activeSessions\n        }],\n        footer: hasAccessToAdminUsers && (_LinkButton4 || (_LinkButton4 = /*#__PURE__*/_jsx(LinkButton, {\n          href: '/admin/users',\n          variant: 'secondary',\n          children: \"Manage users\"\n        })))\n      })]\n    }) : /*#__PURE__*/_jsx(\"p\", {\n      className: styles.notFound,\n      children: \"No stats found.\"\n    }), config.featureToggles.dashboardPreviews && config.featureToggles.dashboardPreviewsAdmin && (_CrawlerStatus || (_CrawlerStatus = /*#__PURE__*/_jsx(CrawlerStatus, {}))), config.featureToggles.export && (_ExportStatus || (_ExportStatus = /*#__PURE__*/_jsx(ExportStatus, {})))]\n  });\n};\n\nconst getStyles = theme => {\n  return {\n    title: css`\n      margin-bottom: ${theme.spacing(4)};\n    `,\n    row: css`\n      display: flex;\n      justify-content: space-between;\n      width: 100%;\n\n      & > div:not(:last-of-type) {\n        margin-right: ${theme.spacing(2)};\n      }\n\n      & > div {\n        width: 33.3%;\n      }\n    `,\n    doubleRow: css`\n      display: flex;\n      flex-direction: column;\n\n      & > div:first-of-type {\n        margin-bottom: ${theme.spacing(2)};\n      }\n    `,\n    loader: css`\n      height: 290px;\n    `,\n    notFound: css`\n      font-size: ${theme.typography.h6.fontSize};\n      text-align: center;\n      height: 290px;\n    `\n  };\n};\n\nconst StatCard = ({\n  content,\n  footer\n}) => {\n  const styles = useStyles2(getCardStyles);\n  return /*#__PURE__*/_jsx(CardContainer, {\n    className: styles.container,\n    disableHover: true,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.inner,\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: styles.content,\n        children: content.map(item => {\n          return /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.row,\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              children: item.name\n            }), /*#__PURE__*/_jsx(\"span\", {\n              children: item.value\n            })]\n          }, item.name);\n        })\n      }), footer && /*#__PURE__*/_jsx(\"div\", {\n        children: footer\n      })]\n    })\n  });\n};\n\nconst getCardStyles = theme => {\n  return {\n    container: css`\n      padding: ${theme.spacing(2)};\n    `,\n    inner: css`\n      display: flex;\n      flex-direction: column;\n      width: 100%;\n    `,\n    content: css`\n      flex: 1 0 auto;\n    `,\n    row: css`\n      display: flex;\n      justify-content: space-between;\n      width: 100%;\n      margin-bottom: ${theme.spacing(2)};\n      align-items: center;\n    `\n  };\n};","map":{"version":3,"names":["css","React","useEffect","useState","config","CardContainer","LinkButton","useStyles2","AccessControlAction","contextSrv","Loader","CrawlerStatus","ExportStatus","getServerStats","ServerStats","stats","setStats","isLoading","setIsLoading","styles","getStyles","hasAccessToDataSources","hasAccess","DataSourcesRead","isGrafanaAdmin","hasAccessToAdminUsers","UsersRead","ActionServerStatsRead","then","title","loader","row","name","value","dashboards","stars","tags","playlists","snapshots","doubleRow","datasources","alerts","orgs","users","activeUsers","activeSessions","notFound","featureToggles","dashboardPreviews","dashboardPreviewsAdmin","export","theme","spacing","typography","h6","fontSize","StatCard","content","footer","getCardStyles","container","inner","map","item"],"sources":["/home/soula/grafana/public/app/features/admin/ServerStats.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { CardContainer, LinkButton, useStyles2 } from '@grafana/ui';\nimport { AccessControlAction } from 'app/types';\n\nimport { contextSrv } from '../../core/services/context_srv';\nimport { Loader } from '../plugins/admin/components/Loader';\n\nimport { CrawlerStatus } from './CrawlerStatus';\nimport { ExportStatus } from './ExportStatus';\nimport { getServerStats, ServerStat } from './state/apis';\n\nexport const ServerStats = () => {\n  const [stats, setStats] = useState<ServerStat | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const styles = useStyles2(getStyles);\n\n  const hasAccessToDataSources = contextSrv.hasAccess(AccessControlAction.DataSourcesRead, contextSrv.isGrafanaAdmin);\n  const hasAccessToAdminUsers = contextSrv.hasAccess(AccessControlAction.UsersRead, contextSrv.isGrafanaAdmin);\n\n  useEffect(() => {\n    if (contextSrv.hasAccess(AccessControlAction.ActionServerStatsRead, contextSrv.isGrafanaAdmin)) {\n      setIsLoading(true);\n      getServerStats().then((stats) => {\n        setStats(stats);\n        setIsLoading(false);\n      });\n    }\n  }, []);\n\n  if (!contextSrv.hasAccess(AccessControlAction.ActionServerStatsRead, contextSrv.isGrafanaAdmin)) {\n    return null;\n  }\n\n  return (\n    <>\n      <h2 className={styles.title}>Instance statistics</h2>\n      {isLoading ? (\n        <div className={styles.loader}>\n          <Loader text={'Loading instance stats...'} />\n        </div>\n      ) : stats ? (\n        <div className={styles.row}>\n          <StatCard\n            content={[\n              { name: 'Dashboards (starred)', value: `${stats.dashboards} (${stats.stars})` },\n              { name: 'Tags', value: stats.tags },\n              { name: 'Playlists', value: stats.playlists },\n              { name: 'Snapshots', value: stats.snapshots },\n            ]}\n            footer={\n              <LinkButton href={'/dashboards'} variant={'secondary'}>\n                Manage dashboards\n              </LinkButton>\n            }\n          />\n\n          <div className={styles.doubleRow}>\n            <StatCard\n              content={[{ name: 'Data sources', value: stats.datasources }]}\n              footer={\n                hasAccessToDataSources && (\n                  <LinkButton href={'/datasources'} variant={'secondary'}>\n                    Manage data sources\n                  </LinkButton>\n                )\n              }\n            />\n            <StatCard\n              content={[{ name: 'Alerts', value: stats.alerts }]}\n              footer={\n                <LinkButton href={'/alerting/list'} variant={'secondary'}>\n                  Alerts\n                </LinkButton>\n              }\n            />\n          </div>\n          <StatCard\n            content={[\n              { name: 'Organisations', value: stats.orgs },\n              { name: 'Users total', value: stats.users },\n              { name: 'Active users in last 30 days', value: stats.activeUsers },\n              { name: 'Active sessions', value: stats.activeSessions },\n            ]}\n            footer={\n              hasAccessToAdminUsers && (\n                <LinkButton href={'/admin/users'} variant={'secondary'}>\n                  Manage users\n                </LinkButton>\n              )\n            }\n          />\n        </div>\n      ) : (\n        <p className={styles.notFound}>No stats found.</p>\n      )}\n\n      {config.featureToggles.dashboardPreviews && config.featureToggles.dashboardPreviewsAdmin && <CrawlerStatus />}\n      {config.featureToggles.export && <ExportStatus />}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    title: css`\n      margin-bottom: ${theme.spacing(4)};\n    `,\n    row: css`\n      display: flex;\n      justify-content: space-between;\n      width: 100%;\n\n      & > div:not(:last-of-type) {\n        margin-right: ${theme.spacing(2)};\n      }\n\n      & > div {\n        width: 33.3%;\n      }\n    `,\n    doubleRow: css`\n      display: flex;\n      flex-direction: column;\n\n      & > div:first-of-type {\n        margin-bottom: ${theme.spacing(2)};\n      }\n    `,\n\n    loader: css`\n      height: 290px;\n    `,\n\n    notFound: css`\n      font-size: ${theme.typography.h6.fontSize};\n      text-align: center;\n      height: 290px;\n    `,\n  };\n};\n\ntype StatCardProps = {\n  content: Array<Record<string, number | string>>;\n  footer?: JSX.Element | boolean;\n};\n\nconst StatCard = ({ content, footer }: StatCardProps) => {\n  const styles = useStyles2(getCardStyles);\n  return (\n    <CardContainer className={styles.container} disableHover>\n      <div className={styles.inner}>\n        <div className={styles.content}>\n          {content.map((item) => {\n            return (\n              <div key={item.name} className={styles.row}>\n                <span>{item.name}</span>\n                <span>{item.value}</span>\n              </div>\n            );\n          })}\n        </div>\n        {footer && <div>{footer}</div>}\n      </div>\n    </CardContainer>\n  );\n};\n\nconst getCardStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css`\n      padding: ${theme.spacing(2)};\n    `,\n    inner: css`\n      display: flex;\n      flex-direction: column;\n      width: 100%;\n    `,\n    content: css`\n      flex: 1 0 auto;\n    `,\n    row: css`\n      display: flex;\n      justify-content: space-between;\n      width: 100%;\n      margin-bottom: ${theme.spacing(2)};\n      align-items: center;\n    `,\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}