{"ast":null,"code":"import { clearPluginSettingsCache } from './pluginSettings';\nconst cache = {};\nconst initializedAt = Date.now();\nexport function registerPluginInCache({\n  path,\n  version\n}) {\n  if (!cache[path]) {\n    cache[path] = encodeURI(version);\n  }\n}\nexport function invalidatePluginInCache(pluginId) {\n  const path = `plugins/${pluginId}/module`;\n\n  if (cache[path]) {\n    delete cache[path];\n  }\n\n  clearPluginSettingsCache(pluginId);\n}\nexport function locateWithCache(load, defaultBust = initializedAt) {\n  const {\n    address\n  } = load;\n  const path = extractPath(address);\n\n  if (!path) {\n    return `${address}?_cache=${defaultBust}`;\n  }\n\n  const version = cache[path];\n  const bust = version || defaultBust;\n  return `${address}?_cache=${bust}`;\n}\n\nfunction extractPath(address) {\n  const match = /\\/public\\/(plugins\\/.+\\/module)\\.js/i.exec(address);\n\n  if (!match) {\n    return;\n  }\n\n  const [_, path] = match;\n\n  if (!path) {\n    return;\n  }\n\n  return path;\n}","map":{"version":3,"names":["clearPluginSettingsCache","cache","initializedAt","Date","now","registerPluginInCache","path","version","encodeURI","invalidatePluginInCache","pluginId","locateWithCache","load","defaultBust","address","extractPath","bust","match","exec","_"],"sources":["/home/soula/grafana/public/app/features/plugins/pluginCacheBuster.ts"],"sourcesContent":["import { clearPluginSettingsCache } from './pluginSettings';\n\nconst cache: Record<string, string> = {};\nconst initializedAt: number = Date.now();\n\ntype CacheablePlugin = {\n  path: string;\n  version: string;\n};\n\nexport function registerPluginInCache({ path, version }: CacheablePlugin): void {\n  if (!cache[path]) {\n    cache[path] = encodeURI(version);\n  }\n}\n\nexport function invalidatePluginInCache(pluginId: string): void {\n  const path = `plugins/${pluginId}/module`;\n  if (cache[path]) {\n    delete cache[path];\n  }\n  clearPluginSettingsCache(pluginId);\n}\n\nexport function locateWithCache(load: { address: string }, defaultBust = initializedAt): string {\n  const { address } = load;\n  const path = extractPath(address);\n\n  if (!path) {\n    return `${address}?_cache=${defaultBust}`;\n  }\n\n  const version = cache[path];\n  const bust = version || defaultBust;\n  return `${address}?_cache=${bust}`;\n}\n\nfunction extractPath(address: string): string | undefined {\n  const match = /\\/public\\/(plugins\\/.+\\/module)\\.js/i.exec(address);\n  if (!match) {\n    return;\n  }\n  const [_, path] = match;\n  if (!path) {\n    return;\n  }\n  return path;\n}\n"],"mappings":"AAAA,SAASA,wBAAT,QAAyC,kBAAzC;AAEA,MAAMC,KAA6B,GAAG,EAAtC;AACA,MAAMC,aAAqB,GAAGC,IAAI,CAACC,GAAL,EAA9B;AAOA,OAAO,SAASC,qBAAT,CAA+B;EAAEC,IAAF;EAAQC;AAAR,CAA/B,EAAyE;EAC9E,IAAI,CAACN,KAAK,CAACK,IAAD,CAAV,EAAkB;IAChBL,KAAK,CAACK,IAAD,CAAL,GAAcE,SAAS,CAACD,OAAD,CAAvB;EACD;AACF;AAED,OAAO,SAASE,uBAAT,CAAiCC,QAAjC,EAAyD;EAC9D,MAAMJ,IAAI,GAAI,WAAUI,QAAS,SAAjC;;EACA,IAAIT,KAAK,CAACK,IAAD,CAAT,EAAiB;IACf,OAAOL,KAAK,CAACK,IAAD,CAAZ;EACD;;EACDN,wBAAwB,CAACU,QAAD,CAAxB;AACD;AAED,OAAO,SAASC,eAAT,CAAyBC,IAAzB,EAAoDC,WAAW,GAAGX,aAAlE,EAAyF;EAC9F,MAAM;IAAEY;EAAF,IAAcF,IAApB;EACA,MAAMN,IAAI,GAAGS,WAAW,CAACD,OAAD,CAAxB;;EAEA,IAAI,CAACR,IAAL,EAAW;IACT,OAAQ,GAAEQ,OAAQ,WAAUD,WAAY,EAAxC;EACD;;EAED,MAAMN,OAAO,GAAGN,KAAK,CAACK,IAAD,CAArB;EACA,MAAMU,IAAI,GAAGT,OAAO,IAAIM,WAAxB;EACA,OAAQ,GAAEC,OAAQ,WAAUE,IAAK,EAAjC;AACD;;AAED,SAASD,WAAT,CAAqBD,OAArB,EAA0D;EACxD,MAAMG,KAAK,GAAG,uCAAuCC,IAAvC,CAA4CJ,OAA5C,CAAd;;EACA,IAAI,CAACG,KAAL,EAAY;IACV;EACD;;EACD,MAAM,CAACE,CAAD,EAAIb,IAAJ,IAAYW,KAAlB;;EACA,IAAI,CAACX,IAAL,EAAW;IACT;EACD;;EACD,OAAOA,IAAP;AACD"},"metadata":{},"sourceType":"module"}