{"ast":null,"code":"var _Page, _br;\n\nimport { css } from '@emotion/css';\nimport React, { useEffect } from 'react';\nimport { usePrevious } from 'react-use';\nimport { locationService } from '@grafana/runtime';\nimport { useStyles2, TabsBar, TabContent, Tab, Alert } from '@grafana/ui';\nimport { Layout } from '@grafana/ui/src/components/Layout/Layout';\nimport { Page } from 'app/core/components/Page/Page';\nimport { AppNotificationSeverity } from 'app/types';\nimport { Loader } from '../components/Loader';\nimport { PluginDetailsBody } from '../components/PluginDetailsBody';\nimport { PluginDetailsDisabledError } from '../components/PluginDetailsDisabledError';\nimport { PluginDetailsHeader } from '../components/PluginDetailsHeader';\nimport { PluginDetailsSignature } from '../components/PluginDetailsSignature';\nimport { usePluginDetailsTabs } from '../hooks/usePluginDetailsTabs';\nimport { useGetSingle, useFetchStatus, useFetchDetailsStatus } from '../state/hooks';\nimport { PluginTabLabels, PluginTabIds } from '../types';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function PluginDetails({\n  match,\n  queryParams\n}) {\n  const {\n    params: {\n      pluginId = ''\n    },\n    url\n  } = match;\n  const parentUrl = url.substring(0, url.lastIndexOf('/'));\n  const defaultTabs = [{\n    label: PluginTabLabels.OVERVIEW,\n    icon: 'file-alt',\n    id: PluginTabIds.OVERVIEW,\n    href: `${url}?page=${PluginTabIds.OVERVIEW}`\n  }];\n  const plugin = useGetSingle(pluginId); // fetches the localplugin settings\n\n  const {\n    tabs,\n    defaultTab\n  } = usePluginDetailsTabs(plugin, defaultTabs);\n  const {\n    isLoading: isFetchLoading\n  } = useFetchStatus();\n  const {\n    isLoading: isFetchDetailsLoading\n  } = useFetchDetailsStatus();\n  const styles = useStyles2(getStyles);\n  const prevTabs = usePrevious(tabs);\n  const pageId = queryParams.page || defaultTab; // If an app plugin is uninstalled we need to reset the active tab when the config / dashboards tabs are removed.\n\n  useEffect(() => {\n    const hasUninstalledWithConfigPages = prevTabs && prevTabs.length > tabs.length;\n    const isViewingAConfigPage = pageId !== PluginTabIds.OVERVIEW && pageId !== PluginTabIds.VERSIONS;\n\n    if (hasUninstalledWithConfigPages && isViewingAConfigPage) {\n      locationService.replace(`${url}?page=${PluginTabIds.OVERVIEW}`);\n    }\n  }, [pageId, url, tabs, prevTabs]);\n\n  if (isFetchLoading || isFetchDetailsLoading) {\n    return _Page || (_Page = /*#__PURE__*/_jsx(Page, {\n      children: /*#__PURE__*/_jsx(Loader, {})\n    }));\n  }\n\n  if (!plugin) {\n    return /*#__PURE__*/_jsx(Layout, {\n      justify: \"center\",\n      align: \"center\",\n      children: /*#__PURE__*/_jsxs(Alert, {\n        severity: AppNotificationSeverity.Warning,\n        title: \"Plugin not found\",\n        children: [\"That plugin cannot be found. Please check the url is correct or \", _br || (_br = /*#__PURE__*/_jsx(\"br\", {})), \"go to the \", /*#__PURE__*/_jsx(\"a\", {\n          href: parentUrl,\n          children: \"plugin catalog\"\n        }), \".\"]\n      })\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(Page, {\n    children: [/*#__PURE__*/_jsx(PluginDetailsHeader, {\n      currentUrl: `${url}?page=${pageId}`,\n      parentUrl: parentUrl,\n      plugin: plugin\n    }), /*#__PURE__*/_jsx(\"div\", {\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"page-container\",\n        children: /*#__PURE__*/_jsx(TabsBar, {\n          hideBorder: true,\n          children: tabs.map(tab => {\n            return /*#__PURE__*/_jsx(Tab, {\n              label: tab.label,\n              href: tab.href,\n              icon: tab.icon,\n              active: tab.id === pageId\n            }, tab.label);\n          })\n        })\n      })\n    }), /*#__PURE__*/_jsx(Page.Contents, {\n      children: /*#__PURE__*/_jsxs(TabContent, {\n        className: styles.tabContent,\n        children: [/*#__PURE__*/_jsx(PluginDetailsSignature, {\n          plugin: plugin,\n          className: styles.alert\n        }), /*#__PURE__*/_jsx(PluginDetailsDisabledError, {\n          plugin: plugin,\n          className: styles.alert\n        }), /*#__PURE__*/_jsx(PluginDetailsBody, {\n          queryParams: queryParams,\n          plugin: plugin,\n          pageId: pageId\n        })]\n      })\n    })]\n  });\n}\nexport const getStyles = theme => {\n  return {\n    alert: css`\n      margin: ${theme.spacing(3)};\n      margin-bottom: 0;\n    `,\n    // Needed due to block formatting context\n    tabContent: css`\n      overflow: auto;\n    `\n  };\n};","map":{"version":3,"names":["css","React","useEffect","usePrevious","locationService","useStyles2","TabsBar","TabContent","Tab","Alert","Layout","Page","AppNotificationSeverity","Loader","PluginDetailsBody","PluginDetailsDisabledError","PluginDetailsHeader","PluginDetailsSignature","usePluginDetailsTabs","useGetSingle","useFetchStatus","useFetchDetailsStatus","PluginTabLabels","PluginTabIds","PluginDetails","match","queryParams","params","pluginId","url","parentUrl","substring","lastIndexOf","defaultTabs","label","OVERVIEW","icon","id","href","plugin","tabs","defaultTab","isLoading","isFetchLoading","isFetchDetailsLoading","styles","getStyles","prevTabs","pageId","page","hasUninstalledWithConfigPages","length","isViewingAConfigPage","VERSIONS","replace","Warning","map","tab","tabContent","alert","theme","spacing"],"sources":["/home/soula/grafana/public/app/features/plugins/admin/pages/PluginDetails.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useEffect } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { useStyles2, TabsBar, TabContent, Tab, Alert, IconName } from '@grafana/ui';\nimport { Layout } from '@grafana/ui/src/components/Layout/Layout';\nimport { Page } from 'app/core/components/Page/Page';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { AppNotificationSeverity } from 'app/types';\n\nimport { Loader } from '../components/Loader';\nimport { PluginDetailsBody } from '../components/PluginDetailsBody';\nimport { PluginDetailsDisabledError } from '../components/PluginDetailsDisabledError';\nimport { PluginDetailsHeader } from '../components/PluginDetailsHeader';\nimport { PluginDetailsSignature } from '../components/PluginDetailsSignature';\nimport { usePluginDetailsTabs } from '../hooks/usePluginDetailsTabs';\nimport { useGetSingle, useFetchStatus, useFetchDetailsStatus } from '../state/hooks';\nimport { PluginTabLabels, PluginTabIds, PluginDetailsTab } from '../types';\n\ntype Props = GrafanaRouteComponentProps<{ pluginId?: string }>;\n\nexport default function PluginDetails({ match, queryParams }: Props): JSX.Element | null {\n  const {\n    params: { pluginId = '' },\n    url,\n  } = match;\n  const parentUrl = url.substring(0, url.lastIndexOf('/'));\n  const defaultTabs: PluginDetailsTab[] = [\n    {\n      label: PluginTabLabels.OVERVIEW,\n      icon: 'file-alt',\n      id: PluginTabIds.OVERVIEW,\n      href: `${url}?page=${PluginTabIds.OVERVIEW}`,\n    },\n  ];\n  const plugin = useGetSingle(pluginId); // fetches the localplugin settings\n  const { tabs, defaultTab } = usePluginDetailsTabs(plugin, defaultTabs);\n  const { isLoading: isFetchLoading } = useFetchStatus();\n  const { isLoading: isFetchDetailsLoading } = useFetchDetailsStatus();\n  const styles = useStyles2(getStyles);\n  const prevTabs = usePrevious(tabs);\n  const pageId = (queryParams.page as PluginTabIds) || defaultTab;\n\n  // If an app plugin is uninstalled we need to reset the active tab when the config / dashboards tabs are removed.\n  useEffect(() => {\n    const hasUninstalledWithConfigPages = prevTabs && prevTabs.length > tabs.length;\n    const isViewingAConfigPage = pageId !== PluginTabIds.OVERVIEW && pageId !== PluginTabIds.VERSIONS;\n\n    if (hasUninstalledWithConfigPages && isViewingAConfigPage) {\n      locationService.replace(`${url}?page=${PluginTabIds.OVERVIEW}`);\n    }\n  }, [pageId, url, tabs, prevTabs]);\n\n  if (isFetchLoading || isFetchDetailsLoading) {\n    return (\n      <Page>\n        <Loader />\n      </Page>\n    );\n  }\n\n  if (!plugin) {\n    return (\n      <Layout justify=\"center\" align=\"center\">\n        <Alert severity={AppNotificationSeverity.Warning} title=\"Plugin not found\">\n          That plugin cannot be found. Please check the url is correct or <br />\n          go to the <a href={parentUrl}>plugin catalog</a>.\n        </Alert>\n      </Layout>\n    );\n  }\n\n  return (\n    <Page>\n      <PluginDetailsHeader currentUrl={`${url}?page=${pageId}`} parentUrl={parentUrl} plugin={plugin} />\n      {/* Tab navigation */}\n      <div>\n        <div className=\"page-container\">\n          <TabsBar hideBorder>\n            {tabs.map((tab: PluginDetailsTab) => {\n              return (\n                <Tab\n                  key={tab.label}\n                  label={tab.label}\n                  href={tab.href}\n                  icon={tab.icon as IconName}\n                  active={tab.id === pageId}\n                />\n              );\n            })}\n          </TabsBar>\n        </div>\n      </div>\n      <Page.Contents>\n        {/* Active tab */}\n        <TabContent className={styles.tabContent}>\n          <PluginDetailsSignature plugin={plugin} className={styles.alert} />\n          <PluginDetailsDisabledError plugin={plugin} className={styles.alert} />\n          <PluginDetailsBody queryParams={queryParams} plugin={plugin} pageId={pageId} />\n        </TabContent>\n      </Page.Contents>\n    </Page>\n  );\n}\n\nexport const getStyles = (theme: GrafanaTheme2) => {\n  return {\n    alert: css`\n      margin: ${theme.spacing(3)};\n      margin-bottom: 0;\n    `,\n    // Needed due to block formatting context\n    tabContent: css`\n      overflow: auto;\n    `,\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}