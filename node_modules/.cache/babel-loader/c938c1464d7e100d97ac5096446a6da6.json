{"ast":null,"code":"const _excluded = [\"position\", \"offset\", \"children\", \"allowPointerEvents\", \"className\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { css, cx } from '@emotion/css';\nimport React, { useState, useMemo, useRef, useLayoutEffect } from 'react';\nimport useWindowSize from 'react-use/lib/useWindowSize';\nimport { useStyles2 } from '../../themes';\nimport { getTooltipContainerStyles } from '../../themes/mixins';\nimport { calculateTooltipPosition } from './utils';\n/**\n * @public\n */\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\n/**\n * @public\n */\nexport const VizTooltipContainer = _ref => {\n  let {\n    position: {\n      x: positionX,\n      y: positionY\n    },\n    offset: {\n      x: offsetX,\n      y: offsetY\n    },\n    children,\n    allowPointerEvents = false,\n    className\n  } = _ref,\n      otherProps = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  const tooltipRef = useRef(null);\n  const [tooltipMeasurement, setTooltipMeasurement] = useState({\n    width: 0,\n    height: 0\n  });\n  const {\n    width,\n    height\n  } = useWindowSize();\n  const [placement, setPlacement] = useState({\n    x: positionX + offsetX,\n    y: positionY + offsetY\n  });\n  const resizeObserver = useMemo(() => // TS has hard time playing games with @types/resize-observer-browser, hence the ignore\n  // @ts-ignore\n  new ResizeObserver(entries => {\n    for (let entry of entries) {\n      const tW = Math.floor(entry.contentRect.width + 2 * 8); //  adding padding until Safari supports borderBoxSize\n\n      const tH = Math.floor(entry.contentRect.height + 2 * 8);\n\n      if (tooltipMeasurement.width !== tW || tooltipMeasurement.height !== tH) {\n        setTooltipMeasurement({\n          width: Math.min(tW, width),\n          height: Math.min(tH, height)\n        });\n      }\n    }\n  }), [tooltipMeasurement, width, height]);\n  useLayoutEffect(() => {\n    if (tooltipRef.current) {\n      resizeObserver.observe(tooltipRef.current);\n    }\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [resizeObserver]); // Make sure tooltip does not overflow window\n\n  useLayoutEffect(() => {\n    if (tooltipRef && tooltipRef.current) {\n      const {\n        x,\n        y\n      } = calculateTooltipPosition(positionX, positionY, tooltipMeasurement.width, tooltipMeasurement.height, offsetX, offsetY, width, height);\n      setPlacement({\n        x,\n        y\n      });\n    }\n  }, [width, height, positionX, offsetX, positionY, offsetY, tooltipMeasurement]);\n  const styles = useStyles2(getStyles);\n  return /*#__PURE__*/_jsx(\"div\", Object.assign({\n    ref: tooltipRef,\n    style: {\n      position: 'fixed',\n      left: 0,\n      // disabling pointer-events is to prevent the tooltip from flickering when moving left to right\n      // see e.g. https://github.com/grafana/grafana/pull/33609\n      pointerEvents: allowPointerEvents ? 'auto' : 'none',\n      top: 0,\n      transform: `translate(${placement.x}px, ${placement.y}px)`,\n      transition: 'transform ease-out 0.1s'\n    }\n  }, otherProps, {\n    className: cx(styles.wrapper, className),\n    children: children\n  }));\n};\nVizTooltipContainer.displayName = 'VizTooltipContainer';\n\nconst getStyles = theme => ({\n  wrapper: css`\n    ${getTooltipContainerStyles(theme)}\n  `\n});","map":{"version":3,"names":["css","cx","React","useState","useMemo","useRef","useLayoutEffect","useWindowSize","useStyles2","getTooltipContainerStyles","calculateTooltipPosition","VizTooltipContainer","position","x","positionX","y","positionY","offset","offsetX","offsetY","children","allowPointerEvents","className","otherProps","tooltipRef","tooltipMeasurement","setTooltipMeasurement","width","height","placement","setPlacement","resizeObserver","ResizeObserver","entries","entry","tW","Math","floor","contentRect","tH","min","current","observe","disconnect","styles","getStyles","left","pointerEvents","top","transform","transition","wrapper","displayName","theme"],"sources":["/home/soula/grafana/packages/grafana-ui/src/components/VizTooltip/VizTooltipContainer.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { useState, HTMLAttributes, useMemo, useRef, useLayoutEffect } from 'react';\nimport useWindowSize from 'react-use/lib/useWindowSize';\n\nimport { Dimensions2D, GrafanaTheme2 } from '@grafana/data';\n\nimport { useStyles2 } from '../../themes';\nimport { getTooltipContainerStyles } from '../../themes/mixins';\n\nimport { calculateTooltipPosition } from './utils';\n\n/**\n * @public\n */\nexport interface VizTooltipContainerProps extends HTMLAttributes<HTMLDivElement> {\n  position: { x: number; y: number };\n  offset: { x: number; y: number };\n  children?: React.ReactNode;\n  allowPointerEvents?: boolean;\n}\n\n/**\n * @public\n */\nexport const VizTooltipContainer: React.FC<VizTooltipContainerProps> = ({\n  position: { x: positionX, y: positionY },\n  offset: { x: offsetX, y: offsetY },\n  children,\n  allowPointerEvents = false,\n  className,\n  ...otherProps\n}) => {\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const [tooltipMeasurement, setTooltipMeasurement] = useState<Dimensions2D>({ width: 0, height: 0 });\n  const { width, height } = useWindowSize();\n  const [placement, setPlacement] = useState({\n    x: positionX + offsetX,\n    y: positionY + offsetY,\n  });\n\n  const resizeObserver = useMemo(\n    () =>\n      // TS has hard time playing games with @types/resize-observer-browser, hence the ignore\n      // @ts-ignore\n      new ResizeObserver((entries) => {\n        for (let entry of entries) {\n          const tW = Math.floor(entry.contentRect.width + 2 * 8); //  adding padding until Safari supports borderBoxSize\n          const tH = Math.floor(entry.contentRect.height + 2 * 8);\n          if (tooltipMeasurement.width !== tW || tooltipMeasurement.height !== tH) {\n            setTooltipMeasurement({\n              width: Math.min(tW, width),\n              height: Math.min(tH, height),\n            });\n          }\n        }\n      }),\n    [tooltipMeasurement, width, height]\n  );\n\n  useLayoutEffect(() => {\n    if (tooltipRef.current) {\n      resizeObserver.observe(tooltipRef.current);\n    }\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [resizeObserver]);\n\n  // Make sure tooltip does not overflow window\n  useLayoutEffect(() => {\n    if (tooltipRef && tooltipRef.current) {\n      const { x, y } = calculateTooltipPosition(\n        positionX,\n        positionY,\n        tooltipMeasurement.width,\n        tooltipMeasurement.height,\n        offsetX,\n        offsetY,\n        width,\n        height\n      );\n\n      setPlacement({ x, y });\n    }\n  }, [width, height, positionX, offsetX, positionY, offsetY, tooltipMeasurement]);\n\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div\n      ref={tooltipRef}\n      style={{\n        position: 'fixed',\n        left: 0,\n        // disabling pointer-events is to prevent the tooltip from flickering when moving left to right\n        // see e.g. https://github.com/grafana/grafana/pull/33609\n        pointerEvents: allowPointerEvents ? 'auto' : 'none',\n        top: 0,\n        transform: `translate(${placement.x}px, ${placement.y}px)`,\n        transition: 'transform ease-out 0.1s',\n      }}\n      {...otherProps}\n      className={cx(styles.wrapper, className)}\n    >\n      {children}\n    </div>\n  );\n};\n\nVizTooltipContainer.displayName = 'VizTooltipContainer';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css`\n    ${getTooltipContainerStyles(theme)}\n  `,\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}