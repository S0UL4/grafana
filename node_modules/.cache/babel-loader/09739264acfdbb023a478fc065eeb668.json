{"ast":null,"code":"var _ExportStartButton, _ExportStartButton2;\n\nimport { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { isLiveChannelMessageEvent, isLiveChannelStatusEvent, LiveChannelScope } from '@grafana/data';\nimport { getBackendSrv, getGrafanaLiveSrv } from '@grafana/runtime';\nimport { Button, useTheme2 } from '@grafana/ui';\nimport { ExportStartButton } from './ExportStartButton';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport const ExportStatus = () => {\n  const styles = getStyles(useTheme2());\n  const [status, setStatus] = useState();\n  useEffect(() => {\n    const subscription = getGrafanaLiveSrv().getStream({\n      scope: LiveChannelScope.Grafana,\n      namespace: 'broadcast',\n      path: 'export'\n    }).subscribe({\n      next: evt => {\n        if (isLiveChannelMessageEvent(evt)) {\n          setStatus(evt.message);\n        } else if (isLiveChannelStatusEvent(evt)) {\n          setStatus(evt.message);\n        }\n      }\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  if (!status) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      className: styles.wrap,\n      children: _ExportStartButton || (_ExportStartButton = /*#__PURE__*/_jsx(ExportStartButton, {}))\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.wrap,\n    children: [/*#__PURE__*/_jsx(\"pre\", {\n      children: JSON.stringify(status, null, 2)\n    }), Boolean(!status.running) && (_ExportStartButton2 || (_ExportStartButton2 = /*#__PURE__*/_jsx(ExportStartButton, {}))), Boolean(status.running) && /*#__PURE__*/_jsx(Button, {\n      variant: \"secondary\",\n      onClick: () => {\n        getBackendSrv().post('/api/admin/export/stop');\n      },\n      children: \"Stop\"\n    })]\n  });\n};\n\nconst getStyles = theme => {\n  return {\n    wrap: css`\n      border: 4px solid red;\n    `,\n    running: css`\n      border: 4px solid green;\n    `\n  };\n};","map":{"version":3,"names":["css","React","useEffect","useState","isLiveChannelMessageEvent","isLiveChannelStatusEvent","LiveChannelScope","getBackendSrv","getGrafanaLiveSrv","Button","useTheme2","ExportStartButton","ExportStatus","styles","getStyles","status","setStatus","subscription","getStream","scope","Grafana","namespace","path","subscribe","next","evt","message","unsubscribe","wrap","JSON","stringify","Boolean","running","post","theme"],"sources":["/home/soula/grafana/public/app/features/admin/ExportStatus.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2, isLiveChannelMessageEvent, isLiveChannelStatusEvent, LiveChannelScope } from '@grafana/data';\nimport { getBackendSrv, getGrafanaLiveSrv } from '@grafana/runtime';\nimport { Button, useTheme2 } from '@grafana/ui';\n\nimport { ExportStartButton } from './ExportStartButton';\n\ninterface ExportStatusMessage {\n  running: boolean;\n  target: string;\n  started: number;\n  finished: number;\n  update: number;\n  count: number;\n  current: number;\n  last: string;\n  status: string;\n}\n\nexport const ExportStatus = () => {\n  const styles = getStyles(useTheme2());\n  const [status, setStatus] = useState<ExportStatusMessage>();\n\n  useEffect(() => {\n    const subscription = getGrafanaLiveSrv()\n      .getStream<ExportStatusMessage>({\n        scope: LiveChannelScope.Grafana,\n        namespace: 'broadcast',\n        path: 'export',\n      })\n      .subscribe({\n        next: (evt) => {\n          if (isLiveChannelMessageEvent(evt)) {\n            setStatus(evt.message);\n          } else if (isLiveChannelStatusEvent(evt)) {\n            setStatus(evt.message);\n          }\n        },\n      });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  if (!status) {\n    return (\n      <div className={styles.wrap}>\n        <ExportStartButton />\n      </div>\n    );\n  }\n\n  return (\n    <div className={styles.wrap}>\n      <pre>{JSON.stringify(status, null, 2)}</pre>\n      {Boolean(!status.running) && <ExportStartButton />}\n      {Boolean(status.running) && (\n        <Button\n          variant=\"secondary\"\n          onClick={() => {\n            getBackendSrv().post('/api/admin/export/stop');\n          }}\n        >\n          Stop\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrap: css`\n      border: 4px solid red;\n    `,\n    running: css`\n      border: 4px solid green;\n    `,\n  };\n};\n"],"mappings":";;AAAA,SAASA,GAAT,QAAoB,cAApB;AACA,OAAOC,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AAEA,SAAwBC,yBAAxB,EAAmDC,wBAAnD,EAA6EC,gBAA7E,QAAqG,eAArG;AACA,SAASC,aAAT,EAAwBC,iBAAxB,QAAiD,kBAAjD;AACA,SAASC,MAAT,EAAiBC,SAAjB,QAAkC,aAAlC;AAEA,SAASC,iBAAT,QAAkC,qBAAlC;;;AAcA,OAAO,MAAMC,YAAY,GAAG,MAAM;EAChC,MAAMC,MAAM,GAAGC,SAAS,CAACJ,SAAS,EAAV,CAAxB;EACA,MAAM,CAACK,MAAD,EAASC,SAAT,IAAsBb,QAAQ,EAApC;EAEAD,SAAS,CAAC,MAAM;IACd,MAAMe,YAAY,GAAGT,iBAAiB,GACnCU,SADkB,CACa;MAC9BC,KAAK,EAAEb,gBAAgB,CAACc,OADM;MAE9BC,SAAS,EAAE,WAFmB;MAG9BC,IAAI,EAAE;IAHwB,CADb,EAMlBC,SANkB,CAMR;MACTC,IAAI,EAAGC,GAAD,IAAS;QACb,IAAIrB,yBAAyB,CAACqB,GAAD,CAA7B,EAAoC;UAClCT,SAAS,CAACS,GAAG,CAACC,OAAL,CAAT;QACD,CAFD,MAEO,IAAIrB,wBAAwB,CAACoB,GAAD,CAA5B,EAAmC;UACxCT,SAAS,CAACS,GAAG,CAACC,OAAL,CAAT;QACD;MACF;IAPQ,CANQ,CAArB;IAeA,OAAO,MAAM;MACXT,YAAY,CAACU,WAAb;IACD,CAFD;EAGD,CAnBQ,EAmBN,EAnBM,CAAT;;EAqBA,IAAI,CAACZ,MAAL,EAAa;IACX,oBACE;MAAK,SAAS,EAAEF,MAAM,CAACe,IAAvB;MAAA,mEACE,KAAC,iBAAD,KADF;IAAA,EADF;EAKD;;EAED,oBACE;IAAK,SAAS,EAAEf,MAAM,CAACe,IAAvB;IAAA,wBACE;MAAA,UAAMC,IAAI,CAACC,SAAL,CAAef,MAAf,EAAuB,IAAvB,EAA6B,CAA7B;IAAN,EADF,EAEGgB,OAAO,CAAC,CAAChB,MAAM,CAACiB,OAAT,CAAP,gEAA4B,KAAC,iBAAD,KAA5B,EAFH,EAGGD,OAAO,CAAChB,MAAM,CAACiB,OAAR,CAAP,iBACC,KAAC,MAAD;MACE,OAAO,EAAC,WADV;MAEE,OAAO,EAAE,MAAM;QACbzB,aAAa,GAAG0B,IAAhB,CAAqB,wBAArB;MACD,CAJH;MAAA;IAAA,EAJJ;EAAA,EADF;AAgBD,CAjDM;;AAmDP,MAAMnB,SAAS,GAAIoB,KAAD,IAA0B;EAC1C,OAAO;IACLN,IAAI,EAAE5B,GAAI;AACd;AACA,KAHS;IAILgC,OAAO,EAAEhC,GAAI;AACjB;AACA;EANS,CAAP;AAQD,CATD"},"metadata":{},"sourceType":"module"}