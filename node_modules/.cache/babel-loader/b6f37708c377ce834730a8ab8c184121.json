{"ast":null,"code":"import React, { useMemo } from 'react';\nimport { Select } from '@grafana/ui';\nimport { getAggregationOptionsByMetric } from '../functions';\nimport { QueryEditorField } from '.';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport const Aggregation = props => {\n  const aggOptions = useAggregationOptionsByMetric(props);\n  const selected = useSelectedFromOptions(aggOptions, props);\n  return /*#__PURE__*/_jsx(QueryEditorField, {\n    labelWidth: 18,\n    label: \"Group by function\",\n    \"data-testid\": \"cloud-monitoring-aggregation\",\n    htmlFor: `${props.refId}-group-by-function`,\n    children: /*#__PURE__*/_jsx(Select, {\n      width: 16,\n      onChange: ({\n        value\n      }) => props.onChange(value),\n      value: selected,\n      options: [{\n        label: 'Template Variables',\n        options: props.templateVariableOptions\n      }, {\n        label: 'Aggregations',\n        expanded: true,\n        options: aggOptions\n      }],\n      placeholder: \"Select Reducer\",\n      inputId: `${props.refId}-group-by-function`\n    })\n  });\n};\n\nconst useAggregationOptionsByMetric = ({\n  metricDescriptor\n}) => {\n  const valueType = metricDescriptor === null || metricDescriptor === void 0 ? void 0 : metricDescriptor.valueType;\n  const metricKind = metricDescriptor === null || metricDescriptor === void 0 ? void 0 : metricDescriptor.metricKind;\n  return useMemo(() => {\n    if (!valueType || !metricKind) {\n      return [];\n    }\n\n    return getAggregationOptionsByMetric(valueType, metricKind).map(a => Object.assign({}, a, {\n      label: a.text\n    }));\n  }, [valueType, metricKind]);\n};\n\nconst useSelectedFromOptions = (aggOptions, props) => {\n  return useMemo(() => {\n    const allOptions = [...aggOptions, ...props.templateVariableOptions];\n    return allOptions.find(s => s.value === props.crossSeriesReducer);\n  }, [aggOptions, props.crossSeriesReducer, props.templateVariableOptions]);\n};","map":{"version":3,"names":["React","useMemo","Select","getAggregationOptionsByMetric","QueryEditorField","Aggregation","props","aggOptions","useAggregationOptionsByMetric","selected","useSelectedFromOptions","refId","value","onChange","label","options","templateVariableOptions","expanded","metricDescriptor","valueType","metricKind","map","a","text","allOptions","find","s","crossSeriesReducer"],"sources":["/home/soula/grafana/public/app/plugins/datasource/cloud-monitoring/components/Aggregation.tsx"],"sourcesContent":["import React, { FC, useMemo } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { Select } from '@grafana/ui';\n\nimport { getAggregationOptionsByMetric } from '../functions';\nimport { MetricDescriptor, MetricKind, ValueTypes } from '../types';\n\nimport { QueryEditorField } from '.';\n\nexport interface Props {\n  refId: string;\n  onChange: (metricDescriptor: string) => void;\n  metricDescriptor?: MetricDescriptor;\n  crossSeriesReducer: string;\n  groupBys: string[];\n  templateVariableOptions: Array<SelectableValue<string>>;\n}\n\nexport const Aggregation: FC<Props> = (props) => {\n  const aggOptions = useAggregationOptionsByMetric(props);\n  const selected = useSelectedFromOptions(aggOptions, props);\n\n  return (\n    <QueryEditorField\n      labelWidth={18}\n      label=\"Group by function\"\n      data-testid=\"cloud-monitoring-aggregation\"\n      htmlFor={`${props.refId}-group-by-function`}\n    >\n      <Select\n        width={16}\n        onChange={({ value }) => props.onChange(value!)}\n        value={selected}\n        options={[\n          {\n            label: 'Template Variables',\n            options: props.templateVariableOptions,\n          },\n          {\n            label: 'Aggregations',\n            expanded: true,\n            options: aggOptions,\n          },\n        ]}\n        placeholder=\"Select Reducer\"\n        inputId={`${props.refId}-group-by-function`}\n      />\n    </QueryEditorField>\n  );\n};\n\nconst useAggregationOptionsByMetric = ({ metricDescriptor }: Props): Array<SelectableValue<string>> => {\n  const valueType = metricDescriptor?.valueType;\n  const metricKind = metricDescriptor?.metricKind;\n\n  return useMemo(() => {\n    if (!valueType || !metricKind) {\n      return [];\n    }\n\n    return getAggregationOptionsByMetric(valueType as ValueTypes, metricKind as MetricKind).map((a) => ({\n      ...a,\n      label: a.text,\n    }));\n  }, [valueType, metricKind]);\n};\n\nconst useSelectedFromOptions = (aggOptions: Array<SelectableValue<string>>, props: Props) => {\n  return useMemo(() => {\n    const allOptions = [...aggOptions, ...props.templateVariableOptions];\n    return allOptions.find((s) => s.value === props.crossSeriesReducer);\n  }, [aggOptions, props.crossSeriesReducer, props.templateVariableOptions]);\n};\n"],"mappings":"AAAA,OAAOA,KAAP,IAAoBC,OAApB,QAAmC,OAAnC;AAGA,SAASC,MAAT,QAAuB,aAAvB;AAEA,SAASC,6BAAT,QAA8C,cAA9C;AAGA,SAASC,gBAAT,QAAiC,GAAjC;;AAWA,OAAO,MAAMC,WAAsB,GAAIC,KAAD,IAAW;EAC/C,MAAMC,UAAU,GAAGC,6BAA6B,CAACF,KAAD,CAAhD;EACA,MAAMG,QAAQ,GAAGC,sBAAsB,CAACH,UAAD,EAAaD,KAAb,CAAvC;EAEA,oBACE,KAAC,gBAAD;IACE,UAAU,EAAE,EADd;IAEE,KAAK,EAAC,mBAFR;IAGE,eAAY,8BAHd;IAIE,OAAO,EAAG,GAAEA,KAAK,CAACK,KAAM,oBAJ1B;IAAA,uBAME,KAAC,MAAD;MACE,KAAK,EAAE,EADT;MAEE,QAAQ,EAAE,CAAC;QAAEC;MAAF,CAAD,KAAeN,KAAK,CAACO,QAAN,CAAeD,KAAf,CAF3B;MAGE,KAAK,EAAEH,QAHT;MAIE,OAAO,EAAE,CACP;QACEK,KAAK,EAAE,oBADT;QAEEC,OAAO,EAAET,KAAK,CAACU;MAFjB,CADO,EAKP;QACEF,KAAK,EAAE,cADT;QAEEG,QAAQ,EAAE,IAFZ;QAGEF,OAAO,EAAER;MAHX,CALO,CAJX;MAeE,WAAW,EAAC,gBAfd;MAgBE,OAAO,EAAG,GAAED,KAAK,CAACK,KAAM;IAhB1B;EANF,EADF;AA2BD,CA/BM;;AAiCP,MAAMH,6BAA6B,GAAG,CAAC;EAAEU;AAAF,CAAD,KAAiE;EACrG,MAAMC,SAAS,GAAGD,gBAAH,aAAGA,gBAAH,uBAAGA,gBAAgB,CAAEC,SAApC;EACA,MAAMC,UAAU,GAAGF,gBAAH,aAAGA,gBAAH,uBAAGA,gBAAgB,CAAEE,UAArC;EAEA,OAAOnB,OAAO,CAAC,MAAM;IACnB,IAAI,CAACkB,SAAD,IAAc,CAACC,UAAnB,EAA+B;MAC7B,OAAO,EAAP;IACD;;IAED,OAAOjB,6BAA6B,CAACgB,SAAD,EAA0BC,UAA1B,CAA7B,CAAiFC,GAAjF,CAAsFC,CAAD,sBACvFA,CADuF;MAE1FR,KAAK,EAAEQ,CAAC,CAACC;IAFiF,EAArF,CAAP;EAID,CATa,EASX,CAACJ,SAAD,EAAYC,UAAZ,CATW,CAAd;AAUD,CAdD;;AAgBA,MAAMV,sBAAsB,GAAG,CAACH,UAAD,EAA6CD,KAA7C,KAA8D;EAC3F,OAAOL,OAAO,CAAC,MAAM;IACnB,MAAMuB,UAAU,GAAG,CAAC,GAAGjB,UAAJ,EAAgB,GAAGD,KAAK,CAACU,uBAAzB,CAAnB;IACA,OAAOQ,UAAU,CAACC,IAAX,CAAiBC,CAAD,IAAOA,CAAC,CAACd,KAAF,KAAYN,KAAK,CAACqB,kBAAzC,CAAP;EACD,CAHa,EAGX,CAACpB,UAAD,EAAaD,KAAK,CAACqB,kBAAnB,EAAuCrB,KAAK,CAACU,uBAA7C,CAHW,CAAd;AAID,CALD"},"metadata":{},"sourceType":"module"}