{"ast":null,"code":"import { Feature } from 'ol';\nimport VectorSource from 'ol/source/Vector';\nimport { getGeometryField } from './location';\nexport class FrameVectorSource extends VectorSource {\n  constructor(location) {\n    super({});\n    this.location = location;\n  }\n\n  update(frame) {\n    this.clear(true);\n    const info = getGeometryField(frame, this.location);\n\n    if (!info.field) {\n      this.changed();\n      return;\n    }\n\n    for (let i = 0; i < frame.length; i++) {\n      this.addFeatureInternal(new Feature({\n        frame,\n        rowIndex: i,\n        geometry: info.field.values.get(i)\n      }));\n    } // only call this at the end\n\n\n    this.changed();\n  }\n\n}","map":{"version":3,"names":["Feature","VectorSource","getGeometryField","FrameVectorSource","constructor","location","update","frame","clear","info","field","changed","i","length","addFeatureInternal","rowIndex","geometry","values","get"],"sources":["/home/soula/grafana/public/app/features/geo/utils/frameVectorSource.ts"],"sourcesContent":["import { Feature } from 'ol';\nimport { Geometry } from 'ol/geom';\nimport VectorSource from 'ol/source/Vector';\n\nimport { DataFrame } from '@grafana/data';\n\nimport { getGeometryField, LocationFieldMatchers } from './location';\n\nexport interface FrameVectorSourceOptions {}\n\nexport class FrameVectorSource<T extends Geometry = Geometry> extends VectorSource<T> {\n  constructor(private location: LocationFieldMatchers) {\n    super({});\n  }\n\n  update(frame: DataFrame) {\n    this.clear(true);\n    const info = getGeometryField(frame, this.location);\n    if (!info.field) {\n      this.changed();\n      return;\n    }\n\n    for (let i = 0; i < frame.length; i++) {\n      this.addFeatureInternal(\n        new Feature({\n          frame,\n          rowIndex: i,\n          geometry: info.field.values.get(i) as T,\n        })\n      );\n    }\n\n    // only call this at the end\n    this.changed();\n  }\n}\n"],"mappings":"AAAA,SAASA,OAAT,QAAwB,IAAxB;AAEA,OAAOC,YAAP,MAAyB,kBAAzB;AAIA,SAASC,gBAAT,QAAwD,YAAxD;AAIA,OAAO,MAAMC,iBAAN,SAA+DF,YAA/D,CAA+E;EACpFG,WAAW,CAASC,QAAT,EAA0C;IACnD,MAAM,EAAN;IADmD,KAAjCA,QAAiC,GAAjCA,QAAiC;EAEpD;;EAEDC,MAAM,CAACC,KAAD,EAAmB;IACvB,KAAKC,KAAL,CAAW,IAAX;IACA,MAAMC,IAAI,GAAGP,gBAAgB,CAACK,KAAD,EAAQ,KAAKF,QAAb,CAA7B;;IACA,IAAI,CAACI,IAAI,CAACC,KAAV,EAAiB;MACf,KAAKC,OAAL;MACA;IACD;;IAED,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,KAAK,CAACM,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;MACrC,KAAKE,kBAAL,CACE,IAAId,OAAJ,CAAY;QACVO,KADU;QAEVQ,QAAQ,EAAEH,CAFA;QAGVI,QAAQ,EAAEP,IAAI,CAACC,KAAL,CAAWO,MAAX,CAAkBC,GAAlB,CAAsBN,CAAtB;MAHA,CAAZ,CADF;IAOD,CAhBsB,CAkBvB;;;IACA,KAAKD,OAAL;EACD;;AAzBmF"},"metadata":{},"sourceType":"module"}