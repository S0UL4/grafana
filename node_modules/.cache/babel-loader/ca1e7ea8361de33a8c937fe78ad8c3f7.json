{"ast":null,"code":"import { GeometryCollection, LineString, Point } from 'ol/geom';\nimport { fromLonLat } from 'ol/proj';\nimport { ArrayVector, FieldType } from '@grafana/data';\nimport { getCenterPoint } from 'app/features/transformers/spatial/utils';\nimport { decodeGeohash } from './geohash';\nexport function pointFieldFromGeohash(geohash) {\n  var _geohash$name;\n\n  return {\n    name: (_geohash$name = geohash.name) !== null && _geohash$name !== void 0 ? _geohash$name : 'Point',\n    type: FieldType.geo,\n    values: new ArrayVector(geohash.values.toArray().map(v => {\n      const coords = decodeGeohash(v);\n\n      if (coords) {\n        return new Point(fromLonLat(coords));\n      }\n\n      return undefined;\n    })),\n    config: hiddenTooltipField\n  };\n}\nexport function pointFieldFromLonLat(lon, lat) {\n  const buffer = new Array(lon.values.length);\n\n  for (let i = 0; i < lon.values.length; i++) {\n    buffer[i] = new Point(fromLonLat([lon.values.get(i), lat.values.get(i)]));\n  }\n\n  return {\n    name: 'Point',\n    type: FieldType.geo,\n    values: new ArrayVector(buffer),\n    config: hiddenTooltipField\n  };\n}\nexport function getGeoFieldFromGazetteer(gaz, field) {\n  const count = field.values.length;\n  const geo = new Array(count);\n\n  for (let i = 0; i < count; i++) {\n    var _gaz$find;\n\n    geo[i] = (_gaz$find = gaz.find(field.values.get(i))) === null || _gaz$find === void 0 ? void 0 : _gaz$find.geometry();\n  }\n\n  return {\n    name: 'Geometry',\n    type: FieldType.geo,\n    values: new ArrayVector(geo),\n    config: hiddenTooltipField\n  };\n}\nexport function createGeometryCollection(src, dest) {\n  const v0 = src.values.toArray();\n  const v1 = dest.values.toArray();\n\n  if (!v0 || !v1) {\n    throw 'missing src/dest';\n  }\n\n  if (v0.length !== v1.length) {\n    throw 'Source and destination field lengths do not match';\n  }\n\n  const count = src.values.length;\n  const geo = new Array(count);\n\n  for (let i = 0; i < count; i++) {\n    const a = v0[i];\n    const b = v1[i];\n\n    if (a && b) {\n      geo[i] = new GeometryCollection([a, b]);\n    } else if (a) {\n      geo[i] = a;\n    } else if (b) {\n      geo[i] = b;\n    }\n  }\n\n  return {\n    name: 'Geometry',\n    type: FieldType.geo,\n    values: new ArrayVector(geo),\n    config: hiddenTooltipField\n  };\n}\nexport function createLineBetween(src, dest) {\n  const v0 = src.values.toArray();\n  const v1 = dest.values.toArray();\n\n  if (!v0 || !v1) {\n    throw 'missing src/dest';\n  }\n\n  if (v0.length !== v1.length) {\n    throw 'Source and destination field lengths do not match';\n  }\n\n  const count = src.values.length;\n  const geo = new Array(count);\n\n  for (let i = 0; i < count; i++) {\n    const a = v0[i];\n    const b = v1[i];\n\n    if (a && b) {\n      geo[i] = new LineString([getCenterPoint(a), getCenterPoint(b)]);\n    }\n  }\n\n  return {\n    name: 'Geometry',\n    type: FieldType.geo,\n    values: new ArrayVector(geo),\n    config: hiddenTooltipField\n  };\n}\nconst hiddenTooltipField = Object.freeze({\n  custom: {\n    hideFrom: {\n      tooltip: true\n    }\n  }\n});","map":{"version":3,"names":["GeometryCollection","LineString","Point","fromLonLat","ArrayVector","FieldType","getCenterPoint","decodeGeohash","pointFieldFromGeohash","geohash","name","type","geo","values","toArray","map","v","coords","undefined","config","hiddenTooltipField","pointFieldFromLonLat","lon","lat","buffer","Array","length","i","get","getGeoFieldFromGazetteer","gaz","field","count","find","geometry","createGeometryCollection","src","dest","v0","v1","a","b","createLineBetween","Object","freeze","custom","hideFrom","tooltip"],"sources":["/home/soula/grafana/public/app/features/geo/format/utils.ts"],"sourcesContent":["import { Geometry, GeometryCollection, LineString, Point } from 'ol/geom';\nimport { fromLonLat } from 'ol/proj';\n\nimport { ArrayVector, Field, FieldConfig, FieldType } from '@grafana/data';\nimport { getCenterPoint } from 'app/features/transformers/spatial/utils';\n\nimport { Gazetteer } from '../gazetteer/gazetteer';\n\nimport { decodeGeohash } from './geohash';\n\nexport function pointFieldFromGeohash(geohash: Field<string>): Field<Point> {\n  return {\n    name: geohash.name ?? 'Point',\n    type: FieldType.geo,\n    values: new ArrayVector<any>(\n      geohash.values.toArray().map((v) => {\n        const coords = decodeGeohash(v);\n        if (coords) {\n          return new Point(fromLonLat(coords));\n        }\n        return undefined;\n      })\n    ),\n    config: hiddenTooltipField,\n  };\n}\n\nexport function pointFieldFromLonLat(lon: Field, lat: Field): Field<Point> {\n  const buffer = new Array<Point>(lon.values.length);\n  for (let i = 0; i < lon.values.length; i++) {\n    buffer[i] = new Point(fromLonLat([lon.values.get(i), lat.values.get(i)]));\n  }\n\n  return {\n    name: 'Point',\n    type: FieldType.geo,\n    values: new ArrayVector(buffer),\n    config: hiddenTooltipField,\n  };\n}\n\nexport function getGeoFieldFromGazetteer(gaz: Gazetteer, field: Field<string>): Field<Geometry | undefined> {\n  const count = field.values.length;\n  const geo = new Array<Geometry | undefined>(count);\n  for (let i = 0; i < count; i++) {\n    geo[i] = gaz.find(field.values.get(i))?.geometry();\n  }\n  return {\n    name: 'Geometry',\n    type: FieldType.geo,\n    values: new ArrayVector(geo),\n    config: hiddenTooltipField,\n  };\n}\n\nexport function createGeometryCollection(\n  src: Field<Geometry | undefined>,\n  dest: Field<Geometry | undefined>\n): Field<Geometry | undefined> {\n  const v0 = src.values.toArray();\n  const v1 = dest.values.toArray();\n  if (!v0 || !v1) {\n    throw 'missing src/dest';\n  }\n  if (v0.length !== v1.length) {\n    throw 'Source and destination field lengths do not match';\n  }\n\n  const count = src.values.length!;\n  const geo = new Array<Geometry | undefined>(count);\n  for (let i = 0; i < count; i++) {\n    const a = v0[i];\n    const b = v1[i];\n    if (a && b) {\n      geo[i] = new GeometryCollection([a, b]);\n    } else if (a) {\n      geo[i] = a;\n    } else if (b) {\n      geo[i] = b;\n    }\n  }\n  return {\n    name: 'Geometry',\n    type: FieldType.geo,\n    values: new ArrayVector(geo),\n    config: hiddenTooltipField,\n  };\n}\n\nexport function createLineBetween(\n  src: Field<Geometry | undefined>,\n  dest: Field<Geometry | undefined>\n): Field<Geometry | undefined> {\n  const v0 = src.values.toArray();\n  const v1 = dest.values.toArray();\n  if (!v0 || !v1) {\n    throw 'missing src/dest';\n  }\n  if (v0.length !== v1.length) {\n    throw 'Source and destination field lengths do not match';\n  }\n\n  const count = src.values.length!;\n  const geo = new Array<Geometry | undefined>(count);\n  for (let i = 0; i < count; i++) {\n    const a = v0[i];\n    const b = v1[i];\n    if (a && b) {\n      geo[i] = new LineString([getCenterPoint(a), getCenterPoint(b)]);\n    }\n  }\n  return {\n    name: 'Geometry',\n    type: FieldType.geo,\n    values: new ArrayVector(geo),\n    config: hiddenTooltipField,\n  };\n}\n\nconst hiddenTooltipField: FieldConfig = Object.freeze({\n  custom: {\n    hideFrom: { tooltip: true },\n  },\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}