{"ast":null,"code":"import React, { useCallback, useRef } from 'react';\nimport { CodeEditor } from '@grafana/ui';\nimport language from '../metric-math/definition';\nimport { TRIGGER_SUGGEST } from '../monarch/commands';\nimport { registerLanguage } from '../monarch/register';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport function MathExpressionQueryField({\n  expression: query,\n  onChange,\n  onRunQuery,\n  datasource\n}) {\n  const containerRef = useRef(null);\n  const onEditorMount = useCallback((editor, monaco) => {\n    editor.onDidFocusEditorText(() => editor.trigger(TRIGGER_SUGGEST.id, TRIGGER_SUGGEST.id, {}));\n    editor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {\n      const text = editor.getValue();\n      onChange(text);\n      onRunQuery();\n    }); // auto resizes the editor to be the height of the content it holds\n    // this code comes from the Prometheus query editor.\n    // We may wish to consider abstracting it into the grafana/ui repo in the future\n\n    const updateElementHeight = () => {\n      const containerDiv = containerRef.current;\n\n      if (containerDiv !== null && editor.getContentHeight() < 200) {\n        const pixelHeight = Math.max(32, editor.getContentHeight());\n        containerDiv.style.height = `${pixelHeight}px`;\n        containerDiv.style.width = '100%';\n        const pixelWidth = containerDiv.clientWidth;\n        editor.layout({\n          width: pixelWidth,\n          height: pixelHeight\n        });\n      }\n    };\n\n    editor.onDidContentSizeChange(updateElementHeight);\n    updateElementHeight();\n  }, [onChange, onRunQuery]);\n  return /*#__PURE__*/_jsx(\"div\", {\n    ref: containerRef,\n    children: /*#__PURE__*/_jsx(CodeEditor, {\n      monacoOptions: {\n        // without this setting, the auto-resize functionality causes an infinite loop, don't remove it!\n        scrollBeyondLastLine: false,\n        // These additional options are style focused and are a subset of those in the query editor in Prometheus\n        fontSize: 14,\n        lineNumbers: 'off',\n        renderLineHighlight: 'none',\n        scrollbar: {\n          vertical: 'hidden',\n          horizontal: 'hidden'\n        },\n        suggestFontSize: 12,\n        wordWrap: 'on',\n        padding: {\n          top: 6\n        }\n      },\n      language: language.id,\n      value: query,\n      onBlur: value => {\n        if (value !== query) {\n          onChange(value);\n          onRunQuery();\n        }\n      },\n      onBeforeEditorMount: monaco => registerLanguage(monaco, language, datasource.metricMathCompletionItemProvider),\n      onEditorDidMount: onEditorMount\n    })\n  });\n}","map":{"version":3,"names":["React","useCallback","useRef","CodeEditor","language","TRIGGER_SUGGEST","registerLanguage","MathExpressionQueryField","expression","query","onChange","onRunQuery","datasource","containerRef","onEditorMount","editor","monaco","onDidFocusEditorText","trigger","id","addCommand","KeyMod","Shift","KeyCode","Enter","text","getValue","updateElementHeight","containerDiv","current","getContentHeight","pixelHeight","Math","max","style","height","width","pixelWidth","clientWidth","layout","onDidContentSizeChange","scrollBeyondLastLine","fontSize","lineNumbers","renderLineHighlight","scrollbar","vertical","horizontal","suggestFontSize","wordWrap","padding","top","value","metricMathCompletionItemProvider"],"sources":["/home/soula/grafana/public/app/plugins/datasource/cloudwatch/components/MathExpressionQueryField.tsx"],"sourcesContent":["import type * as monacoType from 'monaco-editor/esm/vs/editor/editor.api';\nimport React, { useCallback, useRef } from 'react';\n\nimport { CodeEditor, Monaco } from '@grafana/ui';\n\nimport { CloudWatchDatasource } from '../datasource';\nimport language from '../metric-math/definition';\nimport { TRIGGER_SUGGEST } from '../monarch/commands';\nimport { registerLanguage } from '../monarch/register';\n\nexport interface Props {\n  onChange: (query: string) => void;\n  onRunQuery: () => void;\n  expression: string;\n  datasource: CloudWatchDatasource;\n}\n\nexport function MathExpressionQueryField({\n  expression: query,\n  onChange,\n  onRunQuery,\n  datasource,\n}: React.PropsWithChildren<Props>) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const onEditorMount = useCallback(\n    (editor: monacoType.editor.IStandaloneCodeEditor, monaco: Monaco) => {\n      editor.onDidFocusEditorText(() => editor.trigger(TRIGGER_SUGGEST.id, TRIGGER_SUGGEST.id, {}));\n      editor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {\n        const text = editor.getValue();\n        onChange(text);\n        onRunQuery();\n      });\n\n      // auto resizes the editor to be the height of the content it holds\n      // this code comes from the Prometheus query editor.\n      // We may wish to consider abstracting it into the grafana/ui repo in the future\n      const updateElementHeight = () => {\n        const containerDiv = containerRef.current;\n        if (containerDiv !== null && editor.getContentHeight() < 200) {\n          const pixelHeight = Math.max(32, editor.getContentHeight());\n          containerDiv.style.height = `${pixelHeight}px`;\n          containerDiv.style.width = '100%';\n          const pixelWidth = containerDiv.clientWidth;\n          editor.layout({ width: pixelWidth, height: pixelHeight });\n        }\n      };\n\n      editor.onDidContentSizeChange(updateElementHeight);\n      updateElementHeight();\n    },\n    [onChange, onRunQuery]\n  );\n\n  return (\n    <div ref={containerRef}>\n      <CodeEditor\n        monacoOptions={{\n          // without this setting, the auto-resize functionality causes an infinite loop, don't remove it!\n          scrollBeyondLastLine: false,\n\n          // These additional options are style focused and are a subset of those in the query editor in Prometheus\n          fontSize: 14,\n          lineNumbers: 'off',\n          renderLineHighlight: 'none',\n          scrollbar: {\n            vertical: 'hidden',\n            horizontal: 'hidden',\n          },\n          suggestFontSize: 12,\n          wordWrap: 'on',\n          padding: {\n            top: 6,\n          },\n        }}\n        language={language.id}\n        value={query}\n        onBlur={(value) => {\n          if (value !== query) {\n            onChange(value);\n            onRunQuery();\n          }\n        }}\n        onBeforeEditorMount={(monaco: Monaco) =>\n          registerLanguage(monaco, language, datasource.metricMathCompletionItemProvider)\n        }\n        onEditorDidMount={onEditorMount}\n      />\n    </div>\n  );\n}\n"],"mappings":"AACA,OAAOA,KAAP,IAAgBC,WAAhB,EAA6BC,MAA7B,QAA2C,OAA3C;AAEA,SAASC,UAAT,QAAmC,aAAnC;AAGA,OAAOC,QAAP,MAAqB,2BAArB;AACA,SAASC,eAAT,QAAgC,qBAAhC;AACA,SAASC,gBAAT,QAAiC,qBAAjC;;AASA,OAAO,SAASC,wBAAT,CAAkC;EACvCC,UAAU,EAAEC,KAD2B;EAEvCC,QAFuC;EAGvCC,UAHuC;EAIvCC;AAJuC,CAAlC,EAK4B;EACjC,MAAMC,YAAY,GAAGX,MAAM,CAAiB,IAAjB,CAA3B;EACA,MAAMY,aAAa,GAAGb,WAAW,CAC/B,CAACc,MAAD,EAAkDC,MAAlD,KAAqE;IACnED,MAAM,CAACE,oBAAP,CAA4B,MAAMF,MAAM,CAACG,OAAP,CAAeb,eAAe,CAACc,EAA/B,EAAmCd,eAAe,CAACc,EAAnD,EAAuD,EAAvD,CAAlC;IACAJ,MAAM,CAACK,UAAP,CAAkBJ,MAAM,CAACK,MAAP,CAAcC,KAAd,GAAsBN,MAAM,CAACO,OAAP,CAAeC,KAAvD,EAA8D,MAAM;MAClE,MAAMC,IAAI,GAAGV,MAAM,CAACW,QAAP,EAAb;MACAhB,QAAQ,CAACe,IAAD,CAAR;MACAd,UAAU;IACX,CAJD,EAFmE,CAQnE;IACA;IACA;;IACA,MAAMgB,mBAAmB,GAAG,MAAM;MAChC,MAAMC,YAAY,GAAGf,YAAY,CAACgB,OAAlC;;MACA,IAAID,YAAY,KAAK,IAAjB,IAAyBb,MAAM,CAACe,gBAAP,KAA4B,GAAzD,EAA8D;QAC5D,MAAMC,WAAW,GAAGC,IAAI,CAACC,GAAL,CAAS,EAAT,EAAalB,MAAM,CAACe,gBAAP,EAAb,CAApB;QACAF,YAAY,CAACM,KAAb,CAAmBC,MAAnB,GAA6B,GAAEJ,WAAY,IAA3C;QACAH,YAAY,CAACM,KAAb,CAAmBE,KAAnB,GAA2B,MAA3B;QACA,MAAMC,UAAU,GAAGT,YAAY,CAACU,WAAhC;QACAvB,MAAM,CAACwB,MAAP,CAAc;UAAEH,KAAK,EAAEC,UAAT;UAAqBF,MAAM,EAAEJ;QAA7B,CAAd;MACD;IACF,CATD;;IAWAhB,MAAM,CAACyB,sBAAP,CAA8Bb,mBAA9B;IACAA,mBAAmB;EACpB,CAzB8B,EA0B/B,CAACjB,QAAD,EAAWC,UAAX,CA1B+B,CAAjC;EA6BA,oBACE;IAAK,GAAG,EAAEE,YAAV;IAAA,uBACE,KAAC,UAAD;MACE,aAAa,EAAE;QACb;QACA4B,oBAAoB,EAAE,KAFT;QAIb;QACAC,QAAQ,EAAE,EALG;QAMbC,WAAW,EAAE,KANA;QAObC,mBAAmB,EAAE,MAPR;QAQbC,SAAS,EAAE;UACTC,QAAQ,EAAE,QADD;UAETC,UAAU,EAAE;QAFH,CARE;QAYbC,eAAe,EAAE,EAZJ;QAabC,QAAQ,EAAE,IAbG;QAcbC,OAAO,EAAE;UACPC,GAAG,EAAE;QADE;MAdI,CADjB;MAmBE,QAAQ,EAAE/C,QAAQ,CAACe,EAnBrB;MAoBE,KAAK,EAAEV,KApBT;MAqBE,MAAM,EAAG2C,KAAD,IAAW;QACjB,IAAIA,KAAK,KAAK3C,KAAd,EAAqB;UACnBC,QAAQ,CAAC0C,KAAD,CAAR;UACAzC,UAAU;QACX;MACF,CA1BH;MA2BE,mBAAmB,EAAGK,MAAD,IACnBV,gBAAgB,CAACU,MAAD,EAASZ,QAAT,EAAmBQ,UAAU,CAACyC,gCAA9B,CA5BpB;MA8BE,gBAAgB,EAAEvC;IA9BpB;EADF,EADF;AAoCD"},"metadata":{},"sourceType":"module"}