{"ast":null,"code":"import { from, merge, of, Subscription, timer } from 'rxjs';\nimport { catchError, finalize, mapTo, mergeMap, share, takeUntil } from 'rxjs/operators';\nimport { deleteLibraryPanel as apiDeleteLibraryPanel, getLibraryPanels } from '../../state/api';\nimport { initialLibraryPanelsViewState, initSearch, searchCompleted } from './reducer';\nexport function searchForLibraryPanels(args) {\n  return function (dispatch) {\n    const subscription = new Subscription();\n    const dataObservable = from(getLibraryPanels({\n      searchString: args.searchString,\n      perPage: args.perPage,\n      page: args.page,\n      excludeUid: args.currentPanelId,\n      sortDirection: args.sortDirection,\n      typeFilter: args.panelFilter,\n      folderFilter: args.folderFilter\n    })).pipe(mergeMap(({\n      perPage,\n      elements: libraryPanels,\n      page,\n      totalCount\n    }) => of(searchCompleted({\n      libraryPanels,\n      page,\n      perPage,\n      totalCount\n    }))), catchError(err => {\n      console.error(err);\n      return of(searchCompleted(Object.assign({}, initialLibraryPanelsViewState, {\n        page: args.page,\n        perPage: args.perPage\n      })));\n    }), finalize(() => subscription.unsubscribe()), // make sure we unsubscribe\n    share());\n    subscription.add( // If 50ms without a response dispatch a loading state\n    // mapTo will translate the timer event into a loading state\n    // takeUntil will cancel the timer emit when first response is received on the dataObservable\n    merge(timer(50).pipe(mapTo(initSearch()), takeUntil(dataObservable)), dataObservable).subscribe(dispatch));\n  };\n}\nexport function deleteLibraryPanel(uid, args) {\n  return async function (dispatch) {\n    try {\n      await apiDeleteLibraryPanel(uid);\n      searchForLibraryPanels(args)(dispatch);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n}\nexport function asyncDispatcher(dispatch) {\n  return function (action) {\n    if (action instanceof Function) {\n      return action(dispatch);\n    }\n\n    return dispatch(action);\n  };\n}","map":{"version":3,"names":["from","merge","of","Subscription","timer","catchError","finalize","mapTo","mergeMap","share","takeUntil","deleteLibraryPanel","apiDeleteLibraryPanel","getLibraryPanels","initialLibraryPanelsViewState","initSearch","searchCompleted","searchForLibraryPanels","args","dispatch","subscription","dataObservable","searchString","perPage","page","excludeUid","currentPanelId","sortDirection","typeFilter","panelFilter","folderFilter","pipe","elements","libraryPanels","totalCount","err","console","error","unsubscribe","add","subscribe","uid","e","asyncDispatcher","action","Function"],"sources":["/home/soula/grafana/public/app/features/library-panels/components/LibraryPanelsView/actions.ts"],"sourcesContent":["import { AnyAction } from '@reduxjs/toolkit';\nimport { Dispatch } from 'react';\nimport { from, merge, of, Subscription, timer } from 'rxjs';\nimport { catchError, finalize, mapTo, mergeMap, share, takeUntil } from 'rxjs/operators';\n\nimport { deleteLibraryPanel as apiDeleteLibraryPanel, getLibraryPanels } from '../../state/api';\n\nimport { initialLibraryPanelsViewState, initSearch, searchCompleted } from './reducer';\n\ntype DispatchResult = (dispatch: Dispatch<AnyAction>) => void;\ninterface SearchArgs {\n  perPage: number;\n  page: number;\n  searchString: string;\n  sortDirection?: string;\n  panelFilter?: string[];\n  folderFilter?: string[];\n  currentPanelId?: string;\n}\n\nexport function searchForLibraryPanels(args: SearchArgs): DispatchResult {\n  return function (dispatch) {\n    const subscription = new Subscription();\n    const dataObservable = from(\n      getLibraryPanels({\n        searchString: args.searchString,\n        perPage: args.perPage,\n        page: args.page,\n        excludeUid: args.currentPanelId,\n        sortDirection: args.sortDirection,\n        typeFilter: args.panelFilter,\n        folderFilter: args.folderFilter,\n      })\n    ).pipe(\n      mergeMap(({ perPage, elements: libraryPanels, page, totalCount }) =>\n        of(searchCompleted({ libraryPanels, page, perPage, totalCount }))\n      ),\n      catchError((err) => {\n        console.error(err);\n        return of(searchCompleted({ ...initialLibraryPanelsViewState, page: args.page, perPage: args.perPage }));\n      }),\n      finalize(() => subscription.unsubscribe()), // make sure we unsubscribe\n      share()\n    );\n\n    subscription.add(\n      // If 50ms without a response dispatch a loading state\n      // mapTo will translate the timer event into a loading state\n      // takeUntil will cancel the timer emit when first response is received on the dataObservable\n      merge(timer(50).pipe(mapTo(initSearch()), takeUntil(dataObservable)), dataObservable).subscribe(dispatch)\n    );\n  };\n}\n\nexport function deleteLibraryPanel(uid: string, args: SearchArgs): DispatchResult {\n  return async function (dispatch) {\n    try {\n      await apiDeleteLibraryPanel(uid);\n      searchForLibraryPanels(args)(dispatch);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n}\n\nexport function asyncDispatcher(dispatch: Dispatch<AnyAction>) {\n  return function (action: any) {\n    if (action instanceof Function) {\n      return action(dispatch);\n    }\n    return dispatch(action);\n  };\n}\n"],"mappings":"AAEA,SAASA,IAAT,EAAeC,KAAf,EAAsBC,EAAtB,EAA0BC,YAA1B,EAAwCC,KAAxC,QAAqD,MAArD;AACA,SAASC,UAAT,EAAqBC,QAArB,EAA+BC,KAA/B,EAAsCC,QAAtC,EAAgDC,KAAhD,EAAuDC,SAAvD,QAAwE,gBAAxE;AAEA,SAASC,kBAAkB,IAAIC,qBAA/B,EAAsDC,gBAAtD,QAA8E,iBAA9E;AAEA,SAASC,6BAAT,EAAwCC,UAAxC,EAAoDC,eAApD,QAA2E,WAA3E;AAaA,OAAO,SAASC,sBAAT,CAAgCC,IAAhC,EAAkE;EACvE,OAAO,UAAUC,QAAV,EAAoB;IACzB,MAAMC,YAAY,GAAG,IAAIjB,YAAJ,EAArB;IACA,MAAMkB,cAAc,GAAGrB,IAAI,CACzBa,gBAAgB,CAAC;MACfS,YAAY,EAAEJ,IAAI,CAACI,YADJ;MAEfC,OAAO,EAAEL,IAAI,CAACK,OAFC;MAGfC,IAAI,EAAEN,IAAI,CAACM,IAHI;MAIfC,UAAU,EAAEP,IAAI,CAACQ,cAJF;MAKfC,aAAa,EAAET,IAAI,CAACS,aALL;MAMfC,UAAU,EAAEV,IAAI,CAACW,WANF;MAOfC,YAAY,EAAEZ,IAAI,CAACY;IAPJ,CAAD,CADS,CAAJ,CAUrBC,IAVqB,CAWrBvB,QAAQ,CAAC,CAAC;MAAEe,OAAF;MAAWS,QAAQ,EAAEC,aAArB;MAAoCT,IAApC;MAA0CU;IAA1C,CAAD,KACPhC,EAAE,CAACc,eAAe,CAAC;MAAEiB,aAAF;MAAiBT,IAAjB;MAAuBD,OAAvB;MAAgCW;IAAhC,CAAD,CAAhB,CADI,CAXa,EAcrB7B,UAAU,CAAE8B,GAAD,IAAS;MAClBC,OAAO,CAACC,KAAR,CAAcF,GAAd;MACA,OAAOjC,EAAE,CAACc,eAAe,mBAAMF,6BAAN;QAAqCU,IAAI,EAAEN,IAAI,CAACM,IAAhD;QAAsDD,OAAO,EAAEL,IAAI,CAACK;MAApE,GAAhB,CAAT;IACD,CAHS,CAdW,EAkBrBjB,QAAQ,CAAC,MAAMc,YAAY,CAACkB,WAAb,EAAP,CAlBa,EAkBuB;IAC5C7B,KAAK,EAnBgB,CAAvB;IAsBAW,YAAY,CAACmB,GAAb,EACE;IACA;IACA;IACAtC,KAAK,CAACG,KAAK,CAAC,EAAD,CAAL,CAAU2B,IAAV,CAAexB,KAAK,CAACQ,UAAU,EAAX,CAApB,EAAoCL,SAAS,CAACW,cAAD,CAA7C,CAAD,EAAiEA,cAAjE,CAAL,CAAsFmB,SAAtF,CAAgGrB,QAAhG,CAJF;EAMD,CA9BD;AA+BD;AAED,OAAO,SAASR,kBAAT,CAA4B8B,GAA5B,EAAyCvB,IAAzC,EAA2E;EAChF,OAAO,gBAAgBC,QAAhB,EAA0B;IAC/B,IAAI;MACF,MAAMP,qBAAqB,CAAC6B,GAAD,CAA3B;MACAxB,sBAAsB,CAACC,IAAD,CAAtB,CAA6BC,QAA7B;IACD,CAHD,CAGE,OAAOuB,CAAP,EAAU;MACVN,OAAO,CAACC,KAAR,CAAcK,CAAd;IACD;EACF,CAPD;AAQD;AAED,OAAO,SAASC,eAAT,CAAyBxB,QAAzB,EAAwD;EAC7D,OAAO,UAAUyB,MAAV,EAAuB;IAC5B,IAAIA,MAAM,YAAYC,QAAtB,EAAgC;MAC9B,OAAOD,MAAM,CAACzB,QAAD,CAAb;IACD;;IACD,OAAOA,QAAQ,CAACyB,MAAD,CAAf;EACD,CALD;AAMD"},"metadata":{},"sourceType":"module"}