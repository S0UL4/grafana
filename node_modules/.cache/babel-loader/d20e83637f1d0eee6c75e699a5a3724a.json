{"ast":null,"code":"import * as d3 from 'd3';\nimport * as d3ScaleChromatic from 'd3-scale-chromatic';\nimport tinycolor from 'tinycolor2';\nimport { defaultPanelOptions, HeatmapColorMode, HeatmapColorScale } from './models.gen'; // https://observablehq.com/@d3/color-schemes?collection=@d3/d3-scale-chromatic\n// the previous heatmap panel used d3 deps and some code to interpolate to static 9-color palettes. here we just hard-code them for clarity.\n// if the need arises for configurable-sized palettes, we can bring back the deps & variable interpolation (see simplified code at end)\n// Schemes from d3-scale-chromatic\n// https://github.com/d3/d3-scale-chromatic\n\nexport const colorSchemes = [// Diverging\n{\n  name: 'BrBG',\n  invert: 'always'\n}, {\n  name: 'PiYG',\n  invert: 'always'\n}, {\n  name: 'PRGn',\n  invert: 'always'\n}, {\n  name: 'PuOr',\n  invert: 'always'\n}, {\n  name: 'RdBu',\n  invert: 'always'\n}, {\n  name: 'RdGy',\n  invert: 'always'\n}, {\n  name: 'RdYlBu',\n  invert: 'always'\n}, {\n  name: 'RdYlGn',\n  invert: 'always'\n}, {\n  name: 'Spectral',\n  invert: 'always'\n}, // Sequential (Single Hue)\n{\n  name: 'Blues',\n  invert: 'dark'\n}, {\n  name: 'Greens',\n  invert: 'dark'\n}, {\n  name: 'Greys',\n  invert: 'dark'\n}, {\n  name: 'Oranges',\n  invert: 'dark'\n}, {\n  name: 'Purples',\n  invert: 'dark'\n}, {\n  name: 'Reds',\n  invert: 'dark'\n}, // Sequential (Multi-Hue)\n{\n  name: 'Turbo',\n  invert: 'light'\n}, {\n  name: 'Cividis',\n  invert: 'light'\n}, {\n  name: 'Viridis',\n  invert: 'light'\n}, {\n  name: 'Magma',\n  invert: 'light'\n}, {\n  name: 'Inferno',\n  invert: 'light'\n}, {\n  name: 'Plasma',\n  invert: 'light'\n}, {\n  name: 'Warm',\n  invert: 'light'\n}, {\n  name: 'Cool',\n  invert: 'light'\n}, {\n  name: 'Cubehelix',\n  invert: 'light',\n  name2: 'CubehelixDefault'\n}, {\n  name: 'BuGn',\n  invert: 'dark'\n}, {\n  name: 'BuPu',\n  invert: 'dark'\n}, {\n  name: 'GnBu',\n  invert: 'dark'\n}, {\n  name: 'OrRd',\n  invert: 'dark'\n}, {\n  name: 'PuBuGn',\n  invert: 'dark'\n}, {\n  name: 'PuBu',\n  invert: 'dark'\n}, {\n  name: 'PuRd',\n  invert: 'dark'\n}, {\n  name: 'RdPu',\n  invert: 'dark'\n}, {\n  name: 'YlGnBu',\n  invert: 'dark'\n}, {\n  name: 'YlGn',\n  invert: 'dark'\n}, {\n  name: 'YlOrBr',\n  invert: 'dark'\n}, {\n  name: 'YlOrRd',\n  invert: 'dark'\n}, // Cyclical\n{\n  name: 'Rainbow',\n  invert: 'always'\n}, {\n  name: 'Sinebow',\n  invert: 'always'\n}];\nconst DEFAULT_SCHEME = colorSchemes.find(scheme => scheme.name === 'Spectral');\nexport function quantizeScheme(opts, theme) {\n  var _options$steps;\n\n  const options = Object.assign({}, defaultPanelOptions.color, opts);\n  const palette = [];\n  const steps = ((_options$steps = options.steps) !== null && _options$steps !== void 0 ? _options$steps : 128) - 1;\n\n  if (opts.mode === HeatmapColorMode.Opacity) {\n    const fill = tinycolor(theme.visualization.getColorByName(opts.fill)).toPercentageRgb();\n    const scale = options.scale === HeatmapColorScale.Exponential ? d3.scalePow().exponent(options.exponent).domain([0, 1]).range([0, 1]) : d3.scaleLinear().domain([0, 1]).range([0, 1]);\n\n    for (let i = 0; i <= steps; i++) {\n      fill.a = scale(i / steps);\n      palette.push(tinycolor(fill).toString('hex8'));\n    }\n  } else {\n    var _colorSchemes$find, _scheme$name;\n\n    const scheme = (_colorSchemes$find = colorSchemes.find(scheme => scheme.name === options.scheme)) !== null && _colorSchemes$find !== void 0 ? _colorSchemes$find : DEFAULT_SCHEME;\n    let fnName = 'interpolate' + ((_scheme$name = scheme.name2) !== null && _scheme$name !== void 0 ? _scheme$name : scheme.name);\n    const interpolate = d3ScaleChromatic[fnName];\n\n    for (let i = 0; i <= steps; i++) {\n      let rgbStr = interpolate(i / steps);\n      let rgb = rgbStr.indexOf('rgb') === 0 ? '#' + [...rgbStr.matchAll(/\\d+/g)].map(v => (+v[0]).toString(16).padStart(2, '0')).join('') : rgbStr;\n      palette.push(rgb);\n    }\n\n    if (scheme.invert === 'always' || scheme.invert === 'dark' && theme.isDark || scheme.invert === 'light' && theme.isLight) {\n      palette.reverse();\n    }\n  }\n\n  return palette;\n}","map":{"version":3,"names":["d3","d3ScaleChromatic","tinycolor","defaultPanelOptions","HeatmapColorMode","HeatmapColorScale","colorSchemes","name","invert","name2","DEFAULT_SCHEME","find","scheme","quantizeScheme","opts","theme","options","color","palette","steps","mode","Opacity","fill","visualization","getColorByName","toPercentageRgb","scale","Exponential","scalePow","exponent","domain","range","scaleLinear","i","a","push","toString","fnName","interpolate","rgbStr","rgb","indexOf","matchAll","map","v","padStart","join","isDark","isLight","reverse"],"sources":["/home/soula/grafana/public/app/plugins/panel/heatmap/palettes.ts"],"sourcesContent":["import * as d3 from 'd3';\nimport * as d3ScaleChromatic from 'd3-scale-chromatic';\nimport tinycolor from 'tinycolor2';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nimport { HeatmapColorOptions, defaultPanelOptions, HeatmapColorMode, HeatmapColorScale } from './models.gen';\n\n// https://observablehq.com/@d3/color-schemes?collection=@d3/d3-scale-chromatic\n\n// the previous heatmap panel used d3 deps and some code to interpolate to static 9-color palettes. here we just hard-code them for clarity.\n// if the need arises for configurable-sized palettes, we can bring back the deps & variable interpolation (see simplified code at end)\n\n// Schemes from d3-scale-chromatic\n// https://github.com/d3/d3-scale-chromatic\nexport const colorSchemes = [\n  // Diverging\n  { name: 'BrBG', invert: 'always' },\n  { name: 'PiYG', invert: 'always' },\n  { name: 'PRGn', invert: 'always' },\n  { name: 'PuOr', invert: 'always' },\n  { name: 'RdBu', invert: 'always' },\n  { name: 'RdGy', invert: 'always' },\n  { name: 'RdYlBu', invert: 'always' },\n  { name: 'RdYlGn', invert: 'always' },\n  { name: 'Spectral', invert: 'always' },\n\n  // Sequential (Single Hue)\n  { name: 'Blues', invert: 'dark' },\n  { name: 'Greens', invert: 'dark' },\n  { name: 'Greys', invert: 'dark' },\n  { name: 'Oranges', invert: 'dark' },\n  { name: 'Purples', invert: 'dark' },\n  { name: 'Reds', invert: 'dark' },\n\n  // Sequential (Multi-Hue)\n  { name: 'Turbo', invert: 'light' },\n  { name: 'Cividis', invert: 'light' },\n  { name: 'Viridis', invert: 'light' },\n  { name: 'Magma', invert: 'light' },\n  { name: 'Inferno', invert: 'light' },\n  { name: 'Plasma', invert: 'light' },\n  { name: 'Warm', invert: 'light' },\n  { name: 'Cool', invert: 'light' },\n  { name: 'Cubehelix', invert: 'light', name2: 'CubehelixDefault' },\n  { name: 'BuGn', invert: 'dark' },\n  { name: 'BuPu', invert: 'dark' },\n  { name: 'GnBu', invert: 'dark' },\n  { name: 'OrRd', invert: 'dark' },\n  { name: 'PuBuGn', invert: 'dark' },\n  { name: 'PuBu', invert: 'dark' },\n  { name: 'PuRd', invert: 'dark' },\n  { name: 'RdPu', invert: 'dark' },\n  { name: 'YlGnBu', invert: 'dark' },\n  { name: 'YlGn', invert: 'dark' },\n  { name: 'YlOrBr', invert: 'dark' },\n  { name: 'YlOrRd', invert: 'dark' },\n\n  // Cyclical\n  { name: 'Rainbow', invert: 'always' },\n  { name: 'Sinebow', invert: 'always' },\n];\n\ntype Interpolator = (t: number) => string;\n\nconst DEFAULT_SCHEME = colorSchemes.find((scheme) => scheme.name === 'Spectral');\n\nexport function quantizeScheme(opts: HeatmapColorOptions, theme: GrafanaTheme2): string[] {\n  const options = { ...defaultPanelOptions.color, ...opts };\n  const palette = [];\n  const steps = (options.steps ?? 128) - 1;\n\n  if (opts.mode === HeatmapColorMode.Opacity) {\n    const fill = tinycolor(theme.visualization.getColorByName(opts.fill)).toPercentageRgb();\n\n    const scale =\n      options.scale === HeatmapColorScale.Exponential\n        ? d3.scalePow().exponent(options.exponent).domain([0, 1]).range([0, 1])\n        : d3.scaleLinear().domain([0, 1]).range([0, 1]);\n\n    for (let i = 0; i <= steps; i++) {\n      fill.a = scale(i / steps);\n      palette.push(tinycolor(fill).toString('hex8'));\n    }\n  } else {\n    const scheme = colorSchemes.find((scheme) => scheme.name === options.scheme) ?? DEFAULT_SCHEME!;\n    let fnName = 'interpolate' + (scheme.name2 ?? scheme.name);\n    const interpolate: Interpolator = (d3ScaleChromatic as any)[fnName];\n\n    for (let i = 0; i <= steps; i++) {\n      let rgbStr = interpolate(i / steps);\n      let rgb =\n        rgbStr.indexOf('rgb') === 0\n          ? '#' + [...rgbStr.matchAll(/\\d+/g)].map((v) => (+v[0]).toString(16).padStart(2, '0')).join('')\n          : rgbStr;\n      palette.push(rgb);\n    }\n\n    if (\n      scheme.invert === 'always' ||\n      (scheme.invert === 'dark' && theme.isDark) ||\n      (scheme.invert === 'light' && theme.isLight)\n    ) {\n      palette.reverse();\n    }\n  }\n\n  return palette;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}