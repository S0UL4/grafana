{"ast":null,"code":"import { css } from '@emotion/css';\nimport React, { useMemo, useState } from 'react';\nimport Draggable from 'react-draggable';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport const ThresholdDragHandle = ({\n  step,\n  y,\n  dragBounds,\n  mapPositionToValue,\n  formatValue,\n  onChange\n}) => {\n  var _dragBounds$top, _dragBounds$bottom;\n\n  const theme = useTheme2();\n  let yPos = y;\n  let outOfBounds = 'none';\n\n  if (y < ((_dragBounds$top = dragBounds.top) !== null && _dragBounds$top !== void 0 ? _dragBounds$top : 0)) {\n    outOfBounds = 'top';\n  } // there seems to be a 22px offset at the bottom where the threshold line is still drawn\n  // this is probably offset by the size of the x-axis component\n\n\n  if (y > ((_dragBounds$bottom = dragBounds.bottom) !== null && _dragBounds$bottom !== void 0 ? _dragBounds$bottom : 0) + 22) {\n    outOfBounds = 'bottom';\n  }\n\n  if (outOfBounds === 'bottom') {\n    var _dragBounds$bottom2;\n\n    yPos = (_dragBounds$bottom2 = dragBounds.bottom) !== null && _dragBounds$bottom2 !== void 0 ? _dragBounds$bottom2 : y;\n  }\n\n  if (outOfBounds === 'top') {\n    var _dragBounds$top2;\n\n    yPos = (_dragBounds$top2 = dragBounds.top) !== null && _dragBounds$top2 !== void 0 ? _dragBounds$top2 : y;\n  }\n\n  const styles = useStyles2(theme => getStyles(theme, step, outOfBounds));\n  const [currentValue, setCurrentValue] = useState(step.value);\n  const textColor = useMemo(() => {\n    return theme.colors.getContrastText(theme.visualization.getColorByName(step.color));\n  }, [step.color, theme]);\n  return /*#__PURE__*/_jsx(Draggable, {\n    axis: \"y\",\n    grid: [1, 1],\n    onStop: (_e, d) => {\n      onChange(mapPositionToValue(d.lastY)); // as of https://github.com/react-grid-layout/react-draggable/issues/390#issuecomment-623237835\n\n      return false;\n    },\n    onDrag: (_e, d) => setCurrentValue(mapPositionToValue(d.lastY)),\n    position: {\n      x: 0,\n      y: yPos\n    },\n    bounds: dragBounds,\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: styles.handle,\n      style: {\n        color: textColor\n      },\n      children: /*#__PURE__*/_jsx(\"span\", {\n        className: styles.handleText,\n        children: formatValue(currentValue)\n      })\n    })\n  });\n};\nThresholdDragHandle.displayName = 'ThresholdDragHandle';\n\nconst getStyles = (theme, step, outOfBounds) => {\n  const mainColor = theme.visualization.getColorByName(step.color);\n  const arrowStyles = getArrowStyles(outOfBounds);\n  const isOutOfBounds = outOfBounds !== 'none';\n  return {\n    handle: css`\n      display: flex;\n      align-items: center;\n      position: absolute;\n      left: 0;\n      width: calc(100% - 9px);\n      height: 18px;\n      margin-top: -9px;\n      border-color: ${mainColor};\n      cursor: grab;\n      border-top-right-radius: ${theme.shape.borderRadius(1)};\n      border-bottom-right-radius: ${theme.shape.borderRadius(1)};\n      ${isOutOfBounds && css`\n        margin-top: 0;\n        border-radius: ${theme.shape.borderRadius(1)};\n      `}\n      background: ${mainColor};\n      font-size: ${theme.typography.bodySmall.fontSize};\n      &:before {\n        ${arrowStyles};\n      }\n    `,\n    handleText: css`\n      text-align: center;\n      width: 100%;\n      display: block;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      overflow: hidden;\n    `\n  };\n};\n\nfunction getArrowStyles(outOfBounds) {\n  const inBounds = outOfBounds === 'none';\n\n  const triangle = size => css`\n    content: '';\n    position: absolute;\n\n    bottom: 0;\n    top: 0;\n    width: 0;\n    height: 0;\n    left: 0;\n\n    border-right-style: solid;\n    border-right-width: ${size}px;\n    border-right-color: inherit;\n    border-top: ${size}px solid transparent;\n    border-bottom: ${size}px solid transparent;\n  `;\n\n  if (inBounds) {\n    return css`\n      ${triangle(9)};\n      left: -9px;\n    `;\n  }\n\n  if (outOfBounds === 'top') {\n    return css`\n      ${triangle(5)};\n      left: calc(50% - 2.5px);\n      top: -7px;\n      transform: rotate(90deg);\n    `;\n  }\n\n  if (outOfBounds === 'bottom') {\n    return css`\n      ${triangle(5)};\n      left: calc(50% - 2.5px);\n      top: calc(100% - 2.5px);\n      transform: rotate(-90deg);\n    `;\n  }\n\n  return '';\n}","map":{"version":3,"names":["css","React","useMemo","useState","Draggable","useStyles2","useTheme2","ThresholdDragHandle","step","y","dragBounds","mapPositionToValue","formatValue","onChange","theme","yPos","outOfBounds","top","bottom","styles","getStyles","currentValue","setCurrentValue","value","textColor","colors","getContrastText","visualization","getColorByName","color","_e","d","lastY","x","handle","handleText","displayName","mainColor","arrowStyles","getArrowStyles","isOutOfBounds","shape","borderRadius","typography","bodySmall","fontSize","inBounds","triangle","size"],"sources":["/home/soula/grafana/public/app/plugins/panel/timeseries/plugins/ThresholdDragHandle.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useMemo, useState } from 'react';\nimport Draggable, { DraggableBounds } from 'react-draggable';\n\nimport { Threshold, GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\n\ntype OutOfBounds = 'top' | 'bottom' | 'none';\n\ninterface ThresholdDragHandleProps {\n  step: Threshold;\n  y: number;\n  dragBounds: DraggableBounds;\n  mapPositionToValue: (y: number) => number;\n  onChange: (value: number) => void;\n  formatValue: (value: number) => string;\n}\n\nexport const ThresholdDragHandle: React.FC<ThresholdDragHandleProps> = ({\n  step,\n  y,\n  dragBounds,\n  mapPositionToValue,\n  formatValue,\n  onChange,\n}) => {\n  const theme = useTheme2();\n  let yPos = y;\n  let outOfBounds: OutOfBounds = 'none';\n\n  if (y < (dragBounds.top ?? 0)) {\n    outOfBounds = 'top';\n  }\n\n  // there seems to be a 22px offset at the bottom where the threshold line is still drawn\n  // this is probably offset by the size of the x-axis component\n  if (y > (dragBounds.bottom ?? 0) + 22) {\n    outOfBounds = 'bottom';\n  }\n\n  if (outOfBounds === 'bottom') {\n    yPos = dragBounds.bottom ?? y;\n  }\n\n  if (outOfBounds === 'top') {\n    yPos = dragBounds.top ?? y;\n  }\n\n  const styles = useStyles2((theme) => getStyles(theme, step, outOfBounds));\n  const [currentValue, setCurrentValue] = useState(step.value);\n\n  const textColor = useMemo(() => {\n    return theme.colors.getContrastText(theme.visualization.getColorByName(step.color));\n  }, [step.color, theme]);\n\n  return (\n    <Draggable\n      axis=\"y\"\n      grid={[1, 1]}\n      onStop={(_e, d) => {\n        onChange(mapPositionToValue(d.lastY));\n        // as of https://github.com/react-grid-layout/react-draggable/issues/390#issuecomment-623237835\n        return false;\n      }}\n      onDrag={(_e, d) => setCurrentValue(mapPositionToValue(d.lastY))}\n      position={{ x: 0, y: yPos }}\n      bounds={dragBounds}\n    >\n      <div className={styles.handle} style={{ color: textColor }}>\n        <span className={styles.handleText}>{formatValue(currentValue)}</span>\n      </div>\n    </Draggable>\n  );\n};\n\nThresholdDragHandle.displayName = 'ThresholdDragHandle';\n\nconst getStyles = (theme: GrafanaTheme2, step: Threshold, outOfBounds: OutOfBounds) => {\n  const mainColor = theme.visualization.getColorByName(step.color);\n  const arrowStyles = getArrowStyles(outOfBounds);\n  const isOutOfBounds = outOfBounds !== 'none';\n\n  return {\n    handle: css`\n      display: flex;\n      align-items: center;\n      position: absolute;\n      left: 0;\n      width: calc(100% - 9px);\n      height: 18px;\n      margin-top: -9px;\n      border-color: ${mainColor};\n      cursor: grab;\n      border-top-right-radius: ${theme.shape.borderRadius(1)};\n      border-bottom-right-radius: ${theme.shape.borderRadius(1)};\n      ${isOutOfBounds &&\n      css`\n        margin-top: 0;\n        border-radius: ${theme.shape.borderRadius(1)};\n      `}\n      background: ${mainColor};\n      font-size: ${theme.typography.bodySmall.fontSize};\n      &:before {\n        ${arrowStyles};\n      }\n    `,\n    handleText: css`\n      text-align: center;\n      width: 100%;\n      display: block;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      overflow: hidden;\n    `,\n  };\n};\n\nfunction getArrowStyles(outOfBounds: OutOfBounds) {\n  const inBounds = outOfBounds === 'none';\n\n  const triangle = (size: number) => css`\n    content: '';\n    position: absolute;\n\n    bottom: 0;\n    top: 0;\n    width: 0;\n    height: 0;\n    left: 0;\n\n    border-right-style: solid;\n    border-right-width: ${size}px;\n    border-right-color: inherit;\n    border-top: ${size}px solid transparent;\n    border-bottom: ${size}px solid transparent;\n  `;\n\n  if (inBounds) {\n    return css`\n      ${triangle(9)};\n      left: -9px;\n    `;\n  }\n\n  if (outOfBounds === 'top') {\n    return css`\n      ${triangle(5)};\n      left: calc(50% - 2.5px);\n      top: -7px;\n      transform: rotate(90deg);\n    `;\n  }\n\n  if (outOfBounds === 'bottom') {\n    return css`\n      ${triangle(5)};\n      left: calc(50% - 2.5px);\n      top: calc(100% - 2.5px);\n      transform: rotate(-90deg);\n    `;\n  }\n\n  return '';\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}