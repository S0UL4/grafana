{"ast":null,"code":"rebuildOnChange.$inject = [\"$animate\"];\nimport $ from 'jquery';\nimport coreModule from './core_module';\n\nfunction getBlockNodes(nodes) {\n  let node = nodes[0];\n  const endNode = nodes[nodes.length - 1];\n  let blockNodes;\n  node = node.nextSibling;\n\n  for (let i = 1; node !== endNode && node; i++) {\n    if (blockNodes || nodes[i] !== node) {\n      if (!blockNodes) {\n        blockNodes = $([].slice.call(nodes, 0, i));\n      }\n\n      blockNodes.push(node);\n    }\n\n    node = node.nextSibling;\n  }\n\n  return blockNodes || nodes;\n}\n/** @ngInject */\n\n\nfunction rebuildOnChange($animate) {\n  return {\n    multiElement: true,\n    terminal: true,\n    transclude: true,\n    priority: 600,\n    restrict: 'E',\n    link: (scope, elem, attrs, ctrl, transclude) => {\n      let block, childScope, previousElements;\n\n      function cleanUp() {\n        if (previousElements) {\n          previousElements.remove();\n          previousElements = null;\n        }\n\n        if (childScope) {\n          childScope.$destroy();\n          childScope = null;\n        }\n\n        if (block) {\n          previousElements = getBlockNodes(block.clone);\n          $animate.leave(previousElements).then(() => {\n            previousElements = null;\n          });\n          block = null;\n        }\n      }\n\n      scope.$watch(attrs.property, function rebuildOnChangeAction(value, oldValue) {\n        if (childScope && value !== oldValue) {\n          cleanUp();\n        }\n\n        if (!childScope && (value || attrs.showNull)) {\n          transclude((clone, newScope) => {\n            childScope = newScope;\n            clone[clone.length++] = document.createComment(' end rebuild on change ');\n            block = {\n              clone: clone\n            };\n            $animate.enter(clone, elem.parent(), elem);\n          });\n        } else {\n          cleanUp();\n        }\n      });\n    }\n  };\n}\n\ncoreModule.directive('rebuildOnChange', rebuildOnChange);","map":{"version":3,"names":["$","coreModule","getBlockNodes","nodes","node","endNode","length","blockNodes","nextSibling","i","slice","call","push","rebuildOnChange","$animate","multiElement","terminal","transclude","priority","restrict","link","scope","elem","attrs","ctrl","block","childScope","previousElements","cleanUp","remove","$destroy","clone","leave","then","$watch","property","rebuildOnChangeAction","value","oldValue","showNull","newScope","document","createComment","enter","parent","directive"],"sources":["/home/soula/grafana/public/app/angular/rebuild_on_change.ts"],"sourcesContent":["import $ from 'jquery';\n\nimport coreModule from './core_module';\n\nfunction getBlockNodes(nodes: any[]) {\n  let node = nodes[0];\n  const endNode = nodes[nodes.length - 1];\n  let blockNodes: any[] | undefined;\n  node = node.nextSibling;\n\n  for (let i = 1; node !== endNode && node; i++) {\n    if (blockNodes || nodes[i] !== node) {\n      if (!blockNodes) {\n        blockNodes = $([].slice.call(nodes, 0, i)) as any;\n      }\n\n      blockNodes!.push(node);\n    }\n    node = node.nextSibling;\n  }\n\n  return blockNodes || nodes;\n}\n\n/** @ngInject */\nfunction rebuildOnChange($animate: any) {\n  return {\n    multiElement: true,\n    terminal: true,\n    transclude: true,\n    priority: 600,\n    restrict: 'E',\n    link: (scope: any, elem: any, attrs: any, ctrl: any, transclude: any) => {\n      let block: any, childScope: any, previousElements: any;\n\n      function cleanUp() {\n        if (previousElements) {\n          previousElements.remove();\n          previousElements = null;\n        }\n        if (childScope) {\n          childScope.$destroy();\n          childScope = null;\n        }\n        if (block) {\n          previousElements = getBlockNodes(block.clone);\n          $animate.leave(previousElements).then(() => {\n            previousElements = null;\n          });\n          block = null;\n        }\n      }\n\n      scope.$watch(attrs.property, function rebuildOnChangeAction(value: any, oldValue: any) {\n        if (childScope && value !== oldValue) {\n          cleanUp();\n        }\n\n        if (!childScope && (value || attrs.showNull)) {\n          transclude((clone: any, newScope: any) => {\n            childScope = newScope;\n            clone[clone.length++] = document.createComment(' end rebuild on change ');\n            block = { clone: clone };\n            $animate.enter(clone, elem.parent(), elem);\n          });\n        } else {\n          cleanUp();\n        }\n      });\n    },\n  };\n}\n\ncoreModule.directive('rebuildOnChange', rebuildOnChange);\n"],"mappings":";AAAA,OAAOA,CAAP,MAAc,QAAd;AAEA,OAAOC,UAAP,MAAuB,eAAvB;;AAEA,SAASC,aAAT,CAAuBC,KAAvB,EAAqC;EACnC,IAAIC,IAAI,GAAGD,KAAK,CAAC,CAAD,CAAhB;EACA,MAAME,OAAO,GAAGF,KAAK,CAACA,KAAK,CAACG,MAAN,GAAe,CAAhB,CAArB;EACA,IAAIC,UAAJ;EACAH,IAAI,GAAGA,IAAI,CAACI,WAAZ;;EAEA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBL,IAAI,KAAKC,OAAT,IAAoBD,IAApC,EAA0CK,CAAC,EAA3C,EAA+C;IAC7C,IAAIF,UAAU,IAAIJ,KAAK,CAACM,CAAD,CAAL,KAAaL,IAA/B,EAAqC;MACnC,IAAI,CAACG,UAAL,EAAiB;QACfA,UAAU,GAAGP,CAAC,CAAC,GAAGU,KAAH,CAASC,IAAT,CAAcR,KAAd,EAAqB,CAArB,EAAwBM,CAAxB,CAAD,CAAd;MACD;;MAEDF,UAAU,CAAEK,IAAZ,CAAiBR,IAAjB;IACD;;IACDA,IAAI,GAAGA,IAAI,CAACI,WAAZ;EACD;;EAED,OAAOD,UAAU,IAAIJ,KAArB;AACD;AAED;;;AACA,SAASU,eAAT,CAAyBC,QAAzB,EAAwC;EACtC,OAAO;IACLC,YAAY,EAAE,IADT;IAELC,QAAQ,EAAE,IAFL;IAGLC,UAAU,EAAE,IAHP;IAILC,QAAQ,EAAE,GAJL;IAKLC,QAAQ,EAAE,GALL;IAMLC,IAAI,EAAE,CAACC,KAAD,EAAaC,IAAb,EAAwBC,KAAxB,EAAoCC,IAApC,EAA+CP,UAA/C,KAAmE;MACvE,IAAIQ,KAAJ,EAAgBC,UAAhB,EAAiCC,gBAAjC;;MAEA,SAASC,OAAT,GAAmB;QACjB,IAAID,gBAAJ,EAAsB;UACpBA,gBAAgB,CAACE,MAAjB;UACAF,gBAAgB,GAAG,IAAnB;QACD;;QACD,IAAID,UAAJ,EAAgB;UACdA,UAAU,CAACI,QAAX;UACAJ,UAAU,GAAG,IAAb;QACD;;QACD,IAAID,KAAJ,EAAW;UACTE,gBAAgB,GAAGzB,aAAa,CAACuB,KAAK,CAACM,KAAP,CAAhC;UACAjB,QAAQ,CAACkB,KAAT,CAAeL,gBAAf,EAAiCM,IAAjC,CAAsC,MAAM;YAC1CN,gBAAgB,GAAG,IAAnB;UACD,CAFD;UAGAF,KAAK,GAAG,IAAR;QACD;MACF;;MAEDJ,KAAK,CAACa,MAAN,CAAaX,KAAK,CAACY,QAAnB,EAA6B,SAASC,qBAAT,CAA+BC,KAA/B,EAA2CC,QAA3C,EAA0D;QACrF,IAAIZ,UAAU,IAAIW,KAAK,KAAKC,QAA5B,EAAsC;UACpCV,OAAO;QACR;;QAED,IAAI,CAACF,UAAD,KAAgBW,KAAK,IAAId,KAAK,CAACgB,QAA/B,CAAJ,EAA8C;UAC5CtB,UAAU,CAAC,CAACc,KAAD,EAAaS,QAAb,KAA+B;YACxCd,UAAU,GAAGc,QAAb;YACAT,KAAK,CAACA,KAAK,CAACzB,MAAN,EAAD,CAAL,GAAwBmC,QAAQ,CAACC,aAAT,CAAuB,yBAAvB,CAAxB;YACAjB,KAAK,GAAG;cAAEM,KAAK,EAAEA;YAAT,CAAR;YACAjB,QAAQ,CAAC6B,KAAT,CAAeZ,KAAf,EAAsBT,IAAI,CAACsB,MAAL,EAAtB,EAAqCtB,IAArC;UACD,CALS,CAAV;QAMD,CAPD,MAOO;UACLM,OAAO;QACR;MACF,CAfD;IAgBD;EA3CI,CAAP;AA6CD;;AAED3B,UAAU,CAAC4C,SAAX,CAAqB,iBAArB,EAAwChC,eAAxC"},"metadata":{},"sourceType":"module"}