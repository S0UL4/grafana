{"ast":null,"code":"var _span, _span2;\n\nimport { css } from '@emotion/css';\nimport React, { useEffect } from 'react';\nimport { config } from '@grafana/runtime';\nimport { stylesFactory, useTheme, Select, MultiSelect, FilterInput, Button } from '@grafana/ui';\nimport { createDatasourcesList, SortOrder } from 'app/core/utils/richHistory';\nimport { getSortOrderOptions } from './RichHistory';\nimport RichHistoryCard from './RichHistoryCard';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nconst getStyles = stylesFactory(theme => {\n  const bgColor = theme.isLight ? theme.palette.gray5 : theme.palette.dark4;\n  return {\n    container: css`\n      display: flex;\n    `,\n    containerContent: css`\n      width: 100%;\n    `,\n    selectors: css`\n      display: flex;\n      justify-content: space-between;\n      flex-wrap: wrap;\n    `,\n    multiselect: css`\n      width: 100%;\n      margin-bottom: ${theme.spacing.sm};\n      .gf-form-select-box__multi-value {\n        background-color: ${bgColor};\n        padding: ${theme.spacing.xxs} ${theme.spacing.xs} ${theme.spacing.xxs} ${theme.spacing.sm};\n        border-radius: ${theme.border.radius.sm};\n      }\n    `,\n    filterInput: css`\n      margin-bottom: ${theme.spacing.sm};\n    `,\n    sort: css`\n      width: 170px;\n    `,\n    footer: css`\n      height: 60px;\n      margin-top: ${theme.spacing.lg};\n      display: flex;\n      justify-content: center;\n      font-weight: ${theme.typography.weight.light};\n      font-size: ${theme.typography.size.sm};\n      a {\n        font-weight: ${theme.typography.weight.semibold};\n        margin-left: ${theme.spacing.xxs};\n      }\n    `\n  };\n});\nexport function RichHistoryStarredTab(props) {\n  const {\n    updateFilters,\n    clearRichHistoryResults,\n    loadMoreRichHistory,\n    activeDatasourceInstance,\n    richHistorySettings,\n    queries,\n    totalQueries,\n    loading,\n    richHistorySearchFilters,\n    exploreId\n  } = props;\n  const theme = useTheme();\n  const styles = getStyles(theme);\n  const listOfDatasources = createDatasourcesList();\n  useEffect(() => {\n    const datasourceFilters = richHistorySettings.activeDatasourceOnly && richHistorySettings.lastUsedDatasourceFilters ? richHistorySettings.lastUsedDatasourceFilters : [activeDatasourceInstance];\n    const filters = {\n      search: '',\n      sortOrder: SortOrder.Descending,\n      datasourceFilters,\n      from: 0,\n      to: richHistorySettings.retentionPeriod,\n      starred: true\n    };\n    updateFilters(filters);\n    return () => {\n      clearRichHistoryResults();\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  if (!richHistorySearchFilters) {\n    return _span || (_span = /*#__PURE__*/_jsx(\"span\", {\n      children: \"Loading...\"\n    }));\n  }\n\n  const sortOrderOptions = getSortOrderOptions();\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: styles.container,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.containerContent,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: styles.selectors,\n        children: [!richHistorySettings.activeDatasourceOnly && /*#__PURE__*/_jsx(MultiSelect, {\n          className: styles.multiselect,\n          options: listOfDatasources.map(ds => {\n            return {\n              value: ds.name,\n              label: ds.name\n            };\n          }),\n          value: richHistorySearchFilters.datasourceFilters,\n          placeholder: \"Filter queries for data sources(s)\",\n          \"aria-label\": \"Filter queries for data sources(s)\",\n          onChange: options => {\n            updateFilters({\n              datasourceFilters: options.map(option => option.value)\n            });\n          }\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.filterInput,\n          children: /*#__PURE__*/_jsx(FilterInput, {\n            placeholder: \"Search queries\",\n            value: richHistorySearchFilters.search,\n            onChange: search => updateFilters({\n              search\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          \"aria-label\": \"Sort queries\",\n          className: styles.sort,\n          children: /*#__PURE__*/_jsx(Select, {\n            value: sortOrderOptions.filter(order => order.value === richHistorySearchFilters.sortOrder),\n            options: sortOrderOptions,\n            placeholder: \"Sort queries by\",\n            onChange: e => updateFilters({\n              sortOrder: e.value\n            })\n          })\n        })]\n      }), loading && (_span2 || (_span2 = /*#__PURE__*/_jsx(\"span\", {\n        children: \"Loading results...\"\n      }))), !loading && queries.map(q => {\n        const idx = listOfDatasources.findIndex(d => d.name === q.datasourceName);\n        return /*#__PURE__*/_jsx(RichHistoryCard, {\n          query: q,\n          exploreId: exploreId,\n          dsImg: idx === -1 ? 'public/img/icn-datasource.svg' : listOfDatasources[idx].imgUrl,\n          isRemoved: idx === -1\n        }, q.id);\n      }), queries.length && queries.length !== totalQueries ? /*#__PURE__*/_jsxs(\"div\", {\n        children: [\"Showing \", queries.length, \" of \", totalQueries, \" \", /*#__PURE__*/_jsx(Button, {\n          onClick: loadMoreRichHistory,\n          children: \"Load more\"\n        })]\n      }) : null, /*#__PURE__*/_jsx(\"div\", {\n        className: styles.footer,\n        children: !config.queryHistoryEnabled ? 'The history is local to your browser and is not shared with others.' : ''\n      })]\n    })\n  });\n}","map":{"version":3,"names":["css","React","useEffect","config","stylesFactory","useTheme","Select","MultiSelect","FilterInput","Button","createDatasourcesList","SortOrder","getSortOrderOptions","RichHistoryCard","getStyles","theme","bgColor","isLight","palette","gray5","dark4","container","containerContent","selectors","multiselect","spacing","sm","xxs","xs","border","radius","filterInput","sort","footer","lg","typography","weight","light","size","semibold","RichHistoryStarredTab","props","updateFilters","clearRichHistoryResults","loadMoreRichHistory","activeDatasourceInstance","richHistorySettings","queries","totalQueries","loading","richHistorySearchFilters","exploreId","styles","listOfDatasources","datasourceFilters","activeDatasourceOnly","lastUsedDatasourceFilters","filters","search","sortOrder","Descending","from","to","retentionPeriod","starred","sortOrderOptions","map","ds","value","name","label","options","option","filter","order","e","q","idx","findIndex","d","datasourceName","imgUrl","id","length","queryHistoryEnabled"],"sources":["/home/soula/grafana/public/app/features/explore/RichHistory/RichHistoryStarredTab.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useEffect } from 'react';\n\nimport { GrafanaTheme, SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { stylesFactory, useTheme, Select, MultiSelect, FilterInput, Button } from '@grafana/ui';\nimport {\n  createDatasourcesList,\n  SortOrder,\n  RichHistorySearchFilters,\n  RichHistorySettings,\n} from 'app/core/utils/richHistory';\nimport { RichHistoryQuery, ExploreId } from 'app/types/explore';\n\nimport { getSortOrderOptions } from './RichHistory';\nimport RichHistoryCard from './RichHistoryCard';\n\nexport interface Props {\n  queries: RichHistoryQuery[];\n  totalQueries: number;\n  loading: boolean;\n  activeDatasourceInstance: string;\n  updateFilters: (filtersToUpdate: Partial<RichHistorySearchFilters>) => void;\n  clearRichHistoryResults: () => void;\n  loadMoreRichHistory: () => void;\n  richHistorySearchFilters?: RichHistorySearchFilters;\n  richHistorySettings: RichHistorySettings;\n  exploreId: ExploreId;\n}\n\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\n  const bgColor = theme.isLight ? theme.palette.gray5 : theme.palette.dark4;\n  return {\n    container: css`\n      display: flex;\n    `,\n    containerContent: css`\n      width: 100%;\n    `,\n    selectors: css`\n      display: flex;\n      justify-content: space-between;\n      flex-wrap: wrap;\n    `,\n    multiselect: css`\n      width: 100%;\n      margin-bottom: ${theme.spacing.sm};\n      .gf-form-select-box__multi-value {\n        background-color: ${bgColor};\n        padding: ${theme.spacing.xxs} ${theme.spacing.xs} ${theme.spacing.xxs} ${theme.spacing.sm};\n        border-radius: ${theme.border.radius.sm};\n      }\n    `,\n    filterInput: css`\n      margin-bottom: ${theme.spacing.sm};\n    `,\n    sort: css`\n      width: 170px;\n    `,\n    footer: css`\n      height: 60px;\n      margin-top: ${theme.spacing.lg};\n      display: flex;\n      justify-content: center;\n      font-weight: ${theme.typography.weight.light};\n      font-size: ${theme.typography.size.sm};\n      a {\n        font-weight: ${theme.typography.weight.semibold};\n        margin-left: ${theme.spacing.xxs};\n      }\n    `,\n  };\n});\n\nexport function RichHistoryStarredTab(props: Props) {\n  const {\n    updateFilters,\n    clearRichHistoryResults,\n    loadMoreRichHistory,\n    activeDatasourceInstance,\n    richHistorySettings,\n    queries,\n    totalQueries,\n    loading,\n    richHistorySearchFilters,\n    exploreId,\n  } = props;\n\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  const listOfDatasources = createDatasourcesList();\n\n  useEffect(() => {\n    const datasourceFilters =\n      richHistorySettings.activeDatasourceOnly && richHistorySettings.lastUsedDatasourceFilters\n        ? richHistorySettings.lastUsedDatasourceFilters\n        : [activeDatasourceInstance];\n    const filters: RichHistorySearchFilters = {\n      search: '',\n      sortOrder: SortOrder.Descending,\n      datasourceFilters,\n      from: 0,\n      to: richHistorySettings.retentionPeriod,\n      starred: true,\n    };\n    updateFilters(filters);\n    return () => {\n      clearRichHistoryResults();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  if (!richHistorySearchFilters) {\n    return <span>Loading...</span>;\n  }\n\n  const sortOrderOptions = getSortOrderOptions();\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.containerContent}>\n        <div className={styles.selectors}>\n          {!richHistorySettings.activeDatasourceOnly && (\n            <MultiSelect\n              className={styles.multiselect}\n              options={listOfDatasources.map((ds) => {\n                return { value: ds.name, label: ds.name };\n              })}\n              value={richHistorySearchFilters.datasourceFilters}\n              placeholder=\"Filter queries for data sources(s)\"\n              aria-label=\"Filter queries for data sources(s)\"\n              onChange={(options: SelectableValue[]) => {\n                updateFilters({ datasourceFilters: options.map((option) => option.value) });\n              }}\n            />\n          )}\n          <div className={styles.filterInput}>\n            <FilterInput\n              placeholder=\"Search queries\"\n              value={richHistorySearchFilters.search}\n              onChange={(search: string) => updateFilters({ search })}\n            />\n          </div>\n          <div aria-label=\"Sort queries\" className={styles.sort}>\n            <Select\n              value={sortOrderOptions.filter((order) => order.value === richHistorySearchFilters.sortOrder)}\n              options={sortOrderOptions}\n              placeholder=\"Sort queries by\"\n              onChange={(e: SelectableValue<SortOrder>) => updateFilters({ sortOrder: e.value })}\n            />\n          </div>\n        </div>\n        {loading && <span>Loading results...</span>}\n        {!loading &&\n          queries.map((q) => {\n            const idx = listOfDatasources.findIndex((d) => d.name === q.datasourceName);\n            return (\n              <RichHistoryCard\n                query={q}\n                key={q.id}\n                exploreId={exploreId}\n                dsImg={idx === -1 ? 'public/img/icn-datasource.svg' : listOfDatasources[idx].imgUrl}\n                isRemoved={idx === -1}\n              />\n            );\n          })}\n        {queries.length && queries.length !== totalQueries ? (\n          <div>\n            Showing {queries.length} of {totalQueries} <Button onClick={loadMoreRichHistory}>Load more</Button>\n          </div>\n        ) : null}\n        <div className={styles.footer}>\n          {!config.queryHistoryEnabled ? 'The history is local to your browser and is not shared with others.' : ''}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}